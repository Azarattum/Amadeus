var Zo=Object.defineProperty;var ea=(m,f,p)=>f in m?Zo(m,f,{enumerable:!0,configurable:!0,writable:!0,value:p}):m[f]=p;var Oe=(m,f,p)=>(ea(m,typeof f!="symbol"?f+"":f,p),p),Di=(m,f,p)=>{if(!f.has(m))throw TypeError("Cannot "+p)};var N=(m,f,p)=>(Di(m,f,"read from private field"),p?p.call(m):f.get(m)),B=(m,f,p)=>{if(f.has(m))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(m):f.set(m,p)},H=(m,f,p,y)=>(Di(m,f,"write to private field"),y?y.call(m,p):f.set(m,p),p);var Ne=(m,f,p)=>(Di(m,f,"access private method"),p);import{S as SvelteComponent,i as init$1,s as safe_not_equal,F as create_slot,k as element,l as claim_element,m as children,h as detach,n as attr,M as toggle_class,b as insert_hydration,G as update_slot_base,H as get_all_dirty_from_scope,I as get_slot_changes,g as transition_in,d as transition_out,X as setContext,e as empty$1,v as group_outros,O as noop$2,f as check_outros,J as getContext,a as space,c as claim_space,p as set_style,D as append_hydration,L as listen,U as action_destroyer,R as update_keyed_each,W as outro_and_destroy_block,$ as run_all,E as component_subscribe,a4 as createEventDispatcher,o as onMount,t as tick,af as globals,y as create_component,z as claim_component,A as mount_component,B as destroy_component,N as set_store_value,w as binding_callbacks,P as compute_slots,a5 as assign$1,ae as set_dynamic_element_data,a6 as get_spread_update,Y as bubble,ac as src_url_equal,q as text,r as claim_text,u as set_data}from"./index.84a1bd3e.js";import{w as writable,d as derived}from"./paths.5d1d0ced.js";import{l as lock,a as unlock,g as getScrollParent,p as position$1,d as debounce,I as Icon}from"./Spinner.svelte_svelte_type_style_lang.68398dd0.js";import{g as getDefaultExportFromCjs}from"./_commonjsHelpers.39b5b250.js";const observers=new Map,dispatch$1=m=>m.forEach(f=>{var p,y;(p=f.target)==null||p.dispatchEvent(new CustomEvent("intersect",{detail:f})),(y=f.target)==null||y.dispatchEvent(new CustomEvent(f.isIntersecting?"viewenter":"viewleave",{detail:f}))});function intersection(m,f){const p=(f==null?void 0:f.toString())||"",y=observers.get(p)||[new IntersectionObserver(dispatch$1,{threshold:f}),0];return observers.has(p)||observers.set(p,y),y[0].observe(m),y[1]+=1,{destroy(){y[0].unobserve(m),y[1]-=1,y[1]<=0&&(y[0].disconnect(),observers.delete(p))}}}let observing=0,observer=null;const dispatch=m=>m.forEach(f=>{var p;(p=f.target)==null||p.dispatchEvent(new CustomEvent("resize",{detail:f}))});function resize(m){return observer||(observer=new ResizeObserver(dispatch)),observer.observe(m),observing+=1,{destroy(){observer==null||observer.unobserve(m),observing-=1,observing<=0&&(observer==null||observer.disconnect(),observer=null)}}}function drag(m,f="touchstart"){function p(_){do{if(_!=null&&_.draggable)return _;_=(_==null?void 0:_.parentElement)||null}while(_);return null}function y(_){const v=p(_.target);v&&(lock(),_.preventDefault(),v.dispatchEvent(new DragEvent("dragstart",{bubbles:!0})))}function b(_){_.preventDefault(),addEventListener("pointercancel",E),addEventListener("pointerup",E)}function E(){unlock(),removeEventListener("pointercancel",E),removeEventListener("pointerup",E),m.dispatchEvent(new DragEvent("dragend",{bubbles:!0}))}return m.addEventListener(f,y),m.addEventListener("dragstart",b),{destroy(){m.removeEventListener(f,y),m.removeEventListener("dragstart",b)}}}function hold(m,{touch:f=!0,mouse:p=!1,duration:y=300}={}){function b(E){const _=setTimeout(()=>{var S;v();const I=E instanceof TouchEvent?TouchEvent:MouseEvent;(S=E.target)==null||S.dispatchEvent(new I("hold",E))},y),v=()=>{clearTimeout(_),f&&(m.removeEventListener("touchcancel",v),m.removeEventListener("touchmove",v),m.removeEventListener("touchend",v)),p&&(m.removeEventListener("mousemove",v),m.removeEventListener("mouseup",v))};f&&(m.addEventListener("touchcancel",v,{once:!0}),m.addEventListener("touchend",v,{once:!0}),m.addEventListener("touchmove",v,{once:!0,passive:!0})),p&&(m.addEventListener("mousemove",v,{once:!0}),m.addEventListener("mouseup",v,{once:!0}))}return f&&m.addEventListener("touchstart",b,{passive:!0}),p&&m.addEventListener("mousedown",b),{destroy(){m.removeEventListener("touchstart",b),m.removeEventListener("mousedown",b)}}}function create_fragment$7(m){let f,p,y;const b=m[6].default,E=create_slot(b,m,m[5],null);return{c(){f=element("div"),E&&E.c(),this.h()},l(_){f=claim_element(_,"DIV",{class:!0});var v=children(f);E&&E.l(v),v.forEach(detach),this.h()},h(){attr(f,"class",p=m[0]?"contents":"hidden"),toggle_class(f,"sm:contents",!m[0]&&m[1]),toggle_class(f,"md:contents",!m[0]&&m[2]),toggle_class(f,"lg:contents",!m[0]&&m[3]),toggle_class(f,"xl:contents",!m[0]&&m[4]),toggle_class(f,"sm:hidden",m[0]&&m[1]),toggle_class(f,"md:hidden",m[0]&&m[2]),toggle_class(f,"lg:hidden",m[0]&&m[3]),toggle_class(f,"xl:hidden",m[0]&&m[4])},m(_,v){insert_hydration(_,f,v),E&&E.m(f,null),y=!0},p(_,[v]){E&&E.p&&(!y||v&32)&&update_slot_base(E,b,_,_[5],y?get_slot_changes(b,_[5],v,null):get_all_dirty_from_scope(_[5]),null),(!y||v&1&&p!==(p=_[0]?"contents":"hidden"))&&attr(f,"class",p),(!y||v&3)&&toggle_class(f,"sm:contents",!_[0]&&_[1]),(!y||v&5)&&toggle_class(f,"md:contents",!_[0]&&_[2]),(!y||v&9)&&toggle_class(f,"lg:contents",!_[0]&&_[3]),(!y||v&17)&&toggle_class(f,"xl:contents",!_[0]&&_[4]),(!y||v&3)&&toggle_class(f,"sm:hidden",_[0]&&_[1]),(!y||v&5)&&toggle_class(f,"md:hidden",_[0]&&_[2]),(!y||v&9)&&toggle_class(f,"lg:hidden",_[0]&&_[3]),(!y||v&17)&&toggle_class(f,"xl:hidden",_[0]&&_[4])},i(_){y||(transition_in(E,_),y=!0)},o(_){transition_out(E,_),y=!1},d(_){_&&detach(f),E&&E.d(_)}}}function instance$8(m,f,p){let{$$slots:y={},$$scope:b}=f,{not:E=!1}=f,{sm:_=!1}=f,{md:v=!1}=f,{lg:I=!1}=f,{xl:S=!1}=f;return m.$$set=C=>{"not"in C&&p(0,E=C.not),"sm"in C&&p(1,_=C.sm),"md"in C&&p(2,v=C.md),"lg"in C&&p(3,I=C.lg),"xl"in C&&p(4,S=C.xl),"$$scope"in C&&p(5,b=C.$$scope)},[E,_,v,I,S,b,y]}class When extends SvelteComponent{constructor(f){super(),init$1(this,f,instance$8,create_fragment$7,safe_not_equal,{not:0,sm:1,md:2,lg:3,xl:4})}}function create_fragment$6(m){let f;const p=m[1].default,y=create_slot(p,m,m[0],null);return{c(){y&&y.c()},l(b){y&&y.l(b)},m(b,E){y&&y.m(b,E),f=!0},p(b,[E]){y&&y.p&&(!f||E&1)&&update_slot_base(y,p,b,b[0],f?get_slot_changes(p,b[0],E,null):get_all_dirty_from_scope(b[0]),null)},i(b){f||(transition_in(y,b),f=!0)},o(b){transition_out(y,b),f=!1},d(b){y&&y.d(b)}}}const initRealm=()=>({ssr:"",claimed:new Set,mounted:new Set,claim:new Set,destroy:new Set,mount:new Set,target:void 0});function instance$7(m,f,p){let{$$slots:y={},$$scope:b}=f;return setContext("realm",{}),m.$$set=_=>{"$$scope"in _&&p(0,b=_.$$scope)},[b,y]}class Realm extends SvelteComponent{constructor(f){super(),init$1(this,f,instance$7,create_fragment$6,safe_not_equal,{})}}function create_key_block(m){let f;const p=m[4].default,y=create_slot(p,m,m[3],null);return{c(){y&&y.c()},l(b){y&&y.l(b)},m(b,E){y&&y.m(b,E),f=!0},p(b,E){y&&y.p&&(!f||E&8)&&update_slot_base(y,p,b,b[3],f?get_slot_changes(p,b[3],E,null):get_all_dirty_from_scope(b[3]),null)},i(b){f||(transition_in(y,b),f=!0)},o(b){transition_out(y,b),f=!1},d(b){y&&y.d(b)}}}function create_fragment$5(m){let f=m[0],p,y,b=create_key_block(m);return{c(){b.c(),p=empty$1()},l(E){b.l(E),p=empty$1()},m(E,_){b.m(E,_),insert_hydration(E,p,_),y=!0},p(E,[_]){_&1&&safe_not_equal(f,f=E[0])?(group_outros(),transition_out(b,1,1,noop$2),check_outros(),b=create_key_block(E),b.c(),transition_in(b,1),b.m(p.parentNode,p)):b.p(E,_)},i(E){y||(transition_in(b),y=!0)},o(E){transition_out(b),y=!1},d(E){E&&detach(p),b.d(E)}}}function instance$6($$self,$$props,$$invalidate){let{$$slots:slots={},$$scope}=$$props,{to=""}=$$props,{unique=""}=$$props;const realm=getContext("realm");if(!realm)throw new Error("A portal should exists within a realm!");realm[to]||(realm[to]=initRealm());const target=eval("slots");if(target.default){const[m]=target.default;target.default[0]=(...f)=>{const p=m(...f),y=realm[to];let b=!0,E=!0;function _(S){if(!S||y.claimed.has(unique))return E=!1;p.l(S),unique&&y.claimed.add(unique)}function v(S,C){if(y.mounted.has(unique))return b=!1;E&&p.m(S,C),unique&&y.mounted.add(unique)}function I(S){b&&y.mounted.delete(unique),E&&y.claimed.delete(unique),b&&p.d(S),y.claim.delete(_),y.mount.delete(v),y.destroy.delete(I)}return y.claim.add(_),y.mount.add(v),y.destroy.add(I),{...p,d:I,l:()=>{},m:()=>y.target&&v.apply(null,y.target)}}}return $$self.$$set=m=>{"to"in m&&$$invalidate(0,to=m.to),"unique"in m&&$$invalidate(1,unique=m.unique),"$$scope"in m&&$$invalidate(3,$$scope=m.$$scope)},$$self.$$.update=()=>{$$self.$$.dirty&5&&(realm[to]||$$invalidate(2,realm[to]=initRealm(),realm))},[to,unique,realm,$$scope,slots]}class Portal extends SvelteComponent{constructor(f){super(),init$1(this,f,instance$6,create_fragment$5,safe_not_equal,{to:0,unique:1})}}function minmax(m,f,p,y){return m<f?y??f:m>p?y??p:m}const{Map:Map_1}=globals,get_default_slot_changes_1=m=>({item:m[0]&4096}),get_default_slot_context_1=m=>({item:m[12].data,index:NaN});function get_each_context(m,f,p){const y=m.slice();return y[53]=f[p],y[55]=p,y}const get_default_slot_changes$1=m=>({item:m[0]&65536,index:m[0]&66560}),get_default_slot_context$1=m=>({item:m[53],index:m[10]+m[55]});function create_each_block(m,f){let p,y,b,E;const _=f[37].default,v=create_slot(_,f,f[41],get_default_slot_context$1);return{key:m,first:null,c(){p=element("div"),v&&v.c(),y=space(),this.h()},l(I){p=claim_element(I,"DIV",{draggable:!0,style:!0});var S=children(p);v&&v.l(S),y=claim_space(S),S.forEach(detach),this.h()},h(){var I,S;attr(p,"draggable",b=f[3]&&f[2](f[53])!=null?"true":void 0),set_style(p,"overflow-anchor","none"),toggle_class(p,"invisible",((I=f[12])==null?void 0:I.owner)===f[4]&&((S=f[12])==null?void 0:S.key)===f[2](f[53])),this.first=p},m(I,S){insert_hydration(I,p,S),v&&v.m(p,null),append_hydration(p,y),E=!0},p(I,S){var C,W;f=I,v&&v.p&&(!E||S[0]&66560|S[1]&1024)&&update_slot_base(v,_,f,f[41],E?get_slot_changes(_,f[41],S,get_default_slot_changes$1):get_all_dirty_from_scope(f[41]),get_default_slot_context$1),(!E||S[0]&65548&&b!==(b=f[3]&&f[2](f[53])!=null?"true":void 0))&&attr(p,"draggable",b),(!E||S[0]&69652)&&toggle_class(p,"invisible",((C=f[12])==null?void 0:C.owner)===f[4]&&((W=f[12])==null?void 0:W.key)===f[2](f[53]))},i(I){E||(transition_in(v,I),E=!0)},o(I){transition_out(v,I),E=!1},d(I){I&&detach(p),v&&v.d(I)}}}function create_if_block$3(m){let f,p;return f=new Portal({props:{to:"overlay",$$slots:{default:[create_default_slot$1]},$$scope:{ctx:m}}}),{c(){create_component(f.$$.fragment)},l(y){claim_component(f.$$.fragment,y)},m(y,b){mount_component(f,y,b),p=!0},p(y,b){const E={};b[0]&4849|b[1]&1024&&(E.$$scope={dirty:b,ctx:y}),f.$set(E)},i(y){p||(transition_in(f.$$.fragment,y),p=!0)},o(y){transition_out(f.$$.fragment,y),p=!1},d(y){destroy_component(f,y)}}}function create_if_block_1$2(m){let f,p=`translate3d(
          ${m[12].back?m[12].back.x:m[9].x+Math.max(m[12].offset.x,-m[5].width/m[7]+m[0])}px,
          ${m[12].back?m[12].back.y:m[9].y+Math.max(m[12].offset.y,-m[6]+m[0])}px, 0)`,y=`${m[5].width/m[7]-m[0]}px`,b=`${m[6]-m[0]}px`,E;const _=m[37].default,v=create_slot(_,m,m[41],get_default_slot_context_1);return{c(){f=element("div"),v&&v.c(),this.h()},l(I){f=claim_element(I,"DIV",{class:!0});var S=children(f);v&&v.l(S),S.forEach(detach),this.h()},h(){attr(f,"class","absolute will-change-transform contain-[size_layout]"),toggle_class(f,"transition-transform",m[12].back),set_style(f,"transform",p),set_style(f,"width",y),set_style(f,"height",b)},m(I,S){insert_hydration(I,f,S),v&&v.m(f,null),E=!0},p(I,S){v&&v.p&&(!E||S[0]&4096|S[1]&1024)&&update_slot_base(v,_,I,I[41],E?get_slot_changes(_,I[41],S,get_default_slot_changes_1):get_all_dirty_from_scope(I[41]),get_default_slot_context_1),(!E||S[0]&4096)&&toggle_class(f,"transition-transform",I[12].back),S[0]&4833&&p!==(p=`translate3d(
          ${I[12].back?I[12].back.x:I[9].x+Math.max(I[12].offset.x,-I[5].width/I[7]+I[0])}px,
          ${I[12].back?I[12].back.y:I[9].y+Math.max(I[12].offset.y,-I[6]+I[0])}px, 0)`)&&set_style(f,"transform",p),S[0]&161&&y!==(y=`${I[5].width/I[7]-I[0]}px`)&&set_style(f,"width",y),S[0]&65&&b!==(b=`${I[6]-I[0]}px`)&&set_style(f,"height",b)},i(I){E||(transition_in(v,I),E=!0)},o(I){transition_out(v,I),E=!1},d(I){I&&detach(f),v&&v.d(I)}}}function create_default_slot$1(m){var b;let f,p,y=((b=m[12])==null?void 0:b.owner)===m[4]&&create_if_block_1$2(m);return{c(){y&&y.c(),f=empty$1()},l(E){y&&y.l(E),f=empty$1()},m(E,_){y&&y.m(E,_),insert_hydration(E,f,_),p=!0},p(E,_){var v;((v=E[12])==null?void 0:v.owner)===E[4]?y?(y.p(E,_),_[0]&4112&&transition_in(y,1)):(y=create_if_block_1$2(E),y.c(),transition_in(y,1),y.m(f.parentNode,f)):y&&(group_outros(),transition_out(y,1,1,()=>{y=null}),check_outros())},i(E){p||(transition_in(y),p=!0)},o(E){transition_out(y),p=!1},d(E){y&&y.d(E),E&&detach(f)}}}function create_fragment$4(m){let f,p,y,b=`translateY(${+!!m[8]*m[1]*100}%)`,E=`${m[14]}px`,_,v=[],I=new Map_1,S=`translate3d(0,${Math.ceil(m[10]/m[7])*m[6]}px,0)`,C=`${m[0]}px`,W,$=`${m[11]}px`,P,U,R,A=m[16];const x=q=>q[2](q[53])==null?q[55]:q[2](q[53]);for(let q=0;q<A.length;q+=1){let V=get_each_context(m,A,q),Y=x(V);I.set(Y,v[q]=create_each_block(Y,V))}let D=m[3]&&create_if_block$3(m);return{c(){f=element("div"),p=element("div"),y=element("div"),_=space();for(let q=0;q<v.length;q+=1)v[q].c();W=space(),D&&D.c(),this.h()},l(q){f=claim_element(q,"DIV",{class:!0});var V=children(f);p=claim_element(V,"DIV",{class:!0});var Y=children(p);y=claim_element(Y,"DIV",{class:!0,"aria-hidden":!0}),children(y).forEach(detach),_=claim_space(Y);for(let de=0;de<v.length;de+=1)v[de].l(Y);Y.forEach(detach),W=claim_space(V),D&&D.l(V),V.forEach(detach),this.h()},h(){attr(y,"class","absolute z-50 w-0.5"),attr(y,"aria-hidden",""),set_style(y,"transform",b),set_style(y,"height",E),attr(p,"class","grid auto-rows-max will-change-transform contain-layout"),toggle_class(p,"pointer-events-none",!!m[12]),set_style(p,"transform",S),set_style(p,"grid-template-columns",m[15]),set_style(p,"gap",C),attr(f,"class","shrink-0 contain-[size_layout]"),set_style(f,"height",$)},m(q,V){insert_hydration(q,f,V),append_hydration(f,p),append_hydration(p,y),append_hydration(p,_);for(let Y=0;Y<v.length;Y+=1)v[Y]&&v[Y].m(p,null);m[40](p),append_hydration(f,W),D&&D.m(f,null),P=!0,U||(R=[listen(window,"dragstart",m[18]),listen(window,"dragend",m[19]),listen(y,"intersect",m[38]),listen(y,"viewleave",m[39]),action_destroyer(intersection.call(null,y)),action_destroyer(drag.call(null,p,"hold")),action_destroyer(hold.call(null,p))],U=!0)},p(q,V){V[0]&258&&b!==(b=`translateY(${+!!q[8]*q[1]*100}%)`)&&set_style(y,"transform",b),V[0]&16384&&E!==(E=`${q[14]}px`)&&set_style(y,"height",E),V[0]&70684|V[1]&1024&&(A=q[16],group_outros(),v=update_keyed_each(v,V,x,1,q,A,I,p,outro_and_destroy_block,create_each_block,null,get_each_context),check_outros()),(!P||V[0]&4096)&&toggle_class(p,"pointer-events-none",!!q[12]),V[0]&1216&&S!==(S=`translate3d(0,${Math.ceil(q[10]/q[7])*q[6]}px,0)`)&&set_style(p,"transform",S),V[0]&32768&&set_style(p,"grid-template-columns",q[15]),V[0]&1&&C!==(C=`${q[0]}px`)&&set_style(p,"gap",C),q[3]?D?(D.p(q,V),V[0]&8&&transition_in(D,1)):(D=create_if_block$3(q),D.c(),transition_in(D,1),D.m(f,null)):D&&(group_outros(),transition_out(D,1,1,()=>{D=null}),check_outros()),V[0]&2048&&$!==($=`${q[11]}px`)&&set_style(f,"height",$)},i(q){if(!P){for(let V=0;V<A.length;V+=1)transition_in(v[V]);transition_in(D),P=!0}},o(q){for(let V=0;V<v.length;V+=1)transition_out(v[V]);transition_out(D),P=!1},d(q){q&&detach(f);for(let V=0;V<v.length;V+=1)v[V].d();m[40](null),D&&D.d(),U=!1,run_all(R)}}}let transfer=writable(null);function instance$5(m,f,p){let y,b,E,_,v,I,S,C,W,$,P,U,R,A,x,D,q;component_subscribe(m,transfer,te=>p(12,q=te));let{$$slots:V={},$$scope:Y}=f;const de=createEventDispatcher();let{gap:he=0}=f,{items:ue}=f,{move:_e=!1}=f,{fixed:Z=!1}=f,{overthrow:ie=1}=f,{prerender:ee=1}=f,{columns:se=1}=f,{key:me=te=>te}=f,{animate:ye=!1}=f,{sortable:X=!1}=f,{container:ce=void 0}=f,Ee=null,at=new DOMRect,Je=new DOMRect,_t=!1,Ht=!1,dt=1,Ye=0,Ze=0;function Or(te=(Ie=>(Ie=Ee==null?void 0:Ee.firstElementChild)==null?void 0:Ie.getBoundingClientRect())()){!W||!te||(p(8,Ze-=Math.round((te.y-at.y)/W)),!Ht&&Ze>=_-1&&(de("end"),Ht=!0))}function Ft(te){if(!I&&te.length&&tick().then(Vt),!ye||!te.length)return;const Ie=new Map;for(let ve=0;ve<te.length;ve++){const He=me(te[ve]);if(He==null||(Ie.set(He,ve),(q==null?void 0:q.owner)===Ee&&He===(q==null?void 0:q.key))||ve<b||ve>=E)continue;const Ve=I==null?void 0:I.get(He);if(Ve==null)continue;const rn=~~(Ve/Ye)-~~(ve/Ye),nn=~~(Ve%Ye)-~~(ve%Ye);(rn||nn)&&Bn(Ve,nn,rn)}return Ie}function Bn(te,Ie,ve){const He=Ee==null?void 0:Ee.children.item(te-b+1);if(!He||He.style.visibility==="hidden")return;const Ve=[`translate3d(${Ie*100}%,${ve*100}%,0)`,"translate3d(0,0,0)"];He.animate({transform:Ve,zIndex:["100","100"]},{easing:"ease",composite:"accumulate",duration:S})}function Vt(){var He,Ve;if(!ce||!Ee)return;p(5,Je=(He=Ee.parentElement)==null?void 0:He.getBoundingClientRect()),p(27,at=ce.getBoundingClientRect()),p(5,Je.y+=ce.scrollTop,Je),p(5,Je.width+=he,Je);const te=(Ve=Ee.firstElementChild)==null?void 0:Ve.nextElementSibling;if(!te)return;const{width:Ie,height:ve}=te.getBoundingClientRect();!Ie||!ve||(p(7,Ye=~~(Je.width/(Ie+he))),p(6,dt=ve+he))}let Qt,kt,Jt={x:0,y:0},fe={x:0,y:0};async function De({target:te}){if(Vt(),await tick(),!X||!Ee||!te||q||te.parentElement!==Ee||ue[D]==null||me(ue[D])==null)return;kt=D,Qt=_e?-1:kt;const Ie=te.getBoundingClientRect();Ie.x-=Jt.x,Ie.y-=Jt.y,set_store_value(transfer,q={group:X===!0?Ee:X,key:me(ue[D]),data:ue[D],owner:Ee,offset:Ie},q)}function tn(te,Ie=!1){if(!X||!q||Z||me(ue[te])==null)return;if(!Number.isInteger(te)){Qt!=null&&q.owner!==Ee&&(tn(Qt,!0),Qt=void 0);return}if(me(ue[te])===q.key)return;te<0&&!ue.length&&(te=0);const ve=ue.findIndex(He=>me(He)===(q==null?void 0:q.key));ve!==te&&(!Ie&&Qt==null&&(Qt=ve,kt=ve),~ve&&ue.splice(ve,1),~te&&ue.splice(te,0,q.data),requestAnimationFrame(()=>p(20,ue))),!Ie&&Ee&&set_store_value(transfer,q.owner=Ee,q)}async function vr(){if(!X||!q||kt==null)return;const te=ue.findIndex(Ie=>me(Ie)===(q==null?void 0:q.key));if(q.owner===Ee&&~te){const Ie=Ee.children.item(te-b+1);Ie&&(set_store_value(transfer,q.back=Ie.getBoundingClientRect(),q),set_store_value(transfer,q.group=Math.random().toString(),q),await new Promise(ve=>setTimeout(ve,150)))}if(kt!==te){const Ie=q.data,ve=ue[te-1],He=(+!!~kt<<1)+ +!!~te,Ve=[void 0,"push","purge","rearrange"][He];Ve&&de("edit",{action:Ve,index:te,after:ve,item:Ie})}kt=void 0,Qt=void 0,q.owner===Ee&&set_store_value(transfer,q=null,q)}onMount(()=>{const te=debounce(()=>_t||Or(),100);function Ie(){te(),X&&(p(28,fe.x=(ce==null?void 0:ce.scrollLeft)||0,fe),p(28,fe.y=(ce==null?void 0:ce.scrollTop)||0,fe))}ce||p(21,ce=getScrollParent(Ee));const ve=X&&position$1.subscribe(Ve=>p(9,Jt=Ve));ce.addEventListener("scroll",Ie),ce.addEventListener("resize",Vt);const{destroy:He}=resize(ce);return()=>{ce==null||ce.removeEventListener("scroll",Ie),ce==null||ce.removeEventListener("resize",Vt),ve&&ve(),He()}});const Be=te=>p(13,_t=te.detail.isIntersecting),wt=te=>Or(te.detail.boundingClientRect);function Fn(te){binding_callbacks[te?"unshift":"push"](()=>{Ee=te,p(4,Ee)})}return m.$$set=te=>{"gap"in te&&p(0,he=te.gap),"items"in te&&p(20,ue=te.items),"move"in te&&p(22,_e=te.move),"fixed"in te&&p(23,Z=te.fixed),"overthrow"in te&&p(1,ie=te.overthrow),"prerender"in te&&p(24,ee=te.prerender),"columns"in te&&p(25,se=te.columns),"key"in te&&p(2,me=te.key),"animate"in te&&p(26,ye=te.animate),"sortable"in te&&p(3,X=te.sortable),"container"in te&&p(21,ce=te.container),"$$scope"in te&&p(41,Y=te.$$scope)},m.$$.update=()=>{m.$$.dirty[0]&134217920&&p(36,y=Math.ceil(at.height/dt)*Ye),m.$$.dirty[0]&258|m.$$.dirty[1]&32&&p(10,b=Math.max(Ze-ie,0)*y),m.$$.dirty[0]&16777474|m.$$.dirty[1]&32&&p(35,E=Math.max((Ze+ie+1)*y,ee)),m.$$.dirty[0]&1048576|m.$$.dirty[1]&32&&(_=~~(ue.length/y)),m.$$.dirty[0]&1049600|m.$$.dirty[1]&16&&p(16,v=ue.slice(b,E)),m.$$.dirty[0]&1048576&&(I=Ft(ue)),m.$$.dirty[0]&67108864&&(S=ye===!0?300:ye||0),m.$$.dirty[0]&1048769&&p(11,C=Math.ceil(ue.length/Ye)*dt-he),m.$$.dirty[0]&192|m.$$.dirty[1]&32&&p(14,W=y/Ye*dt),m.$$.dirty[0]&33554432&&p(15,$=Number.isInteger(se)?`repeat(${se},1fr)`:`repeat(auto-fill,minmax(min(100%,${se}),1fr))`),m.$$.dirty[0]&2048&&Number.isFinite(C)&&(tick().then(Vt),Ht=!1),m.$$.dirty[0]&24&&p(30,P=X===!0?Ee:X),m.$$.dirty[0]&402653729&&p(34,U=minmax(Jt.y+he/2,at.top,at.bottom,NaN)+fe.y-Je.y),m.$$.dirty[0]&268436001&&p(33,R=minmax(Jt.x+he/2,Je.left,Je.right-he-1,NaN)+fe.x-Je.x),m.$$.dirty[0]&64|m.$$.dirty[1]&8&&p(32,A=Math.floor(U/dt)),m.$$.dirty[0]&160|m.$$.dirty[1]&4&&p(31,x=Math.floor(R/(Je.width/Ye))),m.$$.dirty[0]&1048704|m.$$.dirty[1]&3&&p(29,D=minmax(A*Ye+x,0,ue.length-1)),m.$$.dirty[0]&1610616832&&(q==null?void 0:q.group)===P&&tn(D)},[he,ie,me,X,Ee,Je,dt,Ye,Ze,Jt,b,C,q,_t,W,$,v,Or,De,vr,ue,ce,_e,Z,ee,se,ye,at,fe,D,P,x,A,R,U,E,y,V,Be,wt,Fn,Y]}class Virtual extends SvelteComponent{constructor(f){super(),init$1(this,f,instance$5,create_fragment$4,safe_not_equal,{gap:0,items:20,move:22,fixed:23,overthrow:1,prerender:24,columns:25,key:2,animate:26,sortable:3,container:21},null,[-1,-1])}}const get_after_slot_changes=m=>({}),get_after_slot_context=m=>({}),get_before_slot_changes=m=>({}),get_before_slot_context=m=>({});function create_if_block_1$1(m){let f,p;const y=m[9].before,b=create_slot(y,m,m[8],get_before_slot_context);return{c(){f=element("div"),b&&b.c(),this.h()},l(E){f=claim_element(E,"DIV",{class:!0});var _=children(f);b&&b.l(_),_.forEach(detach),this.h()},h(){attr(f,"class","z-20 flex items-center")},m(E,_){insert_hydration(E,f,_),b&&b.m(f,null),p=!0},p(E,_){b&&b.p&&(!p||_&256)&&update_slot_base(b,y,E,E[8],p?get_slot_changes(y,E[8],_,get_before_slot_changes):get_all_dirty_from_scope(E[8]),get_before_slot_context)},i(E){p||(transition_in(b,E),p=!0)},o(E){transition_out(b,E),p=!1},d(E){E&&detach(f),b&&b.d(E)}}}function create_if_block$2(m){let f;return{c(){f=element("hr"),this.h()},l(p){f=claim_element(p,"HR",{"aria-hidden":!0,class:!0}),this.h()},h(){attr(f,"aria-hidden",""),attr(f,"class","absolute bottom-0 h-[1px] w-full border-none bg-content/10 group-last-of-type:opacity-0")},m(p,y){insert_hydration(p,f,y)},d(p){p&&detach(f)}}}function create_dynamic_element(m){let f,p,y,b,E,_,v,I,S,C,W,$,P,U,R,A,x,D,q,V,Y,de,he,ue=m[7].before&&create_if_block_1$1(m);const _e=m[9].default,Z=create_slot(_e,m,m[8],null);let ie=m[2]&&(m[1]||m[0])&&create_if_block$2();U=new Icon({props:{name:"circle"}}),x=new Icon({props:{name:"target"}});const ee=m[9].after,se=create_slot(ee,m,m[8],get_after_slot_context);let me=[{href:m[5]},{draggable:"false"},{class:V="group relative z-10 flex w-full items-center gap-4 overflow-hidden px-4 outline-2 -outline-offset-2 outline-primary-600 contain-inline-size focus-visible:outline "+(m[4]?"cursor-pointer touch-manipulation select-none "+(m[2]?"":"transition-transform active:scale-95"):"")+" "+(m[0]?"focus-visible:z-50":m[1]?"rounded-lg py-1 focus-visible:z-50":"rounded-2xl py-4")+" "+(m[2]?"bg-surface":"bg-surface-100 shadow-[0_0_20px_-4px] shadow-black/20 dark:shadow-none")}],ye={};for(let X=0;X<me.length;X+=1)ye=assign$1(ye,me[X]);return{c(){f=element(m[4]?m[5]?"a":"button":"article"),p=element("div"),y=space(),b=element("div"),_=space(),ue&&ue.c(),v=space(),I=element("div"),Z&&Z.c(),S=space(),ie&&ie.c(),W=space(),$=element("div"),P=element("div"),create_component(U.$$.fragment),R=space(),A=element("div"),create_component(x.$$.fragment),D=space(),q=element("div"),se&&se.c(),this.h()},l(X){f=claim_element(X,((m[4]?m[5]?"a":"button":"article")||"null").toUpperCase(),{href:!0,draggable:!0,class:!0});var ce=children(f);p=claim_element(ce,"DIV",{"aria-hidden":!0,class:!0}),children(p).forEach(detach),y=claim_space(ce),b=claim_element(ce,"DIV",{"aria-hidden":!0,class:!0}),children(b).forEach(detach),_=claim_space(ce),ue&&ue.l(ce),v=claim_space(ce),I=claim_element(ce,"DIV",{class:!0});var Ee=children(I);Z&&Z.l(Ee),S=claim_space(Ee),ie&&ie.l(Ee),Ee.forEach(detach),W=claim_space(ce),$=claim_element(ce,"DIV",{class:!0});var at=children($);P=claim_element(at,"DIV",{class:!0});var Je=children(P);claim_component(U.$$.fragment,Je),Je.forEach(detach),R=claim_space(at),A=claim_element(at,"DIV",{class:!0});var _t=children(A);claim_component(x.$$.fragment,_t),_t.forEach(detach),D=claim_space(at),q=claim_element(at,"DIV",{class:!0});var Ht=children(q);se&&se.l(Ht),Ht.forEach(detach),at.forEach(detach),ce.forEach(detach),this.h()},h(){attr(p,"aria-hidden",""),attr(p,"class","pointer-events-none absolute inset-0 -z-10 bg-primary-200/30 opacity-0 transition-opacity"),toggle_class(p,"opacity-100",m[6]===!0),attr(b,"aria-hidden",""),attr(b,"class",E="pointer-events-none absolute inset-0 z-0 bg-highlight opacity-0 "+(m[4]?"group-hover:opacity-30 "+(m[2]?"dark:group-hover:opacity-50":"dark:group-hover:opacity-10"):"")),attr(I,"class",C="z-10 grid w-full grid-cols-1 items-baseline overflow-hidden contain-inline-size "+(m[1]||m[0]?"justify-start gap-0.5":"place-items-center justify-center gap-2")+" "+((m[1]||m[0])&&m[3]?"lg:auto-cols-fr lg:grid-flow-col lg:gap-4":"")),attr(P,"class","flex justify-center text-primary-600 opacity-0 transition-opacity"),toggle_class(P,"opacity-100",m[6]),attr(A,"class","flex scale-0 justify-center text-primary-600 transition-transform"),toggle_class(A,"scale-100",m[6]===!0),attr(q,"class","opacity-0 transition-opacity"),toggle_class(q,"opacity-100",!m[6]),attr($,"class","z-20 grid items-center [&>*]:col-start-1 [&>*]:row-start-1"),set_dynamic_element_data(m[4]?m[5]?"a":"button":"article")(f,ye)},m(X,ce){insert_hydration(X,f,ce),append_hydration(f,p),append_hydration(f,y),append_hydration(f,b),append_hydration(f,_),ue&&ue.m(f,null),append_hydration(f,v),append_hydration(f,I),Z&&Z.m(I,null),append_hydration(I,S),ie&&ie.m(I,null),append_hydration(f,W),append_hydration(f,$),append_hydration($,P),mount_component(U,P,null),append_hydration($,R),append_hydration($,A),mount_component(x,A,null),append_hydration($,D),append_hydration($,q),se&&se.m(q,null),Y=!0,de||(he=[listen(f,"click",m[10]),listen(f,"contextmenu",m[11])],de=!0)},p(X,ce){(!Y||ce&64)&&toggle_class(p,"opacity-100",X[6]===!0),(!Y||ce&20&&E!==(E="pointer-events-none absolute inset-0 z-0 bg-highlight opacity-0 "+(X[4]?"group-hover:opacity-30 "+(X[2]?"dark:group-hover:opacity-50":"dark:group-hover:opacity-10"):"")))&&attr(b,"class",E),X[7].before?ue?(ue.p(X,ce),ce&128&&transition_in(ue,1)):(ue=create_if_block_1$1(X),ue.c(),transition_in(ue,1),ue.m(f,v)):ue&&(group_outros(),transition_out(ue,1,1,()=>{ue=null}),check_outros()),Z&&Z.p&&(!Y||ce&256)&&update_slot_base(Z,_e,X,X[8],Y?get_slot_changes(_e,X[8],ce,null):get_all_dirty_from_scope(X[8]),null),X[2]&&(X[1]||X[0])?ie||(ie=create_if_block$2(),ie.c(),ie.m(I,null)):ie&&(ie.d(1),ie=null),(!Y||ce&11&&C!==(C="z-10 grid w-full grid-cols-1 items-baseline overflow-hidden contain-inline-size "+(X[1]||X[0]?"justify-start gap-0.5":"place-items-center justify-center gap-2")+" "+((X[1]||X[0])&&X[3]?"lg:auto-cols-fr lg:grid-flow-col lg:gap-4":"")))&&attr(I,"class",C),(!Y||ce&64)&&toggle_class(P,"opacity-100",X[6]),(!Y||ce&64)&&toggle_class(A,"scale-100",X[6]===!0),se&&se.p&&(!Y||ce&256)&&update_slot_base(se,ee,X,X[8],Y?get_slot_changes(ee,X[8],ce,get_after_slot_changes):get_all_dirty_from_scope(X[8]),get_after_slot_context),(!Y||ce&64)&&toggle_class(q,"opacity-100",!X[6]),set_dynamic_element_data(X[4]?X[5]?"a":"button":"article")(f,ye=get_spread_update(me,[(!Y||ce&32)&&{href:X[5]},{draggable:"false"},(!Y||ce&23&&V!==(V="group relative z-10 flex w-full items-center gap-4 overflow-hidden px-4 outline-2 -outline-offset-2 outline-primary-600 contain-inline-size focus-visible:outline "+(X[4]?"cursor-pointer touch-manipulation select-none "+(X[2]?"":"transition-transform active:scale-95"):"")+" "+(X[0]?"focus-visible:z-50":X[1]?"rounded-lg py-1 focus-visible:z-50":"rounded-2xl py-4")+" "+(X[2]?"bg-surface":"bg-surface-100 shadow-[0_0_20px_-4px] shadow-black/20 dark:shadow-none")))&&{class:V}]))},i(X){Y||(transition_in(ue),transition_in(Z,X),transition_in(U.$$.fragment,X),transition_in(x.$$.fragment,X),transition_in(se,X),Y=!0)},o(X){transition_out(ue),transition_out(Z,X),transition_out(U.$$.fragment,X),transition_out(x.$$.fragment,X),transition_out(se,X),Y=!1},d(X){X&&detach(f),ue&&ue.d(),Z&&Z.d(X),ie&&ie.d(),destroy_component(U),destroy_component(x),se&&se.d(X),de=!1,run_all(he)}}}function create_fragment$3(m){let f=m[4]?m[5]?"a":"button":"article",p,y,b=(m[4]?m[5]?"a":"button":"article")&&create_dynamic_element(m);return{c(){b&&b.c(),p=empty$1()},l(E){b&&b.l(E),p=empty$1()},m(E,_){b&&b.m(E,_),insert_hydration(E,p,_),y=!0},p(E,[_]){!E[4]||E[5],f?safe_not_equal(f,E[4]?E[5]?"a":"button":"article")?(b.d(1),b=create_dynamic_element(E),f=E[4]?E[5]?"a":"button":"article",b.c(),b.m(p.parentNode,p)):b.p(E,_):(b=create_dynamic_element(E),f=E[4]?E[5]?"a":"button":"article",b.c(),b.m(p.parentNode,p))},i(E){y||(transition_in(b),y=!0)},o(E){transition_out(b),y=!1},d(E){E&&detach(p),b&&b.d(E)}}}function instance$4(m,f,p){let{$$slots:y={},$$scope:b}=f;const E=compute_slots(y);let{xs:_=!1}=f,{sm:v=!1}=f,{flat:I=!1}=f,{flow:S=!1}=f,{interactive:C=!1}=f,{href:W=void 0}=f,{selected:$=!1}=f;function P(R){bubble.call(this,m,R)}function U(R){bubble.call(this,m,R)}return m.$$set=R=>{"xs"in R&&p(0,_=R.xs),"sm"in R&&p(1,v=R.sm),"flat"in R&&p(2,I=R.flat),"flow"in R&&p(3,S=R.flow),"interactive"in R&&p(4,C=R.interactive),"href"in R&&p(5,W=R.href),"selected"in R&&p(6,$=R.selected),"$$scope"in R&&p(8,b=R.$$scope)},[_,v,I,S,C,W,$,E,b,y,P,U]}class Card extends SvelteComponent{constructor(f){super(),init$1(this,f,instance$4,create_fragment$3,safe_not_equal,{xs:0,sm:1,flat:2,flow:3,interactive:4,href:5,selected:6})}}function create_fragment$2(m){let f,p,y;const b=m[6].default,E=create_slot(b,m,m[5],null);return{c(){f=element("span"),E&&E.c(),this.h()},l(_){f=claim_element(_,"SPAN",{class:!0});var v=children(f);E&&E.l(v),v.forEach(detach),this.h()},h(){attr(f,"class",p="w-max max-w-full overflow-hidden text-ellipsis whitespace-nowrap rounded-md text-left [&>*]:align-bottom "+(m[1]?"animate-pulse bg-highlight text-transparent":"")+" "+(m[2]?"font-medium":"font-normal")),toggle_class(f,"text-content-200",m[0]),toggle_class(f,"ml-4",m[3]),toggle_class(f,"text-sm",m[4])},m(_,v){insert_hydration(_,f,v),E&&E.m(f,null),y=!0},p(_,[v]){E&&E.p&&(!y||v&32)&&update_slot_base(E,b,_,_[5],y?get_slot_changes(b,_[5],v,null):get_all_dirty_from_scope(_[5]),null),(!y||v&6&&p!==(p="w-max max-w-full overflow-hidden text-ellipsis whitespace-nowrap rounded-md text-left [&>*]:align-bottom "+(_[1]?"animate-pulse bg-highlight text-transparent":"")+" "+(_[2]?"font-medium":"font-normal")))&&attr(f,"class",p),(!y||v&7)&&toggle_class(f,"text-content-200",_[0]),(!y||v&14)&&toggle_class(f,"ml-4",_[3]),(!y||v&22)&&toggle_class(f,"text-sm",_[4])},i(_){y||(transition_in(E,_),y=!0)},o(_){transition_out(E,_),y=!1},d(_){_&&detach(f),E&&E.d(_)}}}function instance$3(m,f,p){let{$$slots:y={},$$scope:b}=f,{secondary:E=!1}=f,{loading:_=!1}=f,{accent:v=!1}=f,{indent:I=!1}=f,{sm:S=!1}=f;return m.$$set=C=>{"secondary"in C&&p(0,E=C.secondary),"loading"in C&&p(1,_=C.loading),"accent"in C&&p(2,v=C.accent),"indent"in C&&p(3,I=C.indent),"sm"in C&&p(4,S=C.sm),"$$scope"in C&&p(5,b=C.$$scope)},[E,_,v,I,S,b,y]}class Text extends SvelteComponent{constructor(f){super(),init$1(this,f,instance$3,create_fragment$2,safe_not_equal,{secondary:0,loading:1,accent:2,indent:3,sm:4})}}function create_if_block_1(m){let f;const p=m[7].default,y=create_slot(p,m,m[6],null);return{c(){y&&y.c()},l(b){y&&y.l(b)},m(b,E){y&&y.m(b,E),f=!0},p(b,E){y&&y.p&&(!f||E&64)&&update_slot_base(y,p,b,b[6],f?get_slot_changes(p,b[6],E,null):get_all_dirty_from_scope(b[6]),null)},i(b){f||(transition_in(y,b),f=!0)},o(b){transition_out(y,b),f=!1},d(b){y&&y.d(b)}}}function create_if_block$1(m){let f,p,y,b,E,_;return{c(){f=element("img"),this.h()},l(v){f=claim_element(v,"IMG",{alt:!0,src:!0,class:!0,loading:!0,width:!0,height:!0,draggable:!0}),this.h()},h(){attr(f,"alt",m[3]),src_url_equal(f.src,p=m[2]<100/devicePixelRatio?m[0]:m[1])||attr(f,"src",p),attr(f,"class","opacity-0 transition-opacity duration-500"),attr(f,"loading","lazy"),attr(f,"width",y=m[2]+"px"),attr(f,"height",b=m[2]+"px"),attr(f,"draggable","false"),toggle_class(f,"opacity-100",m[5]==="ok")},m(v,I){insert_hydration(v,f,I),m[8](f),E||(_=[listen(f,"load",m[9]),listen(f,"error",m[10])],E=!0)},p(v,I){I&8&&attr(f,"alt",v[3]),I&7&&!src_url_equal(f.src,p=v[2]<100/devicePixelRatio?v[0]:v[1])&&attr(f,"src",p),I&4&&y!==(y=v[2]+"px")&&attr(f,"width",y),I&4&&b!==(b=v[2]+"px")&&attr(f,"height",b),I&32&&toggle_class(f,"opacity-100",v[5]==="ok")},i:noop$2,o:noop$2,d(v){v&&detach(f),m[8](null),E=!1,run_all(_)}}}function create_fragment$1(m){let f,p,y,b,E=`${m[2]}px`,_=`${m[2]}px`,v;const I=[create_if_block$1,create_if_block_1],S=[];function C(W,$){return W[1]&&W[5]!=="error"?0:W[5]==="error"?1:-1}return~(p=C(m))&&(y=S[p]=I[p](m)),{c(){f=element("div"),y&&y.c(),this.h()},l(W){f=claim_element(W,"DIV",{class:!0});var $=children(f);y&&y.l($),$.forEach(detach),this.h()},h(){attr(f,"class",b="overflow-hidden "+(m[2]>200?"rounded-2xl":"rounded")+" bg-highlight-100"),toggle_class(f,"animate-pulse",m[5]==="loading"),set_style(f,"height",E),set_style(f,"width",_)},m(W,$){insert_hydration(W,f,$),~p&&S[p].m(f,null),v=!0},p(W,[$]){let P=p;p=C(W),p===P?~p&&S[p].p(W,$):(y&&(group_outros(),transition_out(S[P],1,1,()=>{S[P]=null}),check_outros()),~p?(y=S[p],y?y.p(W,$):(y=S[p]=I[p](W),y.c()),transition_in(y,1),y.m(f,null)):y=null),(!v||$&4&&b!==(b="overflow-hidden "+(W[2]>200?"rounded-2xl":"rounded")+" bg-highlight-100"))&&attr(f,"class",b),(!v||$&36)&&toggle_class(f,"animate-pulse",W[5]==="loading"),$&4&&E!==(E=`${W[2]}px`)&&set_style(f,"height",E),$&4&&_!==(_=`${W[2]}px`)&&set_style(f,"width",_)},i(W){v||(transition_in(y),v=!0)},o(W){transition_out(y),v=!1},d(W){W&&detach(f),~p&&S[p].d()}}}function instance$2(m,f,p){let y,{$$slots:b={},$$scope:E}=f,{thumbnail:_=void 0}=f,{src:v=void 0}=f,{size:I=48}=f,{alt:S=""}=f,C;onMount(()=>(C==null?void 0:C.complete)&&p(4,C.style.opacity="1",C));function W(U){binding_callbacks[U?"unshift":"push"](()=>{C=U,p(4,C)})}const $=()=>p(5,y="ok"),P=()=>p(5,y="error");return m.$$set=U=>{"thumbnail"in U&&p(0,_=U.thumbnail),"src"in U&&p(1,v=U.src),"size"in U&&p(2,I=U.size),"alt"in U&&p(3,S=U.alt),"$$scope"in U&&p(6,E=U.$$scope)},m.$$.update=()=>{m.$$.dirty&2&&p(5,y=v===""||v===null?"error":"loading")},[_,v,I,S,C,y,E,b,W,$,P]}class Image extends SvelteComponent{constructor(f){super(),init$1(this,f,instance$2,create_fragment$1,safe_not_equal,{thumbnail:0,src:1,size:2,alt:3})}}function capitalize(m,f=!0){return m&&(f?m.replace(/\b\w/g,p=>p.toUpperCase()):m.replace(/\b\w/,p=>p.toUpperCase()))}function clean(m){return m.normalize().trim().toLowerCase().replace(/\s+/g," ")}const __vite_glob_0_0=`CREATE TRIGGER IF NOT EXISTS cascade_playlists_library
AFTER DELETE ON playlists
FOR EACH ROW
BEGIN
  DELETE FROM library WHERE playlist = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_library_tracks
AFTER DELETE ON library
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM library 
    WHERE track = OLD.track 
  UNION ALL SELECT 1 FROM playback
    WHERE track = OLD.track
  LIMIT 1
)
BEGIN
  DELETE FROM tracks WHERE id = OLD.track;
END;

CREATE TRIGGER IF NOT EXISTS cascade_playback_tracks
AFTER DELETE ON playback
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM library
    WHERE track = OLD.track
  UNION ALL SELECT 1 FROM playback
    WHERE track = OLD.track
  LIMIT 1
)
BEGIN
  DELETE FROM tracks WHERE id = OLD.track;
END;

CREATE TRIGGER IF NOT EXISTS cascade_tracks_albums
AFTER DELETE ON tracks
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM tracks WHERE album = OLD.album LIMIT 1
)
BEGIN
  DELETE FROM albums WHERE id = OLD.album;
END;

CREATE TRIGGER IF NOT EXISTS cascade_albums_attribution
AFTER DELETE ON albums
FOR EACH ROW
BEGIN
  DELETE FROM attribution WHERE album = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_attribution_artists
AFTER DELETE ON attribution
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM attribution
    WHERE artist = OLD.artist
)
BEGIN
  DELETE FROM artists WHERE id = OLD.artist;
END;

CREATE TRIGGER IF NOT EXISTS cascade_tracks_resources
AFTER DELETE ON tracks
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_albums_resources
AFTER DELETE ON albums
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
  DELETE FROM assets WHERE owner = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_artists_resources
AFTER DELETE ON artists
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
  DELETE FROM assets WHERE owner = OLD.id;
END;
`,__vite_glob_0_1=`CREATE VIRTUAL TABLE IF NOT EXISTS tracks_fts USING fts5 (
  title,
  album,
  artists,
  content='',
  tokenize='trigram'
);

CREATE VIRTUAL TABLE IF NOT EXISTS albums_fts USING fts5 (
  title,
  artists,
  content='',
  tokenize='trigram'
);

CREATE VIRTUAL TABLE IF NOT EXISTS artists_fts USING fts5 (
  title,
  content='',
  tokenize='trigram'
);

---------------------------- Artists Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_artists_insert AFTER INSERT ON artists BEGIN
  -- Update artists index
  INSERT INTO artists_fts(rowid,title) VALUES (NEW.id, NEW.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title,
      CASE WHEN EXISTS (SELECT 1 FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id) THEN albums.title ELSE NULL END,
      (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS fts_artists_update AFTER UPDATE OF title ON artists WHEN (OLD.title IS NOT NEW.title) BEGIN
  -- Update artists index
  INSERT INTO artists_fts(artists_fts,rowid,title) VALUES ('delete', OLD.id, OLD.title);
  INSERT INTO artists_fts(rowid,title) VALUES (NEW.id, NEW.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(CASE WHEN artists.id = OLD.id THEN OLD.title ELSE title END) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = OLD.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(CASE WHEN artists.id = OLD.id THEN OLD.title ELSE title END) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = OLD.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS fts_artists_delete BEFORE DELETE ON artists BEGIN
  -- Update artists index
  INSERT INTO artists_fts(artists_fts,rowid,title) VALUES ('delete', OLD.id, OLD.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = OLD.id;
END;

---------------------------- Albums Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_albums_insert AFTER INSERT ON albums BEGIN
  -- Update albums index
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT NEW.id, NEW.title, group_concat(artists.title)
    FROM attribution
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE attribution.album = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, NULL, NULL
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS albums_fts_update AFTER UPDATE OF title ON albums WHEN (OLD.title IS NOT NEW.title) BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', OLD.id, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
    WHERE attribution.album = OLD.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT NEW.id, NEW.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
    WHERE attribution.album = OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = OLD.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, NEW.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS albums_fts_delete BEFORE DELETE ON albums BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', OLD.id, OLD.title, group_concat(artists.title)
    FROM attribution
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE attribution.album = OLD.id
    GROUP BY OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = OLD.id;
END;

---------------------------- Attribution Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_attribution_insert AFTER INSERT ON attribution
  WHEN EXISTS (SELECT 1 FROM artists WHERE id = NEW.artist) AND EXISTS (SELECT 1 FROM albums WHERE id = NEW.album)
BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, NULL, NULL
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT  tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
END;

CREATE TRIGGER IF NOT EXISTS fts_attribution_delete BEFORE DELETE ON attribution BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = OLD.album AND attribution.artist = OLD.artist;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = OLD.album AND attribution.artist = OLD.artist;
END;

---------------------------- Tracks Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_tracks_insert AFTER INSERT ON tracks BEGIN
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT NEW.id, NEW.title, albums.title, group_concat(artists.title)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE albums.id = NEW.album;
END;

CREATE TRIGGER IF NOT EXISTS fts_tracks_update AFTER UPDATE OF title ON tracks WHEN (OLD.title IS NOT NEW.title) BEGIN
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', OLD.id, OLD.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
    WHERE albums.id = OLD.album;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT NEW.id, NEW.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
    WHERE albums.id = NEW.album;
END;

CREATE TRIGGER IF NOT EXISTS fts_tracks_delete BEFORE DELETE ON tracks BEGIN
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', OLD.id, OLD.title, albums.title, group_concat(artists.title)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE albums.id = OLD.album
    GROUP BY OLD.id;
END;`,__vite_glob_0_2=`INSERT OR IGNORE INTO devices VALUES (crsql_siteid(), -1, 0, 0, 0, 0);

CREATE VIEW IF NOT EXISTS queue AS
  WITH ordered AS
    (SELECT playback.*, row_number() OVER (
      ORDER BY
        CASE WHEN "direction" != 1 THEN "order" ELSE NULL END ASC,
        CASE WHEN "direction" = 1 THEN "order" ELSE NULL END DESC,
        CASE WHEN "direction" != 1 THEN "playback"."id" ELSE NULL END ASC,
        CASE WHEN "direction" = 1 THEN "playback"."id" ELSE NULL END DESC
    ) as position FROM devices INNER JOIN playback ON playback.device = devices.id
    WHERE devices.id = crsql_siteid())
  SELECT id, device, track, 
    (position - 
      (SELECT position FROM ordered WHERE id = (SELECT playback FROM devices WHERE id = device))
    ) as position
  FROM ordered;

CREATE TRIGGER IF NOT EXISTS playback_started
BEFORE INSERT ON playback
FOR EACH ROW
WHEN NEW.device = crsql_siteid()
BEGIN
  UPDATE devices SET playback = NEW.id WHERE id = NEW.device AND playback IS -1;
END;

CREATE TRIGGER IF NOT EXISTS playback_finised
BEFORE UPDATE OF progress ON devices
FOR EACH ROW
WHEN NEW.progress >= 1 AND NEW.id = crsql_siteid()
BEGIN
  INSERT INTO library SELECT ABS(RANDOM() % 4294967296), -1, track, UNIXEPOCH(), -1 FROM playback WHERE id = NEW.playback;
  UPDATE devices SET 
    playback = CASE WHEN NEW.repeat = 2 AND NOT EXISTS (SELECT 1 FROM queue WHERE position > 0)
      THEN IFNULL((SELECT id FROM queue LIMIT 1), playback)
      WHEN NEW.repeat = 1 THEN playback
      ELSE IFNULL((SELECT id FROM queue WHERE position = 1), playback)
    END,
    progress = 0
  WHERE id = NEW.id;
  SELECT RAISE(IGNORE);
END;

CREATE TRIGGER IF NOT EXISTS playback_backtracked
BEFORE UPDATE OF progress ON devices
FOR EACH ROW
WHEN NEW.progress < 0 AND NEW.id = crsql_siteid()
BEGIN
  UPDATE devices SET 
    playback = IFNULL((SELECT id FROM queue WHERE position = -1), playback),
    progress = 0
  WHERE id = NEW.id;
  SELECT RAISE(IGNORE);
END;

CREATE TRIGGER IF NOT EXISTS playback_shuffled
AFTER UPDATE OF direction ON devices
FOR EACH ROW
WHEN NEW.direction = 2 AND NEW.id = crsql_siteid()
BEGIN
  UPDATE playback SET "temp"="order" WHERE
    (SELECT id FROM queue WHERE position = 0) != id AND device = NEW.id;
  UPDATE playback SET
    "order"=(SELECT "order" FROM playback WHERE "temp" IS NULL)||trim(hex(randomblob(2)),'0')
  WHERE "temp" IS NOT NULL;
END;

CREATE TRIGGER IF NOT EXISTS playback_unshuffled
AFTER UPDATE OF direction ON devices
FOR EACH ROW
WHEN OLD.direction = 2 AND NEW.direction != 2 AND NEW.id = crsql_siteid()
BEGIN
  UPDATE playback SET
    "order"="temp",
    "temp"=NULL
  WHERE "temp" IS NOT NULL AND device = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS playback_purged
BEFORE DELETE ON playback
FOR EACH ROW
WHEN (OLD.id = (SELECT playback FROM devices WHERE id = crsql_siteid()))
BEGIN
  UPDATE devices SET 
    playback = (SELECT id FROM queue WHERE position = 1),
    progress = 0
  WHERE id = OLD.device;
END;`,__vite_glob_0_3=`INSERT OR IGNORE INTO playlists (id, title, "order", relevancy, shared, remote) VALUES
  (-1, 'Listened', 1, 0, NULL, NULL),
  (-2, 'Recommended', 1, -1, NULL, NULL),
  (-3, 'Blocked', 1, -1, NULL, NULL),
  (-4, 'Followed', 1, 0, NULL, NULL);`;function isUndefined(m){return typeof m>"u"||m===void 0}function isString(m){return typeof m=="string"}function isNumber(m){return typeof m=="number"}function isBoolean(m){return typeof m=="boolean"}function isNull(m){return m===null}function isDate(m){return m instanceof Date}function isBigInt(m){return typeof m=="bigint"}function isFunction(m){return typeof m=="function"}function isObject$2(m){return typeof m=="object"&&m!==null}function freeze(m){return Object.freeze(m)}function isReadonlyArray(m){return Array.isArray(m)}function noop$1(m){return m}const AlterTableNode=freeze({is(m){return m.kind==="AlterTableNode"},create(m){return freeze({kind:"AlterTableNode",table:m})},cloneWithTableProps(m,f){return freeze({...m,...f})},cloneWithColumnAlteration(m,f){return freeze({...m,columnAlterations:m.columnAlterations?[...m.columnAlterations,f]:[f]})}}),IdentifierNode=freeze({is(m){return m.kind==="IdentifierNode"},create(m){return freeze({kind:"IdentifierNode",name:m})}}),CreateIndexNode=freeze({is(m){return m.kind==="CreateIndexNode"},create(m){return freeze({kind:"CreateIndexNode",name:IdentifierNode.create(m)})},cloneWith(m,f){return freeze({...m,...f})},cloneWithColumns(m,f){return freeze({...m,columns:[...m.columns||[],...f]})}}),CreateSchemaNode=freeze({is(m){return m.kind==="CreateSchemaNode"},create(m,f){return freeze({kind:"CreateSchemaNode",schema:IdentifierNode.create(m),...f})},cloneWith(m,f){return freeze({...m,...f})}}),ON_COMMIT_ACTIONS=["preserve rows","delete rows","drop"],CreateTableNode=freeze({is(m){return m.kind==="CreateTableNode"},create(m){return freeze({kind:"CreateTableNode",table:m,columns:freeze([])})},cloneWithColumn(m,f){return freeze({...m,columns:freeze([...m.columns,f])})},cloneWithConstraint(m,f){return freeze({...m,constraints:m.constraints?freeze([...m.constraints,f]):freeze([f])})},cloneWithFrontModifier(m,f){return freeze({...m,frontModifiers:m.frontModifiers?freeze([...m.frontModifiers,f]):freeze([f])})},cloneWithEndModifier(m,f){return freeze({...m,endModifiers:m.endModifiers?freeze([...m.endModifiers,f]):freeze([f])})},cloneWith(m,f){return freeze({...m,...f})}}),SchemableIdentifierNode=freeze({is(m){return m.kind==="SchemableIdentifierNode"},create(m){return freeze({kind:"SchemableIdentifierNode",identifier:IdentifierNode.create(m)})},createWithSchema(m,f){return freeze({kind:"SchemableIdentifierNode",schema:IdentifierNode.create(m),identifier:IdentifierNode.create(f)})}}),DropIndexNode=freeze({is(m){return m.kind==="DropIndexNode"},create(m,f){return freeze({kind:"DropIndexNode",name:SchemableIdentifierNode.create(m),...f})},cloneWith(m,f){return freeze({...m,...f})}}),DropSchemaNode=freeze({is(m){return m.kind==="DropSchemaNode"},create(m,f){return freeze({kind:"DropSchemaNode",schema:IdentifierNode.create(m),...f})},cloneWith(m,f){return freeze({...m,...f})}}),DropTableNode=freeze({is(m){return m.kind==="DropTableNode"},create(m,f){return freeze({kind:"DropTableNode",table:m,...f})},cloneWith(m,f){return freeze({...m,...f})}}),AliasNode=freeze({is(m){return m.kind==="AliasNode"},create(m,f){return freeze({kind:"AliasNode",node:m,alias:f})}}),TableNode=freeze({is(m){return m.kind==="TableNode"},create(m){return freeze({kind:"TableNode",table:SchemableIdentifierNode.create(m)})},createWithSchema(m,f){return freeze({kind:"TableNode",table:SchemableIdentifierNode.createWithSchema(m,f)})}});function isOperationNodeSource(m){return isObject$2(m)&&isFunction(m.toOperationNode)}function isExpression(m){return isObject$2(m)&&"expressionType"in m&&isOperationNodeSource(m)}function isAliasedExpression(m){return isObject$2(m)&&"expression"in m&&isString(m.alias)&&isOperationNodeSource(m)}const SelectModifierNode=freeze({is(m){return m.kind==="SelectModifierNode"},create(m){return freeze({kind:"SelectModifierNode",modifier:m})},createWithExpression(m){return freeze({kind:"SelectModifierNode",rawModifier:m})}}),AndNode=freeze({is(m){return m.kind==="AndNode"},create(m,f){return freeze({kind:"AndNode",left:m,right:f})}}),OrNode=freeze({is(m){return m.kind==="OrNode"},create(m,f){return freeze({kind:"OrNode",left:m,right:f})}}),OnNode=freeze({is(m){return m.kind==="OnNode"},create(m){return freeze({kind:"OnNode",on:m})},cloneWithOperation(m,f,p){return freeze({...m,on:f==="And"?AndNode.create(m.on,p):OrNode.create(m.on,p)})}}),JoinNode=freeze({is(m){return m.kind==="JoinNode"},create(m,f){return freeze({kind:"JoinNode",joinType:m,table:f,on:void 0})},createWithOn(m,f,p){return freeze({kind:"JoinNode",joinType:m,table:f,on:OnNode.create(p)})},cloneWithOn(m,f){return freeze({...m,on:m.on?OnNode.cloneWithOperation(m.on,"And",f):OnNode.create(f)})},cloneWithOrOn(m,f){return freeze({...m,on:m.on?OnNode.cloneWithOperation(m.on,"Or",f):OnNode.create(f)})}}),BinaryOperationNode=freeze({is(m){return m.kind==="BinaryOperationNode"},create(m,f,p){return freeze({kind:"BinaryOperationNode",leftOperand:m,operator:f,rightOperand:p})}}),RawNode=freeze({is(m){return m.kind==="RawNode"},create(m,f){return freeze({kind:"RawNode",sqlFragments:freeze(m),parameters:freeze(f)})},createWithSql(m){return RawNode.create([m],[])},createWithChild(m){return RawNode.create(["",""],[m])},createWithChildren(m){return RawNode.create(new Array(m.length+1).fill(""),m)}}),COMPARISON_OPERATORS=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->"],ARITHMETIC_OPERATORS=["+","-","*","/","%","^","&","|","#","<<",">>"],BINARY_OPERATORS=[...COMPARISON_OPERATORS,...ARITHMETIC_OPERATORS,"&&","||"],UNARY_FILTER_OPERATORS=["exists","not exists"],UNARY_OPERATORS=["not","-",...UNARY_FILTER_OPERATORS],OPERATORS=[...BINARY_OPERATORS,...UNARY_OPERATORS],OperatorNode=freeze({is(m){return m.kind==="OperatorNode"},create(m){return freeze({kind:"OperatorNode",operator:m})}});function isBinaryOperator(m){return isString(m)&&BINARY_OPERATORS.includes(m)}function isComparisonOperator(m){return isString(m)&&COMPARISON_OPERATORS.includes(m)}const ParensNode=freeze({is(m){return m.kind==="ParensNode"},create(m){return freeze({kind:"ParensNode",node:m})}}),ColumnNode=freeze({is(m){return m.kind==="ColumnNode"},create(m){return freeze({kind:"ColumnNode",column:IdentifierNode.create(m)})}}),SelectAllNode=freeze({is(m){return m.kind==="SelectAllNode"},create(){return freeze({kind:"SelectAllNode"})}}),ReferenceNode=freeze({is(m){return m.kind==="ReferenceNode"},create(m,f){return freeze({kind:"ReferenceNode",table:m,column:f})},createSelectAll(m){return freeze({kind:"ReferenceNode",table:m,column:SelectAllNode.create()})}}),OrderByItemNode=freeze({is(m){return m.kind==="OrderByItemNode"},create(m,f){return freeze({kind:"OrderByItemNode",orderBy:m,direction:f})}});function isOrderByDirection(m){return m==="asc"||m==="desc"}function parseOrderBy(m,f){return OrderByItemNode.create(parseOrderByExpression(m),parseOrderByDirectionExpression(f))}function parseOrderByExpression(m){return parseReferenceExpression(m)}function parseOrderByDirectionExpression(m){if(m)return m==="asc"||m==="desc"?RawNode.createWithSql(m):m.toOperationNode()}function parseSimpleReferenceExpression(m){return isString(m)?parseStringReference(m):m.toOperationNode()}function parseReferenceExpressionOrList(m){return isReadonlyArray(m)?m.map(f=>parseReferenceExpression(f)):[parseReferenceExpression(m)]}function parseReferenceExpression(m){return isExpressionOrFactory(m)?parseExpression(m):parseSimpleReferenceExpression(m)}function parseStringReference(m){const f=".";if(m.includes(f)){const p=m.split(f).map(trim$2);if(p.length===3)return parseStringReferenceWithTableAndSchema(p);if(p.length===2)return parseStringReferenceWithTable(p);throw new Error(`invalid column reference ${m}`)}else return ColumnNode.create(m)}function parseAliasedStringReference(m){const f=" as ";if(m.includes(f)){const[p,y]=m.split(f).map(trim$2);return AliasNode.create(parseStringReference(p),IdentifierNode.create(y))}else return parseStringReference(m)}function parseColumnName(m){return ColumnNode.create(m)}function parseOrderedColumnName(m){const f=" ";if(m.includes(f)){const[p,y]=m.split(f).map(trim$2);if(!isOrderByDirection(y))throw new Error(`invalid order direction "${y}" next to "${p}"`);return parseOrderBy(p,y)}else return parseColumnName(m)}function parseStringReferenceWithTableAndSchema(m){const[f,p,y]=m;return ReferenceNode.create(TableNode.createWithSchema(f,p),ColumnNode.create(y))}function parseStringReferenceWithTable(m){const[f,p]=m;return ReferenceNode.create(TableNode.create(f),ColumnNode.create(p))}function trim$2(m){return m.trim()}const PrimitiveValueListNode=freeze({is(m){return m.kind==="PrimitiveValueListNode"},create(m){return freeze({kind:"PrimitiveValueListNode",values:freeze([...m])})}}),ValueListNode=freeze({is(m){return m.kind==="ValueListNode"},create(m){return freeze({kind:"ValueListNode",values:freeze(m)})}}),ValueNode=freeze({is(m){return m.kind==="ValueNode"},create(m){return freeze({kind:"ValueNode",value:m})},createImmediate(m){return freeze({kind:"ValueNode",value:m,immediate:!0})}});function parseValueExpressionOrList(m){return isReadonlyArray(m)?parseValueExpressionList(m):parseValueExpression(m)}function parseValueExpression(m){return isExpressionOrFactory(m)?parseExpression(m):ValueNode.create(m)}function parseValueExpressionList(m){return m.some(isExpressionOrFactory)?ValueListNode.create(m.map(f=>parseValueExpression(f))):PrimitiveValueListNode.create(m)}const OrderByNode=freeze({is(m){return m.kind==="OrderByNode"},create(m){return freeze({kind:"OrderByNode",items:freeze([m])})},cloneWithItem(m,f){return freeze({...m,items:freeze([...m.items,f])})}}),PartitionByNode=freeze({is(m){return m.kind==="PartitionByNode"},create(m){return freeze({kind:"PartitionByNode",items:freeze(m)})},cloneWithItems(m,f){return freeze({...m,items:freeze([...m.items,...f])})}}),OverNode=freeze({is(m){return m.kind==="OverNode"},create(){return freeze({kind:"OverNode"})},cloneWithOrderByItem(m,f){return freeze({...m,orderBy:m.orderBy?OrderByNode.cloneWithItem(m.orderBy,f):OrderByNode.create(f)})},cloneWithPartitionByItems(m,f){return freeze({...m,partitionBy:m.partitionBy?PartitionByNode.cloneWithItems(m.partitionBy,f):PartitionByNode.create(f)})}}),FromNode=freeze({is(m){return m.kind==="FromNode"},create(m){return freeze({kind:"FromNode",froms:freeze(m)})},cloneWithFroms(m,f){return freeze({...m,froms:freeze([...m.froms,...f])})}}),GroupByNode=freeze({is(m){return m.kind==="GroupByNode"},create(m){return freeze({kind:"GroupByNode",items:freeze(m)})},cloneWithItems(m,f){return freeze({...m,items:freeze([...m.items,...f])})}}),HavingNode=freeze({is(m){return m.kind==="HavingNode"},create(m){return freeze({kind:"HavingNode",having:m})},cloneWithOperation(m,f,p){return freeze({...m,having:f==="And"?AndNode.create(m.having,p):OrNode.create(m.having,p)})}}),SelectQueryNode=freeze({is(m){return m.kind==="SelectQueryNode"},create(m,f){return freeze({kind:"SelectQueryNode",from:FromNode.create(m),...f&&{with:f}})},cloneWithSelections(m,f){return freeze({...m,selections:m.selections?freeze([...m.selections,...f]):freeze(f)})},cloneWithDistinctOn(m,f){return freeze({...m,distinctOn:m.distinctOn?freeze([...m.distinctOn,...f]):freeze(f)})},cloneWithFrontModifier(m,f){return freeze({...m,frontModifiers:m.frontModifiers?freeze([...m.frontModifiers,f]):freeze([f])})},cloneWithEndModifier(m,f){return freeze({...m,endModifiers:m.endModifiers?freeze([...m.endModifiers,f]):freeze([f])})},cloneWithOrderByItem(m,f){return freeze({...m,orderBy:m.orderBy?OrderByNode.cloneWithItem(m.orderBy,f):OrderByNode.create(f)})},cloneWithGroupByItems(m,f){return freeze({...m,groupBy:m.groupBy?GroupByNode.cloneWithItems(m.groupBy,f):GroupByNode.create(f)})},cloneWithLimit(m,f){return freeze({...m,limit:f})},cloneWithOffset(m,f){return freeze({...m,offset:f})},cloneWithHaving(m,f){return freeze({...m,having:m.having?HavingNode.cloneWithOperation(m.having,"And",f):HavingNode.create(f)})},cloneWithOrHaving(m,f){return freeze({...m,having:m.having?HavingNode.cloneWithOperation(m.having,"Or",f):HavingNode.create(f)})},cloneWithSetOperation(m,f){return freeze({...m,setOperations:m.setOperations?freeze([...m.setOperations,f]):freeze([f])})},cloneWithoutSelections(m){return freeze({...m,selections:[]})},cloneWithoutLimit(m){return freeze({...m,limit:void 0})},cloneWithoutOffset(m){return freeze({...m,offset:void 0})},cloneWithoutOrderBy(m){return freeze({...m,orderBy:void 0})}}),UnaryOperationNode=freeze({is(m){return m.kind==="UnaryOperationNode"},create(m,f){return freeze({kind:"UnaryOperationNode",operator:m,operand:f})}});function parseExists(m){return parseUnaryOperation("exists",m)}function parseNotExists(m){return parseUnaryOperation("not exists",m)}function parseUnaryOperation(m,f){return UnaryOperationNode.create(OperatorNode.create(m),parseReferenceExpression(f))}function preventAwait(m,f){Object.defineProperties(m.prototype,{then:{enumerable:!1,value:()=>{throw new Error(f)}}})}var Fe;const vt=class{constructor(f){B(this,Fe,void 0);H(this,Fe,freeze(f))}on(...f){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOn(N(this,Fe).joinNode,parseOn(f))})}orOn(...f){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOrOn(N(this,Fe).joinNode,parseOn(f))})}onRef(f,p,y){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOn(N(this,Fe).joinNode,parseReferentialComparison(f,p,y))})}orOnRef(f,p,y){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOrOn(N(this,Fe).joinNode,parseReferentialComparison(f,p,y))})}onExists(f){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOn(N(this,Fe).joinNode,parseExists(f))})}onNotExists(f){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOn(N(this,Fe).joinNode,parseNotExists(f))})}orOnExists(f){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOrOn(N(this,Fe).joinNode,parseExists(f))})}orOnNotExists(f){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOrOn(N(this,Fe).joinNode,parseNotExists(f))})}onTrue(){return new vt({...N(this,Fe),joinNode:JoinNode.cloneWithOn(N(this,Fe).joinNode,RawNode.createWithSql("true"))})}$call(f){return f(this)}toOperationNode(){return N(this,Fe).joinNode}};let JoinBuilder=vt;Fe=new WeakMap;preventAwait(JoinBuilder,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const PartitionByItemNode=freeze({is(m){return m.kind==="PartitionByItemNode"},create(m){return freeze({kind:"PartitionByItemNode",partitionBy:m})}});function parsePartitionBy(m){return parseReferenceExpressionOrList(m).map(PartitionByItemNode.create)}var dr;const Xn=class{constructor(f){B(this,dr,void 0);H(this,dr,freeze(f))}orderBy(f,p){return new Xn({overNode:OverNode.cloneWithOrderByItem(N(this,dr).overNode,parseOrderBy(f,p))})}partitionBy(f){return new Xn({overNode:OverNode.cloneWithPartitionByItems(N(this,dr).overNode,parsePartitionBy(f))})}$call(f){return f(this)}toOperationNode(){return N(this,dr).overNode}};let OverBuilder=Xn;dr=new WeakMap;preventAwait(OverBuilder,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const SelectionNode=freeze({is(m){return m.kind==="SelectionNode"},create(m){return freeze({kind:"SelectionNode",selection:m})},createSelectAll(){return freeze({kind:"SelectionNode",selection:SelectAllNode.create()})},createSelectAllFromTable(m){return freeze({kind:"SelectionNode",selection:ReferenceNode.createSelectAll(m)})}});var xr;class DynamicReferenceBuilder{constructor(f){B(this,xr,void 0);H(this,xr,f)}get dynamicReference(){return N(this,xr)}get refType(){}toOperationNode(){return parseSimpleReferenceExpression(N(this,xr))}}xr=new WeakMap;function isDynamicReferenceBuilder(m){return isObject$2(m)&&isOperationNodeSource(m)&&isString(m.dynamicReference)}function parseSelectArg(m){return isFunction(m)?parseSelectArg(m(expressionBuilder())):isReadonlyArray(m)?m.map(f=>parseSelectExpression(f)):[parseSelectExpression(m)]}function parseSelectExpression(m){return isString(m)?SelectionNode.create(parseAliasedStringReference(m)):isDynamicReferenceBuilder(m)?SelectionNode.create(m.toOperationNode()):SelectionNode.create(parseAliasedExpression(m))}function parseSelectAll(m){return m?Array.isArray(m)?m.map(parseSelectAllArg):[parseSelectAllArg(m)]:[SelectionNode.createSelectAll()]}function parseSelectAllArg(m){if(isString(m))return SelectionNode.createSelectAllFromTable(parseTable(m));throw new Error(`invalid value selectAll expression: ${JSON.stringify(m)}`)}const ValuesNode=freeze({is(m){return m.kind==="ValuesNode"},create(m){return freeze({kind:"ValuesNode",values:freeze(m)})}}),DefaultInsertValueNode=freeze({is(m){return m.kind==="DefaultInsertValueNode"},create(){return freeze({kind:"DefaultInsertValueNode"})}});function parseInsertExpression(m){const f=isFunction(m)?m(expressionBuilder()):m,p=isReadonlyArray(f)?f:freeze([f]);return parseInsertColumnsAndValues(p)}function parseInsertColumnsAndValues(m){const f=parseColumnNamesAndIndexes(m);return[freeze([...f.keys()].map(ColumnNode.create)),ValuesNode.create(m.map(p=>parseRowValues(p,f)))]}function parseColumnNamesAndIndexes(m){const f=new Map;for(const p of m){const y=Object.keys(p);for(const b of y)!f.has(b)&&p[b]!==void 0&&f.set(b,f.size)}return f}function parseRowValues(m,f){const p=Object.keys(m),y=Array.from({length:f.size});let b=!1;for(const _ of p){const v=f.get(_);if(isUndefined(v))continue;const I=m[_];(isUndefined(I)||isExpressionOrFactory(I))&&(b=!0),y[v]=I}if(p.length<f.size||b){const _=DefaultInsertValueNode.create();return ValueListNode.create(y.map(v=>isUndefined(v)?_:parseValueExpression(v)))}return PrimitiveValueListNode.create(y)}const InsertQueryNode=freeze({is(m){return m.kind==="InsertQueryNode"},create(m,f,p){return freeze({kind:"InsertQueryNode",into:m,...f&&{with:f},replace:p})},cloneWith(m,f){return freeze({...m,...f})}}),UpdateQueryNode=freeze({is(m){return m.kind==="UpdateQueryNode"},create(m,f){return freeze({kind:"UpdateQueryNode",table:m,...f&&{with:f}})},cloneWithFromItems(m,f){return freeze({...m,from:m.from?FromNode.cloneWithFroms(m.from,f):FromNode.create(f)})},cloneWithUpdates(m,f){return freeze({...m,updates:m.updates?freeze([...m.updates,...f]):f})}}),UsingNode=freeze({is(m){return m.kind==="UsingNode"},create(m){return freeze({kind:"UsingNode",tables:freeze(m)})},cloneWithTables(m,f){return freeze({...m,tables:freeze([...m.tables,...f])})}}),DeleteQueryNode=freeze({is(m){return m.kind==="DeleteQueryNode"},create(m,f){return freeze({kind:"DeleteQueryNode",from:FromNode.create(m),...f&&{with:f}})},cloneWithOrderByItem(m,f){return freeze({...m,orderBy:m.orderBy?OrderByNode.cloneWithItem(m.orderBy,f):OrderByNode.create(f)})},cloneWithLimit(m,f){return freeze({...m,limit:f})},cloneWithUsing(m,f){return freeze({...m,using:m.using!==void 0?UsingNode.cloneWithTables(m.using,f):UsingNode.create(f)})}}),WhereNode=freeze({is(m){return m.kind==="WhereNode"},create(m){return freeze({kind:"WhereNode",where:m})},cloneWithOperation(m,f,p){return freeze({...m,where:f==="And"?AndNode.create(m.where,p):OrNode.create(m.where,p)})}}),ReturningNode=freeze({is(m){return m.kind==="ReturningNode"},create(m){return freeze({kind:"ReturningNode",selections:freeze(m)})},cloneWithSelections(m,f){return freeze({...m,selections:m.selections?freeze([...m.selections,...f]):freeze(f)})}}),ExplainNode=freeze({is(m){return m.kind==="ExplainNode"},create(m,f){return freeze({kind:"ExplainNode",format:m,options:f})}}),QueryNode=freeze({is(m){return SelectQueryNode.is(m)||InsertQueryNode.is(m)||UpdateQueryNode.is(m)||DeleteQueryNode.is(m)},cloneWithWhere(m,f){return freeze({...m,where:m.where?WhereNode.cloneWithOperation(m.where,"And",f):WhereNode.create(f)})},cloneWithOrWhere(m,f){return freeze({...m,where:m.where?WhereNode.cloneWithOperation(m.where,"Or",f):WhereNode.create(f)})},cloneWithJoin(m,f){return freeze({...m,joins:m.joins?freeze([...m.joins,f]):freeze([f])})},cloneWithReturning(m,f){return freeze({...m,returning:m.returning?ReturningNode.cloneWithSelections(m.returning,f):ReturningNode.create(f)})},cloneWithoutWhere(m){return freeze({...m,where:void 0})},cloneWithExplain(m,f,p){return freeze({...m,explain:ExplainNode.create(f,p==null?void 0:p.toOperationNode())})}}),ColumnUpdateNode=freeze({is(m){return m.kind==="ColumnUpdateNode"},create(m,f){return freeze({kind:"ColumnUpdateNode",column:m,value:f})}});function parseUpdateExpression(m){const f=isFunction(m)?m(expressionBuilder()):m;return Object.entries(f).filter(([p,y])=>y!==void 0).map(([p,y])=>ColumnUpdateNode.create(ColumnNode.create(p),parseValueExpression(y)))}const OnDuplicateKeyNode=freeze({is(m){return m.kind==="OnDuplicateKeyNode"},create(m){return freeze({kind:"OnDuplicateKeyNode",updates:m})}});var fn,hn;class InsertResult{constructor(f,p){B(this,fn,void 0);B(this,hn,void 0);H(this,fn,f),H(this,hn,p)}get insertId(){return N(this,fn)}get numInsertedOrUpdatedRows(){return N(this,hn)}}fn=new WeakMap,hn=new WeakMap;for(const m of["insertId","numInsertedOrUpdatedRows"])Object.defineProperty(InsertResult.prototype,m,{enumerable:!0});class NoResultError extends Error{constructor(p){super("no result");Oe(this,"node");this.node=p}}function isNoResultErrorConstructor(m){return Object.prototype.hasOwnProperty.call(m,"prototype")}const OnConflictNode=freeze({is(m){return m.kind==="OnConflictNode"},create(){return freeze({kind:"OnConflictNode"})},cloneWith(m,f){return freeze({...m,...f})},cloneWithIndexWhere(m,f){return freeze({...m,indexWhere:m.indexWhere?WhereNode.cloneWithOperation(m.indexWhere,"And",f):WhereNode.create(f)})},cloneWithIndexOrWhere(m,f){return freeze({...m,indexWhere:m.indexWhere?WhereNode.cloneWithOperation(m.indexWhere,"Or",f):WhereNode.create(f)})},cloneWithUpdateWhere(m,f){return freeze({...m,updateWhere:m.updateWhere?WhereNode.cloneWithOperation(m.updateWhere,"And",f):WhereNode.create(f)})},cloneWithUpdateOrWhere(m,f){return freeze({...m,updateWhere:m.updateWhere?WhereNode.cloneWithOperation(m.updateWhere,"Or",f):WhereNode.create(f)})},cloneWithoutIndexWhere(m){return freeze({...m,indexWhere:void 0})},cloneWithoutUpdateWhere(m){return freeze({...m,updateWhere:void 0})}});var we;const ut=class{constructor(f){B(this,we,void 0);H(this,we,freeze(f))}column(f){const p=ColumnNode.create(f);return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWith(N(this,we).onConflictNode,{columns:N(this,we).onConflictNode.columns?freeze([...N(this,we).onConflictNode.columns,p]):freeze([p])})})}columns(f){const p=f.map(ColumnNode.create);return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWith(N(this,we).onConflictNode,{columns:N(this,we).onConflictNode.columns?freeze([...N(this,we).onConflictNode.columns,...p]):freeze(p)})})}constraint(f){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWith(N(this,we).onConflictNode,{constraint:IdentifierNode.create(f)})})}expression(f){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWith(N(this,we).onConflictNode,{indexExpression:f.toOperationNode()})})}where(...f){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithIndexWhere(N(this,we).onConflictNode,parseWhere(f))})}whereRef(f,p,y){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithIndexWhere(N(this,we).onConflictNode,parseReferentialComparison(f,p,y))})}orWhere(...f){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithIndexOrWhere(N(this,we).onConflictNode,parseWhere(f))})}orWhereRef(f,p,y){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithIndexOrWhere(N(this,we).onConflictNode,parseReferentialComparison(f,p,y))})}whereExists(f){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithIndexWhere(N(this,we).onConflictNode,parseExists(f))})}whereNotExists(f){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithIndexWhere(N(this,we).onConflictNode,parseNotExists(f))})}orWhereExists(f){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithIndexOrWhere(N(this,we).onConflictNode,parseExists(f))})}orWhereNotExists(f){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithIndexOrWhere(N(this,we).onConflictNode,parseNotExists(f))})}clearWhere(){return new ut({...N(this,we),onConflictNode:OnConflictNode.cloneWithoutIndexWhere(N(this,we).onConflictNode)})}doNothing(){return new OnConflictDoNothingBuilder({...N(this,we),onConflictNode:OnConflictNode.cloneWith(N(this,we).onConflictNode,{doNothing:!0})})}doUpdateSet(f){return new OnConflictUpdateBuilder({...N(this,we),onConflictNode:OnConflictNode.cloneWith(N(this,we).onConflictNode,{updates:parseUpdateExpression(f)})})}$call(f){return f(this)}};let OnConflictBuilder=ut;we=new WeakMap;preventAwait(OnConflictBuilder,"don't await OnConflictBuilder instances.");var pn;class OnConflictDoNothingBuilder{constructor(f){B(this,pn,void 0);H(this,pn,freeze(f))}toOperationNode(){return N(this,pn).onConflictNode}}pn=new WeakMap;preventAwait(OnConflictDoNothingBuilder,"don't await OnConflictDoNothingBuilder instances.");var Qe;const Tt=class{constructor(f){B(this,Qe,void 0);H(this,Qe,freeze(f))}where(...f){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithUpdateWhere(N(this,Qe).onConflictNode,parseWhere(f))})}whereRef(f,p,y){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithUpdateWhere(N(this,Qe).onConflictNode,parseReferentialComparison(f,p,y))})}orWhere(...f){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithUpdateOrWhere(N(this,Qe).onConflictNode,parseWhere(f))})}orWhereRef(f,p,y){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithUpdateOrWhere(N(this,Qe).onConflictNode,parseReferentialComparison(f,p,y))})}whereExists(f){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithUpdateWhere(N(this,Qe).onConflictNode,parseExists(f))})}whereNotExists(f){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithUpdateWhere(N(this,Qe).onConflictNode,parseNotExists(f))})}orWhereExists(f){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithUpdateOrWhere(N(this,Qe).onConflictNode,parseExists(f))})}orWhereNotExists(f){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithUpdateOrWhere(N(this,Qe).onConflictNode,parseNotExists(f))})}clearWhere(){return new Tt({...N(this,Qe),onConflictNode:OnConflictNode.cloneWithoutUpdateWhere(N(this,Qe).onConflictNode)})}$call(f){return f(this)}toOperationNode(){return N(this,Qe).onConflictNode}};let OnConflictUpdateBuilder=Tt;Qe=new WeakMap;preventAwait(OnConflictUpdateBuilder,"don't await OnConflictUpdateBuilder instances.");var be;const Ke=class{constructor(f){B(this,be,void 0);H(this,be,freeze(f))}values(f){const[p,y]=parseInsertExpression(f);return new Ke({...N(this,be),queryNode:InsertQueryNode.cloneWith(N(this,be).queryNode,{columns:p,values:y})})}columns(f){return new Ke({...N(this,be),queryNode:InsertQueryNode.cloneWith(N(this,be).queryNode,{columns:freeze(f.map(ColumnNode.create))})})}expression(f){return new Ke({...N(this,be),queryNode:InsertQueryNode.cloneWith(N(this,be).queryNode,{values:parseExpression(f)})})}ignore(){return new Ke({...N(this,be),queryNode:InsertQueryNode.cloneWith(N(this,be).queryNode,{ignore:!0})})}onConflict(f){return new Ke({...N(this,be),queryNode:InsertQueryNode.cloneWith(N(this,be).queryNode,{onConflict:f(new OnConflictBuilder({onConflictNode:OnConflictNode.create()})).toOperationNode()})})}onDuplicateKeyUpdate(f){return new Ke({...N(this,be),queryNode:InsertQueryNode.cloneWith(N(this,be).queryNode,{onDuplicateKey:OnDuplicateKeyNode.create(parseUpdateExpression(f))})})}returning(f){return new Ke({...N(this,be),queryNode:QueryNode.cloneWithReturning(N(this,be).queryNode,parseSelectArg(f))})}returningAll(){return new Ke({...N(this,be),queryNode:QueryNode.cloneWithReturning(N(this,be).queryNode,parseSelectAll())})}$call(f){return f(this)}call(f){return this.$call(f)}$if(f,p){return f?p(this):new Ke({...N(this,be)})}if(f,p){return f?p(this):new Ke({...N(this,be)})}$castTo(){return new Ke(N(this,be))}castTo(){return this.$castTo()}$narrowType(){return new Ke(N(this,be))}$assertType(){return new Ke(N(this,be))}assertType(){return new Ke(N(this,be))}withPlugin(f){return new Ke({...N(this,be),executor:N(this,be).executor.withPlugin(f)})}toOperationNode(){return N(this,be).executor.transformQuery(N(this,be).queryNode,N(this,be).queryId)}compile(){return N(this,be).executor.compileQuery(this.toOperationNode(),N(this,be).queryId)}async execute(){const f=this.compile(),p=f.query,y=await N(this,be).executor.executeQuery(f,N(this,be).queryId);return N(this,be).executor.adapter.supportsReturning&&p.returning?y.rows:[new InsertResult(y.insertId,y.numAffectedRows??y.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[f]=await this.execute();return f}async executeTakeFirstOrThrow(f=NoResultError){const p=await this.executeTakeFirst();if(p===void 0)throw isNoResultErrorConstructor(f)?new f(this.toOperationNode()):f(this.toOperationNode());return p}async*stream(f=100){const p=this.compile(),y=N(this,be).executor.stream(p,f,N(this,be).queryId);for await(const b of y)yield*b.rows}async explain(f,p){return await new Ke({...N(this,be),queryNode:QueryNode.cloneWithExplain(N(this,be).queryNode,f,p)}).execute()}};let InsertQueryBuilder=Ke;be=new WeakMap;preventAwait(InsertQueryBuilder,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var mn;class DeleteResult{constructor(f){B(this,mn,void 0);H(this,mn,f)}get numDeletedRows(){return N(this,mn)}}mn=new WeakMap;Object.defineProperty(DeleteResult.prototype,"numDeletedRows",{enumerable:!0});const LimitNode=freeze({is(m){return m.kind==="LimitNode"},create(m){return freeze({kind:"LimitNode",limit:ValueNode.create(m)})}});var ae;const Se=class{constructor(f){B(this,ae,void 0);H(this,ae,freeze(f))}where(...f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithWhere(N(this,ae).queryNode,parseWhere(f))})}whereRef(f,p,y){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithWhere(N(this,ae).queryNode,parseReferentialComparison(f,p,y))})}orWhere(...f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithOrWhere(N(this,ae).queryNode,parseWhere(f))})}orWhereRef(f,p,y){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithOrWhere(N(this,ae).queryNode,parseReferentialComparison(f,p,y))})}whereExists(f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithWhere(N(this,ae).queryNode,parseExists(f))})}whereNotExists(f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithWhere(N(this,ae).queryNode,parseNotExists(f))})}orWhereExists(f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithOrWhere(N(this,ae).queryNode,parseExists(f))})}orWhereNotExists(f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithOrWhere(N(this,ae).queryNode,parseNotExists(f))})}clearWhere(){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithoutWhere(N(this,ae).queryNode)})}using(f){return new Se({...N(this,ae),queryNode:DeleteQueryNode.cloneWithUsing(N(this,ae).queryNode,parseTableExpressionOrList(f))})}innerJoin(...f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithJoin(N(this,ae).queryNode,parseJoin("InnerJoin",f))})}leftJoin(...f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithJoin(N(this,ae).queryNode,parseJoin("LeftJoin",f))})}rightJoin(...f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithJoin(N(this,ae).queryNode,parseJoin("RightJoin",f))})}fullJoin(...f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithJoin(N(this,ae).queryNode,parseJoin("FullJoin",f))})}returning(f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithReturning(N(this,ae).queryNode,parseSelectArg(f))})}returningAll(f){return new Se({...N(this,ae),queryNode:QueryNode.cloneWithReturning(N(this,ae).queryNode,parseSelectAll(f))})}orderBy(f,p){return new Se({...N(this,ae),queryNode:DeleteQueryNode.cloneWithOrderByItem(N(this,ae).queryNode,parseOrderBy(f,p))})}limit(f){return new Se({...N(this,ae),queryNode:DeleteQueryNode.cloneWithLimit(N(this,ae).queryNode,LimitNode.create(f))})}$call(f){return f(this)}call(f){return this.$call(f)}$if(f,p){return f?p(this):new Se({...N(this,ae)})}if(f,p){return this.$if(f,p)}$castTo(){return new Se(N(this,ae))}castTo(){return this.$castTo()}$narrowType(){return new Se(N(this,ae))}$assertType(){return new Se(N(this,ae))}assertType(){return new Se(N(this,ae))}withPlugin(f){return new Se({...N(this,ae),executor:N(this,ae).executor.withPlugin(f)})}toOperationNode(){return N(this,ae).executor.transformQuery(N(this,ae).queryNode,N(this,ae).queryId)}compile(){return N(this,ae).executor.compileQuery(this.toOperationNode(),N(this,ae).queryId)}async execute(){const f=this.compile(),p=f.query,y=await N(this,ae).executor.executeQuery(f,N(this,ae).queryId);return N(this,ae).executor.adapter.supportsReturning&&p.returning?y.rows:[new DeleteResult(y.numAffectedRows??y.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[f]=await this.execute();return f}async executeTakeFirstOrThrow(f=NoResultError){const p=await this.executeTakeFirst();if(p===void 0)throw isNoResultErrorConstructor(f)?new f(this.toOperationNode()):f(this.toOperationNode());return p}async*stream(f=100){const p=this.compile(),y=N(this,ae).executor.stream(p,f,N(this,ae).queryId);for await(const b of y)yield*b.rows}async explain(f,p){return await new Se({...N(this,ae),queryNode:QueryNode.cloneWithExplain(N(this,ae).queryNode,f,p)}).execute()}};let DeleteQueryBuilder=Se;ae=new WeakMap;preventAwait(DeleteQueryBuilder,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var yn;class UpdateResult{constructor(f){B(this,yn,void 0);H(this,yn,f)}get numUpdatedRows(){return N(this,yn)}}yn=new WeakMap;Object.defineProperty(UpdateResult.prototype,"numUpdatedRows",{enumerable:!0});var le;const xe=class{constructor(f){B(this,le,void 0);H(this,le,freeze(f))}where(...f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithWhere(N(this,le).queryNode,parseWhere(f))})}whereRef(f,p,y){return new xe({...N(this,le),queryNode:QueryNode.cloneWithWhere(N(this,le).queryNode,parseReferentialComparison(f,p,y))})}orWhere(...f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithOrWhere(N(this,le).queryNode,parseWhere(f))})}orWhereRef(f,p,y){return new xe({...N(this,le),queryNode:QueryNode.cloneWithOrWhere(N(this,le).queryNode,parseReferentialComparison(f,p,y))})}whereExists(f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithWhere(N(this,le).queryNode,parseExists(f))})}whereNotExists(f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithWhere(N(this,le).queryNode,parseNotExists(f))})}orWhereExists(f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithOrWhere(N(this,le).queryNode,parseExists(f))})}orWhereNotExists(f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithOrWhere(N(this,le).queryNode,parseNotExists(f))})}clearWhere(){return new xe({...N(this,le),queryNode:QueryNode.cloneWithoutWhere(N(this,le).queryNode)})}from(f){return new xe({...N(this,le),queryNode:UpdateQueryNode.cloneWithFromItems(N(this,le).queryNode,parseTableExpressionOrList(f))})}innerJoin(...f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithJoin(N(this,le).queryNode,parseJoin("InnerJoin",f))})}leftJoin(...f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithJoin(N(this,le).queryNode,parseJoin("LeftJoin",f))})}rightJoin(...f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithJoin(N(this,le).queryNode,parseJoin("RightJoin",f))})}fullJoin(...f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithJoin(N(this,le).queryNode,parseJoin("FullJoin",f))})}set(f){return new xe({...N(this,le),queryNode:UpdateQueryNode.cloneWithUpdates(N(this,le).queryNode,parseUpdateExpression(f))})}returning(f){return new xe({...N(this,le),queryNode:QueryNode.cloneWithReturning(N(this,le).queryNode,parseSelectArg(f))})}returningAll(){return new xe({...N(this,le),queryNode:QueryNode.cloneWithReturning(N(this,le).queryNode,parseSelectAll())})}$call(f){return f(this)}call(f){return this.$call(f)}$if(f,p){return f?p(this):new xe({...N(this,le)})}if(f,p){return this.$if(f,p)}$castTo(){return new xe(N(this,le))}castTo(){return this.$castTo()}$narrowType(){return new xe(N(this,le))}$assertType(){return new xe(N(this,le))}assertType(){return new xe(N(this,le))}withPlugin(f){return new xe({...N(this,le),executor:N(this,le).executor.withPlugin(f)})}toOperationNode(){return N(this,le).executor.transformQuery(N(this,le).queryNode,N(this,le).queryId)}compile(){return N(this,le).executor.compileQuery(this.toOperationNode(),N(this,le).queryId)}async execute(){const f=this.compile(),p=f.query,y=await N(this,le).executor.executeQuery(f,N(this,le).queryId);return N(this,le).executor.adapter.supportsReturning&&p.returning?y.rows:[new UpdateResult(y.numAffectedRows??y.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[f]=await this.execute();return f}async executeTakeFirstOrThrow(f=NoResultError){const p=await this.executeTakeFirst();if(p===void 0)throw isNoResultErrorConstructor(f)?new f(this.toOperationNode()):f(this.toOperationNode());return p}async*stream(f=100){const p=this.compile(),y=N(this,le).executor.stream(p,f,N(this,le).queryId);for await(const b of y)yield*b.rows}async explain(f,p){return await new xe({...N(this,le),queryNode:QueryNode.cloneWithExplain(N(this,le).queryNode,f,p)}).execute()}};let UpdateQueryBuilder=xe;le=new WeakMap;preventAwait(UpdateQueryBuilder,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const CommonTableExpressionNode=freeze({is(m){return m.kind==="CommonTableExpressionNode"},create(m,f){return freeze({kind:"CommonTableExpressionNode",name:m,expression:f})}}),CommonTableExpressionNameNode=freeze({is(m){return m.kind==="CommonTableExpressionNameNode"},create(m,f){return freeze({kind:"CommonTableExpressionNameNode",table:TableNode.create(m),columns:f?freeze(f.map(ColumnNode.create)):void 0})}});function parseCommonTableExpression(m,f){const p=f(createQueryCreator());return CommonTableExpressionNode.create(parseCommonTableExpressionName(m),p.toOperationNode())}function parseCommonTableExpressionName(m){if(m.includes("(")){const f=m.split(/[\(\)]/),p=f[0],y=f[1].split(",").map(b=>b.trim());return CommonTableExpressionNameNode.create(p,y)}else return CommonTableExpressionNameNode.create(m)}const WithNode=freeze({is(m){return m.kind==="WithNode"},create(m,f){return freeze({kind:"WithNode",expressions:freeze([m]),...f})},cloneWithExpression(m,f){return freeze({...m,expressions:freeze([...m.expressions,f])})}}),CHARS=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function randomString(m){let f="";for(let p=0;p<m;++p)f+=randomChar();return f}function randomChar(){return CHARS[~~(Math.random()*CHARS.length)]}function createQueryId(){return new LazyQueryId}var kr;class LazyQueryId{constructor(){B(this,kr,void 0)}get queryId(){return N(this,kr)===void 0&&H(this,kr,randomString(8)),N(this,kr)}}kr=new WeakMap;function requireAllProps(m){return m}var Yn;class OperationNodeTransformer{constructor(){Oe(this,"nodeStack",[]);B(this,Yn,freeze({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this)}))}transformNode(f){if(!f)return f;this.nodeStack.push(f);const p=this.transformNodeImpl(f);return this.nodeStack.pop(),freeze(p)}transformNodeImpl(f){return N(this,Yn)[f.kind](f)}transformNodeList(f){return f&&freeze(f.map(p=>this.transformNode(p)))}transformSelectQuery(f){return{kind:"SelectQueryNode",from:this.transformNode(f.from),selections:this.transformNodeList(f.selections),distinctOn:this.transformNodeList(f.distinctOn),joins:this.transformNodeList(f.joins),groupBy:this.transformNode(f.groupBy),orderBy:this.transformNode(f.orderBy),where:this.transformNode(f.where),frontModifiers:this.transformNodeList(f.frontModifiers),endModifiers:this.transformNodeList(f.endModifiers),limit:this.transformNode(f.limit),offset:this.transformNode(f.offset),with:this.transformNode(f.with),having:this.transformNode(f.having),explain:this.transformNode(f.explain),setOperations:this.transformNodeList(f.setOperations)}}transformSelection(f){return{kind:"SelectionNode",selection:this.transformNode(f.selection)}}transformColumn(f){return{kind:"ColumnNode",column:this.transformNode(f.column)}}transformAlias(f){return{kind:"AliasNode",node:this.transformNode(f.node),alias:this.transformNode(f.alias)}}transformTable(f){return{kind:"TableNode",table:this.transformNode(f.table)}}transformFrom(f){return{kind:"FromNode",froms:this.transformNodeList(f.froms)}}transformReference(f){return{kind:"ReferenceNode",table:this.transformNode(f.table),column:this.transformNode(f.column)}}transformAnd(f){return{kind:"AndNode",left:this.transformNode(f.left),right:this.transformNode(f.right)}}transformOr(f){return{kind:"OrNode",left:this.transformNode(f.left),right:this.transformNode(f.right)}}transformValueList(f){return{kind:"ValueListNode",values:this.transformNodeList(f.values)}}transformParens(f){return{kind:"ParensNode",node:this.transformNode(f.node)}}transformJoin(f){return{kind:"JoinNode",joinType:f.joinType,table:this.transformNode(f.table),on:this.transformNode(f.on)}}transformRaw(f){return{kind:"RawNode",sqlFragments:freeze([...f.sqlFragments]),parameters:this.transformNodeList(f.parameters)}}transformWhere(f){return{kind:"WhereNode",where:this.transformNode(f.where)}}transformInsertQuery(f){return{kind:"InsertQueryNode",into:this.transformNode(f.into),columns:this.transformNodeList(f.columns),values:this.transformNode(f.values),returning:this.transformNode(f.returning),onConflict:this.transformNode(f.onConflict),onDuplicateKey:this.transformNode(f.onDuplicateKey),with:this.transformNode(f.with),ignore:f.ignore,replace:f.replace,explain:this.transformNode(f.explain)}}transformValues(f){return{kind:"ValuesNode",values:this.transformNodeList(f.values)}}transformDeleteQuery(f){return{kind:"DeleteQueryNode",from:this.transformNode(f.from),using:this.transformNode(f.using),joins:this.transformNodeList(f.joins),where:this.transformNode(f.where),returning:this.transformNode(f.returning),with:this.transformNode(f.with),orderBy:this.transformNode(f.orderBy),limit:this.transformNode(f.limit),explain:this.transformNode(f.explain)}}transformReturning(f){return{kind:"ReturningNode",selections:this.transformNodeList(f.selections)}}transformCreateTable(f){return{kind:"CreateTableNode",table:this.transformNode(f.table),columns:this.transformNodeList(f.columns),constraints:this.transformNodeList(f.constraints),temporary:f.temporary,ifNotExists:f.ifNotExists,onCommit:f.onCommit,frontModifiers:this.transformNodeList(f.frontModifiers),endModifiers:this.transformNodeList(f.endModifiers)}}transformColumnDefinition(f){return{kind:"ColumnDefinitionNode",column:this.transformNode(f.column),dataType:this.transformNode(f.dataType),references:this.transformNode(f.references),primaryKey:f.primaryKey,autoIncrement:f.autoIncrement,unique:f.unique,notNull:f.notNull,unsigned:f.unsigned,defaultTo:this.transformNode(f.defaultTo),check:this.transformNode(f.check),generated:this.transformNode(f.generated),frontModifiers:this.transformNodeList(f.frontModifiers),endModifiers:this.transformNodeList(f.endModifiers)}}transformAddColumn(f){return{kind:"AddColumnNode",column:this.transformNode(f.column)}}transformDropTable(f){return{kind:"DropTableNode",table:this.transformNode(f.table),ifExists:f.ifExists,cascade:f.cascade}}transformOrderBy(f){return{kind:"OrderByNode",items:this.transformNodeList(f.items)}}transformOrderByItem(f){return{kind:"OrderByItemNode",orderBy:this.transformNode(f.orderBy),direction:this.transformNode(f.direction)}}transformGroupBy(f){return{kind:"GroupByNode",items:this.transformNodeList(f.items)}}transformGroupByItem(f){return{kind:"GroupByItemNode",groupBy:this.transformNode(f.groupBy)}}transformUpdateQuery(f){return{kind:"UpdateQueryNode",table:this.transformNode(f.table),from:this.transformNode(f.from),joins:this.transformNodeList(f.joins),where:this.transformNode(f.where),updates:this.transformNodeList(f.updates),returning:this.transformNode(f.returning),with:this.transformNode(f.with),explain:this.transformNode(f.explain)}}transformColumnUpdate(f){return{kind:"ColumnUpdateNode",column:this.transformNode(f.column),value:this.transformNode(f.value)}}transformLimit(f){return{kind:"LimitNode",limit:this.transformNode(f.limit)}}transformOffset(f){return{kind:"OffsetNode",offset:this.transformNode(f.offset)}}transformOnConflict(f){return{kind:"OnConflictNode",columns:this.transformNodeList(f.columns),constraint:this.transformNode(f.constraint),indexExpression:this.transformNode(f.indexExpression),indexWhere:this.transformNode(f.indexWhere),updates:this.transformNodeList(f.updates),updateWhere:this.transformNode(f.updateWhere),doNothing:f.doNothing}}transformOnDuplicateKey(f){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(f.updates)}}transformCreateIndex(f){return{kind:"CreateIndexNode",name:this.transformNode(f.name),table:this.transformNode(f.table),columns:this.transformNodeList(f.columns),unique:f.unique,using:this.transformNode(f.using),ifNotExists:f.ifNotExists,where:this.transformNode(f.where)}}transformList(f){return{kind:"ListNode",items:this.transformNodeList(f.items)}}transformDropIndex(f){return{kind:"DropIndexNode",name:this.transformNode(f.name),table:this.transformNode(f.table),ifExists:f.ifExists,cascade:f.cascade}}transformPrimaryKeyConstraint(f){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(f.columns),name:this.transformNode(f.name)}}transformUniqueConstraint(f){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(f.columns),name:this.transformNode(f.name)}}transformForeignKeyConstraint(f){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(f.columns),references:this.transformNode(f.references),name:this.transformNode(f.name),onDelete:f.onDelete,onUpdate:f.onUpdate}}transformSetOperation(f){return{kind:"SetOperationNode",operator:f.operator,expression:this.transformNode(f.expression),all:f.all}}transformReferences(f){return{kind:"ReferencesNode",table:this.transformNode(f.table),columns:this.transformNodeList(f.columns),onDelete:f.onDelete,onUpdate:f.onUpdate}}transformCheckConstraint(f){return{kind:"CheckConstraintNode",expression:this.transformNode(f.expression),name:this.transformNode(f.name)}}transformWith(f){return{kind:"WithNode",expressions:this.transformNodeList(f.expressions),recursive:f.recursive}}transformCommonTableExpression(f){return{kind:"CommonTableExpressionNode",name:this.transformNode(f.name),expression:this.transformNode(f.expression)}}transformCommonTableExpressionName(f){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(f.table),columns:this.transformNodeList(f.columns)}}transformHaving(f){return{kind:"HavingNode",having:this.transformNode(f.having)}}transformCreateSchema(f){return{kind:"CreateSchemaNode",schema:this.transformNode(f.schema),ifNotExists:f.ifNotExists}}transformDropSchema(f){return{kind:"DropSchemaNode",schema:this.transformNode(f.schema),ifExists:f.ifExists,cascade:f.cascade}}transformAlterTable(f){return{kind:"AlterTableNode",table:this.transformNode(f.table),renameTo:this.transformNode(f.renameTo),setSchema:this.transformNode(f.setSchema),columnAlterations:this.transformNodeList(f.columnAlterations),addConstraint:this.transformNode(f.addConstraint),dropConstraint:this.transformNode(f.dropConstraint)}}transformDropColumn(f){return{kind:"DropColumnNode",column:this.transformNode(f.column)}}transformRenameColumn(f){return{kind:"RenameColumnNode",column:this.transformNode(f.column),renameTo:this.transformNode(f.renameTo)}}transformAlterColumn(f){return{kind:"AlterColumnNode",column:this.transformNode(f.column),dataType:this.transformNode(f.dataType),dataTypeExpression:this.transformNode(f.dataTypeExpression),setDefault:this.transformNode(f.setDefault),dropDefault:f.dropDefault,setNotNull:f.setNotNull,dropNotNull:f.dropNotNull}}transformModifyColumn(f){return{kind:"ModifyColumnNode",column:this.transformNode(f.column)}}transformAddConstraint(f){return{kind:"AddConstraintNode",constraint:this.transformNode(f.constraint)}}transformDropConstraint(f){return{kind:"DropConstraintNode",constraintName:this.transformNode(f.constraintName),ifExists:f.ifExists,modifier:f.modifier}}transformCreateView(f){return{kind:"CreateViewNode",name:this.transformNode(f.name),temporary:f.temporary,orReplace:f.orReplace,ifNotExists:f.ifNotExists,materialized:f.materialized,columns:this.transformNodeList(f.columns),as:this.transformNode(f.as)}}transformDropView(f){return{kind:"DropViewNode",name:this.transformNode(f.name),ifExists:f.ifExists,materialized:f.materialized,cascade:f.cascade}}transformGenerated(f){return{kind:"GeneratedNode",byDefault:f.byDefault,always:f.always,identity:f.identity,stored:f.stored,expression:this.transformNode(f.expression)}}transformDefaultValue(f){return{kind:"DefaultValueNode",defaultValue:this.transformNode(f.defaultValue)}}transformOn(f){return{kind:"OnNode",on:this.transformNode(f.on)}}transformSelectModifier(f){return{kind:"SelectModifierNode",modifier:f.modifier,rawModifier:this.transformNode(f.rawModifier)}}transformCreateType(f){return{kind:"CreateTypeNode",name:this.transformNode(f.name),enum:this.transformNode(f.enum)}}transformDropType(f){return{kind:"DropTypeNode",name:this.transformNode(f.name),ifExists:f.ifExists}}transformExplain(f){return{kind:"ExplainNode",format:f.format,options:this.transformNode(f.options)}}transformSchemableIdentifier(f){return{kind:"SchemableIdentifierNode",schema:this.transformNode(f.schema),identifier:this.transformNode(f.identifier)}}transformAggregateFunction(f){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(f.aggregated),distinct:f.distinct,filter:this.transformNode(f.filter),func:f.func,over:this.transformNode(f.over)}}transformOver(f){return{kind:"OverNode",orderBy:this.transformNode(f.orderBy),partitionBy:this.transformNode(f.partitionBy)}}transformPartitionBy(f){return{kind:"PartitionByNode",items:this.transformNodeList(f.items)}}transformPartitionByItem(f){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(f.partitionBy)}}transformBinaryOperation(f){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(f.leftOperand),operator:this.transformNode(f.operator),rightOperand:this.transformNode(f.rightOperand)}}transformUnaryOperation(f){return{kind:"UnaryOperationNode",operator:this.transformNode(f.operator),operand:this.transformNode(f.operand)}}transformUsing(f){return{kind:"UsingNode",tables:this.transformNodeList(f.tables)}}transformFunction(f){return{kind:"FunctionNode",func:f.func,arguments:this.transformNodeList(f.arguments)}}transformCase(f){return{kind:"CaseNode",value:this.transformNode(f.value),when:this.transformNodeList(f.when),else:this.transformNode(f.else),isStatement:f.isStatement}}transformWhen(f){return{kind:"WhenNode",condition:this.transformNode(f.condition),result:this.transformNode(f.result)}}transformDataType(f){return f}transformSelectAll(f){return f}transformIdentifier(f){return f}transformValue(f){return f}transformPrimitiveValueList(f){return f}transformOperator(f){return f}transformDefaultInsertValue(f){return f}}Yn=new WeakMap;const ROOT_OPERATION_NODES=freeze({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});var Ar,fr,Zn,_o,ei,Oo,hr,an,Nn,Bi,ti,vo;class WithSchemaTransformer extends OperationNodeTransformer{constructor(p){super();B(this,Zn);B(this,ei);B(this,hr);B(this,Nn);B(this,ti);B(this,Ar,void 0);B(this,fr,new Set);H(this,Ar,p)}transformNodeImpl(p){if(!Ne(this,Zn,_o).call(this,p))return super.transformNodeImpl(p);const y=Ne(this,ei,Oo).call(this,p);for(const E of y)N(this,fr).add(E);const b=super.transformNodeImpl(p);for(const E of y)N(this,fr).delete(E);return b}transformSchemableIdentifier(p){const y=super.transformSchemableIdentifier(p);return y.schema||!N(this,fr).has(p.identifier.name)?y:{...y,schema:IdentifierNode.create(N(this,Ar))}}transformReferences(p){const y=super.transformReferences(p);return y.table.table.schema?y:{...y,table:TableNode.createWithSchema(N(this,Ar),y.table.table.identifier.name)}}}Ar=new WeakMap,fr=new WeakMap,Zn=new WeakSet,_o=function(p){return p.kind in ROOT_OPERATION_NODES},ei=new WeakSet,Oo=function(p){const y=new Set;if("name"in p&&p.name&&SchemableIdentifierNode.is(p.name)&&Ne(this,Nn,Bi).call(this,p.name,y),"from"in p&&p.from)for(const b of p.from.froms)Ne(this,hr,an).call(this,b,y);if("into"in p&&p.into&&Ne(this,hr,an).call(this,p.into,y),"table"in p&&p.table&&Ne(this,hr,an).call(this,p.table,y),"joins"in p&&p.joins)for(const b of p.joins)Ne(this,hr,an).call(this,b.table,y);return"with"in p&&p.with&&Ne(this,ti,vo).call(this,p.with,y),y},hr=new WeakSet,an=function(p,y){const b=TableNode.is(p)?p:AliasNode.is(p)&&TableNode.is(p.node)?p.node:null;b&&Ne(this,Nn,Bi).call(this,b.table,y)},Nn=new WeakSet,Bi=function(p,y){N(this,fr).has(p.identifier.name)||y.add(p.identifier.name)},ti=new WeakSet,vo=function(p,y){for(const b of p.expressions)y.delete(b.name.table.table.identifier.name)};var bn;class WithSchemaPlugin{constructor(f){B(this,bn,void 0);H(this,bn,new WithSchemaTransformer(f))}transformQuery(f){return N(this,bn).transformNode(f.node)}async transformResult(f){return f.result}}bn=new WeakMap;var ke;const ur=class{constructor(f){B(this,ke,void 0);H(this,ke,freeze(f))}selectFrom(f){return new SelectQueryBuilder({queryId:createQueryId(),executor:N(this,ke).executor,queryNode:SelectQueryNode.create(parseTableExpressionOrList(f),N(this,ke).withNode)})}insertInto(f){return new InsertQueryBuilder({queryId:createQueryId(),executor:N(this,ke).executor,queryNode:InsertQueryNode.create(parseTable(f),N(this,ke).withNode)})}replaceInto(f){return new InsertQueryBuilder({queryId:createQueryId(),executor:N(this,ke).executor,queryNode:InsertQueryNode.create(parseTable(f),N(this,ke).withNode,!0)})}deleteFrom(f){return new DeleteQueryBuilder({queryId:createQueryId(),executor:N(this,ke).executor,queryNode:DeleteQueryNode.create(parseTableExpressionOrList(f),N(this,ke).withNode)})}updateTable(f){return new UpdateQueryBuilder({queryId:createQueryId(),executor:N(this,ke).executor,queryNode:UpdateQueryNode.create(parseTableExpression(f),N(this,ke).withNode)})}with(f,p){const y=parseCommonTableExpression(f,p);return new ur({...N(this,ke),withNode:N(this,ke).withNode?WithNode.cloneWithExpression(N(this,ke).withNode,y):WithNode.create(y)})}withRecursive(f,p){const y=parseCommonTableExpression(f,p);return new ur({...N(this,ke),withNode:N(this,ke).withNode?WithNode.cloneWithExpression(N(this,ke).withNode,y):WithNode.create(y,{recursive:!0})})}withPlugin(f){return new ur({...N(this,ke),executor:N(this,ke).executor.withPlugin(f)})}withoutPlugins(){return new ur({...N(this,ke),executor:N(this,ke).executor.withoutPlugins()})}withSchema(f){return new ur({...N(this,ke),executor:N(this,ke).executor.withPluginAtFront(new WithSchemaPlugin(f))})}};let QueryCreator=ur;ke=new WeakMap;var wn,Lr,qr;class Deferred{constructor(){B(this,wn,void 0);B(this,Lr,void 0);B(this,qr,void 0);Oe(this,"resolve",f=>{N(this,Lr)&&N(this,Lr).call(this,f)});Oe(this,"reject",f=>{N(this,qr)&&N(this,qr).call(this,f)});H(this,wn,new Promise((f,p)=>{H(this,qr,p),H(this,Lr,f)}))}get promise(){return N(this,wn)}}wn=new WeakMap,Lr=new WeakMap,qr=new WeakMap;const LOGGED_MESSAGES=new Set;function logOnce(m){LOGGED_MESSAGES.has(m)||(LOGGED_MESSAGES.add(m),console.log(m))}const NO_PLUGINS=freeze([]);var pr,En,Fi;class QueryExecutorBase{constructor(f=NO_PLUGINS){B(this,En);B(this,pr,void 0);H(this,pr,f)}get plugins(){return N(this,pr)}transformQuery(f,p){for(const y of N(this,pr)){const b=y.transformQuery({node:f,queryId:p});if(b.kind===f.kind)f=b;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${f.kind}`,`but it returned a ${b.kind}`].join(" "))}return f}async executeQuery(f,p){return await this.provideConnection(async y=>{const b=await y.executeQuery(f),E=await Ne(this,En,Fi).call(this,b,p);return warnOfOutdatedDriverOrPlugins(b,E),E})}async*stream(f,p,y){const b=new Deferred,E=new Deferred;this.provideConnection(async v=>(b.resolve(v),await E.promise)).catch(v=>b.reject(v));const _=await b.promise;try{for await(const v of _.streamQuery(f,p))yield await Ne(this,En,Fi).call(this,v,y)}finally{E.resolve()}}}pr=new WeakMap,En=new WeakSet,Fi=async function(f,p){for(const y of N(this,pr))f=await y.transformResult({result:f,queryId:p});return f};function warnOfOutdatedDriverOrPlugins(m,f){const{numAffectedRows:p}=m;p===void 0&&m.numUpdatedOrDeletedRows===void 0||p!==void 0&&f.numAffectedRows!==void 0||logOnce("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class NoopQueryExecutor extends QueryExecutorBase{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(f){return new NoopQueryExecutor([...this.plugins,f])}withPlugins(f){return new NoopQueryExecutor([...this.plugins,...f])}withPluginAtFront(f){return new NoopQueryExecutor([f,...this.plugins])}withoutPlugins(){return new NoopQueryExecutor([])}}const NOOP_QUERY_EXECUTOR=new NoopQueryExecutor;function createSelectQueryBuilder(){return new SelectQueryBuilder({queryId:createQueryId(),executor:NOOP_QUERY_EXECUTOR,queryNode:SelectQueryNode.create(parseTableExpressionOrList([]))})}function createQueryCreator(){return new QueryCreator({executor:NOOP_QUERY_EXECUTOR})}function createJoinBuilder(m,f){return new JoinBuilder({joinNode:JoinNode.create(m,parseTableExpression(f))})}function createOverBuilder(){return new OverBuilder({overNode:OverNode.create()})}const WhenNode=freeze({is(m){return m.kind==="WhenNode"},create(m){return freeze({kind:"WhenNode",condition:m})},cloneWithResult(m,f){return freeze({...m,result:f})}}),CaseNode=freeze({is(m){return m.kind==="CaseNode"},create(m){return freeze({kind:"CaseNode",value:m})},cloneWithWhen(m,f){return freeze({...m,when:freeze(m.when?[...m.when,f]:[f])})},cloneWithThen(m,f){return freeze({...m,when:m.when?freeze([...m.when.slice(0,-1),WhenNode.cloneWithResult(m.when[m.when.length-1],f)]):void 0})},cloneWith(m,f){return freeze({...m,...f})}});function parseValueBinaryOperation(m,f,p){if(!isBinaryOperator(f)&&!isOperationNodeSource(f))throw new Error(`invalid binary operator ${JSON.stringify(f)}`);return isIsComparison(f,p)?parseIs(m,f,p):BinaryOperationNode.create(parseReferenceExpression(m),parseOperator(f),parseValueExpressionOrList(p))}function parseReferentialBinaryOperation(m,f,p){if(!isBinaryOperator(f)&&!isOperationNodeSource(f))throw new Error(`invalid binary operator ${JSON.stringify(f)}`);return BinaryOperationNode.create(parseReferenceExpression(m),parseOperator(f),parseReferenceExpression(p))}function parseValueComparison(m,f,p){if(!isComparisonOperator(f)&&!isOperationNodeSource(f))throw new Error(`invalid comparison operator ${JSON.stringify(f)}`);return parseValueBinaryOperation(m,f,p)}function parseReferentialComparison(m,f,p){if(!isComparisonOperator(f)&&!isOperationNodeSource(f))throw new Error(`invalid comparison operator ${JSON.stringify(f)}`);return parseReferentialBinaryOperation(m,f,p)}function parseWhere(m){return parseFilter("where",m)}function parseHaving(m){return parseFilter("having",m)}function parseOn(m){return parseFilter("on",m)}function parseWhen(m){return parseFilter("when",m)}function parseFilter(m,f){if(f.length===3)return parseValueComparison(f[0],f[1],f[2]);if(f.length===1)return parseOneArgFilterExpression(m,f[0]);throw createFilterExpressionError(m,f)}function isIsComparison(m,f){return(m==="is"||m==="is not")&&(isNull(f)||isBoolean(f))}function parseIs(m,f,p){return BinaryOperationNode.create(parseReferenceExpression(m),parseOperator(f),ValueNode.createImmediate(p))}function parseOperator(m){if(isString(m)&&OPERATORS.includes(m))return OperatorNode.create(m);if(isOperationNodeSource(m))return m.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(m)}`)}function parseOneArgFilterExpression(m,f){if(isFunction(f)){if(m==="when")throw new Error("when method doesn't accept a callback as an argument");return CALLBACK_PARSERS[m](f)}else if(isOperationNodeSource(f)){const p=f.toOperationNode();if(RawNode.is(p)||BinaryOperationNode.is(p)||UnaryOperationNode.is(p)||ParensNode.is(p)||CaseNode.is(p))return p}else if(m==="when")return ValueNode.create(f);throw createFilterExpressionError(m,f)}function createFilterExpressionError(m,f){return new Error(`invalid arguments passed to a '${m}' method: ${JSON.stringify(f)}`)}const CALLBACK_PARSERS=freeze({where(m){const f=createSelectQueryBuilder(),p=expressionBuilder(),b=m(Object.assign(f,p)).toOperationNode();if(SelectQueryNode.is(b)){if(!b.where)throw new Error("no `where` methods called inside a group callback");return ParensNode.create(b.where.where)}else return b},having(m){const f=createSelectQueryBuilder(),p=expressionBuilder(),b=m(Object.assign(f,p)).toOperationNode();if(SelectQueryNode.is(b)){if(!b.having)throw new Error("no `having` methods called inside a group callback");return ParensNode.create(b.having.having)}else return b},on(m){const f=createJoinBuilder("InnerJoin","table"),p=expressionBuilder(),b=m(Object.assign(f,p)).toOperationNode();if(JoinNode.is(b)){if(!b.on)throw new Error("no `on` methods called inside a group callback");return ParensNode.create(b.on.on)}else return b}});function parseJoin(m,f){if(f.length===3)return parseSingleOnJoin(m,f[0],f[1],f[2]);if(f.length===2)return parseCallbackJoin(m,f[0],f[1]);throw new Error("not implemented")}function parseCallbackJoin(m,f,p){return p(createJoinBuilder(m,f)).toOperationNode()}function parseSingleOnJoin(m,f,p,y){return JoinNode.createWithOn(m,parseTableExpression(f),parseReferentialComparison(p,"=",y))}const OffsetNode=freeze({is(m){return m.kind==="OffsetNode"},create(m){return freeze({kind:"OffsetNode",offset:ValueNode.create(m)})}}),GroupByItemNode=freeze({is(m){return m.kind==="GroupByItemNode"},create(m){return freeze({kind:"GroupByItemNode",groupBy:m})}});function parseGroupBy(m){return m=isFunction(m)?m(expressionBuilder()):m,parseReferenceExpressionOrList(m).map(GroupByItemNode.create)}const SetOperationNode=freeze({is(m){return m.kind==="SetOperationNode"},create(m,f,p){return freeze({kind:"SetOperationNode",operator:m,expression:f,all:p})}});function parseSetOperation(m,f,p){return SetOperationNode.create(m,f.toOperationNode(),p)}var Q;const oe=class{constructor(f){B(this,Q,void 0);H(this,Q,freeze(f))}get expressionType(){}where(...f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithWhere(N(this,Q).queryNode,parseWhere(f))})}whereRef(f,p,y){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithWhere(N(this,Q).queryNode,parseReferentialComparison(f,p,y))})}orWhere(...f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithOrWhere(N(this,Q).queryNode,parseWhere(f))})}orWhereRef(f,p,y){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithOrWhere(N(this,Q).queryNode,parseReferentialComparison(f,p,y))})}whereExists(f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithWhere(N(this,Q).queryNode,parseExists(f))})}whereNotExists(f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithWhere(N(this,Q).queryNode,parseNotExists(f))})}orWhereExists(f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithOrWhere(N(this,Q).queryNode,parseExists(f))})}orWhereNotExists(f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithOrWhere(N(this,Q).queryNode,parseNotExists(f))})}having(...f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithHaving(N(this,Q).queryNode,parseHaving(f))})}havingRef(f,p,y){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithHaving(N(this,Q).queryNode,parseReferentialComparison(f,p,y))})}orHaving(...f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithOrHaving(N(this,Q).queryNode,parseHaving(f))})}orHavingRef(f,p,y){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithOrHaving(N(this,Q).queryNode,parseReferentialComparison(f,p,y))})}havingExists(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithHaving(N(this,Q).queryNode,parseExists(f))})}havingNotExist(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithHaving(N(this,Q).queryNode,parseNotExists(f))})}havingNotExists(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithHaving(N(this,Q).queryNode,parseNotExists(f))})}orHavingExists(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithOrHaving(N(this,Q).queryNode,parseExists(f))})}orHavingNotExists(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithOrHaving(N(this,Q).queryNode,parseNotExists(f))})}select(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithSelections(N(this,Q).queryNode,parseSelectArg(f))})}distinctOn(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithDistinctOn(N(this,Q).queryNode,parseReferenceExpressionOrList(f))})}modifyFront(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithFrontModifier(N(this,Q).queryNode,SelectModifierNode.createWithExpression(f.toOperationNode()))})}modifyEnd(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithEndModifier(N(this,Q).queryNode,SelectModifierNode.createWithExpression(f.toOperationNode()))})}distinct(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithFrontModifier(N(this,Q).queryNode,SelectModifierNode.create("Distinct"))})}forUpdate(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithEndModifier(N(this,Q).queryNode,SelectModifierNode.create("ForUpdate"))})}forShare(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithEndModifier(N(this,Q).queryNode,SelectModifierNode.create("ForShare"))})}forKeyShare(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithEndModifier(N(this,Q).queryNode,SelectModifierNode.create("ForKeyShare"))})}forNoKeyUpdate(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithEndModifier(N(this,Q).queryNode,SelectModifierNode.create("ForNoKeyUpdate"))})}skipLocked(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithEndModifier(N(this,Q).queryNode,SelectModifierNode.create("SkipLocked"))})}noWait(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithEndModifier(N(this,Q).queryNode,SelectModifierNode.create("NoWait"))})}selectAll(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithSelections(N(this,Q).queryNode,parseSelectAll(f))})}innerJoin(...f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithJoin(N(this,Q).queryNode,parseJoin("InnerJoin",f))})}leftJoin(...f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithJoin(N(this,Q).queryNode,parseJoin("LeftJoin",f))})}rightJoin(...f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithJoin(N(this,Q).queryNode,parseJoin("RightJoin",f))})}fullJoin(...f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithJoin(N(this,Q).queryNode,parseJoin("FullJoin",f))})}innerJoinLateral(...f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithJoin(N(this,Q).queryNode,parseJoin("LateralInnerJoin",f))})}leftJoinLateral(...f){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithJoin(N(this,Q).queryNode,parseJoin("LateralLeftJoin",f))})}orderBy(f,p){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithOrderByItem(N(this,Q).queryNode,parseOrderBy(f,p))})}groupBy(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithGroupByItems(N(this,Q).queryNode,parseGroupBy(f))})}limit(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithLimit(N(this,Q).queryNode,LimitNode.create(f))})}offset(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithOffset(N(this,Q).queryNode,OffsetNode.create(f))})}union(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithSetOperation(N(this,Q).queryNode,parseSetOperation("union",f,!1))})}unionAll(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithSetOperation(N(this,Q).queryNode,parseSetOperation("union",f,!0))})}intersect(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithSetOperation(N(this,Q).queryNode,parseSetOperation("intersect",f,!1))})}intersectAll(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithSetOperation(N(this,Q).queryNode,parseSetOperation("intersect",f,!0))})}except(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithSetOperation(N(this,Q).queryNode,parseSetOperation("except",f,!1))})}exceptAll(f){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithSetOperation(N(this,Q).queryNode,parseSetOperation("except",f,!0))})}as(f){return new AliasedSelectQueryBuilder(this,f)}clearSelect(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithoutSelections(N(this,Q).queryNode)})}clearWhere(){return new oe({...N(this,Q),queryNode:QueryNode.cloneWithoutWhere(N(this,Q).queryNode)})}clearLimit(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithoutLimit(N(this,Q).queryNode)})}clearOffset(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithoutOffset(N(this,Q).queryNode)})}clearOrderBy(){return new oe({...N(this,Q),queryNode:SelectQueryNode.cloneWithoutOrderBy(N(this,Q).queryNode)})}$call(f){return f(this)}call(f){return this.$call(f)}$if(f,p){return f?p(this):new oe({...N(this,Q)})}if(f,p){return this.$if(f,p)}$castTo(){return new oe(N(this,Q))}castTo(){return this.$castTo()}$narrowType(){return new oe(N(this,Q))}$assertType(){return new oe(N(this,Q))}assertType(){return new oe(N(this,Q))}withPlugin(f){return new oe({...N(this,Q),executor:N(this,Q).executor.withPlugin(f)})}toOperationNode(){return N(this,Q).executor.transformQuery(N(this,Q).queryNode,N(this,Q).queryId)}compile(){return N(this,Q).executor.compileQuery(this.toOperationNode(),N(this,Q).queryId)}async execute(){const f=this.compile();return(await N(this,Q).executor.executeQuery(f,N(this,Q).queryId)).rows}async executeTakeFirst(){const[f]=await this.execute();return f}async executeTakeFirstOrThrow(f=NoResultError){const p=await this.executeTakeFirst();if(p===void 0)throw isNoResultErrorConstructor(f)?new f(this.toOperationNode()):f(this.toOperationNode());return p}async*stream(f=100){const p=this.compile(),y=N(this,Q).executor.stream(p,f,N(this,Q).queryId);for await(const b of y)yield*b.rows}async explain(f,p){return await new oe({...N(this,Q),queryNode:QueryNode.cloneWithExplain(N(this,Q).queryNode,f,p)}).execute()}};let SelectQueryBuilder=oe;Q=new WeakMap;preventAwait(SelectQueryBuilder,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Wr,Dr;class AliasedSelectQueryBuilder{constructor(f,p){B(this,Wr,void 0);B(this,Dr,void 0);H(this,Wr,f),H(this,Dr,p)}get expression(){return N(this,Wr)}get alias(){return N(this,Dr)}toOperationNode(){return AliasNode.create(N(this,Wr).toOperationNode(),IdentifierNode.create(N(this,Dr)))}}Wr=new WeakMap,Dr=new WeakMap;var Br;const Ui=class{constructor(f){B(this,Br,void 0);H(this,Br,f)}get expressionType(){}as(f){return new AliasedExpressionWrapper(this,f)}$castTo(){return new Ui(N(this,Br))}toOperationNode(){return N(this,Br)}};let ExpressionWrapper=Ui;Br=new WeakMap;var Fr,Zt;class AliasedExpressionWrapper{constructor(f,p){B(this,Fr,void 0);B(this,Zt,void 0);H(this,Fr,f),H(this,Zt,p)}get expression(){return N(this,Fr)}get alias(){return N(this,Zt)}toOperationNode(){return AliasNode.create(N(this,Fr).toOperationNode(),isOperationNodeSource(N(this,Zt))?N(this,Zt).toOperationNode():IdentifierNode.create(N(this,Zt)))}}Fr=new WeakMap,Zt=new WeakMap;const AggregateFunctionNode=freeze({is(m){return m.kind==="AggregateFunctionNode"},create(m,f=[]){return freeze({kind:"AggregateFunctionNode",func:m,aggregated:f})},cloneWithDistinct(m){return freeze({...m,distinct:!0})},cloneWithFilter(m,f){return freeze({...m,filter:m.filter?WhereNode.cloneWithOperation(m.filter,"And",f):WhereNode.create(f)})},cloneWithOrFilter(m,f){return freeze({...m,filter:m.filter?WhereNode.cloneWithOperation(m.filter,"Or",f):WhereNode.create(f)})},cloneWithOver(m,f){return freeze({...m,over:f})}}),FunctionNode=freeze({is(m){return m.kind==="FunctionNode"},create(m,f){return freeze({kind:"FunctionNode",func:m,arguments:f})}});var Le;const Et=class{constructor(f){B(this,Le,void 0);H(this,Le,freeze(f))}get expressionType(){}as(f){return new AliasedAggregateFunctionBuilder(this,f)}distinct(){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithDistinct(N(this,Le).aggregateFunctionNode)})}filterWhere(...f){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(N(this,Le).aggregateFunctionNode,parseWhere(f))})}filterWhereExists(f){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(N(this,Le).aggregateFunctionNode,parseExists(f))})}filterWhereNotExists(f){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(N(this,Le).aggregateFunctionNode,parseNotExists(f))})}filterWhereRef(f,p,y){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(N(this,Le).aggregateFunctionNode,parseReferentialComparison(f,p,y))})}orFilterWhere(...f){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithOrFilter(N(this,Le).aggregateFunctionNode,parseWhere(f))})}orFilterWhereExists(f){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithOrFilter(N(this,Le).aggregateFunctionNode,parseExists(f))})}orFilterWhereNotExists(f){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithOrFilter(N(this,Le).aggregateFunctionNode,parseNotExists(f))})}orFilterWhereRef(f,p,y){return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithOrFilter(N(this,Le).aggregateFunctionNode,parseReferentialComparison(f,p,y))})}over(f){const p=createOverBuilder();return new Et({...N(this,Le),aggregateFunctionNode:AggregateFunctionNode.cloneWithOver(N(this,Le).aggregateFunctionNode,(f?f(p):p).toOperationNode())})}$call(f){return f(this)}toOperationNode(){return N(this,Le).aggregateFunctionNode}};let AggregateFunctionBuilder=Et;Le=new WeakMap;preventAwait(AggregateFunctionBuilder,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var Qr,zr;class AliasedAggregateFunctionBuilder{constructor(f,p){B(this,Qr,void 0);B(this,zr,void 0);H(this,Qr,f),H(this,zr,p)}get expression(){return N(this,Qr)}get alias(){return N(this,zr)}toOperationNode(){return AliasNode.create(N(this,Qr).toOperationNode(),IdentifierNode.create(N(this,zr)))}}Qr=new WeakMap,zr=new WeakMap;function createFunctionModule(){const m=(p,y)=>new ExpressionWrapper(FunctionNode.create(p,parseReferenceExpressionOrList(y))),f=(p,y)=>new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create(p,y?parseReferenceExpressionOrList(y):void 0)});return Object.assign(m,{agg:f,avg(p){return f("avg",[p])},coalesce(p,...y){return m("coalesce",[p,...y])},count(p){return f("count",[p])},countAll(p){return new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create("count",parseSelectAll(p))})},max(p){return f("max",[p])},min(p){return f("min",[p])},sum(p){return f("sum",[p])}})}var Pr;class CaseBuilder{constructor(f){B(this,Pr,void 0);H(this,Pr,freeze(f))}when(...f){return new CaseThenBuilder({...N(this,Pr),node:CaseNode.cloneWithWhen(N(this,Pr).node,WhenNode.create(parseWhen(f)))})}}Pr=new WeakMap;var Mr;class CaseThenBuilder{constructor(f){B(this,Mr,void 0);H(this,Mr,freeze(f))}then(f){return new CaseWhenBuilder({...N(this,Mr),node:CaseNode.cloneWithThen(N(this,Mr).node,parseValueExpression(f))})}}Mr=new WeakMap;var Wt;class CaseWhenBuilder{constructor(f){B(this,Wt,void 0);H(this,Wt,freeze(f))}when(...f){return new CaseThenBuilder({...N(this,Wt),node:CaseNode.cloneWithWhen(N(this,Wt).node,WhenNode.create(parseWhen(f)))})}else(f){return new CaseEndBuilder({...N(this,Wt),node:CaseNode.cloneWith(N(this,Wt).node,{else:parseValueExpression(f)})})}end(){return new ExpressionWrapper(CaseNode.cloneWith(N(this,Wt).node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(CaseNode.cloneWith(N(this,Wt).node,{isStatement:!0}))}}Wt=new WeakMap;var Ur;class CaseEndBuilder{constructor(f){B(this,Ur,void 0);H(this,Ur,freeze(f))}end(){return new ExpressionWrapper(CaseNode.cloneWith(N(this,Ur).node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(CaseNode.cloneWith(N(this,Ur).node,{isStatement:!0}))}}Ur=new WeakMap;function createExpressionBuilder(m=NOOP_QUERY_EXECUTOR){function f(p,y){return new ExpressionWrapper(parseUnaryOperation(p,y))}return{get fn(){return createFunctionModule()},selectFrom(p){return new SelectQueryBuilder({queryId:createQueryId(),executor:m,queryNode:SelectQueryNode.create(parseTableExpressionOrList(p))})},case(p){return new CaseBuilder({node:CaseNode.create(isUndefined(p)?void 0:parseReferenceExpression(p))})},ref(p){return new ExpressionWrapper(parseStringReference(p))},val(p){return new ExpressionWrapper(parseValueExpressionOrList(p))},cmpr(p,y,b){return new ExpressionWrapper(parseValueBinaryOperation(p,y,b))},bxp(p,y,b){return new ExpressionWrapper(parseValueBinaryOperation(p,y,b))},unary:f,not(p){return f("not",p)},exists(p){return f("exists",p)},neg(p){return f("-",p)},and(p){if(p.length===0)return new ExpressionWrapper(ValueNode.createImmediate(!0));if(p.length===1)return new ExpressionWrapper(p[0].toOperationNode());let y=AndNode.create(p[0].toOperationNode(),p[1].toOperationNode());for(let b=2;b<p.length;++b)y=AndNode.create(y,p[b].toOperationNode());return new ExpressionWrapper(ParensNode.create(y))},or(p){if(p.length===0)return new ExpressionWrapper(ValueNode.createImmediate(!1));if(p.length===1)return new ExpressionWrapper(p[0].toOperationNode());let y=OrNode.create(p[0].toOperationNode(),p[1].toOperationNode());for(let b=2;b<p.length;++b)y=OrNode.create(y,p[b].toOperationNode());return new ExpressionWrapper(ParensNode.create(y))},withSchema(p){return createExpressionBuilder(m.withPluginAtFront(new WithSchemaPlugin(p)))}}}function expressionBuilder(m){return createExpressionBuilder()}function parseExpression(m){if(isOperationNodeSource(m))return m.toOperationNode();if(isFunction(m))return m(expressionBuilder()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(m)}`)}function parseAliasedExpression(m){if(isOperationNodeSource(m))return m.toOperationNode();if(isFunction(m))return m(expressionBuilder()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(m)}`)}function isExpressionOrFactory(m){return isExpression(m)||isAliasedExpression(m)||isFunction(m)}function parseTableExpressionOrList(m){return isReadonlyArray(m)?m.map(f=>parseTableExpression(f)):[parseTableExpression(m)]}function parseTableExpression(m){return isString(m)?parseAliasedTable(m):parseAliasedExpression(m)}function parseAliasedTable(m){const f=" as ";if(m.includes(f)){const[p,y]=m.split(f).map(trim$1);return AliasNode.create(parseTable(p),IdentifierNode.create(y))}else return parseTable(m)}function parseTable(m){const f=".";if(m.includes(f)){const[p,y]=m.split(f).map(trim$1);return TableNode.createWithSchema(p,y)}else return TableNode.create(m)}function trim$1(m){return m.trim()}const AddColumnNode=freeze({is(m){return m.kind==="AddColumnNode"},create(m){return freeze({kind:"AddColumnNode",column:m})}}),AlterColumnNode=freeze({is(m){return m.kind==="AlterColumnNode"},create(m){return freeze({kind:"AlterColumnNode",column:ColumnNode.create(m)})},cloneWith(m,f){return freeze({...m,...f})}}),ColumnDefinitionNode=freeze({is(m){return m.kind==="ColumnDefinitionNode"},create(m,f){return freeze({kind:"ColumnDefinitionNode",column:ColumnNode.create(m),dataType:f})},cloneWithFrontModifier(m,f){return freeze({...m,frontModifiers:m.frontModifiers?freeze([...m.frontModifiers,f]):[f]})},cloneWithEndModifier(m,f){return freeze({...m,endModifiers:m.endModifiers?freeze([...m.endModifiers,f]):[f]})},cloneWith(m,f){return freeze({...m,...f})}}),DropColumnNode=freeze({is(m){return m.kind==="DropColumnNode"},create(m){return freeze({kind:"DropColumnNode",column:ColumnNode.create(m)})}}),RenameColumnNode=freeze({is(m){return m.kind==="RenameColumnNode"},create(m,f){return freeze({kind:"RenameColumnNode",column:ColumnNode.create(m),renameTo:ColumnNode.create(f)})}}),CheckConstraintNode=freeze({is(m){return m.kind==="CheckConstraintNode"},create(m,f){return freeze({kind:"CheckConstraintNode",expression:m,name:f?IdentifierNode.create(f):void 0})}}),ON_MODIFY_FOREIGN_ACTIONS=["no action","restrict","cascade","set null","set default"],ReferencesNode=freeze({is(m){return m.kind==="ReferencesNode"},create(m,f){return freeze({kind:"ReferencesNode",table:m,columns:freeze([...f])})},cloneWithOnDelete(m,f){return freeze({...m,onDelete:f})},cloneWithOnUpdate(m,f){return freeze({...m,onUpdate:f})}});function parseDefaultValueExpression(m){return isOperationNodeSource(m)?m.toOperationNode():ValueNode.createImmediate(m)}const GeneratedNode=freeze({is(m){return m.kind==="GeneratedNode"},create(m){return freeze({kind:"GeneratedNode",...m})},createWithExpression(m){return freeze({kind:"GeneratedNode",always:!0,expression:m})},cloneWith(m,f){return freeze({...m,...f})}}),DefaultValueNode=freeze({is(m){return m.kind==="DefaultValueNode"},create(m){return freeze({kind:"DefaultValueNode",defaultValue:m})}});function parseOnModifyForeignAction(m){if(ON_MODIFY_FOREIGN_ACTIONS.includes(m))return m;throw new Error(`invalid OnModifyForeignAction ${m}`)}var Ce;const Ge=class{constructor(f){B(this,Ce,void 0);H(this,Ce,f)}autoIncrement(){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{autoIncrement:!0}))}primaryKey(){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{primaryKey:!0}))}references(f){const p=parseStringReference(f);if(!ReferenceNode.is(p)||SelectAllNode.is(p.column))throw new Error(`invalid call references('${f}'). The reference must have format table.column or schema.table.column`);return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{references:ReferencesNode.create(p.table,[p.column])}))}onDelete(f){if(!N(this,Ce).references)throw new Error("on delete constraint can only be added for foreign keys");return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{references:ReferencesNode.cloneWithOnDelete(N(this,Ce).references,parseOnModifyForeignAction(f))}))}onUpdate(f){if(!N(this,Ce).references)throw new Error("on update constraint can only be added for foreign keys");return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{references:ReferencesNode.cloneWithOnUpdate(N(this,Ce).references,parseOnModifyForeignAction(f))}))}unique(){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{unique:!0}))}notNull(){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{notNull:!0}))}unsigned(){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{unsigned:!0}))}defaultTo(f){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{defaultTo:DefaultValueNode.create(parseDefaultValueExpression(f))}))}check(f){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{check:CheckConstraintNode.create(f.toOperationNode())}))}generatedAlwaysAs(f){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{generated:GeneratedNode.createWithExpression(f.toOperationNode())}))}generatedAlwaysAsIdentity(){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{generated:GeneratedNode.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{generated:GeneratedNode.create({identity:!0,byDefault:!0})}))}stored(){if(!N(this,Ce).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new Ge(ColumnDefinitionNode.cloneWith(N(this,Ce),{generated:GeneratedNode.cloneWith(N(this,Ce).generated,{stored:!0})}))}modifyFront(f){return new Ge(ColumnDefinitionNode.cloneWithFrontModifier(N(this,Ce),f.toOperationNode()))}modifyEnd(f){return new Ge(ColumnDefinitionNode.cloneWithEndModifier(N(this,Ce),f.toOperationNode()))}$call(f){return f(this)}toOperationNode(){return N(this,Ce)}};let ColumnDefinitionBuilder=Ge;Ce=new WeakMap;preventAwait(ColumnDefinitionBuilder,"don't await ColumnDefinitionBuilder instances directly.");const ModifyColumnNode=freeze({is(m){return m.kind==="ModifyColumnNode"},create(m){return freeze({kind:"ModifyColumnNode",column:m})}}),DataTypeNode=freeze({is(m){return m.kind==="DataTypeNode"},create(m){return freeze({kind:"DataTypeNode",dataType:m})}});function parseDataTypeExpression(m){return isOperationNodeSource(m)?m.toOperationNode():DataTypeNode.create(m)}const ForeignKeyConstraintNode=freeze({is(m){return m.kind==="ForeignKeyConstraintNode"},create(m,f,p,y){return freeze({kind:"ForeignKeyConstraintNode",columns:m,references:ReferencesNode.create(f,p),name:y?IdentifierNode.create(y):void 0})},cloneWith(m,f){return freeze({...m,...f})}});var mr;const ri=class{constructor(f){B(this,mr,void 0);H(this,mr,f)}onDelete(f){return new ri(ForeignKeyConstraintNode.cloneWith(N(this,mr),{onDelete:parseOnModifyForeignAction(f)}))}onUpdate(f){return new ri(ForeignKeyConstraintNode.cloneWith(N(this,mr),{onUpdate:parseOnModifyForeignAction(f)}))}$call(f){return f(this)}toOperationNode(){return N(this,mr)}};let ForeignKeyConstraintBuilder=ri;mr=new WeakMap;preventAwait(ForeignKeyConstraintBuilder,"don't await ForeignKeyConstraintBuilder instances directly.");const AddConstraintNode=freeze({is(m){return m.kind==="AddConstraintNode"},create(m){return freeze({kind:"AddConstraintNode",constraint:m})}}),UniqueConstraintNode=freeze({is(m){return m.kind==="UniqueConstraintNode"},create(m,f){return freeze({kind:"UniqueConstraintNode",columns:freeze(m.map(ColumnNode.create)),name:f?IdentifierNode.create(f):void 0})}}),DropConstraintNode=freeze({is(m){return m.kind==="DropConstraintNode"},create(m){return freeze({kind:"DropConstraintNode",constraintName:IdentifierNode.create(m)})},cloneWith(m,f){return freeze({...m,...f})}});class AlterColumnBuilder{constructor(f){Oe(this,"alterColumnNode");this.alterColumnNode=f}setDataType(f){return new AlteredColumnBuilder(AlterColumnNode.cloneWith(this.alterColumnNode,{dataType:parseDataTypeExpression(f)}))}setDefault(f){return new AlteredColumnBuilder(AlterColumnNode.cloneWith(this.alterColumnNode,{setDefault:parseDefaultValueExpression(f)}))}dropDefault(){return new AlteredColumnBuilder(AlterColumnNode.cloneWith(this.alterColumnNode,{dropDefault:!0}))}setNotNull(){return new AlteredColumnBuilder(AlterColumnNode.cloneWith(this.alterColumnNode,{setNotNull:!0}))}dropNotNull(){return new AlteredColumnBuilder(AlterColumnNode.cloneWith(this.alterColumnNode,{dropNotNull:!0}))}$call(f){return f(this)}}class AlteredColumnBuilder extends AlterColumnBuilder{toOperationNode(){return this.alterColumnNode}}var It;class AlterTableExecutor{constructor(f){B(this,It,void 0);H(this,It,freeze(f))}toOperationNode(){return N(this,It).executor.transformQuery(N(this,It).node,N(this,It).queryId)}compile(){return N(this,It).executor.compileQuery(this.toOperationNode(),N(this,It).queryId)}async execute(){await N(this,It).executor.executeQuery(this.compile(),N(this,It).queryId)}}It=new WeakMap;preventAwait(AlterTableExecutor,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var st;const ni=class{constructor(f){B(this,st,void 0);H(this,st,freeze(f))}onDelete(f){return new ni({...N(this,st),constraintBuilder:N(this,st).constraintBuilder.onDelete(f)})}onUpdate(f){return new ni({...N(this,st),constraintBuilder:N(this,st).constraintBuilder.onUpdate(f)})}$call(f){return f(this)}toOperationNode(){return N(this,st).executor.transformQuery(AlterTableNode.cloneWithTableProps(N(this,st).node,{addConstraint:AddConstraintNode.create(N(this,st).constraintBuilder.toOperationNode())}),N(this,st).queryId)}compile(){return N(this,st).executor.compileQuery(this.toOperationNode(),N(this,st).queryId)}async execute(){await N(this,st).executor.executeQuery(this.compile(),N(this,st).queryId)}};let AlterTableAddForeignKeyConstraintBuilder=ni;st=new WeakMap;preventAwait(AlterTableAddForeignKeyConstraintBuilder,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var $e;const un=class{constructor(f){B(this,$e,void 0);H(this,$e,freeze(f))}ifExists(){return new un({...N(this,$e),node:AlterTableNode.cloneWithTableProps(N(this,$e).node,{dropConstraint:DropConstraintNode.cloneWith(N(this,$e).node.dropConstraint,{ifExists:!0})})})}cascade(){return new un({...N(this,$e),node:AlterTableNode.cloneWithTableProps(N(this,$e).node,{dropConstraint:DropConstraintNode.cloneWith(N(this,$e).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new un({...N(this,$e),node:AlterTableNode.cloneWithTableProps(N(this,$e).node,{dropConstraint:DropConstraintNode.cloneWith(N(this,$e).node.dropConstraint,{modifier:"restrict"})})})}$call(f){return f(this)}toOperationNode(){return N(this,$e).executor.transformQuery(N(this,$e).node,N(this,$e).queryId)}compile(){return N(this,$e).executor.compileQuery(this.toOperationNode(),N(this,$e).queryId)}async execute(){await N(this,$e).executor.executeQuery(this.compile(),N(this,$e).queryId)}};let AlterTableDropConstraintBuilder=un;$e=new WeakMap;preventAwait(AlterTableDropConstraintBuilder,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");var qe;class AlterTableBuilder{constructor(f){B(this,qe,void 0);H(this,qe,freeze(f))}renameTo(f){return new AlterTableExecutor({...N(this,qe),node:AlterTableNode.cloneWithTableProps(N(this,qe).node,{renameTo:parseTable(f)})})}setSchema(f){return new AlterTableExecutor({...N(this,qe),node:AlterTableNode.cloneWithTableProps(N(this,qe).node,{setSchema:IdentifierNode.create(f)})})}alterColumn(f,p){const y=p(new AlterColumnBuilder(AlterColumnNode.create(f)));return new AlterTableColumnAlteringBuilder({...N(this,qe),node:AlterTableNode.cloneWithColumnAlteration(N(this,qe).node,y.toOperationNode())})}dropColumn(f){return new AlterTableColumnAlteringBuilder({...N(this,qe),node:AlterTableNode.cloneWithColumnAlteration(N(this,qe).node,DropColumnNode.create(f))})}renameColumn(f,p){return new AlterTableColumnAlteringBuilder({...N(this,qe),node:AlterTableNode.cloneWithColumnAlteration(N(this,qe).node,RenameColumnNode.create(f,p))})}addColumn(f,p,y=noop$1){const b=y(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(f,parseDataTypeExpression(p))));return new AlterTableColumnAlteringBuilder({...N(this,qe),node:AlterTableNode.cloneWithColumnAlteration(N(this,qe).node,AddColumnNode.create(b.toOperationNode()))})}modifyColumn(f,p,y=noop$1){const b=y(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(f,parseDataTypeExpression(p))));return new AlterTableColumnAlteringBuilder({...N(this,qe),node:AlterTableNode.cloneWithColumnAlteration(N(this,qe).node,ModifyColumnNode.create(b.toOperationNode()))})}addUniqueConstraint(f,p){return new AlterTableExecutor({...N(this,qe),node:AlterTableNode.cloneWithTableProps(N(this,qe).node,{addConstraint:AddConstraintNode.create(UniqueConstraintNode.create(p,f))})})}addCheckConstraint(f,p){return new AlterTableExecutor({...N(this,qe),node:AlterTableNode.cloneWithTableProps(N(this,qe).node,{addConstraint:AddConstraintNode.create(CheckConstraintNode.create(p.toOperationNode(),f))})})}addForeignKeyConstraint(f,p,y,b){return new AlterTableAddForeignKeyConstraintBuilder({...N(this,qe),constraintBuilder:new ForeignKeyConstraintBuilder(ForeignKeyConstraintNode.create(p.map(ColumnNode.create),parseTable(y),b.map(ColumnNode.create),f))})}dropConstraint(f){return new AlterTableDropConstraintBuilder({...N(this,qe),node:AlterTableNode.cloneWithTableProps(N(this,qe).node,{dropConstraint:DropConstraintNode.create(f)})})}$call(f){return f(this)}call(f){return this.$call(f)}}qe=new WeakMap;var Me;const lr=class{constructor(f){B(this,Me,void 0);H(this,Me,freeze(f))}alterColumn(f,p){const y=p(new AlterColumnBuilder(AlterColumnNode.create(f)));return new lr({...N(this,Me),node:AlterTableNode.cloneWithColumnAlteration(N(this,Me).node,y.toOperationNode())})}dropColumn(f){return new lr({...N(this,Me),node:AlterTableNode.cloneWithColumnAlteration(N(this,Me).node,DropColumnNode.create(f))})}renameColumn(f,p){return new lr({...N(this,Me),node:AlterTableNode.cloneWithColumnAlteration(N(this,Me).node,RenameColumnNode.create(f,p))})}addColumn(f,p,y=noop$1){const b=y(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(f,parseDataTypeExpression(p))));return new lr({...N(this,Me),node:AlterTableNode.cloneWithColumnAlteration(N(this,Me).node,AddColumnNode.create(b.toOperationNode()))})}modifyColumn(f,p,y=noop$1){const b=y(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(f,parseDataTypeExpression(p))));return new lr({...N(this,Me),node:AlterTableNode.cloneWithColumnAlteration(N(this,Me).node,ModifyColumnNode.create(b.toOperationNode()))})}toOperationNode(){return N(this,Me).executor.transformQuery(N(this,Me).node,N(this,Me).queryId)}compile(){return N(this,Me).executor.compileQuery(this.toOperationNode(),N(this,Me).queryId)}async execute(){await N(this,Me).executor.executeQuery(this.compile(),N(this,Me).queryId)}};let AlterTableColumnAlteringBuilder=lr;Me=new WeakMap;preventAwait(AlterTableBuilder,"don't await AlterTableBuilder instances");preventAwait(AlterColumnBuilder,"don't await AlterColumnBuilder instances");preventAwait(AlterTableColumnAlteringBuilder,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class ImmediateValueTransformer extends OperationNodeTransformer{transformValue(f){return{...super.transformValue(f),immediate:!0}}}var Re;const qt=class{constructor(f){B(this,Re,void 0);H(this,Re,freeze(f))}ifNotExists(){return new qt({...N(this,Re),node:CreateIndexNode.cloneWith(N(this,Re).node,{ifNotExists:!0})})}unique(){return new qt({...N(this,Re),node:CreateIndexNode.cloneWith(N(this,Re).node,{unique:!0})})}on(f){return new qt({...N(this,Re),node:CreateIndexNode.cloneWith(N(this,Re).node,{table:parseTable(f)})})}column(f){return new qt({...N(this,Re),node:CreateIndexNode.cloneWithColumns(N(this,Re).node,[parseOrderedColumnName(f)])})}columns(f){return new qt({...N(this,Re),node:CreateIndexNode.cloneWithColumns(N(this,Re).node,f.map(parseOrderedColumnName))})}expression(f){return new qt({...N(this,Re),node:CreateIndexNode.cloneWithColumns(N(this,Re).node,[f.toOperationNode()])})}using(f){return new qt({...N(this,Re),node:CreateIndexNode.cloneWith(N(this,Re).node,{using:RawNode.createWithSql(f)})})}where(...f){const p=new ImmediateValueTransformer;return new qt({...N(this,Re),node:QueryNode.cloneWithWhere(N(this,Re).node,p.transformNode(parseWhere(f)))})}$call(f){return f(this)}toOperationNode(){return N(this,Re).executor.transformQuery(N(this,Re).node,N(this,Re).queryId)}compile(){return N(this,Re).executor.compileQuery(this.toOperationNode(),N(this,Re).queryId)}async execute(){await N(this,Re).executor.executeQuery(this.compile(),N(this,Re).queryId)}};let CreateIndexBuilder=qt;Re=new WeakMap;preventAwait(CreateIndexBuilder,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var yt;const $i=class{constructor(f){B(this,yt,void 0);H(this,yt,freeze(f))}ifNotExists(){return new $i({...N(this,yt),node:CreateSchemaNode.cloneWith(N(this,yt).node,{ifNotExists:!0})})}$call(f){return f(this)}toOperationNode(){return N(this,yt).executor.transformQuery(N(this,yt).node,N(this,yt).queryId)}compile(){return N(this,yt).executor.compileQuery(this.toOperationNode(),N(this,yt).queryId)}async execute(){await N(this,yt).executor.executeQuery(this.compile(),N(this,yt).queryId)}};let CreateSchemaBuilder=$i;yt=new WeakMap;preventAwait(CreateSchemaBuilder,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");const PrimaryConstraintNode=freeze({is(m){return m.kind==="PrimaryKeyConstraintNode"},create(m,f){return freeze({kind:"PrimaryKeyConstraintNode",columns:freeze(m.map(ColumnNode.create)),name:f?IdentifierNode.create(f):void 0})}});function parseOnCommitAction(m){if(ON_COMMIT_ACTIONS.includes(m))return m;throw new Error(`invalid OnCommitAction ${m}`)}var Te;const gt=class{constructor(f){B(this,Te,void 0);H(this,Te,freeze(f))}temporary(){return new gt({...N(this,Te),node:CreateTableNode.cloneWith(N(this,Te).node,{temporary:!0})})}onCommit(f){return new gt({...N(this,Te),node:CreateTableNode.cloneWith(N(this,Te).node,{onCommit:parseOnCommitAction(f)})})}ifNotExists(){return new gt({...N(this,Te),node:CreateTableNode.cloneWith(N(this,Te).node,{ifNotExists:!0})})}addColumn(f,p,y=noop$1){const b=y(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(f,parseDataTypeExpression(p))));return new gt({...N(this,Te),node:CreateTableNode.cloneWithColumn(N(this,Te).node,b.toOperationNode())})}addPrimaryKeyConstraint(f,p){return new gt({...N(this,Te),node:CreateTableNode.cloneWithConstraint(N(this,Te).node,PrimaryConstraintNode.create(p,f))})}addUniqueConstraint(f,p){return new gt({...N(this,Te),node:CreateTableNode.cloneWithConstraint(N(this,Te).node,UniqueConstraintNode.create(p,f))})}addCheckConstraint(f,p){return new gt({...N(this,Te),node:CreateTableNode.cloneWithConstraint(N(this,Te).node,CheckConstraintNode.create(p.toOperationNode(),f))})}addForeignKeyConstraint(f,p,y,b,E=noop$1){const _=E(new ForeignKeyConstraintBuilder(ForeignKeyConstraintNode.create(p.map(ColumnNode.create),parseTable(y),b.map(ColumnNode.create),f)));return new gt({...N(this,Te),node:CreateTableNode.cloneWithConstraint(N(this,Te).node,_.toOperationNode())})}modifyFront(f){return new gt({...N(this,Te),node:CreateTableNode.cloneWithFrontModifier(N(this,Te).node,f.toOperationNode())})}modifyEnd(f){return new gt({...N(this,Te),node:CreateTableNode.cloneWithEndModifier(N(this,Te).node,f.toOperationNode())})}$call(f){return f(this)}call(f){return this.$call(f)}toOperationNode(){return N(this,Te).executor.transformQuery(N(this,Te).node,N(this,Te).queryId)}compile(){return N(this,Te).executor.compileQuery(this.toOperationNode(),N(this,Te).queryId)}async execute(){await N(this,Te).executor.executeQuery(this.compile(),N(this,Te).queryId)}};let CreateTableBuilder=gt;Te=new WeakMap;preventAwait(CreateTableBuilder,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var tt;const ln=class{constructor(f){B(this,tt,void 0);H(this,tt,freeze(f))}on(f){return new ln({...N(this,tt),node:DropIndexNode.cloneWith(N(this,tt).node,{table:parseTable(f)})})}ifExists(){return new ln({...N(this,tt),node:DropIndexNode.cloneWith(N(this,tt).node,{ifExists:!0})})}cascade(){return new ln({...N(this,tt),node:DropIndexNode.cloneWith(N(this,tt).node,{cascade:!0})})}$call(f){return f(this)}toOperationNode(){return N(this,tt).executor.transformQuery(N(this,tt).node,N(this,tt).queryId)}compile(){return N(this,tt).executor.compileQuery(this.toOperationNode(),N(this,tt).queryId)}async execute(){await N(this,tt).executor.executeQuery(this.compile(),N(this,tt).queryId)}};let DropIndexBuilder=ln;tt=new WeakMap;preventAwait(DropIndexBuilder,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var lt;const ii=class{constructor(f){B(this,lt,void 0);H(this,lt,freeze(f))}ifExists(){return new ii({...N(this,lt),node:DropSchemaNode.cloneWith(N(this,lt).node,{ifExists:!0})})}cascade(){return new ii({...N(this,lt),node:DropSchemaNode.cloneWith(N(this,lt).node,{cascade:!0})})}$call(f){return f(this)}toOperationNode(){return N(this,lt).executor.transformQuery(N(this,lt).node,N(this,lt).queryId)}compile(){return N(this,lt).executor.compileQuery(this.toOperationNode(),N(this,lt).queryId)}async execute(){await N(this,lt).executor.executeQuery(this.compile(),N(this,lt).queryId)}};let DropSchemaBuilder=ii;lt=new WeakMap;preventAwait(DropSchemaBuilder,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var ct;const si=class{constructor(f){B(this,ct,void 0);H(this,ct,freeze(f))}ifExists(){return new si({...N(this,ct),node:DropTableNode.cloneWith(N(this,ct).node,{ifExists:!0})})}cascade(){return new si({...N(this,ct),node:DropTableNode.cloneWith(N(this,ct).node,{cascade:!0})})}$call(f){return f(this)}toOperationNode(){return N(this,ct).executor.transformQuery(N(this,ct).node,N(this,ct).queryId)}compile(){return N(this,ct).executor.compileQuery(this.toOperationNode(),N(this,ct).queryId)}async execute(){await N(this,ct).executor.executeQuery(this.compile(),N(this,ct).queryId)}};let DropTableBuilder=si;ct=new WeakMap;preventAwait(DropTableBuilder,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const CreateViewNode=freeze({is(m){return m.kind==="CreateViewNode"},create(m){return freeze({kind:"CreateViewNode",name:SchemableIdentifierNode.create(m)})},cloneWith(m,f){return freeze({...m,...f})}});var oi;class ImmediateValuePlugin{constructor(){B(this,oi,new ImmediateValueTransformer)}transformQuery(f){return N(this,oi).transformNode(f.node)}transformResult(f){return Promise.resolve(f.result)}}oi=new WeakMap;var ze;const Yt=class{constructor(f){B(this,ze,void 0);H(this,ze,freeze(f))}temporary(){return new Yt({...N(this,ze),node:CreateViewNode.cloneWith(N(this,ze).node,{temporary:!0})})}materialized(){return new Yt({...N(this,ze),node:CreateViewNode.cloneWith(N(this,ze).node,{materialized:!0})})}ifNotExists(){return new Yt({...N(this,ze),node:CreateViewNode.cloneWith(N(this,ze).node,{ifNotExists:!0})})}orReplace(){return new Yt({...N(this,ze),node:CreateViewNode.cloneWith(N(this,ze).node,{orReplace:!0})})}columns(f){return new Yt({...N(this,ze),node:CreateViewNode.cloneWith(N(this,ze).node,{columns:f.map(parseColumnName)})})}as(f){const p=f.withPlugin(new ImmediateValuePlugin).toOperationNode();return new Yt({...N(this,ze),node:CreateViewNode.cloneWith(N(this,ze).node,{as:p})})}$call(f){return f(this)}toOperationNode(){return N(this,ze).executor.transformQuery(N(this,ze).node,N(this,ze).queryId)}compile(){return N(this,ze).executor.compileQuery(this.toOperationNode(),N(this,ze).queryId)}async execute(){await N(this,ze).executor.executeQuery(this.compile(),N(this,ze).queryId)}};let CreateViewBuilder=Yt;ze=new WeakMap;preventAwait(CreateViewBuilder,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const DropViewNode=freeze({is(m){return m.kind==="DropViewNode"},create(m){return freeze({kind:"DropViewNode",name:SchemableIdentifierNode.create(m)})},cloneWith(m,f){return freeze({...m,...f})}});var rt;const cn=class{constructor(f){B(this,rt,void 0);H(this,rt,freeze(f))}materialized(){return new cn({...N(this,rt),node:DropViewNode.cloneWith(N(this,rt).node,{materialized:!0})})}ifExists(){return new cn({...N(this,rt),node:DropViewNode.cloneWith(N(this,rt).node,{ifExists:!0})})}cascade(){return new cn({...N(this,rt),node:DropViewNode.cloneWith(N(this,rt).node,{cascade:!0})})}$call(f){return f(this)}toOperationNode(){return N(this,rt).executor.transformQuery(N(this,rt).node,N(this,rt).queryId)}compile(){return N(this,rt).executor.compileQuery(this.toOperationNode(),N(this,rt).queryId)}async execute(){await N(this,rt).executor.executeQuery(this.compile(),N(this,rt).queryId)}};let DropViewBuilder=cn;rt=new WeakMap;preventAwait(DropViewBuilder,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const CreateTypeNode=freeze({is(m){return m.kind==="CreateTypeNode"},create(m){return freeze({kind:"CreateTypeNode",name:m})},cloneWithEnum(m,f){return freeze({...m,enum:ValueListNode.create(f.map(p=>ValueNode.createImmediate(p)))})}});var Nt;const Hi=class{constructor(f){B(this,Nt,void 0);H(this,Nt,freeze(f))}toOperationNode(){return N(this,Nt).executor.transformQuery(N(this,Nt).node,N(this,Nt).queryId)}asEnum(f){return new Hi({...N(this,Nt),node:CreateTypeNode.cloneWithEnum(N(this,Nt).node,f)})}$call(f){return f(this)}compile(){return N(this,Nt).executor.compileQuery(this.toOperationNode(),N(this,Nt).queryId)}async execute(){await N(this,Nt).executor.executeQuery(this.compile(),N(this,Nt).queryId)}};let CreateTypeBuilder=Hi;Nt=new WeakMap;preventAwait(CreateTypeBuilder,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const DropTypeNode=freeze({is(m){return m.kind==="DropTypeNode"},create(m){return freeze({kind:"DropTypeNode",name:m})},cloneWith(m,f){return freeze({...m,...f})}});var bt;const Vi=class{constructor(f){B(this,bt,void 0);H(this,bt,freeze(f))}ifExists(){return new Vi({...N(this,bt),node:DropTypeNode.cloneWith(N(this,bt).node,{ifExists:!0})})}$call(f){return f(this)}toOperationNode(){return N(this,bt).executor.transformQuery(N(this,bt).node,N(this,bt).queryId)}compile(){return N(this,bt).executor.compileQuery(this.toOperationNode(),N(this,bt).queryId)}async execute(){await N(this,bt).executor.executeQuery(this.compile(),N(this,bt).queryId)}};let DropTypeBuilder=Vi;bt=new WeakMap;preventAwait(DropTypeBuilder,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function parseSchemableIdentifier(m){const f=".";if(m.includes(f)){const p=m.split(f).map(trim);if(p.length===2)return SchemableIdentifierNode.createWithSchema(p[0],p[1]);throw new Error(`invalid schemable identifier ${m}`)}else return SchemableIdentifierNode.create(m)}function trim(m){return m.trim()}var Xe;const dn=class{constructor(f){B(this,Xe,void 0);H(this,Xe,f)}createTable(f){return new CreateTableBuilder({queryId:createQueryId(),executor:N(this,Xe),node:CreateTableNode.create(parseTable(f))})}dropTable(f){return new DropTableBuilder({queryId:createQueryId(),executor:N(this,Xe),node:DropTableNode.create(parseTable(f))})}createIndex(f){return new CreateIndexBuilder({queryId:createQueryId(),executor:N(this,Xe),node:CreateIndexNode.create(f)})}dropIndex(f){return new DropIndexBuilder({queryId:createQueryId(),executor:N(this,Xe),node:DropIndexNode.create(f)})}createSchema(f){return new CreateSchemaBuilder({queryId:createQueryId(),executor:N(this,Xe),node:CreateSchemaNode.create(f)})}dropSchema(f){return new DropSchemaBuilder({queryId:createQueryId(),executor:N(this,Xe),node:DropSchemaNode.create(f)})}alterTable(f){return new AlterTableBuilder({queryId:createQueryId(),executor:N(this,Xe),node:AlterTableNode.create(parseTable(f))})}createView(f){return new CreateViewBuilder({queryId:createQueryId(),executor:N(this,Xe),node:CreateViewNode.create(f)})}dropView(f){return new DropViewBuilder({queryId:createQueryId(),executor:N(this,Xe),node:DropViewNode.create(f)})}createType(f){return new CreateTypeBuilder({queryId:createQueryId(),executor:N(this,Xe),node:CreateTypeNode.create(parseSchemableIdentifier(f))})}dropType(f){return new DropTypeBuilder({queryId:createQueryId(),executor:N(this,Xe),node:DropTypeNode.create(parseSchemableIdentifier(f))})}withPlugin(f){return new dn(N(this,Xe).withPlugin(f))}withoutPlugins(){return new dn(N(this,Xe).withoutPlugins())}withSchema(f){return new dn(N(this,Xe).withPluginAtFront(new WithSchemaPlugin(f)))}};let SchemaModule=dn;Xe=new WeakMap;class DynamicModule{ref(f){return new DynamicReferenceBuilder(f)}}var $r;class DefaultConnectionProvider{constructor(f){B(this,$r,void 0);H(this,$r,f)}async provideConnection(f){const p=await N(this,$r).acquireConnection();try{return await f(p)}finally{await N(this,$r).releaseConnection(p)}}}$r=new WeakMap;var Dt,Bt,Pt;const cr=class extends QueryExecutorBase{constructor(p,y,b,E=[]){super(E);B(this,Dt,void 0);B(this,Bt,void 0);B(this,Pt,void 0);H(this,Dt,p),H(this,Bt,y),H(this,Pt,b)}get adapter(){return N(this,Bt)}compileQuery(p){return N(this,Dt).compileQuery(p)}provideConnection(p){return N(this,Pt).provideConnection(p)}withPlugins(p){return new cr(N(this,Dt),N(this,Bt),N(this,Pt),[...this.plugins,...p])}withPlugin(p){return new cr(N(this,Dt),N(this,Bt),N(this,Pt),[...this.plugins,p])}withPluginAtFront(p){return new cr(N(this,Dt),N(this,Bt),N(this,Pt),[p,...this.plugins])}withConnectionProvider(p){return new cr(N(this,Dt),N(this,Bt),p,[...this.plugins])}withoutPlugins(){return new cr(N(this,Dt),N(this,Bt),N(this,Pt),[])}};let DefaultQueryExecutor=cr;Dt=new WeakMap,Bt=new WeakMap,Pt=new WeakMap;function performanceNow(){return typeof performance<"u"&&isFunction(performance.now)?performance.now():Date.now()}var St,er,Mt,yr,gn,ai,To,ui,Io,li,So,ci,Co,_n,Qi;class RuntimeDriver{constructor(f,p){B(this,ai);B(this,ui);B(this,li);B(this,ci);B(this,_n);B(this,St,void 0);B(this,er,void 0);B(this,Mt,void 0);B(this,yr,void 0);B(this,gn,new WeakSet);H(this,St,f),H(this,er,p)}async init(){N(this,Mt)||H(this,Mt,N(this,St).init().catch(f=>(H(this,Mt,void 0),Promise.reject(f)))),await N(this,Mt)}async acquireConnection(){await this.init();const f=await N(this,St).acquireConnection();return N(this,gn).has(f)||(Ne(this,ai,To).call(this)&&Ne(this,ui,Io).call(this,f),N(this,gn).add(f)),f}async releaseConnection(f){await N(this,St).releaseConnection(f)}beginTransaction(f,p){return N(this,St).beginTransaction(f,p)}commitTransaction(f){return N(this,St).commitTransaction(f)}rollbackTransaction(f){return N(this,St).rollbackTransaction(f)}async destroy(){N(this,Mt)&&(await N(this,Mt),N(this,yr)||H(this,yr,N(this,St).destroy().catch(f=>(H(this,yr,void 0),Promise.reject(f)))),await N(this,yr))}}St=new WeakMap,er=new WeakMap,Mt=new WeakMap,yr=new WeakMap,gn=new WeakMap,ai=new WeakSet,To=function(){return N(this,er).isLevelEnabled("query")||N(this,er).isLevelEnabled("error")},ui=new WeakSet,Io=function(f){const p=f.executeQuery;f.executeQuery=async y=>{const b=performanceNow();try{return await p.call(f,y)}catch(E){throw await Ne(this,li,So).call(this,E,y,b),E}finally{await Ne(this,ci,Co).call(this,y,b)}}},li=new WeakSet,So=async function(f,p,y){await N(this,er).error(()=>({level:"error",error:f,query:p,queryDurationMillis:Ne(this,_n,Qi).call(this,y)}))},ci=new WeakSet,Co=async function(f,p){await N(this,er).query(()=>({level:"query",query:f,queryDurationMillis:Ne(this,_n,Qi).call(this,p)}))},_n=new WeakSet,Qi=function(f){return performanceNow()-f};var On,tr,di,Ro;class SingleConnectionProvider{constructor(f){B(this,di);B(this,On,void 0);B(this,tr,void 0);H(this,On,f)}async provideConnection(f){for(;N(this,tr);)await N(this,tr);const p=Ne(this,di,Ro).call(this,f);return H(this,tr,p.then(()=>{H(this,tr,void 0)}).catch(()=>{H(this,tr,void 0)})),p}}On=new WeakMap,tr=new WeakMap,di=new WeakSet,Ro=async function(f){return await f(N(this,On))};const TRANSACTION_ISOLATION_LEVELS=["read uncommitted","read committed","repeatable read","serializable"];freeze(["query","error"]);var rr,Nr;class Log{constructor(f){B(this,rr,void 0);B(this,Nr,void 0);isFunction(f)?(H(this,Nr,f),H(this,rr,freeze({query:!0,error:!0}))):(H(this,Nr,defaultLogger),H(this,rr,freeze({query:f.includes("query"),error:f.includes("error")})))}isLevelEnabled(f){return N(this,rr)[f]}async query(f){N(this,rr).query&&await N(this,Nr).call(this,f())}async error(f){N(this,rr).error&&await N(this,Nr).call(this,f())}}rr=new WeakMap,Nr=new WeakMap;function defaultLogger(m){m.level==="query"?(console.log(`kysely:query: ${m.query.sql}`),console.log(`kysely:query: duration: ${m.queryDurationMillis.toFixed(1)}ms`)):m.level==="error"&&(m.error instanceof Error?console.error(`kysely:error: ${m.error.stack??m.error.message}`):console.error(`kysely:error: ${m}`))}function isCompilable(m){return isObject$2(m)&&isFunction(m.compile)}var nt;const Cr=class extends QueryCreator{constructor(p){let y,b;if(isKyselyProps(p))y={executor:p.executor},b={...p};else{const E=p.dialect,_=E.createDriver(),v=E.createQueryCompiler(),I=E.createAdapter(),S=new Log(p.log??[]),C=new RuntimeDriver(_,S),W=new DefaultConnectionProvider(C),$=new DefaultQueryExecutor(v,I,W,p.plugins??[]);y={executor:$},b={config:p,executor:$,dialect:E,driver:C}}super(y);B(this,nt,void 0);H(this,nt,freeze(b))}get schema(){return new SchemaModule(N(this,nt).executor)}get dynamic(){return new DynamicModule}get introspection(){return N(this,nt).dialect.createIntrospector(this.withoutPlugins())}case(p){return new CaseBuilder({node:CaseNode.create(isUndefined(p)?void 0:parseExpression(p))})}get fn(){return createFunctionModule()}transaction(){return new TransactionBuilder({...N(this,nt)})}connection(){return new ConnectionBuilder({...N(this,nt)})}withPlugin(p){return new Cr({...N(this,nt),executor:N(this,nt).executor.withPlugin(p)})}withoutPlugins(){return new Cr({...N(this,nt),executor:N(this,nt).executor.withoutPlugins()})}withSchema(p){return new Cr({...N(this,nt),executor:N(this,nt).executor.withPluginAtFront(new WithSchemaPlugin(p))})}withTables(){return new Cr({...N(this,nt)})}async destroy(){await N(this,nt).driver.destroy()}get isTransaction(){return!1}getExecutor(){return N(this,nt).executor}executeQuery(p,y=createQueryId()){const b=isCompilable(p)?p.compile():p;return this.getExecutor().executeQuery(b,y)}};let Kysely=Cr;nt=new WeakMap;var Ct;const Rr=class extends Kysely{constructor(p){super(p);B(this,Ct,void 0);H(this,Ct,p)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(p){return new Rr({...N(this,Ct),executor:N(this,Ct).executor.withPlugin(p)})}withoutPlugins(){return new Rr({...N(this,Ct),executor:N(this,Ct).executor.withoutPlugins()})}withSchema(p){return new Rr({...N(this,Ct),executor:N(this,Ct).executor.withPluginAtFront(new WithSchemaPlugin(p))})}withTables(){return new Rr({...N(this,Ct)})}};let Transaction=Rr;Ct=new WeakMap;function isKyselyProps(m){return isObject$2(m)&&isObject$2(m.config)&&isObject$2(m.driver)&&isObject$2(m.executor)&&isObject$2(m.dialect)}var br;class ConnectionBuilder{constructor(f){B(this,br,void 0);H(this,br,freeze(f))}async execute(f){return N(this,br).executor.provideConnection(async p=>{const y=N(this,br).executor.withConnectionProvider(new SingleConnectionProvider(p)),b=new Kysely({...N(this,br),executor:y});return await f(b)})}}br=new WeakMap;preventAwait(ConnectionBuilder,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var Rt;const Ji=class{constructor(f){B(this,Rt,void 0);H(this,Rt,freeze(f))}setIsolationLevel(f){return new Ji({...N(this,Rt),isolationLevel:f})}async execute(f){const{isolationLevel:p,...y}=N(this,Rt),b={isolationLevel:p};return validateTransactionSettings(b),N(this,Rt).executor.provideConnection(async E=>{const _=N(this,Rt).executor.withConnectionProvider(new SingleConnectionProvider(E)),v=new Transaction({...y,executor:_});try{await N(this,Rt).driver.beginTransaction(E,b);const I=await f(v);return await N(this,Rt).driver.commitTransaction(E),I}catch(I){throw await N(this,Rt).driver.rollbackTransaction(E),I}})}};let TransactionBuilder=Ji;Rt=new WeakMap;preventAwait(TransactionBuilder,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function validateTransactionSettings(m){if(m.isolationLevel&&!TRANSACTION_ISOLATION_LEVELS.includes(m.isolationLevel))throw new Error(`invalid transaction isolation level ${m.isolationLevel}`)}var pt,Hr,Gn,vn,zi,Tn,Pi;const fi=class{constructor(f){B(this,Hr);B(this,vn);B(this,Tn);B(this,pt,void 0);H(this,pt,freeze(f))}get expressionType(){}as(f){return new AliasedRawBuilder(this,f)}$castTo(){return new fi({...N(this,pt)})}castTo(){return this.$castTo()}withPlugin(f){return new fi({...N(this,pt),plugins:N(this,pt).plugins!==void 0?freeze([...N(this,pt).plugins,f]):freeze([f])})}toOperationNode(){return Ne(this,vn,zi).call(this,Ne(this,Hr,Gn).call(this))}compile(f){return Ne(this,Tn,Pi).call(this,Ne(this,Hr,Gn).call(this,f))}async execute(f){const p=Ne(this,Hr,Gn).call(this,f);return p.executeQuery(Ne(this,Tn,Pi).call(this,p),N(this,pt).queryId)}};let RawBuilder=fi;pt=new WeakMap,Hr=new WeakSet,Gn=function(f){const p=f!==void 0?f.getExecutor():NOOP_QUERY_EXECUTOR;return N(this,pt).plugins!==void 0?p.withPlugins(N(this,pt).plugins):p},vn=new WeakSet,zi=function(f){return f.transformQuery(N(this,pt).rawNode,N(this,pt).queryId)},Tn=new WeakSet,Pi=function(f){return f.compileQuery(Ne(this,vn,zi).call(this,f),N(this,pt).queryId)};preventAwait(RawBuilder,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Vr,nr;class AliasedRawBuilder{constructor(f,p){B(this,Vr,void 0);B(this,nr,void 0);H(this,Vr,f),H(this,nr,p)}get expression(){return N(this,Vr)}get alias(){return N(this,nr)}toOperationNode(){return AliasNode.create(N(this,Vr).toOperationNode(),isOperationNodeSource(N(this,nr))?N(this,nr).toOperationNode():IdentifierNode.create(N(this,nr)))}}Vr=new WeakMap,nr=new WeakMap;const sql=Object.assign((m,...f)=>new RawBuilder({queryId:createQueryId(),rawNode:RawNode.create(m,(f==null?void 0:f.map(parseValueExpression))??[])}),{ref(m){return new RawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseStringReference(m))})},val(m){return new RawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseValueExpression(m))})},value(m){return this.val(m)},table(m){return new RawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseTable(m))})},id(...m){const f=new Array(m.length+1).fill(".");return f[0]="",f[f.length-1]="",new RawBuilder({queryId:createQueryId(),rawNode:RawNode.create(f,m.map(IdentifierNode.create))})},lit(m){return new RawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(ValueNode.createImmediate(m))})},literal(m){return this.lit(m)},raw(m){return new RawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithSql(m)})},join(m,f=sql`, `){const p=new Array(2*m.length-1),y=f.toOperationNode();for(let b=0;b<m.length;++b)p[2*b]=parseValueExpression(m[b]),b!==m.length-1&&(p[2*b+1]=y);return new RawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChildren(p)})}});var hi;class OperationNodeVisitor{constructor(){Oe(this,"nodeStack",[]);B(this,hi,freeze({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this)}));Oe(this,"visitNode",f=>{this.nodeStack.push(f),N(this,hi)[f.kind](f),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}hi=new WeakMap;var Jr,wr;class DefaultQueryCompiler extends OperationNodeVisitor{constructor(){super(...arguments);B(this,Jr,"");B(this,wr,[])}get numParameters(){return N(this,wr).length}compileQuery(p){return H(this,Jr,""),H(this,wr,[]),this.visitNode(p),freeze({query:p,sql:this.getSql(),parameters:[...N(this,wr)]})}getSql(){return N(this,Jr)}visitSelectQuery(p){const y=this.parentNode!==void 0&&!InsertQueryNode.is(this.parentNode)&&!CreateViewNode.is(this.parentNode)&&!SetOperationNode.is(this.parentNode);this.parentNode===void 0&&p.explain&&(this.visitNode(p.explain),this.append(" ")),y&&this.append("("),p.with&&(this.visitNode(p.with),this.append(" ")),this.append("select "),p.distinctOn&&(this.compileDistinctOn(p.distinctOn),this.append(" ")),p.frontModifiers&&p.frontModifiers.length>0&&(this.compileList(p.frontModifiers," "),this.append(" ")),p.selections&&(this.compileList(p.selections),this.append(" ")),this.visitNode(p.from),p.joins&&(this.append(" "),this.compileList(p.joins," ")),p.where&&(this.append(" "),this.visitNode(p.where)),p.groupBy&&(this.append(" "),this.visitNode(p.groupBy)),p.having&&(this.append(" "),this.visitNode(p.having)),p.setOperations&&(this.append(" "),this.compileList(p.setOperations," ")),p.orderBy&&(this.append(" "),this.visitNode(p.orderBy)),p.limit&&(this.append(" "),this.visitNode(p.limit)),p.offset&&(this.append(" "),this.visitNode(p.offset)),p.endModifiers&&p.endModifiers.length>0&&(this.append(" "),this.compileList(p.endModifiers," ")),y&&this.append(")")}visitFrom(p){this.append("from "),this.compileList(p.froms)}visitSelection(p){this.visitNode(p.selection)}visitColumn(p){this.visitNode(p.column)}compileDistinctOn(p){this.append("distinct on ("),this.compileList(p),this.append(")")}compileList(p,y=", "){const b=p.length-1;for(let E=0;E<=b;E++)this.visitNode(p[E]),E<b&&this.append(y)}visitWhere(p){this.append("where "),this.visitNode(p.where)}visitHaving(p){this.append("having "),this.visitNode(p.having)}visitInsertQuery(p){const y=this.nodeStack.find(QueryNode.is)!==p;!y&&p.explain&&(this.visitNode(p.explain),this.append(" ")),y&&this.append("("),p.with&&(this.visitNode(p.with),this.append(" ")),this.append(p.replace?"replace":"insert"),p.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(p.into),p.columns&&(this.append(" ("),this.compileList(p.columns),this.append(")")),p.values&&(this.append(" "),this.visitNode(p.values)),p.onConflict&&(this.append(" "),this.visitNode(p.onConflict)),p.onDuplicateKey&&(this.append(" "),this.visitNode(p.onDuplicateKey)),p.returning&&(this.append(" "),this.visitNode(p.returning)),y&&this.append(")")}visitValues(p){this.append("values "),this.compileList(p.values)}visitDeleteQuery(p){const y=this.nodeStack.find(QueryNode.is)!==p;!y&&p.explain&&(this.visitNode(p.explain),this.append(" ")),y&&this.append("("),p.with&&(this.visitNode(p.with),this.append(" ")),this.append("delete "),this.visitNode(p.from),p.using&&(this.append(" "),this.visitNode(p.using)),p.joins&&(this.append(" "),this.compileList(p.joins," ")),p.where&&(this.append(" "),this.visitNode(p.where)),p.orderBy&&(this.append(" "),this.visitNode(p.orderBy)),p.limit&&(this.append(" "),this.visitNode(p.limit)),p.returning&&(this.append(" "),this.visitNode(p.returning)),y&&this.append(")")}visitReturning(p){this.append("returning "),this.compileList(p.selections)}visitAlias(p){this.visitNode(p.node),this.append(" as "),this.visitNode(p.alias)}visitReference(p){this.visitNode(p.table),this.append("."),this.visitNode(p.column)}visitSelectAll(p){this.append("*")}visitIdentifier(p){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(p),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(p){if(!isString(p.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(p.name))}visitAnd(p){this.visitNode(p.left),this.append(" and "),this.visitNode(p.right)}visitOr(p){this.visitNode(p.left),this.append(" or "),this.visitNode(p.right)}visitValue(p){p.immediate?this.appendImmediateValue(p.value):this.appendValue(p.value)}visitValueList(p){this.append("("),this.compileList(p.values),this.append(")")}visitPrimitiveValueList(p){this.append("(");const{values:y}=p;for(let b=0;b<y.length;++b)this.appendValue(y[b]),b!==y.length-1&&this.append(", ");this.append(")")}visitParens(p){this.append("("),this.visitNode(p.node),this.append(")")}visitJoin(p){this.append(JOIN_TYPE_SQL[p.joinType]),this.append(" "),this.visitNode(p.table),p.on&&(this.append(" "),this.visitNode(p.on))}visitOn(p){this.append("on "),this.visitNode(p.on)}visitRaw(p){const{sqlFragments:y,parameters:b}=p;for(let E=0;E<y.length;++E)this.append(y[E]),b.length>E&&this.visitNode(b[E])}visitOperator(p){this.append(p.operator)}visitTable(p){this.visitNode(p.table)}visitSchemableIdentifier(p){p.schema&&(this.visitNode(p.schema),this.append(".")),this.visitNode(p.identifier)}visitCreateTable(p){this.append("create "),p.frontModifiers&&p.frontModifiers.length>0&&(this.compileList(p.frontModifiers," "),this.append(" ")),p.temporary&&this.append("temporary "),this.append("table "),p.ifNotExists&&this.append("if not exists "),this.visitNode(p.table),this.append(" ("),this.compileList([...p.columns,...p.constraints??[]]),this.append(")"),p.onCommit&&(this.append(" on commit "),this.append(p.onCommit)),p.endModifiers&&p.endModifiers.length>0&&(this.append(" "),this.compileList(p.endModifiers," "))}visitColumnDefinition(p){this.visitNode(p.column),this.append(" "),this.visitNode(p.dataType),p.unsigned&&this.append(" unsigned"),p.frontModifiers&&p.frontModifiers.length>0&&(this.append(" "),this.compileList(p.frontModifiers," ")),p.generated&&(this.append(" "),this.visitNode(p.generated)),p.defaultTo&&(this.append(" "),this.visitNode(p.defaultTo)),p.notNull&&this.append(" not null"),p.unique&&this.append(" unique"),p.primaryKey&&this.append(" primary key"),p.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),p.references&&(this.append(" "),this.visitNode(p.references)),p.check&&(this.append(" "),this.visitNode(p.check)),p.endModifiers&&p.endModifiers.length>0&&(this.append(" "),this.compileList(p.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(p){this.append("references "),this.visitNode(p.table),this.append(" ("),this.compileList(p.columns),this.append(")"),p.onDelete&&(this.append(" on delete "),this.append(p.onDelete)),p.onUpdate&&(this.append(" on update "),this.append(p.onUpdate))}visitDropTable(p){this.append("drop table "),p.ifExists&&this.append("if exists "),this.visitNode(p.table),p.cascade&&this.append(" cascade")}visitDataType(p){this.append(p.dataType)}visitOrderBy(p){this.append("order by "),this.compileList(p.items)}visitOrderByItem(p){this.visitNode(p.orderBy),p.direction&&(this.append(" "),this.visitNode(p.direction))}visitGroupBy(p){this.append("group by "),this.compileList(p.items)}visitGroupByItem(p){this.visitNode(p.groupBy)}visitUpdateQuery(p){const y=this.nodeStack.find(QueryNode.is)!==p;!y&&p.explain&&(this.visitNode(p.explain),this.append(" ")),y&&this.append("("),p.with&&(this.visitNode(p.with),this.append(" ")),this.append("update "),this.visitNode(p.table),this.append(" set "),p.updates&&this.compileList(p.updates),p.from&&(this.append(" "),this.visitNode(p.from)),p.joins&&(this.append(" "),this.compileList(p.joins," ")),p.where&&(this.append(" "),this.visitNode(p.where)),p.returning&&(this.append(" "),this.visitNode(p.returning)),y&&this.append(")")}visitColumnUpdate(p){this.visitNode(p.column),this.append(" = "),this.visitNode(p.value)}visitLimit(p){this.append("limit "),this.visitNode(p.limit)}visitOffset(p){this.append("offset "),this.visitNode(p.offset)}visitOnConflict(p){this.append("on conflict"),p.columns?(this.append(" ("),this.compileList(p.columns),this.append(")")):p.constraint?(this.append(" on constraint "),this.visitNode(p.constraint)):p.indexExpression&&(this.append(" ("),this.visitNode(p.indexExpression),this.append(")")),p.indexWhere&&(this.append(" "),this.visitNode(p.indexWhere)),p.doNothing===!0?this.append(" do nothing"):p.updates&&(this.append(" do update set "),this.compileList(p.updates),p.updateWhere&&(this.append(" "),this.visitNode(p.updateWhere)))}visitOnDuplicateKey(p){this.append("on duplicate key update "),this.compileList(p.updates)}visitCreateIndex(p){this.append("create "),p.unique&&this.append("unique "),this.append("index "),p.ifNotExists&&this.append("if not exists "),this.visitNode(p.name),p.table&&(this.append(" on "),this.visitNode(p.table)),p.using&&(this.append(" using "),this.visitNode(p.using)),p.columns&&(this.append(" ("),this.compileList(p.columns),this.append(")")),p.where&&(this.append(" "),this.visitNode(p.where))}visitDropIndex(p){this.append("drop index "),p.ifExists&&this.append("if exists "),this.visitNode(p.name),p.table&&(this.append(" on "),this.visitNode(p.table)),p.cascade&&this.append(" cascade")}visitCreateSchema(p){this.append("create schema "),p.ifNotExists&&this.append("if not exists "),this.visitNode(p.schema)}visitDropSchema(p){this.append("drop schema "),p.ifExists&&this.append("if exists "),this.visitNode(p.schema),p.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(p){p.name&&(this.append("constraint "),this.visitNode(p.name),this.append(" ")),this.append("primary key ("),this.compileList(p.columns),this.append(")")}visitUniqueConstraint(p){p.name&&(this.append("constraint "),this.visitNode(p.name),this.append(" ")),this.append("unique ("),this.compileList(p.columns),this.append(")")}visitCheckConstraint(p){p.name&&(this.append("constraint "),this.visitNode(p.name),this.append(" ")),this.append("check ("),this.visitNode(p.expression),this.append(")")}visitForeignKeyConstraint(p){p.name&&(this.append("constraint "),this.visitNode(p.name),this.append(" ")),this.append("foreign key ("),this.compileList(p.columns),this.append(") "),this.visitNode(p.references),p.onDelete&&(this.append(" on delete "),this.append(p.onDelete)),p.onUpdate&&(this.append(" on update "),this.append(p.onUpdate))}visitList(p){this.compileList(p.items)}visitWith(p){this.append("with "),p.recursive&&this.append("recursive "),this.compileList(p.expressions)}visitCommonTableExpression(p){this.visitNode(p.name),this.append(" as "),this.visitNode(p.expression)}visitCommonTableExpressionName(p){this.visitNode(p.table),p.columns&&(this.append("("),this.compileList(p.columns),this.append(")"))}visitAlterTable(p){this.append("alter table "),this.visitNode(p.table),this.append(" "),p.renameTo&&(this.append("rename to "),this.visitNode(p.renameTo)),p.setSchema&&(this.append("set schema "),this.visitNode(p.setSchema)),p.addConstraint&&this.visitNode(p.addConstraint),p.dropConstraint&&this.visitNode(p.dropConstraint),p.columnAlterations&&this.compileList(p.columnAlterations)}visitAddColumn(p){this.append("add column "),this.visitNode(p.column)}visitRenameColumn(p){this.append("rename column "),this.visitNode(p.column),this.append(" to "),this.visitNode(p.renameTo)}visitDropColumn(p){this.append("drop column "),this.visitNode(p.column)}visitAlterColumn(p){this.append("alter column "),this.visitNode(p.column),this.append(" "),p.dataType&&(this.append("type "),this.visitNode(p.dataType),p.dataTypeExpression&&(this.append("using "),this.visitNode(p.dataTypeExpression))),p.setDefault&&(this.append("set default "),this.visitNode(p.setDefault)),p.dropDefault&&this.append("drop default"),p.setNotNull&&this.append("set not null"),p.dropNotNull&&this.append("drop not null")}visitModifyColumn(p){this.append("modify column "),this.visitNode(p.column)}visitAddConstraint(p){this.append("add "),this.visitNode(p.constraint)}visitDropConstraint(p){this.append("drop constraint "),p.ifExists&&this.append("if exists "),this.visitNode(p.constraintName),p.modifier==="cascade"?this.append(" cascade"):p.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(p){this.append(p.operator),this.append(" "),p.all&&this.append("all "),this.visitNode(p.expression)}visitCreateView(p){this.append("create "),p.orReplace&&this.append("or replace "),p.materialized&&this.append("materialized "),p.temporary&&this.append("temporary "),this.append("view "),p.ifNotExists&&this.append("if not exists "),this.visitNode(p.name),this.append(" "),p.columns&&(this.append("("),this.compileList(p.columns),this.append(") ")),p.as&&(this.append("as "),this.visitNode(p.as))}visitDropView(p){this.append("drop "),p.materialized&&this.append("materialized "),this.append("view "),p.ifExists&&this.append("if exists "),this.visitNode(p.name),p.cascade&&this.append(" cascade")}visitGenerated(p){this.append("generated "),p.always&&this.append("always "),p.byDefault&&this.append("by default "),this.append("as "),p.identity&&this.append("identity"),p.expression&&(this.append("("),this.visitNode(p.expression),this.append(")")),p.stored&&this.append(" stored")}visitDefaultValue(p){this.append("default "),this.visitNode(p.defaultValue)}visitSelectModifier(p){p.rawModifier?this.visitNode(p.rawModifier):this.append(SELECT_MODIFIER_SQL[p.modifier])}visitCreateType(p){this.append("create type "),this.visitNode(p.name),p.enum&&(this.append(" as enum "),this.visitNode(p.enum))}visitDropType(p){this.append("drop type "),p.ifExists&&this.append("if exists "),this.visitNode(p.name)}visitExplain(p){this.append("explain"),(p.options||p.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),p.options&&(this.visitNode(p.options),p.format&&this.append(this.getExplainOptionsDelimiter())),p.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(p.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(p){this.append("default")}visitAggregateFunction(p){this.append(p.func),this.append("("),p.distinct&&this.append("distinct "),this.compileList(p.aggregated),this.append(")"),p.filter&&(this.append(" filter("),this.visitNode(p.filter),this.append(")")),p.over&&(this.append(" "),this.visitNode(p.over))}visitOver(p){this.append("over("),p.partitionBy&&(this.visitNode(p.partitionBy),p.orderBy&&this.append(" ")),p.orderBy&&this.visitNode(p.orderBy),this.append(")")}visitPartitionBy(p){this.append("partition by "),this.compileList(p.items)}visitPartitionByItem(p){this.visitNode(p.partitionBy)}visitBinaryOperation(p){this.visitNode(p.leftOperand),this.append(" "),this.visitNode(p.operator),this.append(" "),this.visitNode(p.rightOperand)}visitUnaryOperation(p){this.visitNode(p.operator),this.isMinusOperator(p.operator)||this.append(" "),this.visitNode(p.operand)}isMinusOperator(p){return OperatorNode.is(p)&&p.operator==="-"}visitUsing(p){this.append("using "),this.compileList(p.tables)}visitFunction(p){this.append(p.func),this.append("("),this.compileList(p.arguments),this.append(")")}visitCase(p){this.append("case"),p.value&&(this.append(" "),this.visitNode(p.value)),p.when&&(this.append(" "),this.compileList(p.when," ")),p.else&&(this.append(" else "),this.visitNode(p.else)),this.append(" end"),p.isStatement&&this.append(" case")}visitWhen(p){this.append("when "),this.visitNode(p.condition),p.result&&(this.append(" then "),this.visitNode(p.result))}append(p){H(this,Jr,N(this,Jr)+p)}appendValue(p){this.addParameter(p),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(p){const y=this.getLeftIdentifierWrapper(),b=this.getRightIdentifierWrapper();let E="";for(const _ of p)E+=_,_===y?E+=y:_===b&&(E+=b);return E}addParameter(p){N(this,wr).push(p)}appendImmediateValue(p){if(isString(p))this.append(`'${p}'`);else if(isNumber(p)||isBoolean(p))this.append(p.toString());else if(isNull(p))this.append("null");else if(isDate(p))this.appendImmediateValue(p.toISOString());else if(isBigInt(p))this.appendImmediateValue(p.toString());else throw new Error(`invalid immediate value ${p}`)}}Jr=new WeakMap,wr=new WeakMap;const SELECT_MODIFIER_SQL=freeze({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),JOIN_TYPE_SQL=freeze({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),CompiledQuery=freeze({raw(m){return freeze({sql:m,query:RawNode.createWithSql(m),parameters:freeze([])})}});var Ut,In,jr,Kr;class SqliteDriver{constructor(f){B(this,Ut,void 0);B(this,In,new ConnectionMutex);B(this,jr,void 0);B(this,Kr,void 0);H(this,Ut,freeze({...f}))}async init(){H(this,jr,isFunction(N(this,Ut).database)?await N(this,Ut).database():N(this,Ut).database),H(this,Kr,new SqliteConnection(N(this,jr))),N(this,Ut).onCreateConnection&&await N(this,Ut).onCreateConnection(N(this,Kr))}async acquireConnection(){return await N(this,In).lock(),N(this,Kr)}async beginTransaction(f){await f.executeQuery(CompiledQuery.raw("begin"))}async commitTransaction(f){await f.executeQuery(CompiledQuery.raw("commit"))}async rollbackTransaction(f){await f.executeQuery(CompiledQuery.raw("rollback"))}async releaseConnection(){N(this,In).unlock()}async destroy(){var f;(f=N(this,jr))==null||f.close()}}Ut=new WeakMap,In=new WeakMap,jr=new WeakMap,Kr=new WeakMap;var Sn;class SqliteConnection{constructor(f){B(this,Sn,void 0);H(this,Sn,f)}executeQuery(f){const{sql:p,parameters:y}=f,b=N(this,Sn).prepare(p);if(b.reader)return Promise.resolve({rows:b.all(y)});{const{changes:E,lastInsertRowid:_}=b.run(y),v=E!=null?BigInt(E):void 0;return Promise.resolve({numUpdatedOrDeletedRows:v,numAffectedRows:v,insertId:_!=null?BigInt(_):void 0,rows:[]})}}async*streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}}Sn=new WeakMap;var Er,Gr;class ConnectionMutex{constructor(){B(this,Er,void 0);B(this,Gr,void 0)}async lock(){for(;N(this,Er);)await N(this,Er);H(this,Er,new Promise(f=>{H(this,Gr,f)}))}unlock(){const f=N(this,Gr);H(this,Er,void 0),H(this,Gr,void 0),f==null||f()}}Er=new WeakMap,Gr=new WeakMap;const ID_WRAP_REGEX=/"/g;class SqliteQueryCompiler extends DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(f){return f.replace(ID_WRAP_REGEX,'""')}visitDefaultInsertValue(f){this.append("null")}}const DEFAULT_MIGRATION_TABLE="kysely_migration",DEFAULT_MIGRATION_LOCK_TABLE="kysely_migration_lock";freeze({__noMigrations__:!0});var Xr,pi,xo;class SqliteIntrospector{constructor(f){B(this,pi);B(this,Xr,void 0);H(this,Xr,f)}async getSchemas(){return[]}async getTables(f={withInternalKyselyTables:!1}){let p=N(this,Xr).selectFrom("sqlite_schema").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();f.withInternalKyselyTables||(p=p.where("name","!=",DEFAULT_MIGRATION_TABLE).where("name","!=",DEFAULT_MIGRATION_LOCK_TABLE));const y=await p.execute();return Promise.all(y.map(({name:b})=>Ne(this,pi,xo).call(this,b)))}async getMetadata(f){return{tables:await this.getTables(f)}}}Xr=new WeakMap,pi=new WeakSet,xo=async function(f){var _,v,I,S,C,W;const p=N(this,Xr),y=await p.selectFrom("sqlite_master").where("name","=",f).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),b=(W=(C=(S=(I=(v=(_=y.sql)==null?void 0:_.split(/[\(\),]/))==null?void 0:v.find($=>$.toLowerCase().includes("autoincrement")))==null?void 0:I.trimStart())==null?void 0:S.split(/\s+/))==null?void 0:C[0])==null?void 0:W.replace(/["`]/g,""),E=await p.selectFrom(sql`pragma_table_info(${f})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:f,isView:y.type==="view",columns:E.map($=>({name:$.name,dataType:$.type,isNullable:!$.notnull,isAutoIncrementing:$.name===b,hasDefaultValue:$.dflt_value!=null}))}};class SqliteAdapter{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(){}async releaseMigrationLock(){}}var Cn;class SqliteDialect{constructor(f){B(this,Cn,void 0);H(this,Cn,freeze({...f}))}createDriver(){return new SqliteDriver(N(this,Cn))}createQueryCompiler(){return new SqliteQueryCompiler}createAdapter(){return new SqliteAdapter}createIntrospector(f){return new SqliteIntrospector(f)}}Cn=new WeakMap;function toBytes(m){return Uint8Array.from([...m].map(f=>f.charCodeAt(0)))}function fromBytes(m){return String.fromCharCode(...m)}function encode(m){return m.length?[fromBytes(m[0].site_id),...m.flatMap(f=>[f.cid,f.pk,f.table,f.val,f.db_version,f.col_version])]:[]}function decode(m){if(!m[0])return[];const f=toBytes(m[0]),p=[];for(let y=1;y<m.length;y+=6)p.push({site_id:f,cid:m[y],pk:m[y+1],table:m[y+2],val:m[y+3],db_version:m[y+4],col_version:m[y+5]});return p}function selectVersion(){const m=sql`SELECT 
    crsql_dbversion() as current,
    IFNULL(MAX(version), 0) as synced
  FROM "__crstore_sync"`;return{execute:()=>m.execute(this).then(f=>f.rows[0])}}function updateVersion(m){return this.updateTable("__crstore_sync").set({version:m??sql`crsql_dbversion()`})}function selectClient(){const m=sql`SELECT crsql_siteid() as client`;return{execute:()=>m.execute(this).then(f=>fromBytes(f.rows[0].client))}}function changesSince(m,f){let p=this.selectFrom("crsql_changes").select(sql`crsql_siteid()`.as("site_id")).select(["cid","pk","table","val","db_version","col_version"]).where("db_version",">",m).$if(!m,y=>y.where("cid","!=","__crsql_del")).$if(f===null,y=>y.where("site_id","is",null)).$if(typeof f=="string",y=>y.where("site_id","is not",toBytes(f))).$castTo();return{execute:()=>p.execute().then(encode)}}function insertChanges(m){const f=async p=>{m.length&&(await p.insertInto("crsql_changes").values(decode(m)).execute(),await updateVersion.bind(p)().execute())};return{execute:()=>this.isTransaction?f(this):this.transaction().execute(f)}}function resolveChanges(m){return{execute:()=>applyOperation.bind(this)(f=>insertChanges.bind(f)(m).execute()).execute().then(f=>f.changes)}}function applyOperation(m,...f){return{execute:()=>this.transaction().execute(async p=>{const{current:y}=await selectVersion.bind(p)().execute(),b=await m(p,...f),E=await changesSince.bind(p)(y).execute();return{result:b,changes:E}})}}function finalize(){const m=sql`select crsql_finalize();`;return{execute:()=>m.execute(this)}}function affectedTables(m){var f,p,y;if(Array.isArray(m)){const b=new Set;for(let E=3;E<m.length;E+=6)b.add(m[E]);return[...b]}if(m.kind==="TableNode")return[m.table.identifier.name];if(m.kind==="ReferenceNode")return[m.table.table.identifier.name];if(m.kind==="AliasNode")return affectedTables(m.node);if(m.kind==="SelectQueryNode"){const b=[...m.from.froms,...((f=m.joins)==null?void 0:f.map(E=>E.table))||[],...((p=m.selections)==null?void 0:p.map(E=>E.selection))||[],...((y=m.with)==null?void 0:y.expressions.map(E=>E.expression))||[]].flatMap(affectedTables);return[...new Set(b)]}return[]}class CRDialect extends SqliteDialect{constructor(p){super(p);Oe(this,"database");this.database=async()=>typeof p.database=="function"?p.database():p.database}createDriver(){const p=this.database,y=mutex();let b,E;return{async init(){b=await p(),E={async executeQuery(_){return{rows:await b.execO(_.sql,_.parameters)}},async*streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}}},async acquireConnection(){return await y.lock(),E},async beginTransaction(_){await _.executeQuery(CompiledQuery.raw("begin"))},async commitTransaction(_){await _.executeQuery(CompiledQuery.raw("commit"))},async rollbackTransaction(_){await _.executeQuery(CompiledQuery.raw("rollback"))},async releaseConnection(){y.unlock()},async destroy(){b==null||b.close()}}}}function mutex(){let m,f;return{async lock(){for(;m;)await m;m=new Promise(p=>f=p)},unlock(){const p=f;m=void 0,f=void 0,p==null||p()}}}function json(m,f){const p=Object.entries(f).flatMap(([y,b])=>[sql.lit(y),typeof b=="string"?m.ref(b):b]);return sql`json_object(${sql.join(p)})`.withPlugin({transformQuery({node:y}){return{...y,json:!0}}}).$castTo()}function group(m,f){const p=typeof f=="string"?m.ref(f).toOperationNode():f.toOperationNode();return new AggregateFunctionBuilder({aggregateFunctionNode:{...AggregateFunctionNode.create("json_group_array",[p]),json:!0}})}function groupJSON(m,f){return group(m,json(m,f))}var Rn;class JSONPlugin{constructor(){B(this,Rn,new WeakMap)}transformQuery({node:f,queryId:p}){return f.kind!=="SelectQueryNode"||N(this,Rn).set(p,new Set(this.getColumns(f))),f}async transformResult({result:f,queryId:p}){if(!Array.isArray(f.rows))return f;const y=N(this,Rn).get(p);return y&&f.rows.forEach(b=>this.parseObject(b,y)),f}getColumns(f){var y,b;const p=[];for(const E in f)f[E]&&typeof f[E]=="object"&&(f[E].json===!0&&typeof((y=f.alias)==null?void 0:y.name)=="string"&&p.push((b=f.alias)==null?void 0:b.name),p.push(...this.getColumns(f[E])));return p}parseObject(f,p){for(const y in f)p.has(y)&&(f[y]=JSON.parse(String(f[y]))),typeof f[y]=="object"&&this.parseObject(f[y],p)}}Rn=new WeakMap;function covert(m){const p={any:"blob",string:"text",number:"real",unknown:"blob",instance:"blob",bigint:"integer",integer:"integer",boolean:"boolean"}[m];if(p)return p;throw new Error(`Type "${m}" is not allowed in the database schema!`)}async function apply(m,{schema:f}){var p;for(const y in f){const b=f[y];let E=m.schema.createTable(y).ifNotExists();for(const _ in b.schema){const{type:v}=b.schema[_];E=E.addColumn(_,(p=b.ordered)!=null&&p.find(([I])=>I===_)?"blob":covert(v))}b.primary&&(E=E.addPrimaryKeyConstraint("primary_key",b.primary)),await E.execute();for(const _ of b.indices||[])await m.schema.createIndex(`${y}_${_.join("_")}`).ifNotExists().on(y).columns(_).execute();b.crr&&await sql`SELECT crsql_as_crr(${y})`.execute(m);for(const _ of b.ordered||[])await sql`SELECT crsql_fract_as_ordered(${y},${sql.join(_)})`.execute(m);await m.schema.createTable("__crstore_sync").ifNotExists().addColumn("version","integer").execute(),await sql`INSERT INTO __crstore_sync (version) SELECT 0
      WHERE NOT EXISTS (SELECT * FROM __crstore_sync)
    `.execute(m)}}function primary(m,...f){return m.primary=f,m}function crr(m){return m.crr=!0,m}function ordered(m,f,...p){return m.ordered||(m.ordered=[]),m.ordered.push([f,...p]),m}function index(m,...f){return m.indices||(m.indices=[]),m.indices.push(f),m}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var e=function(){return(e=Object.assign||function(m){for(var f,p=1,y=arguments.length;p<y;p++)for(var b in f=arguments[p])Object.prototype.hasOwnProperty.call(f,b)&&(m[b]=f[b]);return m}).apply(this,arguments)};function t(m,f,p,y){return new(p||(p=Promise))(function(b,E){function _(S){try{I(y.next(S))}catch(C){E(C)}}function v(S){try{I(y.throw(S))}catch(C){E(C)}}function I(S){var C;S.done?b(S.value):(C=S.value,C instanceof p?C:new p(function(W){W(C)})).then(_,v)}I((y=y.apply(m,f||[])).next())})}function n(m,f){var p,y,b,E,_={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return E={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(E[Symbol.iterator]=function(){return this}),E;function v(I){return function(S){return function(C){if(p)throw new TypeError("Generator is already executing.");for(;_;)try{if(p=1,y&&(b=2&C[0]?y.return:C[0]?y.throw||((b=y.return)&&b.call(y),0):y.next)&&!(b=b.call(y,C[1])).done)return b;switch(y=0,b&&(C=[2&C[0],b.value]),C[0]){case 0:case 1:b=C;break;case 4:return _.label++,{value:C[1],done:!1};case 5:_.label++,y=C[1],C=[0];continue;case 7:C=_.ops.pop(),_.trys.pop();continue;default:if(b=_.trys,!((b=b.length>0&&b[b.length-1])||C[0]!==6&&C[0]!==2)){_=0;continue}if(C[0]===3&&(!b||C[1]>b[0]&&C[1]<b[3])){_.label=C[1];break}if(C[0]===6&&_.label<b[1]){_.label=b[1],b=C;break}if(b&&_.label<b[2]){_.label=b[2],_.ops.push(C);break}b[2]&&_.ops.pop(),_.trys.pop();continue}C=f.call(m,_)}catch(W){C=[6,W],y=0}finally{p=b=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}([I,S])}}}function o(m,f){var p=typeof Symbol=="function"&&m[Symbol.iterator];if(!p)return m;var y,b,E=p.call(m),_=[];try{for(;(f===void 0||f-- >0)&&!(y=E.next()).done;)_.push(y.value)}catch(v){b={error:v}}finally{try{y&&!y.done&&(p=E.return)&&p.call(E)}finally{if(b)throw b.error}}return _}function r(m,f){for(var p=0,y=f.length,b=m.length;p<y;p++,b++)m[b]=f[p];return m}var i=function(){function m(f){var p=this,y=f.key,b=f.heartBeatIntervalTime,E=b===void 0?1e3:b,_=f.heartBeatDetectIntervalTime,v=_===void 0?2e3:_;this._heartBeatIntervalId=null,this._heartBeatDetectIntervalId=null,this._key=y,this._heartBeatIntervalTime=E,this._heartBeatDetectIntervalTime=v,window.addEventListener("unload",function(){p.destroy()})}return m.prototype.start=function(){var f=this;this._heartBeatIntervalId=setInterval(function(){f._setLocalTime()},this._heartBeatIntervalTime)},m.prototype.destroy=function(){this._heartBeatIntervalId&&clearInterval(this._heartBeatIntervalId),this._heartBeatDetectIntervalId&&clearInterval(this._heartBeatDetectIntervalId)},m.prototype._setLocalTime=function(){window.localStorage.setItem(this._key,Date.now().toString())},m.prototype.detect=function(f){this._heartBeatDetectIntervalId=setInterval(function(){f()},this._heartBeatDetectIntervalTime)},m}();function u(m,f){window.localStorage.setItem(m,f),function(p,y){var b=new Event(p);b.value=y,b.key=p,document.dispatchEvent(b)}(m,f)}function a(m){return window.localStorage.getItem(m)}function s(m,f){var p=function(){return t(this,void 0,void 0,function(){return n(this,function(b){switch(b.label){case 0:return[4,f()];case 1:return b.sent()&&document.removeEventListener(m,p),[2]}})})};document.addEventListener(m,p,!1);var y=function(b){return t(this,void 0,void 0,function(){return n(this,function(E){switch(E.label){case 0:return b.storageArea!==localStorage||b.key!==m?[3,2]:[4,f()];case 1:E.sent()&&window.removeEventListener("storage",y),E.label=2;case 2:return[2]}})})};window.addEventListener("storage",y,!1)}var c,l={EXCLUSIVE:"exclusive",SHARED:"shared"};function d(){return new Date().getTime()+"-"+String(Math.random()).substring(2)}(function(m){m.REQUEST_QUEUE_MAP="$navigator.locks-requestQueueMap",m.HELD_LOCK_SET="$navigator.locks-heldLockSet",m.CLIENT_IDS="$navigator.locks-clientIds"})(c||(c={}));var h=function(){function m(){this._defaultOptions={mode:l.EXCLUSIVE,ifAvailable:!1,steal:!1},this._clientId="$navigator.locks-clientId-"+d(),this._init()}return m.prototype._init=function(){var f=this;this._storeThisClientId();var p=new i({key:this._clientId});p.start(),p.detect(function(){return f._cleanUnliveClientLocks()}),this._onUnload()},m.prototype._getClientIds=function(){var f=a(c.CLIENT_IDS);return f&&JSON.parse(f)||[]},m.prototype._storeClientIds=function(f){u(c.CLIENT_IDS,JSON.stringify(f))},m.prototype._storeThisClientId=function(){var f=r(r([],o(this._getClientIds())),[this._clientId]);this._storeClientIds(f)},m.prototype.request=function(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];return t(this,void 0,void 0,function(){var y;return n(this,function(b){return y=this,[2,new Promise(function(E,_){return t(this,void 0,void 0,function(){var v,I,S,C,W,$,P,U,R;return n(this,function(A){if(!(v=y._handleRequestArgs(f,_)))return[2];if(I=v.cb,S=v._options,C=f[0],W={name:C,mode:S.mode,clientId:y._clientId,uuid:C+"-"+d(),resolve:E,reject:_},$=y._resolveWithCB(I,E,_),P=y._heldLockSet(),U=P.find(function(x){return x.name===W.name}),R=y._requestLockQueueMap()[W.name]||[],S.steal===!0){if(!y._handleExceptionWhenStealIsTrue(S,_))return[2];P=P.filter(function(x){return x.name!==W.name}),U=P.find(function(x){return x.name===W.name})}else{if(S.ifAvailable===!0)return U&&(U.mode!==l.SHARED||W.mode!==l.SHARED)||R.length?[2,$(null)]:[2,y._handleNewHeldLock(W,$)];if(S.signal!==void 0&&!y._handleSignalExisted(S,_,W))return[2]}return y._handleHeldLockAndRequest(U,W,$,R,P),[2]})})})]})})},m.prototype.query=function(){return t(this,void 0,void 0,function(){return n(this,function(f){return[2,this._query()]})})},m.prototype._pushToLockRequestQueueMap=function(f){var p=this._requestLockQueueMap(),y=p[f.name]||[];return p[f.name]=r(r([],o(y)),[f]),this._storeRequestLockQueueMap(p),f},m.prototype._pushToHeldLockSet=function(f,p){p===void 0&&(p=this._heldLockSet());var y=r(r([],o(p)),[f]);return this._storeHeldLockSet(y),f},m.prototype._requestLockQueueMap=function(){var f=a(c.REQUEST_QUEUE_MAP);return f&&JSON.parse(f)||{}},m.prototype._heldLockSet=function(){var f=a(c.HELD_LOCK_SET);return f&&JSON.parse(f)||[]},m.prototype._updateHeldAndRequestLocks=function(f){var p=this._heldLockSet(),y=p.findIndex(function(C){return C.uuid===f.uuid});if(y!==-1){p.splice(y,1);var b=this._requestLockQueueMap(),E=b[f.name]||[],_=o(E),v=_[0],I=_.slice(1);if(v){if(v.mode===l.EXCLUSIVE||I.length===0)p.push(v),b[f.name]=I;else if(v.mode===l.SHARED){var S=E.findIndex(function(C){return C.mode!==l.SHARED});S===-1&&(S=E.length),p=r(r([],o(p)),o(E.splice(0,S)))}return this._storeHeldLockSetAndRequestLockQueueMap(p,b),v}this._storeHeldLockSet(p)}else console.log("this held lock which uuid is "+f.uuid+" had been steal")},m.prototype._handleSignalExisted=function(f,p,y){return f.signal instanceof AbortSignal?f.signal.aborted?(p(new DOMException("Failed to execute 'request' on 'LockManager': The request was aborted.")),!1):(this._signalOnabort(f.signal,y),!0):(p(new TypeError("Failed to execute 'request' on 'LockManager': member signal is not of type AbortSignal.")),!1)},m.prototype._handleExceptionWhenStealIsTrue=function(f,p){return f.mode!==l.EXCLUSIVE?(p(new DOMException("Failed to execute 'request' on 'LockManager': The 'steal' option may only be used with 'exclusive' locks.")),!1):f.ifAvailable!==!0||(p(new DOMException("Failed to execute 'request' on 'LockManager': The 'steal' and 'ifAvailable' options cannot be used together.")),!1)},m.prototype._handleRequestArgs=function(f,p){var y,b,E=f.length;if(E<2)return p(new TypeError("Failed to execute 'request' on 'LockManager': 2 arguments required, but only "+f.length+" present.")),null;if(E===2){if(typeof f[1]!="function")return p(new TypeError("Failed to execute 'request' on 'LockManager': parameter 2 is not of type 'Function'.")),null;y=f[1],b=this._defaultOptions}else{if(typeof f[2]!="function")return p(new TypeError("Failed to execute 'request' on 'LockManager': parameter 3 is not of type 'Function'.")),null;y=f[2],b=e(e({},this._defaultOptions),f[1])}return Object.values(l).indexOf(b.mode)<0?(p(new TypeError("Failed to execute 'request' on 'LockManager': The provided value '"+b.mode+"' is not a valid enum value of type LockMode.")),null):f[0][0]==="-"?(p(new DOMException("Failed to execute 'request' on 'LockManager': Names cannot start with '-'.")),null):{cb:y,_options:b}},m.prototype._handleHeldLockAndRequest=function(f,p,y,b,E){f?f.mode===l.EXCLUSIVE?this._handleNewLockRequest(p,y):f.mode===l.SHARED&&(p.mode===l.SHARED&&b.length===0?this._handleNewHeldLock(p,y,E):this._handleNewLockRequest(p,y)):this._handleNewHeldLock(p,y,E)},m.prototype._signalOnabort=function(f,p){var y=this,b=p.name,E=p.uuid;f.onabort=function(){var _=y._requestLockQueueMap(),v=_[b].findIndex(function(I){return I.uuid===E});v!==-1&&(_[b].splice(v,1),y._storeRequestLockQueueMap(_))}},m.prototype._resolveWithCB=function(f,p,y){var b=this;return function(E){return new Promise(function(_){new Promise(function(v){return v("")}).then(function(){return t(b,void 0,void 0,function(){var v,I;return n(this,function(S){switch(S.label){case 0:return S.trys.push([0,2,,3]),[4,f(E)];case 1:return v=S.sent(),_(v),p(v),[3,3];case 2:return I=S.sent(),_(I),y(I),[3,3];case 3:return[2]}})})})})}},m.prototype._handleNewHeldLock=function(f,p,y){return t(this,void 0,void 0,function(){var b,E,_,v=this;return n(this,function(I){return this._pushToHeldLockSet(f,y),b=!1,E=!1,_=function(){return!(b||E||v._isInHeldLockSet(f.uuid))&&(v._handleHeldLockBeSteal(f),E=!0,!0)},s(c.HELD_LOCK_SET,_),p({name:f.name,mode:f.mode}).then(function(){b=!0,v._updateHeldAndRequestLocks(f)}),[2]})})},m.prototype._handleHeldLockBeSteal=function(f){f.reject(new DOMException("Lock broken by another request with the 'steal' option."))},m.prototype._storeHeldLockSet=function(f){u(c.HELD_LOCK_SET,JSON.stringify(f))},m.prototype._storeRequestLockQueueMap=function(f){u(c.REQUEST_QUEUE_MAP,JSON.stringify(f))},m.prototype._isInHeldLockSet=function(f){return this._heldLockSet().some(function(p){return p.uuid===f})},m.prototype._handleNewLockRequest=function(f,p){var y=this;this._pushToLockRequestQueueMap(f);var b=!1;s(c.HELD_LOCK_SET,function(){return t(y,void 0,void 0,function(){return n(this,function(E){switch(E.label){case 0:return b||!this._isInHeldLockSet(f.uuid)?[3,5]:(b=!0,[4,p({name:f.name,mode:f.mode})]);case 1:return E.sent(),this._isInHeldLockSet(f.uuid)||this._handleHeldLockBeSteal(f),f.mode!==l.EXCLUSIVE?[3,2]:(this._updateHeldAndRequestLocks(f),[3,4]);case 2:return f.mode!==l.SHARED?[3,4]:[4,this._handleSharedLockFromListener(f)];case 3:E.sent(),E.label=4;case 4:return[2,!0];case 5:return[2,!1]}})})})},m.prototype._handleSharedLockFromListener=function(f){return t(this,void 0,void 0,function(){var p;return n(this,function(y){switch(y.label){case 0:return[4,(b=Math.floor(1e3*Math.random()),new Promise(function(E){return setTimeout(E,b)}))];case 1:return y.sent(),(p=this._heldLockSet().filter(function(E){return E.name===f.name&&E.uuid!==f.uuid&&E.mode===l.SHARED})).length?this._storeHeldLockSet(p):this._updateHeldAndRequestLocks(f),[2]}var b})})},m.prototype._storeHeldLockSetAndRequestLockQueueMap=function(f,p){this._storeHeldLockSet(f),this._storeRequestLockQueueMap(p)},m.prototype._query=function(){var f={held:this._heldLockSet(),pending:[]},p=this._requestLockQueueMap();for(var y in p){var b=p[y];f.pending=f.pending.concat(b)}return f},m.prototype._onUnload=function(){var f=this;window.addEventListener("unload",function(p){f._cleanClientLocksByClientId(f._clientId)})},m.prototype._cleanClientLocksByClientId=function(f){var p=this._requestLockQueueMap();this._cleanRequestLockQueueByClientId(p,f);var y=this._cleanHeldLockSetByClientId(p,f);this._storeHeldLockSetAndRequestLockQueueMap(y,p)},m.prototype._cleanHeldLockSetByClientId=function(f,p){var y=this._heldLockSet(),b=[];return y.forEach(function(E){if(E.clientId!==p)b.push(E);else{var _=f[E.name]||[],v=o(_),I=v[0],S=v.slice(1);if(I){if(I.mode===l.EXCLUSIVE||S.length===0)b.push(I),f[E.name]=S;else if(I.mode===l.SHARED){var C=_.findIndex(function(W){return W.mode!==l.SHARED});C===-1&&(C=_.length),b=r(r([],o(b)),o(_.splice(0,C)))}}}}),b},m.prototype._cleanRequestLockQueueByClientId=function(f,p){for(var y in f){var b=f[y];f[y]=b.filter(function(E){return E.clientId!==p})}},m.prototype._cleanUnliveClientLocks=function(){var f=this,p=r([],o(new Set(this._getClientIds())));if(p.length){var y=[];p.forEach(function(b){var E,_=a(b);!_||Date.now()-Number(_)>3100?(E=b,window.localStorage.removeItem(E),f._cleanClientLocksByClientId(b)):y.push(b)}),JSON.stringify(p)!==JSON.stringify(y)&&this._storeClientIds(y)}else this._storeClientIds([])},m}();(function(){if(typeof window<"u"){var m=window.navigator;if(m&&!m.locks){var f=new h;Object.defineProperty(m,"locks",{value:f})}}})();const wasmUrl=""+new URL("../assets/crsqlite.0980e00c.wasm",import.meta.url).href;var Module=(()=>{var m=import.meta.url;return function(f={}){var p;p||(p=typeof f<"u"?f:{});var y,b;p.ready=new Promise(function(w,g){y=w,b=g});var E=Object.assign({},p),_="./this.program",v=(w,g)=>{throw g},I=typeof window=="object",S=typeof importScripts=="function",C="",W;(I||S)&&(S?C=self.location.href:typeof document<"u"&&document.currentScript&&(C=document.currentScript.src),m&&(C=m),C.indexOf("blob:")!==0?C=C.substr(0,C.replace(/[?#].*/,"").lastIndexOf("/")+1):C="",S&&(W=w=>{var g=new XMLHttpRequest;return g.open("GET",w,!1),g.responseType="arraybuffer",g.send(null),new Uint8Array(g.response)}));var $=p.print||console.log.bind(console),P=p.printErr||console.warn.bind(console);Object.assign(p,E),E=null,p.thisProgram&&(_=p.thisProgram),p.quit&&(v=p.quit);var U;p.wasmBinary&&(U=p.wasmBinary);var R=p.noExitRuntime||!0;typeof WebAssembly!="object"&&Ze("no native wasm support detected");var A,x=!1,D,q=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function V(w,g,O){var T=g+O;for(O=g;w[O]&&!(O>=T);)++O;if(16<O-g&&w.buffer&&q)return q.decode(w.subarray(g,O));for(T="";g<O;){var k=w[g++];if(k&128){var L=w[g++]&63;if((k&224)==192)T+=String.fromCharCode((k&31)<<6|L);else{var F=w[g++]&63;k=(k&240)==224?(k&15)<<12|L<<6|F:(k&7)<<18|L<<12|F<<6|w[g++]&63,65536>k?T+=String.fromCharCode(k):(k-=65536,T+=String.fromCharCode(55296|k>>10,56320|k&1023))}}else T+=String.fromCharCode(k)}return T}function Y(w,g){return w?V(Z,w,g):""}function de(w,g,O,T){if(!(0<T))return 0;var k=O;T=O+T-1;for(var L=0;L<w.length;++L){var F=w.charCodeAt(L);if(55296<=F&&57343>=F){var K=w.charCodeAt(++L);F=65536+((F&1023)<<10)|K&1023}if(127>=F){if(O>=T)break;g[O++]=F}else{if(2047>=F){if(O+1>=T)break;g[O++]=192|F>>6}else{if(65535>=F){if(O+2>=T)break;g[O++]=224|F>>12}else{if(O+3>=T)break;g[O++]=240|F>>18,g[O++]=128|F>>12&63}g[O++]=128|F>>6&63}g[O++]=128|F&63}}return g[O]=0,O-k}function he(w,g,O){return de(w,Z,g,O)}function ue(w){for(var g=0,O=0;O<w.length;++O){var T=w.charCodeAt(O);127>=T?g++:2047>=T?g+=2:55296<=T&&57343>=T?(g+=4,++O):g+=3}return g}var _e,Z,ie,ee,se,me,ye;function X(){var w=A.buffer;p.HEAP8=_e=new Int8Array(w),p.HEAP16=ie=new Int16Array(w),p.HEAP32=ee=new Int32Array(w),p.HEAPU8=Z=new Uint8Array(w),p.HEAPU16=new Uint16Array(w),p.HEAPU32=se=new Uint32Array(w),p.HEAPF32=me=new Float32Array(w),p.HEAPF64=ye=new Float64Array(w)}var ce=[],Ee=[],at=[],Je=[],_t=0;function Ht(){var w=p.preRun.shift();ce.unshift(w)}var dt=0,Ye=null;function Ze(w){throw p.onAbort&&p.onAbort(w),w="Aborted("+w+")",P(w),x=!0,D=1,w=new WebAssembly.RuntimeError(w+". Build with -sASSERTIONS for more info."),b(w),w}function Or(w){return w.startsWith("data:application/octet-stream;base64,")}var Ft;if(p.locateFile){if(Ft="crsqlite.wasm",!Or(Ft)){var Bn=Ft;Ft=p.locateFile?p.locateFile(Bn,C):C+Bn}}else Ft=new URL(""+new URL("../assets/crsqlite.0980e00c.wasm",import.meta.url).href,self.location).href;function Vt(w){try{if(w==Ft&&U)return new Uint8Array(U);if(W)return W(w);throw"both async and sync fetching of the wasm failed"}catch(g){Ze(g)}}function Qt(w){return U||!I&&!S||typeof fetch!="function"?Promise.resolve().then(function(){return Vt(w)}):fetch(w,{credentials:"same-origin"}).then(function(g){if(!g.ok)throw"failed to load wasm binary file at '"+w+"'";return g.arrayBuffer()}).catch(function(){return Vt(w)})}function kt(w,g,O){return Qt(w).then(function(T){return WebAssembly.instantiate(T,g)}).then(function(T){return T}).then(O,function(T){P("failed to asynchronously prepare wasm: "+T),Ze(T)})}function Jt(w,g){var O=Ft;return U||typeof WebAssembly.instantiateStreaming!="function"||Or(O)||typeof fetch!="function"?kt(O,w,g):fetch(O,{credentials:"same-origin"}).then(function(T){return WebAssembly.instantiateStreaming(T,w).then(g,function(k){return P("wasm streaming compile failed: "+k),P("falling back to ArrayBuffer instantiation"),kt(O,w,g)})})}var fe,De;function tn(w){this.name="ExitStatus",this.message="Program terminated with exit("+w+")",this.status=w}function vr(w){for(;0<w.length;)w.shift()(p)}function Be(w,g="i8"){switch(g.endsWith("*")&&(g="*"),g){case"i1":return _e[w>>0];case"i8":return _e[w>>0];case"i16":return ie[w>>1];case"i32":return ee[w>>2];case"i64":return ee[w>>2];case"float":return me[w>>2];case"double":return ye[w>>3];case"*":return se[w>>2];default:Ze("invalid type for getValue: "+g)}}function wt(w,g,O="i8"){switch(O.endsWith("*")&&(O="*"),O){case"i1":_e[w>>0]=g;break;case"i8":_e[w>>0]=g;break;case"i16":ie[w>>1]=g;break;case"i32":ee[w>>2]=g;break;case"i64":De=[g>>>0,(fe=g,1<=+Math.abs(fe)?0<fe?(Math.min(+Math.floor(fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],ee[w>>2]=De[0],ee[w+4>>2]=De[1];break;case"float":me[w>>2]=g;break;case"double":ye[w>>3]=g;break;case"*":se[w>>2]=g;break;default:Ze("invalid type for setValue: "+O)}}var Fn=(w,g)=>{for(var O=0,T=w.length-1;0<=T;T--){var k=w[T];k==="."?w.splice(T,1):k===".."?(w.splice(T,1),O++):O&&(w.splice(T,1),O--)}if(g)for(;O;O--)w.unshift("..");return w},te=w=>{var g=w.charAt(0)==="/",O=w.substr(-1)==="/";return(w=Fn(w.split("/").filter(T=>!!T),!g).join("/"))||g||(w="."),w&&O&&(w+="/"),(g?"/":"")+w},Ie=w=>{var g=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(w).slice(1);return w=g[0],g=g[1],!w&&!g?".":(g&&(g=g.substr(0,g.length-1)),w+g)},ve=w=>{if(w==="/")return"/";w=te(w),w=w.replace(/\/$/,"");var g=w.lastIndexOf("/");return g===-1?w:w.substr(g+1)};function He(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var w=new Uint8Array(1);return()=>(crypto.getRandomValues(w),w[0])}return()=>Ze("randomDevice")}function Ve(){for(var w="",g=!1,O=arguments.length-1;-1<=O&&!g;O--){if(g=0<=O?arguments[O]:"/",typeof g!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!g)return"";w=g+"/"+w,g=g.charAt(0)==="/"}return w=Fn(w.split("/").filter(T=>!!T),!g).join("/"),(g?"/":"")+w||"."}var rn=[];function nn(w,g){rn[w]={input:[],Ob:[],Zb:g},Ti(w,Bo)}var Bo={open:function(w){var g=rn[w.node.bc];if(!g)throw new G(43);w.Pb=g,w.seekable=!1},close:function(w){w.Pb.Zb.ec(w.Pb)},ec:function(w){w.Pb.Zb.ec(w.Pb)},read:function(w,g,O,T){if(!w.Pb||!w.Pb.Zb.vc)throw new G(60);for(var k=0,L=0;L<T;L++){try{var F=w.Pb.Zb.vc(w.Pb)}catch{throw new G(29)}if(F===void 0&&k===0)throw new G(6);if(F==null)break;k++,g[O+L]=F}return k&&(w.node.timestamp=Date.now()),k},write:function(w,g,O,T){if(!w.Pb||!w.Pb.Zb.pc)throw new G(60);try{for(var k=0;k<T;k++)w.Pb.Zb.pc(w.Pb,g[O+k])}catch{throw new G(29)}return T&&(w.node.timestamp=Date.now()),k}},Fo={vc:function(w){if(!w.input.length){var g=null;if(typeof window<"u"&&typeof window.prompt=="function"?(g=window.prompt("Input: "),g!==null&&(g+=`
`)):typeof readline=="function"&&(g=readline(),g!==null&&(g+=`
`)),!g)return null;var O=Array(ue(g)+1);g=de(g,O,0,O.length),O.length=g,w.input=O}return w.input.shift()},pc:function(w,g){g===null||g===10?($(V(w.Ob,0)),w.Ob=[]):g!=0&&w.Ob.push(g)},ec:function(w){w.Ob&&0<w.Ob.length&&($(V(w.Ob,0)),w.Ob=[])}},Qo={pc:function(w,g){g===null||g===10?(P(V(w.Ob,0)),w.Ob=[]):g!=0&&w.Ob.push(g)},ec:function(w){w.Ob&&0<w.Ob.length&&(P(V(w.Ob,0)),w.Ob=[])}},pe={Sb:null,Rb:function(){return pe.createNode(null,"/",16895,0)},createNode:function(w,g,O,T){if((O&61440)===24576||(O&61440)===4096)throw new G(63);return pe.Sb||(pe.Sb={dir:{node:{Qb:pe.Ab.Qb,Nb:pe.Ab.Nb,$b:pe.Ab.$b,fc:pe.Ab.fc,yc:pe.Ab.yc,lc:pe.Ab.lc,jc:pe.Ab.jc,xc:pe.Ab.xc,kc:pe.Ab.kc},stream:{Wb:pe.Jb.Wb}},file:{node:{Qb:pe.Ab.Qb,Nb:pe.Ab.Nb},stream:{Wb:pe.Jb.Wb,read:pe.Jb.read,write:pe.Jb.write,rc:pe.Jb.rc,hc:pe.Jb.hc,ic:pe.Jb.ic}},link:{node:{Qb:pe.Ab.Qb,Nb:pe.Ab.Nb,cc:pe.Ab.cc},stream:{}},sc:{node:{Qb:pe.Ab.Qb,Nb:pe.Ab.Nb},stream:Uo}}),O=Xi(w,g,O,T),(O.mode&61440)===16384?(O.Ab=pe.Sb.dir.node,O.Jb=pe.Sb.dir.stream,O.Kb={}):(O.mode&61440)===32768?(O.Ab=pe.Sb.file.node,O.Jb=pe.Sb.file.stream,O.Mb=0,O.Kb=null):(O.mode&61440)===40960?(O.Ab=pe.Sb.link.node,O.Jb=pe.Sb.link.stream):(O.mode&61440)===8192&&(O.Ab=pe.Sb.sc.node,O.Jb=pe.Sb.sc.stream),O.timestamp=Date.now(),w&&(w.Kb[g]=O,w.timestamp=O.timestamp),O},Qc:function(w){return w.Kb?w.Kb.subarray?w.Kb.subarray(0,w.Mb):new Uint8Array(w.Kb):new Uint8Array(0)},tc:function(w,g){var O=w.Kb?w.Kb.length:0;O>=g||(g=Math.max(g,O*(1048576>O?2:1.125)>>>0),O!=0&&(g=Math.max(g,256)),O=w.Kb,w.Kb=new Uint8Array(g),0<w.Mb&&w.Kb.set(O.subarray(0,w.Mb),0))},Mc:function(w,g){if(w.Mb!=g)if(g==0)w.Kb=null,w.Mb=0;else{var O=w.Kb;w.Kb=new Uint8Array(g),O&&w.Kb.set(O.subarray(0,Math.min(g,w.Mb))),w.Mb=g}},Ab:{Qb:function(w){var g={};return g.Ec=(w.mode&61440)===8192?w.id:1,g.nc=w.id,g.mode=w.mode,g.Kc=1,g.uid=0,g.Hc=0,g.bc=w.bc,(w.mode&61440)===16384?g.size=4096:(w.mode&61440)===32768?g.size=w.Mb:(w.mode&61440)===40960?g.size=w.link.length:g.size=0,g.Ac=new Date(w.timestamp),g.Jc=new Date(w.timestamp),g.Dc=new Date(w.timestamp),g.Bc=4096,g.Cc=Math.ceil(g.size/g.Bc),g},Nb:function(w,g){g.mode!==void 0&&(w.mode=g.mode),g.timestamp!==void 0&&(w.timestamp=g.timestamp),g.size!==void 0&&pe.Mc(w,g.size)},$b:function(){throw Oi[44]},fc:function(w,g,O,T){return pe.createNode(w,g,O,T)},yc:function(w,g,O){if((w.mode&61440)===16384){try{var T=or(g,O)}catch{}if(T)for(var k in T.Kb)throw new G(55)}delete w.parent.Kb[w.name],w.parent.timestamp=Date.now(),w.name=O,g.Kb[O]=w,g.timestamp=w.parent.timestamp,w.parent=g},lc:function(w,g){delete w.Kb[g],w.timestamp=Date.now()},jc:function(w,g){var O=or(w,g),T;for(T in O.Kb)throw new G(55);delete w.Kb[g],w.timestamp=Date.now()},xc:function(w){var g=[".",".."],O;for(O in w.Kb)w.Kb.hasOwnProperty(O)&&g.push(O);return g},kc:function(w,g,O){return w=pe.createNode(w,g,41471,0),w.link=O,w},cc:function(w){if((w.mode&61440)!==40960)throw new G(28);return w.link}},Jb:{read:function(w,g,O,T,k){var L=w.node.Kb;if(k>=w.node.Mb)return 0;if(w=Math.min(w.node.Mb-k,T),8<w&&L.subarray)g.set(L.subarray(k,k+w),O);else for(T=0;T<w;T++)g[O+T]=L[k+T];return w},write:function(w,g,O,T,k,L){if(g.buffer===_e.buffer&&(L=!1),!T)return 0;if(w=w.node,w.timestamp=Date.now(),g.subarray&&(!w.Kb||w.Kb.subarray)){if(L)return w.Kb=g.subarray(O,O+T),w.Mb=T;if(w.Mb===0&&k===0)return w.Kb=g.slice(O,O+T),w.Mb=T;if(k+T<=w.Mb)return w.Kb.set(g.subarray(O,O+T),k),T}if(pe.tc(w,k+T),w.Kb.subarray&&g.subarray)w.Kb.set(g.subarray(O,O+T),k);else for(L=0;L<T;L++)w.Kb[k+L]=g[O+L];return w.Mb=Math.max(w.Mb,k+T),T},Wb:function(w,g,O){if(O===1?g+=w.position:O===2&&(w.node.mode&61440)===32768&&(g+=w.node.Mb),0>g)throw new G(28);return g},rc:function(w,g,O){pe.tc(w.node,g+O),w.node.Mb=Math.max(w.node.Mb,g+O)},hc:function(w,g,O,T,k){if((w.node.mode&61440)!==32768)throw new G(43);if(w=w.node.Kb,k&2||w.buffer!==_e.buffer){if((0<O||O+g<w.length)&&(w.subarray?w=w.subarray(O,O+g):w=Array.prototype.slice.call(w,O,O+g)),O=!0,g=65536*Math.ceil(g/65536),(k=co(65536,g))?(Z.fill(0,k,k+g),g=k):g=0,!g)throw new G(48);_e.set(w,g)}else O=!1,g=w.byteOffset;return{Lc:g,zc:O}},ic:function(w,g,O,T){return pe.Jb.write(w,g,0,T,O,!1),0}}},_i=null,ji={},jt=[],zo=1,Kt=null,Ki=!0,G=null,Oi={},ft=(w,g={})=>{if(w=Ve(w),!w)return{path:"",node:null};if(g=Object.assign({uc:!0,qc:0},g),8<g.qc)throw new G(32);w=w.split("/").filter(F=>!!F);for(var O=_i,T="/",k=0;k<w.length;k++){var L=k===w.length-1;if(L&&g.parent)break;if(O=or(O,w[k]),T=te(T+"/"+w[k]),O.Xb&&(!L||L&&g.uc)&&(O=O.Xb.root),!L||g.Vb){for(L=0;(O.mode&61440)===40960;)if(O=ss(T),T=Ve(Ie(T),O),O=ft(T,{qc:g.qc+1}).node,40<L++)throw new G(32)}}return{path:T,node:O}},Qn=w=>{for(var g;;){if(w===w.parent)return w=w.Rb.wc,g?w[w.length-1]!=="/"?w+"/"+g:w+g:w;g=g?w.name+"/"+g:w.name,w=w.parent}},vi=(w,g)=>{for(var O=0,T=0;T<g.length;T++)O=(O<<5)-O+g.charCodeAt(T)|0;return(w+O>>>0)%Kt.length},Gi=w=>{var g=vi(w.parent.id,w.name);if(Kt[g]===w)Kt[g]=w.Yb;else for(g=Kt[g];g;){if(g.Yb===w){g.Yb=w.Yb;break}g=g.Yb}},or=(w,g)=>{var O;if(O=(O=Tr(w,"x"))?O:w.Ab.$b?0:2)throw new G(O,w);for(O=Kt[vi(w.id,g)];O;O=O.Yb){var T=O.name;if(O.parent.id===w.id&&T===g)return O}return w.Ab.$b(w,g)},Xi=(w,g,O,T)=>(w=new oo(w,g,O,T),g=vi(w.parent.id,w.name),w.Yb=Kt[g],Kt[g]=w),Po={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},Yi=w=>{var g=["r","w","rw"][w&3];return w&512&&(g+="w"),g},Tr=(w,g)=>{if(Ki)return 0;if(!g.includes("r")||w.mode&292){if(g.includes("w")&&!(w.mode&146)||g.includes("x")&&!(w.mode&73))return 2}else return 2;return 0},Zi=(w,g)=>{try{return or(w,g),20}catch{}return Tr(w,"wx")},es=(w,g,O)=>{try{var T=or(w,g)}catch(k){return k.Lb}if(w=Tr(w,"wx"))return w;if(O){if((T.mode&61440)!==16384)return 54;if(T===T.parent||Qn(T)==="/")return 10}else if((T.mode&61440)===16384)return 31;return 0},Mo=(w=0)=>{for(;4096>=w;w++)if(!jt[w])return w;throw new G(33)},ts=(w,g)=>(on||(on=function(){this.dc={}},on.prototype={},Object.defineProperties(on.prototype,{object:{get:function(){return this.node},set:function(O){this.node=O}},flags:{get:function(){return this.dc.flags},set:function(O){this.dc.flags=O}},position:{get:function(){return this.dc.position},set:function(O){this.dc.position=O}}})),w=Object.assign(new on,w),g=Mo(g),w.Tb=g,jt[g]=w),Uo={open:w=>{w.Jb=ji[w.node.bc].Jb,w.Jb.open&&w.Jb.open(w)},Wb:()=>{throw new G(70)}},Ti=(w,g)=>{ji[w]={Jb:g}},rs=(w,g)=>{var O=g==="/",T=!g;if(O&&_i)throw new G(10);if(!O&&!T){var k=ft(g,{uc:!1});if(g=k.path,k=k.node,k.Xb)throw new G(10);if((k.mode&61440)!==16384)throw new G(54)}g={type:w,Sc:{},wc:g,Ic:[]},w=w.Rb(g),w.Rb=g,g.root=w,O?_i=w:k&&(k.Xb=g,k.Rb&&k.Rb.Ic.push(g))},Ii=(w,g,O)=>{var T=ft(w,{parent:!0}).node;if(w=ve(w),!w||w==="."||w==="..")throw new G(28);var k=Zi(T,w);if(k)throw new G(k);if(!T.Ab.fc)throw new G(63);return T.Ab.fc(T,w,g,O)},At=(w,g)=>Ii(w,(g!==void 0?g:511)&1023|16384,0),zn=(w,g,O)=>{typeof O>"u"&&(O=g,g=438),Ii(w,g|8192,O)},Si=(w,g)=>{if(!Ve(w))throw new G(44);var O=ft(g,{parent:!0}).node;if(!O)throw new G(44);g=ve(g);var T=Zi(O,g);if(T)throw new G(T);if(!O.Ab.kc)throw new G(63);O.Ab.kc(O,g,w)},ns=w=>{var g=ft(w,{parent:!0}).node;w=ve(w);var O=or(g,w),T=es(g,w,!0);if(T)throw new G(T);if(!g.Ab.jc)throw new G(63);if(O.Xb)throw new G(10);g.Ab.jc(g,w),Gi(O)},ss=w=>{if(w=ft(w).node,!w)throw new G(44);if(!w.Ab.cc)throw new G(28);return Ve(Qn(w.parent),w.Ab.cc(w))},Pn=(w,g)=>{if(w=ft(w,{Vb:!g}).node,!w)throw new G(44);if(!w.Ab.Qb)throw new G(63);return w.Ab.Qb(w)},os=w=>Pn(w,!0),as=(w,g)=>{if(w=typeof w=="string"?ft(w,{Vb:!0}).node:w,!w.Ab.Nb)throw new G(63);w.Ab.Nb(w,{mode:g&4095|w.mode&-4096,timestamp:Date.now()})},us=(w,g)=>{if(0>g)throw new G(28);if(w=typeof w=="string"?ft(w,{Vb:!0}).node:w,!w.Ab.Nb)throw new G(63);if((w.mode&61440)===16384)throw new G(31);if((w.mode&61440)!==32768)throw new G(28);var O=Tr(w,"w");if(O)throw new G(O);w.Ab.Nb(w,{size:g,timestamp:Date.now()})},Mn=(w,g,O)=>{if(w==="")throw new G(44);if(typeof g=="string"){var T=Po[g];if(typeof T>"u")throw Error("Unknown file open mode: "+g);g=T}if(O=g&64?(typeof O>"u"?438:O)&4095|32768:0,typeof w=="object")var k=w;else{w=te(w);try{k=ft(w,{Vb:!(g&131072)}).node}catch{}}if(T=!1,g&64)if(k){if(g&128)throw new G(20)}else k=Ii(w,O,0),T=!0;if(!k)throw new G(44);if((k.mode&61440)===8192&&(g&=-513),g&65536&&(k.mode&61440)!==16384)throw new G(54);if(!T&&(O=k?(k.mode&61440)===40960?32:(k.mode&61440)===16384&&(Yi(g)!=="r"||g&512)?31:Tr(k,Yi(g)):44))throw new G(O);return g&512&&!T&&us(k,0),g&=-131713,k=ts({node:k,path:Qn(k),flags:g,seekable:!0,position:0,Jb:k.Jb,Pc:[],error:!1}),k.Jb.open&&k.Jb.open(k),!p.logReadFiles||g&1||(Un||(Un={}),w in Un||(Un[w]=1)),k},ls=(w,g,O)=>{if(w.Tb===null)throw new G(8);if(!w.seekable||!w.Jb.Wb)throw new G(70);if(O!=0&&O!=1&&O!=2)throw new G(28);w.position=w.Jb.Wb(w,g,O),w.Pc=[]},cs=()=>{G||(G=function(w,g){this.name="ErrnoError",this.node=g,this.Nc=function(O){this.Lb=O},this.Nc(w),this.message="FS error"},G.prototype=Error(),G.prototype.constructor=G,[44].forEach(w=>{Oi[w]=new G(w),Oi[w].stack="<generic error, no stack>"}))},ds,$o=(w,g)=>{var O=0;return w&&(O|=365),g&&(O|=146),O},sn=(w,g,O)=>{w=te("/dev/"+w);var T=$o(!!g,!!O);Ci||(Ci=64);var k=Ci++<<8|0;Ti(k,{open:L=>{L.seekable=!1},close:()=>{O&&O.buffer&&O.buffer.length&&O(10)},read:(L,F,K,z)=>{for(var M=0,J=0;J<z;J++){try{var j=g()}catch{throw new G(29)}if(j===void 0&&M===0)throw new G(6);if(j==null)break;M++,F[K+J]=j}return M&&(L.node.timestamp=Date.now()),M},write:(L,F,K,z)=>{for(var M=0;M<z;M++)try{O(F[K+M])}catch{throw new G(29)}return z&&(L.node.timestamp=Date.now()),M}}),zn(w,T,k)},Ci,Ae={},on,Un;function ar(w,g,O){if(g.charAt(0)==="/")return g;if(w=w===-100?"/":Ot(w).path,g.length==0){if(!O)throw new G(44);return w}return te(w+"/"+g)}function $n(w,g,O){try{var T=w(g)}catch(L){if(L&&L.node&&te(g)!==te(Qn(L.node)))return-54;throw L}ee[O>>2]=T.Ec,ee[O+8>>2]=T.nc,ee[O+12>>2]=T.mode,se[O+16>>2]=T.Kc,ee[O+20>>2]=T.uid,ee[O+24>>2]=T.Hc,ee[O+28>>2]=T.bc,De=[T.size>>>0,(fe=T.size,1<=+Math.abs(fe)?0<fe?(Math.min(+Math.floor(fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],ee[O+40>>2]=De[0],ee[O+44>>2]=De[1],ee[O+48>>2]=4096,ee[O+52>>2]=T.Cc,w=T.Ac.getTime(),g=T.Jc.getTime();var k=T.Dc.getTime();return De=[Math.floor(w/1e3)>>>0,(fe=Math.floor(w/1e3),1<=+Math.abs(fe)?0<fe?(Math.min(+Math.floor(fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],ee[O+56>>2]=De[0],ee[O+60>>2]=De[1],se[O+64>>2]=w%1e3*1e3,De=[Math.floor(g/1e3)>>>0,(fe=Math.floor(g/1e3),1<=+Math.abs(fe)?0<fe?(Math.min(+Math.floor(fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],ee[O+72>>2]=De[0],ee[O+76>>2]=De[1],se[O+80>>2]=g%1e3*1e3,De=[Math.floor(k/1e3)>>>0,(fe=Math.floor(k/1e3),1<=+Math.abs(fe)?0<fe?(Math.min(+Math.floor(fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],ee[O+88>>2]=De[0],ee[O+92>>2]=De[1],se[O+96>>2]=k%1e3*1e3,De=[T.nc>>>0,(fe=T.nc,1<=+Math.abs(fe)?0<fe?(Math.min(+Math.floor(fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],ee[O+104>>2]=De[0],ee[O+108>>2]=De[1],0}var Hn=void 0;function Vn(){return Hn+=4,ee[Hn-4>>2]}function Ot(w){if(w=jt[w],!w)throw new G(8);return w}function Ri(w){return se[w>>2]+4294967296*ee[w+4>>2]}var Ho=[0,31,60,91,121,152,182,213,244,274,305,335],Vo=[0,31,59,90,120,151,181,212,243,273,304,334];function fs(w){var g=ue(w)+1,O=qi(g);return O&&de(w,_e,O,g),O}var xi={};function hs(){if(!ki){var w={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:_||"./this.program"},g;for(g in xi)xi[g]===void 0?delete w[g]:w[g]=xi[g];var O=[];for(g in w)O.push(g+"="+w[g]);ki=O}return ki}var ki;function ps(){}function ms(){}function ys(){}function Ns(){}function bs(){}function ws(){}function Es(){}function gs(){}function _s(){}function Os(){}function vs(){}function Ts(){}function Is(){}function Ss(){}function Cs(){}function Rs(){}function xs(){}function ks(){}function As(){}function Ls(){}function qs(){}function Ws(){}function Ds(){}function Bs(){}function Fs(){}function Qs(){}function zs(){}function Ps(){}function Ms(){}function Us(){}function $s(){}function Hs(){}function Vs(){}function Js(){}function js(){}function Ks(){}function Gs(){}function Xs(){}function Ys(w){D=w,R||0<_t||(p.onExit&&p.onExit(w),x=!0),v(w,new tn(w))}function Ai(w){w instanceof tn||w=="unwind"||v(1,w)}function Jn(w){try{w()}catch(g){Ze(g)}}function Jo(w){var g={},O;for(O in w)(function(T){var k=w[T];g[T]=typeof k=="function"?function(){jn.push(T);try{return k.apply(null,arguments)}finally{x||(jn.pop()===T||Ze(),Lt&&Gt===1&&jn.length===0&&(Gt=0,Jn(yo),typeof Fibers<"u"&&Fibers.Tc()))}}:k})(O);return g}var Gt=0,Lt=null,Zs=0,jn=[],eo={},ro={},jo=0,Li=null,Ko=[];function Go(){return new Promise((w,g)=>{Li={resolve:w,reject:g}})}function Xo(){var w=qi(12300),g=w+12;ee[w>>2]=g,ee[w+4>>2]=g+12288,g=jn[0];var O=eo[g];return O===void 0&&(O=jo++,eo[g]=O,ro[O]=g),ee[w+8>>2]=O,w}function no(w){if(!x){if(Gt===0){var g=!1,O=!1;w((T=0)=>{if(!x&&(Zs=T,g=!0,O)){Gt=2,Jn(()=>No(Lt)),T=!1;try{var k=(0,p.asm[ro[ee[Lt+8>>2]]])()}catch(K){k=K,T=!0}var L=!1;if(!Lt){var F=Li;F&&(Li=null,(T?F.reject:F.resolve)(k),L=!0)}if(T&&!L)throw k}}),O=!0,g||(Gt=1,Lt=Xo(),Jn(()=>mo(Lt)))}else Gt===2?(Gt=0,Jn(bo),ao(Lt),Lt=null,Ko.forEach(T=>{if(!x)try{if(T(),!(R||0<_t))try{D=T=D,Ys(T)}catch(k){Ai(k)}}catch(k){Ai(k)}})):Ze("invalid state: "+Gt);return Zs}}function io(w){return no(g=>{w().then(g)})}var so={};function zt(w,g,O,T,k){function L(j){return--_t,z!==0&&po(z),g==="string"?Y(j):g==="boolean"?!!j:j}var F={string:j=>{var ne=0;if(j!=null&&j!==0){var ge=(j.length<<2)+1;ne=Wi(ge),he(j,ne,ge)}return ne},array:j=>{var ne=Wi(j.length);return _e.set(j,ne),ne}};w=p["_"+w];var K=[],z=0;if(T)for(var M=0;M<T.length;M++){var J=F[O[M]];J?(z===0&&(z=ho()),K[M]=J(T[M])):K[M]=T[M]}return O=Lt,T=w.apply(null,K),_t+=1,k=k&&k.async,Lt!=O?Go().then(L):(T=L(T),k?Promise.resolve(T):T)}function oo(w,g,O,T){w||(w=this),this.parent=w,this.Rb=w.Rb,this.Xb=null,this.id=zo++,this.name=g,this.mode=O,this.Ab={},this.Jb={},this.bc=T}Object.defineProperties(oo.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(w){w?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(w){w?this.mode|=146:this.mode&=-147}}}),cs(),Kt=Array(4096),rs(pe,"/"),At("/tmp"),At("/home"),At("/home/web_user"),(()=>{At("/dev"),Ti(259,{read:()=>0,write:(g,O,T,k)=>k}),zn("/dev/null",259),nn(1280,Fo),nn(1536,Qo),zn("/dev/tty",1280),zn("/dev/tty1",1536);var w=He();sn("random",w),sn("urandom",w),At("/dev/shm"),At("/dev/shm/tmp")})(),(()=>{At("/proc");var w=At("/proc/self");At("/proc/self/fd"),rs({Rb:()=>{var g=Xi(w,"fd",16895,73);return g.Ab={$b:(O,T)=>{var k=jt[+T];if(!k)throw new G(8);return O={parent:null,Rb:{wc:"fake"},Ab:{cc:()=>k.path}},O.parent=O}},g}},"/proc/self/fd")})(),function(){function w(T,k){const L=[];for(let F=0;T[k+F]!=0;++F){if(1e3<F)throw Error("C-string never terminated after 1k characters");L.push(T[k+F])}return String.fromCharCode(...L)}const g=new Map,O=new Map;p.updateHook=function(T,k){const L=g.size;return g.set(L,k),zt("update_hook","void",["number","number"],[T,L])},p.createFunction=function(T,k,L,F,K,z){const M=g.size;return g.set(M,{f:z,Ub:K}),zt("create_function","number","number string number number number number".split(" "),[T,k,L,F,M,0])},p.createAggregate=function(T,k,L,F,K,z,M){const J=g.size;return g.set(J,{step:z,Fc:M,Ub:K}),zt("create_function","number","number string number number number number".split(" "),[T,k,L,F,J,1])},p.getFunctionUserData=function(T){return O.get(T)},Ns=function(T,k,L,F,K,z){T=g.get(T);const M=_e;K=BigInt(z)<<32n|BigInt(K)&4294967295n,T(k,w(M,L),w(M,F),K)},ms=function(T,k,L,F){T=g.get(T),O.set(k,T.Ub),T.f(k,new Uint32Array(Z.buffer,F,L)),O.delete(k)},ys=function(T,k,L,F){T=g.get(T),O.set(k,T.Ub),T.step(k,new Uint32Array(Z.buffer,F,L)),O.delete(k)},ps=function(T,k){T=g.get(T),O.set(k,T.Ub),T.Fc(k),O.delete(k)}}(),function(){function w(z,M){const J=`get${z}`,j=`set${z}`;return new Proxy(new DataView(Z.buffer,M,z==="Int32"?4:8),{get(ne,ge){if(ge===J)return function(We,je){if(!je)throw Error("must be little endian");return ne[ge](We,je)};if(ge===j)return function(We,je,Ue){if(!Ue)throw Error("must be little endian");return ne[ge](We,je,Ue)};if(typeof ge=="string"&&ge.match(/^(get)|(set)/))throw Error("invalid type");return ne[ge]}})}const g=typeof so=="object",O=new Map,T=new Map,k=new Map,L=g?new Set:null,F=g?new Set:null,K=new Map;qs=function(z,M,J,j){K.set(Y(z),{size:M,ac:Array.from(new Uint32Array(Z.buffer,j,J))})},p.createModule=function(z,M,J,j){g&&(J.handleAsync=io);const ne=O.size;return O.set(ne,{module:J,Ub:j}),j=0,J.xCreate&&(j|=1),J.xConnect&&(j|=2),J.xBestIndex&&(j|=4),J.xDisconnect&&(j|=8),J.xDestroy&&(j|=16),J.xOpen&&(j|=32),J.xClose&&(j|=64),J.xFilter&&(j|=128),J.xNext&&(j|=256),J.xEof&&(j|=512),J.xColumn&&(j|=1024),J.xRowid&&(j|=2048),J.xUpdate&&(j|=4096),J.xBegin&&(j|=8192),J.xSync&&(j|=16384),J.xCommit&&(j|=32768),J.xRollback&&(j|=65536),J.xFindFunction&&(j|=131072),J.xRename&&(j|=262144),zt("create_module","number",["number","string","number","number"],[z,M,ne,j])},vs=function(z,M,J,j,ne,ge){if(M=O.get(M),T.set(ne,M),g){L.delete(ne);for(const We of L)T.delete(We)}return j=Array.from(new Uint32Array(Z.buffer,j,J)).map(We=>Y(We)),M.module.xCreate(z,M.Ub,j,ne,w("Int32",ge))},Os=function(z,M,J,j,ne,ge){if(M=O.get(M),T.set(ne,M),g){L.delete(ne);for(const We of L)T.delete(We)}return j=Array.from(new Uint32Array(Z.buffer,j,J)).map(We=>Y(We)),M.module.xConnect(z,M.Ub,j,ne,w("Int32",ge))},ws=function(z,M){var J=T.get(z),j=K.get("sqlite3_index_info").ac;const ne={};ne.nConstraint=Be(M+j[0],"i32"),ne.aConstraint=[];for(var ge=Be(M+j[1],"i32"),We=K.get("sqlite3_index_constraint").size,je=0;je<ne.nConstraint;++je){var Ue=ne.aConstraint,ht=Ue.push,et=ge+je*We,Ir=K.get("sqlite3_index_constraint").ac,Xt={};Xt.iColumn=Be(et+Ir[0],"i32"),Xt.op=Be(et+Ir[1],"i8"),Xt.usable=!!Be(et+Ir[2],"i8"),ht.call(Ue,Xt)}for(ne.nOrderBy=Be(M+j[2],"i32"),ne.aOrderBy=[],ge=Be(M+j[3],"i32"),We=K.get("sqlite3_index_orderby").size,je=0;je<ne.nOrderBy;++je)Ue=ne.aOrderBy,ht=Ue.push,et=ge+je*We,Ir=K.get("sqlite3_index_orderby").ac,Xt={},Xt.iColumn=Be(et+Ir[0],"i32"),Xt.desc=!!Be(et+Ir[1],"i8"),ht.call(Ue,Xt);for(ne.aConstraintUsage=[],ge=0;ge<ne.nConstraint;++ge)ne.aConstraintUsage.push({argvIndex:0,omit:!1});for(ne.idxNum=Be(M+j[5],"i32"),ne.idxStr=null,ne.orderByConsumed=!!Be(M+j[8],"i8"),ne.estimatedCost=Be(M+j[9],"double"),ne.estimatedRows=Be(M+j[10],"i64"),ne.idxFlags=Be(M+j[11],"i32"),ne.colUsed=Be(M+j[12],"i64"),z=J.module.xBestIndex(z,ne),J=K.get("sqlite3_index_info").ac,j=Be(M+J[4],"i32"),ge=K.get("sqlite3_index_constraint_usage").size,ht=0;ht<ne.nConstraint;++ht)We=j+ht*ge,Ue=ne.aConstraintUsage[ht],et=K.get("sqlite3_index_constraint_usage").ac,wt(We+et[0],Ue.argvIndex,"i32"),wt(We+et[1],Ue.omit?1:0,"i8");return wt(M+J[5],ne.idxNum,"i32"),typeof ne.idxStr=="string"&&(j=ue(ne.idxStr),ge=zt("sqlite3_malloc","number",["number"],[j+1]),he(ne.idxStr,ge,j+1),wt(M+J[6],ge,"i32"),wt(M+J[7],1,"i32")),wt(M+J[8],ne.orderByConsumed,"i32"),wt(M+J[9],ne.estimatedCost,"double"),wt(M+J[10],ne.estimatedRows,"i64"),wt(M+J[11],ne.idxFlags,"i32"),z},Is=function(z){const M=T.get(z);return g?L.add(z):T.delete(z),M.module.xDisconnect(z)},Ts=function(z){const M=T.get(z);return g?L.add(z):T.delete(z),M.module.xDestroy(z)},xs=function(z,M){const J=T.get(z);if(k.set(M,J),g){F.delete(M);for(const j of F)k.delete(j)}return J.module.xOpen(z,M)},Es=function(z){const M=k.get(z);return g?F.add(z):k.delete(z),M.module.xClose(z)},Ss=function(z){return k.get(z).module.xEof(z)?1:0},Cs=function(z,M,J,j,ne){const ge=k.get(z);return J=J?Y(J):null,ne=new Uint32Array(Z.buffer,ne,j),ge.module.xFilter(z,M,J,ne)},Rs=function(z){return k.get(z).module.xNext(z)},gs=function(z,M,J){return k.get(z).module.xColumn(z,M,J)},Ls=function(z,M){return k.get(z).module.xRowid(z,w("BigInt64",M))},Ds=function(z,M,J,j){const ne=T.get(z);return J=new Uint32Array(Z.buffer,J,M),ne.module.xUpdate(z,J,w("BigInt64",j))},bs=function(z){return T.get(z).module.xBegin(z)},Ws=function(z){return T.get(z).module.xSync(z)},_s=function(z){return T.get(z).module.xCommit(z)},As=function(z){return T.get(z).module.xRollback(z)},ks=function(z,M){const J=T.get(z);return M=Y(M),J.module.xRename(z,M)}}(),function(){function w(L,F){const K=`get${L}`,z=`set${L}`;return new Proxy(new DataView(Z.buffer,F,L==="Int32"?4:8),{get(M,J){if(J===K)return function(j,ne){if(!ne)throw Error("must be little endian");return M[J](j,ne)};if(J===z)return function(j,ne,ge){if(!ge)throw Error("must be little endian");return M[J](j,ne,ge)};if(typeof J=="string"&&J.match(/^(get)|(set)/))throw Error("invalid type");return M[J]}})}const g=typeof so=="object",O=new Map,T=new Map;p.registerVFS=function(L,F){if(zt("sqlite3_vfs_find","number",["string"],[L.name]))throw Error(`VFS '${L.name}' already registered`);g&&(L.handleAsync=io);var K=L.Rc??64;const z=p._malloc(4);return F=zt("register_vfs","number",["string","number","number","number"],[L.name,K,F?1:0,z]),F||(K=Be(z,"i32"),O.set(K,L)),p._free(z),F};const k=g?new Set:null;Qs=function(L){const F=T.get(L);return g?k.add(L):T.delete(L),F.xClose(L)},Vs=function(L,F,K,z){return T.get(L).xRead(L,Z.subarray(F,F+K),Be(z,"i64"))},Xs=function(L,F,K,z){return T.get(L).xWrite(L,Z.subarray(F,F+K),Be(z,"i64"))},Ks=function(L,F){return T.get(L).xTruncate(L,Be(F,"i64"))},js=function(L,F){return T.get(L).xSync(L,F)},Us=function(L,F){const K=T.get(L);return F=w("BigInt64",F),K.xFileSize(L,F)},$s=function(L,F){return T.get(L).xLock(L,F)},Gs=function(L,F){return T.get(L).xUnlock(L,F)},Fs=function(L,F){const K=T.get(L);return F=w("Int32",F),K.xCheckReservedLock(L,F)},Ms=function(L,F,K){const z=T.get(L);return K=new DataView(Z.buffer,K),z.xFileControl(L,F,K)},Js=function(L){return T.get(L).xSectorSize(L)},Ps=function(L){return T.get(L).xDeviceCharacteristics(L)},Hs=function(L,F,K,z,M){if(L=O.get(L),T.set(K,L),g){k.delete(K);for(var J of k)T.delete(J)}if(J=null,z&64){J=1;const j=[];for(;J;){const ne=Z[F++];if(ne)j.push(ne);else switch(Z[F]||(J=null),J){case 1:j.push(63),J=2;break;case 2:j.push(61),J=3;break;case 3:j.push(38),J=2}}J=new TextDecoder().decode(new Uint8Array(j))}else F&&(J=Y(F));return M=w("Int32",M),L.xOpen(J,K,z,M)},zs=function(L,F,K){return O.get(L).xDelete(Y(F),K)},Bs=function(L,F,K,z){return L=O.get(L),z=w("Int32",z),L.xAccess(Y(F),K,z)}}();var Yo={a:function(w,g,O,T){Ze("Assertion failed: "+Y(w)+", at: "+[g?Y(g):"unknown filename",O,T?Y(T):"unknown function"])},K:function(w,g){try{return w=Y(w),as(w,g),0}catch(O){if(typeof Ae>"u"||O.name!=="ErrnoError")throw O;return-O.Lb}},N:function(w,g,O){try{if(g=Y(g),g=ar(w,g),O&-8)return-28;var T=ft(g,{Vb:!0}).node;return T?(w="",O&4&&(w+="r"),O&2&&(w+="w"),O&1&&(w+="x"),w&&Tr(T,w)?-2:0):-44}catch(k){if(typeof Ae>"u"||k.name!=="ErrnoError")throw k;return-k.Lb}},L:function(w,g){try{var O=jt[w];if(!O)throw new G(8);return as(O.node,g),0}catch(T){if(typeof Ae>"u"||T.name!=="ErrnoError")throw T;return-T.Lb}},J:function(w){try{var g=jt[w];if(!g)throw new G(8);var O=g.node,T=typeof O=="string"?ft(O,{Vb:!0}).node:O;if(!T.Ab.Nb)throw new G(63);return T.Ab.Nb(T,{timestamp:Date.now()}),0}catch(k){if(typeof Ae>"u"||k.name!=="ErrnoError")throw k;return-k.Lb}},b:function(w,g,O){Hn=O;try{var T=Ot(w);switch(g){case 0:var k=Vn();return 0>k?-28:ts(T,k).Tb;case 1:case 2:return 0;case 3:return T.flags;case 4:return k=Vn(),T.flags|=k,0;case 5:return k=Vn(),ie[k+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return ee[uo()>>2]=28,-1;default:return-28}}catch(L){if(typeof Ae>"u"||L.name!=="ErrnoError")throw L;return-L.Lb}},I:function(w,g){try{var O=Ot(w);return $n(Pn,O.path,g)}catch(T){if(typeof Ae>"u"||T.name!=="ErrnoError")throw T;return-T.Lb}},k:function(w,g,O){try{if(g=O+2097152>>>0<4194305-!!g?(g>>>0)+4294967296*O:NaN,isNaN(g))return-61;var T=jt[w];if(!T)throw new G(8);if(!(T.flags&2097155))throw new G(28);return us(T.node,g),0}catch(k){if(typeof Ae>"u"||k.name!=="ErrnoError")throw k;return-k.Lb}},C:function(w,g){try{if(g===0)return-28;var O=ue("/")+1;return g<O?-68:(he("/",w,g),O)}catch(T){if(typeof Ae>"u"||T.name!=="ErrnoError")throw T;return-T.Lb}},G:function(w,g){try{return w=Y(w),$n(os,w,g)}catch(O){if(typeof Ae>"u"||O.name!=="ErrnoError")throw O;return-O.Lb}},z:function(w,g,O){try{return g=Y(g),g=ar(w,g),g=te(g),g[g.length-1]==="/"&&(g=g.substr(0,g.length-1)),At(g,O),0}catch(T){if(typeof Ae>"u"||T.name!=="ErrnoError")throw T;return-T.Lb}},E:function(w,g,O,T){try{g=Y(g);var k=T&256;return g=ar(w,g,T&4096),$n(k?os:Pn,g,O)}catch(L){if(typeof Ae>"u"||L.name!=="ErrnoError")throw L;return-L.Lb}},v:function(w,g,O,T){Hn=T;try{g=Y(g),g=ar(w,g);var k=T?Vn():0;return Mn(g,O,k).Tb}catch(L){if(typeof Ae>"u"||L.name!=="ErrnoError")throw L;return-L.Lb}},s:function(w,g,O,T){try{if(g=Y(g),g=ar(w,g),0>=T)return-28;var k=ss(g),L=Math.min(T,ue(k)),F=_e[O+L];return he(k,O,T+1),_e[O+L]=F,L}catch(K){if(typeof Ae>"u"||K.name!=="ErrnoError")throw K;return-K.Lb}},r:function(w){try{return w=Y(w),ns(w),0}catch(g){if(typeof Ae>"u"||g.name!=="ErrnoError")throw g;return-g.Lb}},H:function(w,g){try{return w=Y(w),$n(Pn,w,g)}catch(O){if(typeof Ae>"u"||O.name!=="ErrnoError")throw O;return-O.Lb}},o:function(w,g,O){try{if(g=Y(g),g=ar(w,g),O===0){w=g;var T=ft(w,{parent:!0}).node;if(!T)throw new G(44);var k=ve(w),L=or(T,k),F=es(T,k,!1);if(F)throw new G(F);if(!T.Ab.lc)throw new G(63);if(L.Xb)throw new G(10);T.Ab.lc(T,k),Gi(L)}else O===512?ns(g):Ze("Invalid flags passed to unlinkat");return 0}catch(K){if(typeof Ae>"u"||K.name!=="ErrnoError")throw K;return-K.Lb}},n:function(w,g,O){try{if(g=Y(g),g=ar(w,g,!0),O){var T=Ri(O),k=ee[O+8>>2];L=1e3*T+k/1e6,O+=16,T=Ri(O),k=ee[O+8>>2],F=1e3*T+k/1e6}else var L=Date.now(),F=L;w=L;var K=ft(g,{Vb:!0}).node;return K.Ab.Nb(K,{timestamp:Math.max(w,F)}),0}catch(z){if(typeof Ae>"u"||z.name!=="ErrnoError")throw z;return-z.Lb}},y:function(w,g){w=new Date(1e3*Ri(w)),ee[g>>2]=w.getSeconds(),ee[g+4>>2]=w.getMinutes(),ee[g+8>>2]=w.getHours(),ee[g+12>>2]=w.getDate(),ee[g+16>>2]=w.getMonth(),ee[g+20>>2]=w.getFullYear()-1900,ee[g+24>>2]=w.getDay();var O=w.getFullYear();ee[g+28>>2]=(O%4!==0||O%100===0&&O%400!==0?Vo:Ho)[w.getMonth()]+w.getDate()-1|0,ee[g+36>>2]=-(60*w.getTimezoneOffset()),O=new Date(w.getFullYear(),6,1).getTimezoneOffset();var T=new Date(w.getFullYear(),0,1).getTimezoneOffset();ee[g+32>>2]=(O!=T&&w.getTimezoneOffset()==Math.min(T,O))|0},w:function(w,g,O,T,k,L,F){try{var K=Ot(T);if(g&2&&!(O&2)&&(K.flags&2097155)!==2)throw new G(2);if((K.flags&2097155)===1)throw new G(2);if(!K.Jb.hc)throw new G(43);var z=K.Jb.hc(K,w,k,g,O),M=z.Lc;return ee[L>>2]=z.zc,se[F>>2]=M,0}catch(J){if(typeof Ae>"u"||J.name!=="ErrnoError")throw J;return-J.Lb}},x:function(w,g,O,T,k,L){try{var F=Ot(k);if(O&2){if((F.node.mode&61440)!==32768)throw new G(43);T&2||F.Jb.ic&&F.Jb.ic(F,Z.slice(w,w+g),L,g,T)}}catch(K){if(typeof Ae>"u"||K.name!=="ErrnoError")throw K;return-K.Lb}},p:function(w,g,O){function T(z){return(z=z.toTimeString().match(/\(([A-Za-z ]+)\)$/))?z[1]:"GMT"}var k=new Date().getFullYear(),L=new Date(k,0,1),F=new Date(k,6,1);k=L.getTimezoneOffset();var K=F.getTimezoneOffset();se[w>>2]=60*Math.max(k,K),ee[g>>2]=+(k!=K),w=T(L),g=T(F),w=fs(w),g=fs(g),K<k?(se[O>>2]=w,se[O+4>>2]=g):(se[O>>2]=g,se[O+4>>2]=w)},e:function(){return Date.now()},d:()=>performance.now(),l:function(w){var g=Z.length;if(w>>>=0,2147483648<w)return!1;for(var O=1;4>=O;O*=2){var T=g*(1+.2/O);T=Math.min(T,w+100663296);var k=Math,L=k.min;T=Math.max(w,T),T+=(65536-T%65536)%65536;e:{var F=A.buffer;try{A.grow(L.call(k,2147483648,T)-F.byteLength+65535>>>16),X();var K=1;break e}catch{}K=void 0}if(K)return!0}return!1},A:function(w,g){var O=0;return hs().forEach(function(T,k){var L=g+O;for(k=se[w+4*k>>2]=L,L=0;L<T.length;++L)_e[k++>>0]=T.charCodeAt(L);_e[k>>0]=0,O+=T.length+1}),0},B:function(w,g){var O=hs();se[w>>2]=O.length;var T=0;return O.forEach(function(k){T+=k.length+1}),se[g>>2]=T,0},f:function(w){try{var g=Ot(w);if(g.Tb===null)throw new G(8);g.mc&&(g.mc=null);try{g.Jb.close&&g.Jb.close(g)}catch(O){throw O}finally{jt[g.Tb]=null}return g.Tb=null,0}catch(O){if(typeof Ae>"u"||O.name!=="ErrnoError")throw O;return O.Lb}},m:function(w,g){try{var O=Ot(w);return _e[g>>0]=O.Pb?2:(O.mode&61440)===16384?3:(O.mode&61440)===40960?7:4,0}catch(T){if(typeof Ae>"u"||T.name!=="ErrnoError")throw T;return T.Lb}},t:function(w,g,O,T){try{e:{var k=Ot(w);w=g;for(var L,F=g=0;F<O;F++){var K=se[w>>2],z=se[w+4>>2];w+=8;var M=k,J=K,j=z,ne=L,ge=_e;if(0>j||0>ne)throw new G(28);if(M.Tb===null)throw new G(8);if((M.flags&2097155)===1)throw new G(8);if((M.node.mode&61440)===16384)throw new G(31);if(!M.Jb.read)throw new G(28);var We=typeof ne<"u";if(!We)ne=M.position;else if(!M.seekable)throw new G(70);var je=M.Jb.read(M,ge,J,j,ne);We||(M.position+=je);var Ue=je;if(0>Ue){var ht=-1;break e}if(g+=Ue,Ue<z)break;typeof L<"u"&&(L+=Ue)}ht=g}return se[T>>2]=ht,0}catch(et){if(typeof Ae>"u"||et.name!=="ErrnoError")throw et;return et.Lb}},i:function(w,g,O,T,k){try{if(g=O+2097152>>>0<4194305-!!g?(g>>>0)+4294967296*O:NaN,isNaN(g))return 61;var L=Ot(w);return ls(L,g,T),De=[L.position>>>0,(fe=L.position,1<=+Math.abs(fe)?0<fe?(Math.min(+Math.floor(fe/4294967296),4294967295)|0)>>>0:~~+Math.ceil((fe-+(~~fe>>>0))/4294967296)>>>0:0)],ee[k>>2]=De[0],ee[k+4>>2]=De[1],L.mc&&g===0&&T===0&&(L.mc=null),0}catch(F){if(typeof Ae>"u"||F.name!=="ErrnoError")throw F;return F.Lb}},D:function(w){try{var g=Ot(w);return no(function(O){var T=g.node.Rb;T.type.Oc?T.type.Oc(T,!1,function(k){O(k?function(){return 29}:0)}):O(0)})}catch(O){if(typeof Ae>"u"||O.name!=="ErrnoError")throw O;return O.Lb}},q:function(w,g,O,T){try{e:{var k=Ot(w);w=g;for(var L,F=g=0;F<O;F++){var K=se[w>>2],z=se[w+4>>2];w+=8;var M=k,J=K,j=z,ne=L,ge=_e;if(0>j||0>ne)throw new G(28);if(M.Tb===null)throw new G(8);if(!(M.flags&2097155))throw new G(8);if((M.node.mode&61440)===16384)throw new G(31);if(!M.Jb.write)throw new G(28);M.seekable&&M.flags&1024&&ls(M,0,2);var We=typeof ne<"u";if(!We)ne=M.position;else if(!M.seekable)throw new G(70);var je=M.Jb.write(M,ge,J,j,ne,void 0);We||(M.position+=je);var Ue=je;if(0>Ue){var ht=-1;break e}g+=Ue,typeof L<"u"&&(L+=Ue)}ht=g}return se[T>>2]=ht,0}catch(et){if(typeof Ae>"u"||et.name!=="ErrnoError")throw et;return et.Lb}},X:ps,qa:ms,fa:ys,M:Ns,ka:bs,F:ws,h:Es,na:gs,ia:_s,da:Os,ea:vs,j:Ts,u:Is,oa:Ss,g:Cs,pa:Rs,ca:xs,ga:ks,ha:As,ma:Ls,c:qs,ja:Ws,la:Ds,aa:Bs,V:Fs,$:Qs,ba:zs,S:Ps,U:Ms,Z:Us,Y:$s,R:Hs,Q:Vs,T:Js,_:js,O:Ks,W:Gs,P:Xs};(function(){function w(O){if(O=O.exports,O=Jo(O),p.asm=O,A=p.asm.ra,X(),Ee.unshift(p.asm.sa),dt--,p.monitorRunDependencies&&p.monitorRunDependencies(dt),dt==0&&Ye){var T=Ye;Ye=null,T()}return O}var g={a:Yo};if(dt++,p.monitorRunDependencies&&p.monitorRunDependencies(dt),p.instantiateWasm)try{return p.instantiateWasm(g,w)}catch(O){P("Module.instantiateWasm callback failed with error: "+O),b(O)}return Jt(g,function(O){w(O.instance)}).catch(b),{}})(),p._sqlite3_malloc=function(){return(p._sqlite3_malloc=p.asm.ta).apply(null,arguments)},p._sqlite3_free=function(){return(p._sqlite3_free=p.asm.ua).apply(null,arguments)},p._sqlite3_bind_blob=function(){return(p._sqlite3_bind_blob=p.asm.va).apply(null,arguments)},p._sqlite3_bind_int=function(){return(p._sqlite3_bind_int=p.asm.wa).apply(null,arguments)},p._sqlite3_bind_int64=function(){return(p._sqlite3_bind_int64=p.asm.xa).apply(null,arguments)},p._sqlite3_bind_text=function(){return(p._sqlite3_bind_text=p.asm.ya).apply(null,arguments)},p._sqlite3_close=function(){return(p._sqlite3_close=p.asm.za).apply(null,arguments)},p._sqlite3_column_type=function(){return(p._sqlite3_column_type=p.asm.Aa).apply(null,arguments)},p._sqlite3_column_count=function(){return(p._sqlite3_column_count=p.asm.Ba).apply(null,arguments)},p._sqlite3_column_text=function(){return(p._sqlite3_column_text=p.asm.Ca).apply(null,arguments)},p._sqlite3_column_blob=function(){return(p._sqlite3_column_blob=p.asm.Da).apply(null,arguments)},p._sqlite3_column_bytes=function(){return(p._sqlite3_column_bytes=p.asm.Ea).apply(null,arguments)},p._sqlite3_column_double=function(){return(p._sqlite3_column_double=p.asm.Fa).apply(null,arguments)},p._sqlite3_column_int=function(){return(p._sqlite3_column_int=p.asm.Ga).apply(null,arguments)},p._sqlite3_column_int64=function(){return(p._sqlite3_column_int64=p.asm.Ha).apply(null,arguments)},p._sqlite3_column_name=function(){return(p._sqlite3_column_name=p.asm.Ia).apply(null,arguments)},p._sqlite3_declare_vtab=function(){return(p._sqlite3_declare_vtab=p.asm.Ja).apply(null,arguments)},p._sqlite3_errmsg=function(){return(p._sqlite3_errmsg=p.asm.Ka).apply(null,arguments)},p._sqlite3_exec=function(){return(p._sqlite3_exec=p.asm.La).apply(null,arguments)},p._sqlite3_finalize=function(){return(p._sqlite3_finalize=p.asm.Ma).apply(null,arguments)},p._sqlite3_prepare_v2=function(){return(p._sqlite3_prepare_v2=p.asm.Na).apply(null,arguments)},p._sqlite3_result_int=function(){return(p._sqlite3_result_int=p.asm.Oa).apply(null,arguments)},p._sqlite3_result_blob=function(){return(p._sqlite3_result_blob=p.asm.Pa).apply(null,arguments)},p._sqlite3_result_int64=function(){return(p._sqlite3_result_int64=p.asm.Qa).apply(null,arguments)},p._sqlite3_result_double=function(){return(p._sqlite3_result_double=p.asm.Ra).apply(null,arguments)},p._sqlite3_result_null=function(){return(p._sqlite3_result_null=p.asm.Sa).apply(null,arguments)},p._sqlite3_result_error=function(){return(p._sqlite3_result_error=p.asm.Ta).apply(null,arguments)},p._sqlite3_result_text=function(){return(p._sqlite3_result_text=p.asm.Ua).apply(null,arguments)},p._sqlite3_sql=function(){return(p._sqlite3_sql=p.asm.Va).apply(null,arguments)},p._sqlite3_reset=function(){return(p._sqlite3_reset=p.asm.Wa).apply(null,arguments)},p._sqlite3_step=function(){return(p._sqlite3_step=p.asm.Xa).apply(null,arguments)},p._sqlite3_value_text=function(){return(p._sqlite3_value_text=p.asm.Ya).apply(null,arguments)},p._sqlite3_value_type=function(){return(p._sqlite3_value_type=p.asm.Za).apply(null,arguments)},p._sqlite3_value_bytes=function(){return(p._sqlite3_value_bytes=p.asm._a).apply(null,arguments)},p._sqlite3_value_blob=function(){return(p._sqlite3_value_blob=p.asm.$a).apply(null,arguments)},p._sqlite3_value_int=function(){return(p._sqlite3_value_int=p.asm.ab).apply(null,arguments)},p._sqlite3_value_int64=function(){return(p._sqlite3_value_int64=p.asm.bb).apply(null,arguments)},p._sqlite3_value_double=function(){return(p._sqlite3_value_double=p.asm.cb).apply(null,arguments)},p._RegisterExtensionFunctions=function(){return(p._RegisterExtensionFunctions=p.asm.db).apply(null,arguments)};var ao=p._free=function(){return(ao=p._free=p.asm.eb).apply(null,arguments)};function uo(){return(uo=p.asm.fb).apply(null,arguments)}p._create_function=function(){return(p._create_function=p.asm.gb).apply(null,arguments)},p._update_hook=function(){return(p._update_hook=p.asm.hb).apply(null,arguments)},p._create_module=function(){return(p._create_module=p.asm.ib).apply(null,arguments)},p._register_vfs=function(){return(p._register_vfs=p.asm.jb).apply(null,arguments)},p._sqlite3_vfs_find=function(){return(p._sqlite3_vfs_find=p.asm.kb).apply(null,arguments)},p._getSqliteFree=function(){return(p._getSqliteFree=p.asm.lb).apply(null,arguments)};var lo=p._main=function(){return(lo=p._main=p.asm.mb).apply(null,arguments)};p._sqlite3_bind_null=function(){return(p._sqlite3_bind_null=p.asm.nb).apply(null,arguments)},p._sqlite3_clear_bindings=function(){return(p._sqlite3_clear_bindings=p.asm.ob).apply(null,arguments)},p._sqlite3_data_count=function(){return(p._sqlite3_data_count=p.asm.pb).apply(null,arguments)},p._sqlite3_bind_double=function(){return(p._sqlite3_bind_double=p.asm.qb).apply(null,arguments)},p._sqlite3_bind_parameter_count=function(){return(p._sqlite3_bind_parameter_count=p.asm.rb).apply(null,arguments)},p._sqlite3_bind_parameter_name=function(){return(p._sqlite3_bind_parameter_name=p.asm.sb).apply(null,arguments)},p._sqlite3_libversion=function(){return(p._sqlite3_libversion=p.asm.tb).apply(null,arguments)},p._sqlite3_libversion_number=function(){return(p._sqlite3_libversion_number=p.asm.ub).apply(null,arguments)},p._sqlite3_changes=function(){return(p._sqlite3_changes=p.asm.vb).apply(null,arguments)},p._sqlite3_open_v2=function(){return(p._sqlite3_open_v2=p.asm.wb).apply(null,arguments)},p._sqlite3_get_autocommit=function(){return(p._sqlite3_get_autocommit=p.asm.xb).apply(null,arguments)};var qi=p._malloc=function(){return(qi=p._malloc=p.asm.yb).apply(null,arguments)};function co(){return(co=p.asm.zb).apply(null,arguments)}function fo(){return(fo=p.asm.Bb).apply(null,arguments)}function ho(){return(ho=p.asm.Cb).apply(null,arguments)}function po(){return(po=p.asm.Db).apply(null,arguments)}function Wi(){return(Wi=p.asm.Eb).apply(null,arguments)}function mo(){return(mo=p.asm.Fb).apply(null,arguments)}function yo(){return(yo=p.asm.Gb).apply(null,arguments)}function No(){return(No=p.asm.Hb).apply(null,arguments)}function bo(){return(bo=p.asm.Ib).apply(null,arguments)}p.UTF8ToString=Y,p.stringToUTF8=he,p.lengthBytesUTF8=ue,p.getTempRet0=fo,p.ccall=zt,p.cwrap=function(w,g,O,T){var k=!O||O.every(L=>L==="number"||L==="boolean");return g!=="string"&&k&&!T?p["_"+w]:function(){return zt(w,g,O,arguments,T)}},p.setValue=wt,p.getValue=Be;var Kn;Ye=function w(){Kn||wo(),Kn||(Ye=w)};function wo(){function w(){if(!Kn&&(Kn=!0,p.calledRun=!0,!x)){if(p.noFSInit||ds||(ds=!0,cs(),p.stdin=p.stdin,p.stdout=p.stdout,p.stderr=p.stderr,p.stdin?sn("stdin",p.stdin):Si("/dev/tty","/dev/stdin"),p.stdout?sn("stdout",null,p.stdout):Si("/dev/tty","/dev/stdout"),p.stderr?sn("stderr",null,p.stderr):Si("/dev/tty1","/dev/stderr"),Mn("/dev/stdin",0),Mn("/dev/stdout",1),Mn("/dev/stderr",1)),Ki=!1,vr(Ee),vr(at),y(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),Eo){var g=lo;try{var O=g(0,0);D=O,Ys(O)}catch(T){Ai(T)}}if(p.postRun)for(typeof p.postRun=="function"&&(p.postRun=[p.postRun]);p.postRun.length;)g=p.postRun.shift(),Je.unshift(g);vr(Je)}}if(!(0<dt)){if(p.preRun)for(typeof p.preRun=="function"&&(p.preRun=[p.preRun]);p.preRun.length;)Ht();vr(ce),0<dt||(p.setStatus?(p.setStatus("Running..."),setTimeout(function(){setTimeout(function(){p.setStatus("")},1),w()},1)):w())}}if(p.preInit)for(typeof p.preInit=="function"&&(p.preInit=[p.preInit]);0<p.preInit.length;)p.preInit.pop()();var Eo=!0;return p.noInitialRun&&(Eo=!1),wo(),f.ready}})();const SQLiteAsyncESMFactory=Module,SQLITE_OK=0,SQLITE_BUSY=5,SQLITE_IOERR=10,SQLITE_NOTFOUND=12,SQLITE_CANTOPEN=14,SQLITE_MISUSE=21,SQLITE_RANGE=25,SQLITE_NOTICE=27,SQLITE_ROW=100,SQLITE_DONE=101,SQLITE_IOERR_LOCK=3850,SQLITE_IOERR_SHORT_READ=522,SQLITE_OPEN_READONLY=1,SQLITE_OPEN_READWRITE=2,SQLITE_OPEN_CREATE=4,SQLITE_OPEN_DELETEONCLOSE=8,SQLITE_OPEN_URI=64,SQLITE_LOCK_NONE=0,SQLITE_LOCK_SHARED=1,SQLITE_LOCK_RESERVED=2,SQLITE_LOCK_PENDING=3,SQLITE_LOCK_EXCLUSIVE=4,SQLITE_IOCAP_SAFE_APPEND=512,SQLITE_IOCAP_SEQUENTIAL=1024,SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN=2048,SQLITE_IOCAP_BATCH_ATOMIC=16384,SQLITE_INTEGER=1,SQLITE_FLOAT=2,SQLITE_TEXT=3,SQLITE_BLOB=4,SQLITE_NULL=5,SQLITE_UTF8=1,MAX_INT64=0x7fffffffffffffffn,MIN_INT64=-0x8000000000000000n;class SQLiteError extends Error{constructor(f,p){super(f),this.code=p}}const async=!0;function Factory(m){const f={},p=m._getSqliteFree(),y=m._malloc(8),b=[y,y+4];function E(R){if(typeof R!="string")return 0;const A=m.lengthBytesUTF8(R),x=m._sqlite3_malloc(A+1);return m.stringToUTF8(R,x,A+1),x}function _(R,A){return BigInt(A)<<32n|BigInt(R)&0xffffffffn}const v=function(){const R=BigInt(Number.MAX_SAFE_INTEGER)>>32n,A=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(x,D){return D>R||D<A?_(x,D):D*4294967296+(x&2147483647)-(x&2147483648)}}(),I=new Set;function S(R){if(!I.has(R))throw new SQLiteError("not a database",SQLITE_MISUSE)}const C=new Map;function W(R){if(!C.has(R))throw new SQLiteError("not a statement",SQLITE_MISUSE)}f.bind_collection=function(R,A){W(R);const x=Array.isArray(A),D=f.bind_parameter_count(R);for(let q=1;q<=D;++q){const V=x?q-1:f.bind_parameter_name(R,q),Y=A[V];Y!==void 0&&f.bind(R,q,Y)}return SQLITE_OK},f.bind=function(R,A,x){switch(W(R),typeof x){case"number":return x===(x|0)?f.bind_int(R,A,x):f.bind_double(R,A,x);case"string":return f.bind_text(R,A,x);default:if(x instanceof Uint8Array||Array.isArray(x))return f.bind_blob(R,A,x);if(x===null)return f.bind_null(R,A);if(typeof x=="bigint")return f.bind_int64(R,A,x);if(x===void 0)return SQLITE_NOTICE;throw new Error("Unknown binding type "+typeof x)}},f.bind_blob=function(){const R="sqlite3_bind_blob",A=m.cwrap(R,...decl("nnnnn:n"));return function(x,D,q){W(x);const V=q.byteLength??q.length,Y=m._sqlite3_malloc(V);m.HEAPU8.subarray(Y).set(q);const de=A(x,D,Y,V,p);return U(R,de,C.get(x))}}(),f.bind_parameter_count=function(){const R="sqlite3_bind_parameter_count",A=m.cwrap(R,...decl("n:n"));return function(x){return W(x),A(x)}}(),f.bind_double=function(){const R="sqlite3_bind_double",A=m.cwrap(R,...decl("nnn:n"));return function(x,D,q){W(x);const V=A(x,D,q);return U(R,V,C.get(x))}}(),f.bind_int=function(){const R="sqlite3_bind_int",A=m.cwrap(R,...decl("nnn:n"));return function(x,D,q){if(W(x),q>2147483647||q<-2147483648)return SQLITE_RANGE;const V=A(x,D,q);return U(R,V,C.get(x))}}(),f.bind_int64=function(){const R="sqlite3_bind_int64",A=m.cwrap(R,...decl("nnnn:n"));return function(x,D,q){if(W(x),q>MAX_INT64||q<MIN_INT64)return SQLITE_RANGE;const V=q&0xffffffffn,Y=q>>32n,de=A(x,D,Number(V),Number(Y));return U(R,de,C.get(x))}}(),f.bind_null=function(){const R="sqlite3_bind_null",A=m.cwrap(R,...decl("nn:n"));return function(x,D){W(x);const q=A(x,D);return U(R,q,C.get(x))}}(),f.bind_parameter_name=function(){const R="sqlite3_bind_parameter_name",A=m.cwrap(R,...decl("n:s"));return function(x,D){return W(x),A(x,D)}}(),f.bind_text=function(){const R="sqlite3_bind_text",A=m.cwrap(R,...decl("nnnnn:n"));return function(x,D,q){W(x);const V=E(q),Y=A(x,D,V,-1,p);return U(R,Y,C.get(x))}}(),f.changes=function(){const R="sqlite3_changes",A=m.cwrap(R,...decl("n:n"));return function(x){return S(x),A(x)}}(),f.close=function(){const R="sqlite3_close",A=m.cwrap(R,...decl("n:n"),{async});return async function(x){S(x);const D=await A(x);return I.delete(x),U(R,D,x)}}(),f.column=function(R,A){W(R);const x=f.column_type(R,A);switch(x){case SQLITE_BLOB:return f.column_blob(R,A);case SQLITE_FLOAT:return f.column_double(R,A);case SQLITE_INTEGER:const D=f.column_int(R,A),q=m.getTempRet0();return v(D,q);case SQLITE_NULL:return null;case SQLITE_TEXT:return f.column_text(R,A);default:throw new SQLiteError("unknown type",x)}},f.column_blob=function(){const R="sqlite3_column_blob",A=m.cwrap(R,...decl("nn:n"));return function(x,D){W(x);const q=f.column_bytes(x,D),V=A(x,D),Y=m.HEAPU8.subarray(V,V+q),de=new ArrayBuffer(Y.byteLength),he=new Uint8Array(de);return he.set(Y),he}}(),f.column_bytes=function(){const R="sqlite3_column_bytes",A=m.cwrap(R,...decl("nn:n"));return function(x,D){return W(x),A(x,D)}}(),f.column_count=function(){const R="sqlite3_column_count",A=m.cwrap(R,...decl("n:n"));return function(x){return W(x),A(x)}}(),f.column_double=function(){const R="sqlite3_column_double",A=m.cwrap(R,...decl("nn:n"));return function(x,D){return W(x),A(x,D)}}(),f.column_int=function(){const R="sqlite3_column_int64",A=m.cwrap(R,...decl("nn:n"));return function(x,D){return W(x),A(x,D)}}(),f.column_int64=function(){const R="sqlite3_column_int64",A=m.cwrap(R,...decl("nn:n"));return function(x,D){W(x);const q=A(x,D),V=m.getTempRet0();return _(q,V)}}(),f.column_name=function(){const R="sqlite3_column_name",A=m.cwrap(R,...decl("nn:s"));return function(x,D){return W(x),A(x,D)}}(),f.column_names=function(R){const A=[],x=f.column_count(R);for(let D=0;D<x;++D)A.push(f.column_name(R,D));return A},f.column_text=function(){const R="sqlite3_column_text",A=m.cwrap(R,...decl("nn:s"));return function(x,D){return W(x),A(x,D)}}(),f.column_type=function(){const R="sqlite3_column_type",A=m.cwrap(R,...decl("nn:n"));return function(x,D){return W(x),A(x,D)}}(),f.update_hook=function(R,A){return S(R),m.updateHook(R,A),SQLITE_OK},f.create_function=function(R,A,x,D,q,V,Y,de){if(S(R),V&&!Y&&!de){const he=m.createFunction(R,A,x,D,q,V);return U("sqlite3_create_function",he,R)}if(!V&&Y&&de){const he=m.createAggregate(R,A,x,D,q,Y,de);return U("sqlite3_create_function",he,R)}throw new SQLiteError("invalid function combination",SQLITE_MISUSE)},f.create_module=function(R,A,x,D){S(R);const q=m.createModule(R,A,x,D);return U("sqlite3_create_module",q,R)},f.data_count=function(){const R="sqlite3_data_count",A=m.cwrap(R,...decl("n:n"));return function(x){return W(x),A(x)}}(),f.declare_vtab=function(){const R="sqlite3_declare_vtab",A=m.cwrap(R,...decl("ns:n"));return function(x,D){const q=A(x,D);return U("sqlite3_declare_vtab",q)}}(),f.exec=async function(R,A,x){for await(const D of f.statements(R,A)){let q;for(;await f.step(D)===SQLITE_ROW;)if(x){q=q??f.column_names(D);const V=f.row(D);await x(V,q)}}return SQLITE_OK},f.finalize=function(){const R="sqlite3_finalize",A=m.cwrap(R,...decl("n:n"),{async});return async function(x){W(x);const D=await A(x),q=C.get(x);return C.delete(x),U(R,D,q)}}(),f.get_autocommit=function(){const R="sqlite3_get_autocommit",A=m.cwrap(R,...decl("n:n"));return function(x){return A(x)}}(),f.libversion=function(){const R="sqlite3_libversion",A=m.cwrap(R,...decl(":s"));return function(){return A()}}(),f.libversion_number=function(){const R="sqlite3_libversion_number",A=m.cwrap(R,...decl(":n"));return function(){return A()}}(),f.open_v2=function(){const R="sqlite3_open_v2",A=m.cwrap(R,...decl("snnn:n"),{async});return async function(x,D,q){D=D||SQLITE_OPEN_CREATE|SQLITE_OPEN_READWRITE,q=E(q);const V=await A(x,b[0],D,q),Y=m.getValue(b[0],"i32");return I.add(Y),m._sqlite3_free(q),m.ccall("RegisterExtensionFunctions","void",["number"],[Y]),U(R,V),Y}}(),f.prepare_v2=function(){const R="sqlite3_prepare_v2",A=m.cwrap(R,...decl("nnnnn:n"),{async});return async function(x,D){const q=await A(x,D,-1,b[0],b[1]);U(R,q,x);const V=m.getValue(b[0],"i32");return V?(C.set(V,x),{stmt:V,sql:m.getValue(b[1],"i32")}):null}}(),f.reset=function(){const R="sqlite3_reset",A=m.cwrap(R,...decl("n:n"),{async});return async function(x){W(x);const D=await A(x);return U(R,D,C.get(x))}}(),f.result=function(R,A){switch(typeof A){case"number":A===(A|0)?f.result_int(R,A):f.result_double(R,A);break;case"string":f.result_text(R,A);break;default:if(A instanceof Uint8Array||Array.isArray(A))f.result_blob(R,A);else if(A===null)f.result_null(R);else{if(typeof A=="bigint")return f.result_int64(R,A);console.warn("unknown result converted to null",A),f.result_null(R)}break}},f.result_blob=function(){const R="sqlite3_result_blob",A=m.cwrap(R,...decl("nnnn:n"));return function(x,D){const q=D.byteLength??D.length,V=m._sqlite3_malloc(q);m.HEAPU8.subarray(V).set(D),A(x,V,q,p)}}(),f.result_double=function(){const R="sqlite3_result_double",A=m.cwrap(R,...decl("nn:n"));return function(x,D){A(x,D)}}(),f.result_int=function(){const R="sqlite3_result_int",A=m.cwrap(R,...decl("nn:n"));return function(x,D){A(x,D)}}(),f.result_int64=function(){const R="sqlite3_result_int64",A=m.cwrap(R,...decl("nnn:n"));return function(x,D){if(D>MAX_INT64||D<MIN_INT64)return SQLITE_RANGE;const q=D&0xffffffffn,V=D>>32n;A(x,Number(q),Number(V))}}(),f.result_null=function(){const R="sqlite3_result_null",A=m.cwrap(R,...decl("n:n"));return function(x){A(x)}}(),f.result_text=function(){const R="sqlite3_result_text",A=m.cwrap(R,...decl("nnnn:n"));return function(x,D){const q=E(D);A(x,q,-1,p)}}(),f.row=function(R){const A=[],x=f.data_count(R);for(let D=0;D<x;++D){const q=f.column(R,D);A.push((q==null?void 0:q.buffer)===m.HEAPU8.buffer?q.slice():q)}return A},f.sql=function(){const R="sqlite3_sql",A=m.cwrap(R,...decl("n:s"));return function(x){return W(x),A(x)}}(),f.statements=function(R,A){return async function*(){const x=f.str_new(R,A);let D={stmt:null,sql:f.str_value(x)};try{for(;D=await f.prepare_v2(R,D.sql);)yield D.stmt,f.finalize(D.stmt),D.stmt=null}finally{D!=null&&D.stmt&&f.finalize(D.stmt),f.str_finish(x)}}()},f.step=function(){const R="sqlite3_step",A=m.cwrap(R,...decl("n:n"),{async});return async function(x){W(x);const D=await A(x);return U(R,D,C.get(x),[SQLITE_ROW,SQLITE_DONE])}}();let $=0;const P=new Map;f.str_new=function(R,A=""){const x=m.lengthBytesUTF8(A),D=$++&4294967295,q={offset:m._sqlite3_malloc(x+1),bytes:x};return P.set(D,q),m.stringToUTF8(A,q.offset,q.bytes+1),D},f.str_appendall=function(R,A){if(!P.has(R))throw new SQLiteError("not a string",SQLITE_MISUSE);const x=P.get(R),D=m.lengthBytesUTF8(A),q=x.bytes+D,V=m._sqlite3_malloc(q+1);m.HEAPU8.subarray(V,V+q+1).set(m.HEAPU8.subarray(x.offset,x.offset+x.bytes)),m.stringToUTF8(A,V+x.bytes,D+1),m._sqlite3_free(x.offset),x.offset=V,x.bytes=q,P.set(R,x)},f.str_finish=function(R){if(!P.has(R))throw new SQLiteError("not a string",SQLITE_MISUSE);const A=P.get(R);P.delete(R),m._sqlite3_free(A.offset)},f.str_value=function(R){if(!P.has(R))throw new SQLiteError("not a string",SQLITE_MISUSE);return P.get(R).offset},f.user_data=function(R){return m.getFunctionUserData(R)},f.value=function(R){const A=f.value_type(R);switch(A){case SQLITE_BLOB:return f.value_blob(R);case SQLITE_FLOAT:return f.value_double(R);case SQLITE_INTEGER:const x=f.value_int(R),D=m.getTempRet0();return v(x,D);case SQLITE_NULL:return null;case SQLITE_TEXT:return f.value_text(R);default:throw new SQLiteError("unknown type",A)}},f.value_blob=function(){const R="sqlite3_value_blob",A=m.cwrap(R,...decl("n:n"));return function(x){const D=f.value_bytes(x),q=A(x);return m.HEAPU8.subarray(q,q+D)}}(),f.value_bytes=function(){const R="sqlite3_value_bytes",A=m.cwrap(R,...decl("n:n"));return function(x){return A(x)}}(),f.value_double=function(){const R="sqlite3_value_double",A=m.cwrap(R,...decl("n:n"));return function(x){return A(x)}}(),f.value_int=function(){const R="sqlite3_value_int64",A=m.cwrap(R,...decl("n:n"));return function(x){return A(x)}}(),f.value_int64=function(){const R="sqlite3_value_int64",A=m.cwrap(R,...decl("n:n"));return function(x){const D=A(x),q=m.getTempRet0();return _(D,q)}}(),f.value_text=function(){const R="sqlite3_value_text",A=m.cwrap(R,...decl("n:s"));return function(x){return A(x)}}(),f.value_type=function(){const R="sqlite3_value_type",A=m.cwrap(R,...decl("n:n"));return function(x){return A(x)}}(),f.vfs_register=function(R,A){const x=m.registerVFS(R,A);return U("sqlite3_vfs_register",x)};function U(R,A,x=null,D=[SQLITE_OK]){if(D.includes(A))return A;const q=x?m.ccall("sqlite3_errmsg","string",["number"],[x]):R;throw new SQLiteError(q,A)}return f}function decl(m){const f=[],p=m.match(/([ns@]*):([ns@])/);switch(p[2]){case"n":f.push("number");break;case"s":f.push("string");break}const y=[];for(let b of p[1])switch(b){case"n":y.push("number");break;case"s":y.push("string");break}return f.push(y),f}class Base{constructor(){Oe(this,"mxPathName",64)}xClose(f){return SQLITE_IOERR}xRead(f,p,y){return SQLITE_IOERR}xWrite(f,p,y){return SQLITE_IOERR}xTruncate(f,p){return SQLITE_IOERR}xSync(f,p){return SQLITE_OK}xFileSize(f,p){return SQLITE_IOERR}xLock(f,p){return SQLITE_OK}xUnlock(f,p){return SQLITE_OK}xCheckReservedLock(f,p){return p.setInt32(0,0,!0),SQLITE_OK}xFileControl(f,p,y){return SQLITE_NOTFOUND}xSectorSize(f){return 512}xDeviceCharacteristics(f){return 0}xOpen(f,p,y,b){return SQLITE_CANTOPEN}xDelete(f,p){return SQLITE_IOERR}xAccess(f,p,y){return SQLITE_IOERR}handleAsync(f){return f()}}const LOCK_TYPE_MASK=SQLITE_LOCK_NONE|SQLITE_LOCK_SHARED|SQLITE_LOCK_RESERVED|SQLITE_LOCK_PENDING|SQLITE_LOCK_EXCLUSIVE;var it,Yr,xn,kn,Mi,mi,ko,yi,Ao;class WebLocksBase{constructor(){B(this,kn);B(this,mi);B(this,yi);B(this,it,SQLITE_LOCK_NONE);Oe(this,"timeoutMillis",0);B(this,Yr,new Map);B(this,xn,Promise.resolve(0))}get state(){return N(this,it)}async lock(f){return Ne(this,kn,Mi).call(this,Ne(this,mi,ko),f)}async unlock(f){return Ne(this,kn,Mi).call(this,Ne(this,yi,Ao),f)}async isSomewhereReserved(){throw new Error("unimplemented")}async _NONEtoSHARED(){}async _SHAREDtoEXCLUSIVE(){await this._SHAREDtoRESERVED(),await this._RESERVEDtoEXCLUSIVE()}async _SHAREDtoRESERVED(){}async _RESERVEDtoEXCLUSIVE(){}async _EXCLUSIVEtoRESERVED(){}async _EXCLUSIVEtoSHARED(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED()}async _EXCLUSIVEtoNONE(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _RESERVEDtoSHARED(){}async _RESERVEDtoNONE(){await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _SHAREDtoNONE(){}_acquireWebLock(f,p){return new Promise(async(y,b)=>{try{await navigator.locks.request(f,p,E=>{if(y(E),E)return new Promise(_=>N(this,Yr).set(f,_))})}catch(E){b(E)}})}_releaseWebLock(f){var p;(p=N(this,Yr).get(f))==null||p(),N(this,Yr).delete(f)}async _pollWebLock(f){var y;return(y=(await navigator.locks.query()).held.find(({name:b})=>b===f))==null?void 0:y.mode}_getTimeoutSignal(){if(this.timeoutMillis){const f=new AbortController;return setTimeout(()=>f.abort(),this.timeoutMillis),f.signal}}}it=new WeakMap,Yr=new WeakMap,xn=new WeakMap,kn=new WeakSet,Mi=async function(f,p){const y=p&LOCK_TYPE_MASK;try{const b=()=>f.call(this,y);return await H(this,xn,N(this,xn).then(b,b)),H(this,it,y),SQLITE_OK}catch(b){return b.name==="AbortError"?SQLITE_BUSY:(console.error(b),SQLITE_IOERR_LOCK)}},mi=new WeakSet,ko=async function(f){if(f===N(this,it))return SQLITE_OK;switch(N(this,it)){case SQLITE_LOCK_NONE:switch(f){case SQLITE_LOCK_SHARED:return this._NONEtoSHARED();default:throw new Error(`unexpected transition ${N(this,it)} -> ${f}`)}case SQLITE_LOCK_SHARED:switch(f){case SQLITE_LOCK_RESERVED:return this._SHAREDtoRESERVED();case SQLITE_LOCK_EXCLUSIVE:return this._SHAREDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${N(this,it)} -> ${f}`)}case SQLITE_LOCK_RESERVED:switch(f){case SQLITE_LOCK_EXCLUSIVE:return this._RESERVEDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${N(this,it)} -> ${f}`)}default:throw new Error(`unexpected transition ${N(this,it)} -> ${f}`)}},yi=new WeakSet,Ao=async function(f){if(f===N(this,it))return SQLITE_OK;switch(N(this,it)){case SQLITE_LOCK_EXCLUSIVE:switch(f){case SQLITE_LOCK_SHARED:return this._EXCLUSIVEtoSHARED();case SQLITE_LOCK_NONE:return this._EXCLUSIVEtoNONE();default:throw new Error(`unexpected transition ${N(this,it)} -> ${f}`)}case SQLITE_LOCK_RESERVED:switch(f){case SQLITE_LOCK_SHARED:return this._RESERVEDtoSHARED();case SQLITE_LOCK_NONE:return this._RESERVEDtoNONE();default:throw new Error(`unexpected transition ${N(this,it)} -> ${f}`)}case SQLITE_LOCK_SHARED:switch(f){case SQLITE_LOCK_NONE:return this._SHAREDtoNONE();default:throw new Error(`unexpected transition ${N(this,it)} -> ${f}`)}default:throw new Error(`unexpected transition ${N(this,it)} -> ${f}`)}};class WebLocksExclusive extends WebLocksBase{constructor(f){super(),this._lockName=f+"-outer",this._reservedName=f+"-reserved"}async isSomewhereReserved(){return await this._pollWebLock(this._reservedName)==="exclusive"}async _NONEtoSHARED(){await this._acquireWebLock(this._lockName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _SHAREDtoRESERVED(){await this._acquireWebLock(this._reservedName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _RESERVEDtoSHARED(){this._releaseWebLock(this._reservedName)}async _SHAREDtoNONE(){this._releaseWebLock(this._lockName)}}const RETRYABLE_EXCEPTIONS=new Set(["TransactionInactiveError","InvalidStateError"]);let nextTxId=0;const mapTxToId=new WeakMap;function log$2(...m){}var Zr,An,mt,Ln,gr,qn,Ni,Lo,bi,qo;class IDBContext{constructor(f,p={durability:"default"}){B(this,Ni);B(this,bi);B(this,Zr,void 0);B(this,An,void 0);B(this,mt,null);B(this,Ln,null);B(this,gr,null);B(this,qn,Promise.resolve());H(this,Zr,Promise.resolve(f)),H(this,An,p)}async close(){(await N(this,Zr)).close()}async run(f,p){return H(this,qn,N(this,qn).then(()=>Ne(this,Ni,Lo).call(this,f,p)))}async sync(){return await new Promise(f=>this.run("readwrite",f)),N(this,Ln)}}Zr=new WeakMap,An=new WeakMap,mt=new WeakMap,Ln=new WeakMap,gr=new WeakMap,qn=new WeakMap,Ni=new WeakSet,Lo=async function(f,p){var E,_;const y=await N(this,Zr),b=Array.from(y.objectStoreNames);f!=="readonly"&&((E=N(this,mt))==null?void 0:E.mode)==="readonly"?H(this,mt,null):((_=N(this,gr))==null?void 0:_.readyState)==="pending"&&await new Promise(v=>{N(this,gr).addEventListener("success",v),N(this,gr).addEventListener("error",v)});for(let v=0;v<2;++v){N(this,mt)||(H(this,mt,y.transaction(b,f,N(this,An))),H(this,Ln,new Promise(I=>{N(this,mt).addEventListener("complete",S=>{N(this,mt)===S.target&&H(this,mt,null),I(),log$2(`transaction ${mapTxToId.get(S.target)} complete`)})})),mapTxToId.set(N(this,mt),nextTxId++));try{const I=Object.fromEntries(b.map(S=>{const C=N(this,mt).objectStore(S),W=new Store(C,$=>Ne(this,bi,qo).call(this,$));return[S,W]}));return await p(I)}catch(I){if(v||!RETRYABLE_EXCEPTIONS.has(I.name)){try{N(this,mt).abort()}catch{}throw I}H(this,mt,null)}}},bi=new WeakSet,qo=function(f){return H(this,gr,f),new Promise((p,y)=>{f.onsuccess=()=>p(f.result),f.onerror=()=>y(f.error)})};class Store{constructor(f,p){this.store=f,this.addRequest=p}get(f){log$2(`get ${this.store.name}`,f);const p=this.store.get(f);return this.addRequest(p)}getAll(f,p){log$2(`getAll ${this.store.name}`,f,p);const y=this.store.getAll(f,p);return this.addRequest(y)}getKey(f){log$2(`getKey ${this.store.name}`,f);const p=this.store.getKey(f);return this.addRequest(p)}getAllKeys(f,p){log$2(`getAllKeys ${this.store.name}`,f,p);const y=this.store.getAllKeys(f,p);return this.addRequest(y)}put(f,p){log$2(`put ${this.store.name}`,f,p);const y=this.store.put(f,p);return this.addRequest(y)}delete(f){log$2(`delete ${this.store.name}`,f);const p=this.store.delete(f);return this.addRequest(p)}clear(){log$2(`clear ${this.store.name}`);const f=this.store.clear();return this.addRequest(f)}index(f){return new Index(this.store.index(f),p=>this.addRequest(p))}}class Index{constructor(f,p){this.index=f,this.addRequest=p}getAllKeys(f,p){log$2(`IDBIndex.getAllKeys ${this.index.objectStore.name}<${this.index.name}>`,f,p);const y=this.index.getAllKeys(f,p);return this.addRequest(y)}}const SECTOR_SIZE=512,DEFAULT_OPTIONS={durability:"default",purge:"deferred",purgeAtLeast:16};function log$1(...m){}var ir,ot,Pe,_r,wi,Wo,sr,Sr,Ei,Do;class IDBBatchAtomicVFS extends Base{constructor(p="wa-sqlite",y=DEFAULT_OPTIONS){super();B(this,wi);B(this,sr);B(this,Ei);B(this,ir,void 0);B(this,ot,new Map);B(this,Pe,void 0);B(this,_r,new Set);this.name=p,H(this,ir,Object.assign({},DEFAULT_OPTIONS,y)),H(this,Pe,new IDBContext(openDatabase(p),{durability:N(this,ir).durability}))}async close(){var p;for(const y of N(this,ot).keys())await this.xClose(y);(p=N(this,Pe))==null||p.close(),H(this,Pe,null)}xOpen(p,y,b,E){return this.handleAsync(async()=>{p===null&&(p=`null_${y}`),log$1(`xOpen ${p} 0x${y.toString(16)} 0x${b.toString(16)}`);try{const _=new URL(p,"http://localhost/"),v={path:_.pathname,flags:b,block0:null,locks:new WebLocksExclusive(_.pathname)};return N(this,ot).set(y,v),await N(this,Pe).run("readwrite",async({blocks:I})=>{if(v.block0=await I.get(Ne(this,sr,Sr).call(this,v,0)),!v.block0)if(b&SQLITE_OPEN_CREATE)v.block0={path:v.path,offset:0,version:0,data:new Uint8Array(0),fileSize:0},I.put(v.block0);else throw new Error(`file not found: ${v.path}`)}),E.setInt32(0,b&SQLITE_OPEN_READONLY,!0),SQLITE_OK}catch(_){return console.error(_),SQLITE_CANTOPEN}})}xClose(p){return this.handleAsync(async()=>{try{const y=N(this,ot).get(p);return y&&(log$1(`xClose ${y.path}`),N(this,ot).delete(p),y.flags&SQLITE_OPEN_DELETEONCLOSE&&N(this,Pe).run("readwrite",({blocks:b})=>{b.delete(IDBKeyRange.bound([y.path],[y.path,[]]))})),SQLITE_OK}catch(y){return console.error(y),SQLITE_IOERR}})}xRead(p,y,b){return this.handleAsync(async()=>{const E=N(this,ot).get(p);log$1(`xRead ${E.path} ${y.byteLength} ${b}`);try{return await N(this,Pe).run("readonly",async({blocks:v})=>{let I=0;for(;I<y.byteLength;){const S=b+I,C=S<E.block0.data.byteLength?E.block0:await v.get(Ne(this,sr,Sr).call(this,E,-S));if(!C||C.data.byteLength-C.offset<=S)return y.fill(0,I),SQLITE_IOERR_SHORT_READ;const W=y.subarray(I),$=S+C.offset,P=Math.min(Math.max(C.data.byteLength-$,0),W.byteLength);W.set(C.data.subarray($,$+P)),I+=P}return SQLITE_OK})}catch(_){return console.error(_),SQLITE_IOERR}})}xWrite(p,y,b){const E=N(this,ot).get(p);log$1(`xWrite ${E.path} ${y.byteLength} ${b}`);try{const _=E.block0.fileSize;E.block0.fileSize=Math.max(E.block0.fileSize,b+y.byteLength);const v=b===0?E.block0:{path:E.path,offset:-b,version:E.block0.version,data:null};return v.data=y.slice(),E.changedPages?(_===E.block0.fileSize&&E.changedPages.add(-b),b!==0&&N(this,Pe).run("readwrite",({blocks:I})=>I.put(v))):N(this,Pe).run("readwrite",({blocks:I})=>I.put(v)),SQLITE_OK}catch(_){return console.error(_),SQLITE_IOERR}}xTruncate(p,y){const b=N(this,ot).get(p);log$1(`xTruncate ${b.path} ${y}`);try{Object.assign(b.block0,{fileSize:y,data:b.block0.data.slice(0,y)});const E=Object.assign({},b.block0);return N(this,Pe).run("readwrite",({blocks:_})=>{_.delete(Ne(this,sr,Sr).call(this,b,-1/0,-y)),_.put(E)}),SQLITE_OK}catch(E){return console.error(E),SQLITE_IOERR}}xSync(p,y){const b=N(this,ot).get(p);log$1(`xSync ${b.path} ${y}`);try{return N(this,ir).durability!=="relaxed"?this.handleAsync(async()=>(await N(this,Pe).sync(),SQLITE_OK)):SQLITE_OK}catch(E){return console.error(E),SQLITE_IOERR}}xFileSize(p,y){const b=N(this,ot).get(p);return log$1(`xFileSize ${b.path}`),y.setBigInt64(0,BigInt(b.block0.fileSize),!0),SQLITE_OK}xLock(p,y){return this.handleAsync(async()=>{const b=N(this,ot).get(p);log$1(`xLock ${b.path} ${y}`);try{const E=await b.locks.lock(y);return E===SQLITE_OK&&b.locks.state===SQLITE_LOCK_SHARED&&(b.block0=await N(this,Pe).run("readonly",({blocks:_})=>_.get(Ne(this,sr,Sr).call(this,b,0)))),E}catch(E){return console.error(E),SQLITE_IOERR}})}xUnlock(p,y){return this.handleAsync(async()=>{const b=N(this,ot).get(p);log$1(`xUnlock ${b.path} ${y}`);try{return b.locks.unlock(y)}catch(E){return console.error(E),SQLITE_IOERR}})}xCheckReservedLock(p,y){return this.handleAsync(async()=>{const b=N(this,ot).get(p);log$1(`xCheckReservedLock ${b.path}`);const E=await b.locks.isSomewhereReserved();return y.setInt32(0,E?1:0,!0),SQLITE_OK})}xSectorSize(p){return SECTOR_SIZE}xDeviceCharacteristics(p){return SQLITE_IOCAP_BATCH_ATOMIC|SQLITE_IOCAP_SAFE_APPEND|SQLITE_IOCAP_SEQUENTIAL|SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN}xFileControl(p,y,b){const E=N(this,ot).get(p);switch(log$1(`xFileControl ${E.path} ${y}`),y){case 11:return E.overwrite=!0,SQLITE_OK;case 21:if(E.overwrite)try{return this.handleAsync(async()=>(await Ne(this,Ei,Do).call(this,E),SQLITE_OK))}catch(_){return console.error(_),SQLITE_IOERR}return SQLITE_OK;case 22:return E.overwrite=!1,SQLITE_OK;case 31:return this.handleAsync(async()=>{try{return E.block0.version--,E.changedPages=new Set,N(this,Pe).run("readwrite",async({blocks:_})=>{const v=await _.index("version").getAllKeys(IDBKeyRange.bound([E.path],[E.path,E.block0.version]));for(const I of v)_.delete(I)}),SQLITE_OK}catch(_){return console.error(_),SQLITE_IOERR}});case 32:try{const _=Object.assign({},E.block0);_.data=_.data.slice();const v=E.changedPages;return E.changedPages=null,N(this,Pe).run("readwrite",async({blocks:I})=>{I.put(_);const S=await I.get([E.path,"purge",0])??{path:E.path,offset:"purge",version:0,data:new Map,count:0};S.count+=v.size;for(const C of v)S.data.set(C,_.version);I.put(S),Ne(this,wi,Wo).call(this,E.path,S.count)}),SQLITE_OK}catch(_){return console.error(_),SQLITE_IOERR}case 33:return this.handleAsync(async()=>{try{return E.changedPages=null,E.block0=await N(this,Pe).run("readonly",({blocks:_})=>_.get([E.path,0,E.block0.version+1])),SQLITE_OK}catch(_){return console.error(_),SQLITE_IOERR}});default:return SQLITE_NOTFOUND}}xAccess(p,y,b){return this.handleAsync(async()=>{try{const E=new URL(p,"file://localhost/").pathname;log$1(`xAccess ${E} ${y}`);const _=await N(this,Pe).run("readonly",({blocks:v})=>v.getKey(Ne(this,sr,Sr).call(this,{path:E},0)));return b.setInt32(0,_?1:0,!0),SQLITE_OK}catch(E){return console.error(E),SQLITE_IOERR}})}xDelete(p,y){return this.handleAsync(async()=>{const b=new URL(p,"file://localhost/").pathname;try{return N(this,Pe).run("readwrite",({blocks:E})=>E.delete(IDBKeyRange.bound([b],[b,[]]))),y&&await N(this,Pe).sync(),SQLITE_OK}catch(E){return console.error(E),SQLITE_IOERR}})}async purge(p){const y=Date.now();await N(this,Pe).run("readwrite",async({blocks:b})=>{const E=await b.get([p,"purge",0]);if(E){for(const[_,v]of E.data)b.delete(IDBKeyRange.bound([p,_,v],[p,_,1/0],!0,!1));await b.delete([p,"purge",0])}log$1(`purge ${p} ${(E==null?void 0:E.data.size)??0} pages in ${Date.now()-y} ms`)})}}ir=new WeakMap,ot=new WeakMap,Pe=new WeakMap,_r=new WeakMap,wi=new WeakSet,Wo=function(p,y){N(this,ir).purge==="manual"||N(this,_r).has(p)||y<N(this,ir).purgeAtLeast||(globalThis.requestIdleCallback?globalThis.requestIdleCallback(()=>{this.purge(p),N(this,_r).delete(p)}):setTimeout(()=>{this.purge(p),N(this,_r).delete(p)}),N(this,_r).add(p))},sr=new WeakSet,Sr=function(p,y,b=0){const E=!y||-y<p.block0.data.length?-1/0:p.block0.version;return IDBKeyRange.bound([p.path,y,E],[p.path,b,1/0])},Ei=new WeakSet,Do=async function(p){const y=p.block0.data.length;if(y<18)return;const b=new DataView(p.block0.data.buffer,p.block0.data.byteOffset);let E=b.getUint16(16);if(E===1&&(E=65536),E===y)return;const _=Math.max(y,E),v=_/y,I=_/E,C=b.getUint32(28)*E,W=p.block0.version;await N(this,Pe).run("readwrite",async({blocks:$})=>{const P=await $.index("version").getAllKeys(IDBKeyRange.bound([p.path,W+1],[p.path,1/0]));for(const U of P)$.delete(U);$.delete([p.path,"purge",0]);for(let U=0;U<C;U+=_){const R=await $.getAll(IDBKeyRange.lowerBound([p.path,-(U+_),1/0]),v);for(const A of R)$.delete([A.path,A.offset,A.version]);if(I===1){const A=new Uint8Array(E);for(const D of R)A.set(D.data,-(U+D.offset));const x={path:p.path,offset:-U,version:W,data:A};x.offset===0&&(x.fileSize=C,p.block0=x),$.put(x)}else{const A=R[0];for(let x=0;x<I;++x){const D=-(U+x*E);if(-D>=C)break;const q={path:A.path,offset:D,version:W,data:A.data.subarray(x*E,(x+1)*E)};q.offset===0&&(q.fileSize=C,p.block0=q),$.put(q)}}}})};function openDatabase(m){return new Promise((f,p)=>{const y=globalThis.indexedDB.open(m,5);y.addEventListener("upgradeneeded",function(){y.result.createObjectStore("blocks",{keyPath:["path","offset","version"]}).createIndex("version",["path","version"])}),y.addEventListener("success",()=>{f(y.result)}),y.addEventListener("error",()=>{p(y.error)})})}const E_CANCELED=new Error("request for lock canceled");var __awaiter$2=function(m,f,p,y){function b(E){return E instanceof p?E:new p(function(_){_(E)})}return new(p||(p=Promise))(function(E,_){function v(C){try{S(y.next(C))}catch(W){_(W)}}function I(C){try{S(y.throw(C))}catch(W){_(W)}}function S(C){C.done?E(C.value):b(C.value).then(v,I)}S((y=y.apply(m,f||[])).next())})};class Semaphore{constructor(f,p=E_CANCELED){this._value=f,this._cancelError=p,this._weightedQueues=[],this._weightedWaiters=[]}acquire(f=1){if(f<=0)throw new Error(`invalid weight ${f}: must be positive`);return new Promise((p,y)=>{this._weightedQueues[f-1]||(this._weightedQueues[f-1]=[]),this._weightedQueues[f-1].push({resolve:p,reject:y}),this._dispatch()})}runExclusive(f,p=1){return __awaiter$2(this,void 0,void 0,function*(){const[y,b]=yield this.acquire(p);try{return yield f(y)}finally{b()}})}waitForUnlock(f=1){if(f<=0)throw new Error(`invalid weight ${f}: must be positive`);return new Promise(p=>{this._weightedWaiters[f-1]||(this._weightedWaiters[f-1]=[]),this._weightedWaiters[f-1].push(p),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(f){this._value=f,this._dispatch()}release(f=1){if(f<=0)throw new Error(`invalid weight ${f}: must be positive`);this._value+=f,this._dispatch()}cancel(){this._weightedQueues.forEach(f=>f.forEach(p=>p.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var f;for(let p=this._value;p>0;p--){const y=(f=this._weightedQueues[p-1])===null||f===void 0?void 0:f.shift();if(!y)continue;const b=this._value,E=p;this._value-=p,p=this._value+1,y.resolve([b,this._newReleaser(E)])}this._drainUnlockWaiters()}_newReleaser(f){let p=!1;return()=>{p||(p=!0,this.release(f))}}_drainUnlockWaiters(){for(let f=this._value;f>0;f--)this._weightedWaiters[f-1]&&(this._weightedWaiters[f-1].forEach(p=>p()),this._weightedWaiters[f-1]=[])}}var __awaiter$1=function(m,f,p,y){function b(E){return E instanceof p?E:new p(function(_){_(E)})}return new(p||(p=Promise))(function(E,_){function v(C){try{S(y.next(C))}catch(W){_(W)}}function I(C){try{S(y.throw(C))}catch(W){_(W)}}function S(C){C.done?E(C.value):b(C.value).then(v,I)}S((y=y.apply(m,f||[])).next())})};class Mutex{constructor(f){this._semaphore=new Semaphore(1,f)}acquire(){return __awaiter$1(this,void 0,void 0,function*(){const[,f]=yield this._semaphore.acquire();return f})}runExclusive(f){return this._semaphore.runExclusive(()=>f())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const isDebug=globalThis.__vlcn_wa_crsqlite_dbg;function log(...m){isDebug&&console.log("crsqlite-wasm: ",...m)}const re=/insert\s|update\s|delete\s/,txRe=/begin\s|commit\s|rollback\s|savepoint\s/;function computeCacheKey(m,f,p){const y=m.toLowerCase();if(txRe.exec(y)==null)return re.exec(y)!=null?(log("received write"),null):p!=null?y+"|"+f+"|"+p.map(E=>E!=null?E.toString():"null").join("|"):y}class Stmt{constructor(f,p,y,b,E,_,v){Oe(this,"originDB");Oe(this,"cache");Oe(this,"api");Oe(this,"base");Oe(this,"str");Oe(this,"sql");Oe(this,"mode","o");Oe(this,"finalized",!1);Oe(this,"bindings",[]);this.originDB=f,this.cache=y,this.api=b,this.base=E,this.str=_,this.sql=v,p.set(E,new WeakRef(this))}run(f,...p){return serialize(this.cache,computeCacheKey(this.sql,this.mode,p.length>0?p:this.bindings),()=>(p.length>0&&this.bind(p),this.api.step(this.base).then(()=>this.api.reset(this.base))),(f==null?void 0:f.__mutex)||this.originDB.__mutex)}get(f,...p){return serialize(this.cache,computeCacheKey(this.sql,this.mode,p.length>0?p:this.bindings),async()=>{p.length>0&&this.bind(p);let y=null,b=this.mode==="o"?this.api.column_names(this.base):null;if(await this.api.step(this.base)==SQLITE_ROW){const E=this.api.row(this.base);if(b!=null){const _={};for(let v=0;v<b.length;++v)_[b[v]]=E[v];y=_}else y=E}return await this.api.reset(this.base),y},(f==null?void 0:f.__mutex)||this.originDB.__mutex)}all(f,...p){return serialize(this.cache,computeCacheKey(this.sql,this.mode,p.length>0?p:this.bindings),async()=>{p.length>0&&this.bind(p);const y=[];let b=this.mode==="o"?this.api.column_names(this.base):null;for(;await this.api.step(this.base)==SQLITE_ROW;)if(b!=null){const E={};for(let _=0;_<b.length;++_)E[b[_]]=this.api.column(this.base,_);y.push(E)}else{y.push(this.api.row(this.base));continue}return await this.api.reset(this.base),y},(f==null?void 0:f.__mutex)||this.originDB.__mutex)}async*iterate(f,...p){for(this.bind(p);await serialize(this.cache,void 0,()=>this.api.step(this.base),(f==null?void 0:f.__mutex)||this.originDB.__mutex)==SQLITE_ROW;)yield this.api.row(this.base);await serialize(this.cache,void 0,()=>this.api.reset(this.base),(f==null?void 0:f.__mutex)||this.originDB.__mutex)}raw(f){return f?this.mode="a":this.mode="o",this}bind(f){this.bindings=f;for(let p=0;p<f.length;++p)this.api.bind(this.base,p+1,f[p]);return this}finalize(f){return serialize(this.cache,void 0,()=>{if(!this.finalized)return this.finalized=!0,this.api.str_finish(this.str),this.api.finalize(this.base)},(f==null?void 0:f.__mutex)||this.originDB.__mutex)}}class TX{constructor(f,p,y,b,E){Oe(this,"api");Oe(this,"db");Oe(this,"__mutex");Oe(this,"assertOpen");Oe(this,"stmtFinalizer");Oe(this,"cache",new Map);this.api=f,this.db=p,this.__mutex=y,this.assertOpen=b,this.stmtFinalizer=E}execMany(f){return this.assertOpen(),serialize(this.cache,null,()=>this.api.exec(this.db,f.join("")),this.__mutex)}exec(f,p){return this.assertOpen(),serialize(this.cache,computeCacheKey(f,"a",p),()=>this.statements(f,!1,p),this.__mutex)}execO(f,p){return this.assertOpen(),serialize(this.cache,computeCacheKey(f,"o",p),()=>this.statements(f,!0,p),this.__mutex)}execA(f,p){return this.assertOpen(),serialize(this.cache,computeCacheKey(f,"a",p),()=>this.statements(f,!1,p),this.__mutex)}prepare(f){return this.assertOpen(),serialize(this.cache,void 0,async()=>{const p=this.api.str_new(this.db,f),y=await this.api.prepare_v2(this.db,this.api.str_value(p));if(y==null)throw this.api.str_finish(p),new Error(`Could not prepare ${f}`);return new Stmt(this,this.stmtFinalizer,this.cache,this.api,y.stmt,p,f)},this.__mutex)}tx(f){return this.assertOpen(),serializeTx(async p=>{await p.exec("SAVEPOINT crsql_transaction");try{await f(p)}catch(y){throw await p.exec("ROLLBACK"),y}await p.exec("RELEASE crsql_transaction")},this.__mutex,this)}imperativeTx(){return this.__mutex.acquire().then(f=>{const p=new Mutex;return[f,new TX(this.api,this.db,p,this.assertOpen,this.stmtFinalizer)]})}async statements(f,p,y){const b=[],E=this.api.str_new(this.db,f);let _={stmt:null,sql:this.api.str_value(E)};try{for(;_=await this.api.prepare_v2(this.db,_.sql);){const S=_.stmt,C=[],W=this.api.column_names(S);for(y&&this.bind(S,y);await this.api.step(S)===SQLITE_ROW;){const $=this.api.row(S);C.push($)}W.length&&b.push({columns:W,rows:C}),this.api.finalize(_.stmt),_.stmt=null}}finally{_!=null&&_.stmt&&this.api.finalize(_.stmt),this.api.str_finish(E)}const v=b[0];if(v==null)return null;if(!p)return v.rows;const I=[];for(const S of v.rows){const C={};for(let W=0;W<v.columns.length;++W)C[v.columns[W]]=S[W];I.push(C)}return I}bind(f,p){for(let y=0;y<p.length;++y){const b=p[y];this.api.bind(f,y+1,typeof b=="boolean"?b&&1||0:b)}}}const topLevelMutex=new Mutex;topLevelMutex.name="topLevelMutex";function serialize(m,f,p,y){if(f===null)log("Cache clear"),m==null||m.clear();else if(f!==void 0){const E=m==null?void 0:m.get(f);if(E)return log("Cache hit",f),E}log("Enqueueing query ",f);const b=y.runExclusive(p);return f&&(m==null||m.set(f,b),b.finally(()=>m==null?void 0:m.delete(f)).catch(E=>{console.error(E)})),b}function serializeTx(m,f,p){return f.runExclusive(()=>{const y=new Mutex,b=new TX(p.api,p.db,y,p.assertOpen,p.stmtFinalizer);return m(b)})}function cryb64(m,f=0){let p=3735928559^f,y=1103547991^f;for(let b=0,E;b<m.length;b++)E=m.charCodeAt(b),p=Math.imul(p^E,2654435761),y=Math.imul(y^E,1597334677);return p=Math.imul(p^p>>>16,2246822507),p^=Math.imul(y^y>>>13,3266489909),y=Math.imul(y^y>>>16,2246822507),y^=Math.imul(p^p>>>13,3266489909),4294967296n*BigInt(y)+BigInt(p)}function firstPick(m){const f=m[0];if(f!=null)return f[Object.keys(f)[0]]}var en,$t,Wn,xt,Dn,gi;class DB{constructor(f,p,y){Oe(this,"api");Oe(this,"db");Oe(this,"filename");Oe(this,"__mutex",topLevelMutex);Oe(this,"stmtFinalizer",new Map);B(this,en,null);Oe(this,"cache",new Map);B(this,$t,null);B(this,Wn,!1);B(this,xt,void 0);B(this,Dn,()=>{if(N(this,Wn))throw new Error("The DB is closed")});B(this,gi,(f,p,y,b)=>{N(this,$t)!=null&&N(this,$t).forEach(E=>{try{E(f,p,y,b)}catch(_){console.error("Failed notifying a DB update listener"),console.error(_)}})});this.api=f,this.db=p,this.filename=y,H(this,xt,new TX(f,p,topLevelMutex,N(this,Dn),this.stmtFinalizer))}get siteid(){return N(this,en)}_setSiteid(f){if(N(this,en))throw new Error("Site id already set");H(this,en,f)}async automigrateTo(f,p){const y=cryb64(p),b=firstPick(await this.execA("SELECT value FROM crsql_master WHERE key = 'schema_name'")),E=firstPick(await this.execA("SELECT value FROM crsql_master WHERE key = 'schema_version'"));if(b===f&&BigInt(E||0)===y)return"noop";const _=b===void 0||b!==f?"apply":"migrate";return await this.tx(async v=>{if(E==null||b!==f){if(b!==f){const I=await v.execA("SELECT name FROM sqlite_master WHERE type = 'table' AND name NOT LIKE '%crsql_%'");for(const S of I)await v.exec(`DROP TABLE [${S[0]}]`)}await v.exec(p)}else await v.exec("SELECT crsql_automigrate(?, 'SELECT crsql_finalize();')",[p]);await v.exec("INSERT OR REPLACE INTO crsql_master (key, value) VALUES (?, ?)",["schema_version",y]),await v.exec("INSERT OR REPLACE INTO crsql_master (key, value) VALUES (?, ?)",["schema_name",f])}),await this.exec("VACUUM;"),_}execMany(f){return N(this,xt).execMany(f)}exec(f,p){return N(this,xt).exec(f,p)}execO(f,p){return N(this,xt).execO(f,p)}execA(f,p){return N(this,xt).execA(f,p)}prepare(f){return N(this,xt).prepare(f)}tx(f){return N(this,xt).tx(f)}imperativeTx(){return N(this,xt).imperativeTx()}async close(){for(const f of this.stmtFinalizer.values()){const p=f.deref();p&&await p.finalize(this)}return this.exec("SELECT crsql_finalize()").then(()=>(H(this,Wn,!0),serialize(this.cache,void 0,()=>this.api.close(this.db),this.__mutex)))}createFunction(f,p,y){N(this,Dn).call(this),this.api.create_function(this.db,f,p.length,SQLITE_UTF8,0,(b,E)=>{const _=[];for(let I=0;I<p.length;++I)_.push(this.api.value(E[I]));const v=p(..._);v!==void 0&&this.api.result(b,v)})}onUpdate(f){return N(this,$t)==null&&(this.api.update_hook(this.db,N(this,gi)),H(this,$t,new Set)),N(this,$t).add(f),()=>{var p;return(p=N(this,$t))==null?void 0:p.delete(f)}}}en=new WeakMap,$t=new WeakMap,Wn=new WeakMap,xt=new WeakMap,Dn=new WeakMap,gi=new WeakMap;let api=null;class SQLite3{constructor(f){Oe(this,"base");this.base=f}open(f,p="c"){return serialize(null,void 0,()=>this.base.open_v2(f||":memory:",SQLITE_OPEN_CREATE|SQLITE_OPEN_READWRITE|SQLITE_OPEN_URI,f!=null?"idb-batch-atomic":void 0),topLevelMutex).then(y=>{const b=new DB(this.base,y,f||":memory:");return b.execA("select quote(crsql_siteid());").then(E=>(b._setSiteid(E[0][0].replace(/'|X/g,"")),b))})}}async function initWasm(m){if(api!=null)return api;const f=await SQLiteAsyncESMFactory({locateFile(y){return m?m(y):new URL(""+new URL("../assets/crsqlite.0980e00c.wasm",import.meta.url).href,self.location).href}}),p=Factory(f);return p.vfs_register(new IDBBatchAtomicVFS("idb-batch-atomic",{durability:"relaxed"})),api=new SQLite3(p),api}async function load(m,f){return{database:await(await initWasm(()=>f.wasm||wasmUrl)).open(m),browser:!0}}const connections$1=new Map,defaultPaths={};async function init(m,f,p=defaultPaths){if(connections$1.has(m))return connections$1.get(m);const{database:y,browser:b}=await load(m,p),E=b?CRDialect:SqliteDialect,_=new Kysely({dialect:new E({database:y}),plugins:[new JSONPlugin]}),v=_.destroy.bind(_);await _.transaction().execute(S=>apply(S,f));const I=Object.assign(_,{resolveChanges,applyOperation,insertChanges,updateVersion,selectVersion,selectClient,changesSince,async destroy(){return connections$1.delete(m),await finalize.bind(_)().execute(),v()}});return connections$1.set(m,I),I}const raf=globalThis.requestAnimationFrame||globalThis.setTimeout,error=Symbol("error");function queue(m,f){const p=new Map;let y;async function b(){return y||(y=new Promise(E=>raf(async()=>{const _=await m,v=new Map;await _.transaction().execute(async I=>{const S=f&&(await selectVersion.bind(I)().execute()).current;for(const[C,W]of p.entries()){const $=await W(I).catch(P=>({[error]:P}));v.set(C,$)}f==null||f(await changesSince.bind(I)(S).execute())}),p.clear(),y=void 0,E(v)})))}return{enqueue(E,_,...v){return p.set(E,I=>_(I,...v)),b().then(I=>I.get(E)).then(I=>{if(I&&typeof I=="object"&&error in I)throw I[error];return I})}}}const empty=[],ready=m=>m!==empty;function database(m,{ssr:f=!1,name:p="crstore.db",paths:y=defaultPaths,error:b=void 0,push:E=void 0,pull:_=void 0,online:v=()=>{var I;return!!((I=globalThis.navigator)!=null&&I.onLine)}}={}){var _e;const S=!f&&!1?new Promise(()=>{}):init(p,m,y),C="BroadcastChannel"in globalThis?new globalThis.BroadcastChannel(`${p}-sync`):null,W=Z=>de(Z.data,Z.data[0]),$=queue(S,de),P=queue(S);C==null||C.addEventListener("message",W),(_e=globalThis.addEventListener)==null||_e.call(globalThis,"online",q);const U=new Map;let R=()=>{};q();async function A(Z,ie){return P.enqueue(ie,ee=>ee.getExecutor().executeQuery(Z,ie)).then(ee=>ee.rows)}function x(Z,ie,ee){const se=async(me,ye)=>{try{if(ee&&ee.client===ye)return;await ie(me,ye)}catch(X){b==null||b(X)}};return Z.forEach(me=>{var ye;U.has(me)||U.set(me,new Set),(ye=U.get(me))==null||ye.add(se)}),ee?S.then(async me=>{const ye=await me.changesSince(ee.version,ee.client).execute();ye.length&&se(ye)}):se([]),()=>Z.forEach(me=>{var ye;return(ye=U.get(me))==null?void 0:ye.delete(se)})}async function D(){if(!E||!v())return;const Z=await S,{current:ie,synced:ee}=await Z.selectVersion().execute();if(ie<=ee)return;const se=await Z.changesSince(ee,null).execute();await E(se),await Z.updateVersion(ie).execute()}async function q(){var se,me;if((se=globalThis.removeEventListener)==null||se.call(globalThis,"offline",R),R(),!_||!v())return;const Z=await S,{synced:ie}=await Z.selectVersion().execute(),ee=await Z.selectClient().execute();await D(),R=_({version:ie,client:ee},{async onData(ye){ye.length&&(await Z.insertChanges(ye).execute(),await de(ye,ye[0]))}}).unsubscribe,(me=globalThis.addEventListener)==null||me.call(globalThis,"offline",R)}async function V(Z,...ie){return $.enqueue({},Z,...ie)}async function Y(Z){if(!Z.length)return;const ie=await S;await de(await ie.resolveChanges(Z).execute(),Z[0])}async function de(Z,ie){var ye;if(!Z.length)return;const ee=new Set,se=affectedTables(Z);(ye=U.get("*"))==null||ye.forEach(X=>ee.add(X)),se.forEach(X=>{var ce;return(ce=U.get(X))==null?void 0:ce.forEach(Ee=>ee.add(Ee))});const me=[...ee].map(X=>X(Z,ie));ie||(C==null||C.postMessage(Z),await D()),await Promise.all(me)}async function he(){var Z,ie;R(),C==null||C.close(),U.clear(),(Z=globalThis.removeEventListener)==null||Z.call(globalThis,"online",q),(ie=globalThis.removeEventListener)==null||ie.call(globalThis,"offline",R),C==null||C.removeEventListener("message",W),await S.then(ee=>ee.destroy())}const ue=Object.assign(store.bind({connection:S,subscribe:x,update:V,refresh:A},[]),{with:(...Z)=>store.bind({connection:S,subscribe:x,update:V,refresh:A},Z)});return{close:he,merge:Y,update:V,subscribe:x,connection:S,store:ue}}function store(m,f,p={}){const{connection:y,update:b,refresh:E}=this,_=derived(m,P=>P);let v=null,I=null;const{subscribe:S,set:C}=writable(empty,()=>{let P=()=>{};return y.then(U=>{if(!P)return;let R=()=>{};const A=_.subscribe(x=>{const D=f(U,...x).toOperationNode(),q=affectedTables(D),V=U.getExecutor();I={queryId:Math.random().toString(36).slice(2)},v=V.compileQuery(V.transformQuery(D,I),I),R(),R=this.subscribe(q,W)});P=()=>(A(),R())}),()=>(P==null||P(),P=null)});async function W(){await y,!(!v||!I)&&C(await E(v,I))}const $={};for(const P in p)$[P]=(...U)=>b(p[P],...U);return{...$,set:C,subscribe:S,update(P,...U){return P?b(P,...U):W()},then(P,U){let R=[];const A=S(x=>R=x);return W().then(()=>(A(),P(R)),U)}}}const APPEND=1,source=m=>m.selectFrom(f=>f.selectFrom("sources").select(["owner","source"]).orderBy("sources.primary","desc").as("ordered")).select(["owner",f=>group(f,"source").as("sources")]).groupBy("owner").$castTo(),asset=m=>m.selectFrom(f=>f.selectFrom("assets").select(["owner","art","thumbnail"]).orderBy("assets.primary","desc").as("ordered")).select(["owner",f=>group(f,"art").as("arts"),f=>group(f,"thumbnail").as("thumbnails")]).groupBy("owner").$castTo(),artist$1=m=>m.selectFrom("artists").leftJoin("source","source.owner","artists.id").leftJoin("asset","asset.owner","artists.id").select(["artists.id","artists.title","artists.following",f=>f.fn.coalesce("asset.arts",f.val("[]")).as("arts"),f=>f.fn.coalesce("asset.thumbnails",f.val("[]")).as("thumbnails"),f=>f.fn.coalesce("source.sources",f.val("[]")).as("sources")]).$castTo(),album$1=m=>m.selectFrom("albums").leftJoin("source","source.owner","albums.id").leftJoin("asset","asset.owner","albums.id").leftJoin("attribution","attribution.album","albums.id").innerJoin("artist","artist.id","attribution.artist").select(["albums.id","albums.title","albums.year",f=>f.fn.coalesce("asset.arts",f.val("[]")).as("arts"),f=>f.fn.coalesce("asset.thumbnails",f.val("[]")).as("thumbnails"),f=>f.fn.coalesce("source.sources",f.val("[]")).as("sources"),f=>groupJSON(f,{id:"artist.id",title:"artist.title",arts:"artist.arts",thumbnails:"artist.thumbnails",sources:"artist.sources"}).filterWhere("artist.id","is not",null).as("artists")]).groupBy("albums.id").$castTo(),track$2=m=>m.selectFrom("tracks").leftJoin("source","source.owner","tracks.id").innerJoin("album","album.id","tracks.album").select(["tracks.id","tracks.title","tracks.duration","album.artists",f=>f.fn.coalesce("source.sources",f.val("[]")).as("sources"),f=>json(f,{id:"album.id",title:"album.title",year:"album.year",arts:"album.arts",thumbnails:"album.thumbnails",sources:"album.sources"}).as("album")]).$castTo(),localDevice=sql`crsql_siteid()`,uuid=()=>Math.random()*2**32>>>0,sanitize=m=>m.replace(/-/g," ").split(/\s+/g).map(f=>`"${f.replace(/"/g,'""')}"`).join(" "),position={first:null,before:m=>m.selectFrom("queue").select("id").where("position","=",1).limit(1),shift:m=>f=>f.selectFrom("queue").select("id").whereRef(p=>p.selectFrom("queue").select(sql`position + 1`.as("position")).where("id","=",m),"=","position").limit(1),next:m=>m.selectFrom("devices").select("playback").where("id","=",localDevice).limit(1),last:m=>m.selectFrom("playback").select("id").where("device","=",localDevice).orderBy("order","desc").orderBy("id","desc").limit(1),random:m=>f=>f.selectFrom(p=>p.selectFrom("queue").select(["id","position"]).$if(!!m.length,y=>y.unionAll(sql`VALUES ${sql.raw(m.map(b=>`(${b}, 1)`).join(","))}`)).unionAll(sql`SELECT null,1 WHERE NOT EXISTS (SELECT 1 FROM queue WHERE position >= 0)`).as("data")).select("id").where("position",">=",0).orderBy(sql`random()`).limit(1)};async function pushTracks(m,f){f.length&&(await pushAlbums(m,f.map(p=>({...p.album,artists:p.artists}))),await m.insertInto("tracks").onConflict(p=>p.doNothing()).values(f.map(p=>({id:p.id,title:p.title,duration:p.duration,album:p.album.id}))).execute(),await pushResources(m,f))}async function pushAlbums(m,f){f.length&&(await pushArtists(m,f.flatMap(p=>p.artists)),f.find(p=>p.artists.length)&&await m.insertInto("attribution").onConflict(p=>p.doNothing()).values(f.flatMap(p=>p.artists.map(({id:y})=>({album:p.id,artist:y})))).execute(),await m.insertInto("albums").onConflict(p=>p.doNothing()).values(f.map(p=>({id:p.id,title:p.title,year:p.year}))).execute(),await pushResources(m,f))}async function pushArtists(m,f){f.length&&(await m.insertInto("artists").onConflict(p=>p.doNothing()).values(f.map(p=>({id:p.id,title:p.title,following:0}))).execute(),await pushResources(m,f))}async function pushResources(m,f){f.length&&(f.find(p=>p.sources.length)&&await m.insertInto("sources").onConflict(p=>p.doNothing()).values(f.flatMap(({id:p,sources:y})=>y.map((b,E)=>({owner:p,source:b,primary:+!E&&sql`NOT EXISTS (SELECT 1 FROM sources WHERE owner = ${p} AND "primary" = 1)`})))).execute(),f.find(p=>{var y;return(y=p.arts)==null?void 0:y.length})&&await m.insertInto("assets").onConflict(p=>p.doNothing()).values(f.flatMap(({id:p,arts:y,thumbnails:b})=>{if(!y)return[];const E=y.find((_,v)=>!!(b!=null&&b[v]))||y[0];return y.map((_,v)=>({owner:p,art:_,thumbnail:b==null?void 0:b[v],primary:+(_===E)&&sql`NOT EXISTS (SELECT 1 FROM assets WHERE owner = ${p} AND "primary" = 1)`}))})).execute())}const preceding$1=({store:m})=>m(f=>f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).with("update",p=>p.selectFrom("playback").select(y=>y.selectFrom("devices").select("id").as("_"))).selectFrom("queue").innerJoin("track","track.id","queue.track").where("position","<",0).select("queue.id as entry").select(fields).$castTo()),upcoming$1=({store:m})=>m(f=>f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).with("update",p=>p.selectFrom("playback").select(y=>y.selectFrom("devices").select("id").as("_"))).selectFrom("queue").innerJoin("track","track.id","queue.track").where("position",">",0).select("queue.id as entry").select(fields).$castTo()),playback$2=({store:m})=>m(f=>f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("devices").innerJoin("playback","playback.id","devices.playback").innerJoin("track","track.id","playback.track").select(["direction","repeat","infinite","device","progress"]).select(p=>json(p,{entry:"playback.id",id:"track.id",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).as("track")).select(sql`device = crsql_siteid()`.as("local")).select(fields).$castTo(),{async push(f,p,y="next"){if(!p.length)return;await pushTracks(f,p);const{direction:b,playback:E}=await f.selectFrom("devices").where("id","=",localDevice).select(["direction","playback"]).executeTakeFirstOrThrow(),_=p.map(uuid),v=b!=1?Number.isInteger(y)?y:y==="first"?position.first:y==="next"?position.next:position.last:Number.isInteger(y)?position.shift(+y):y==="first"?position.last:y==="next"?position.before:position.first;await f.insertInto("playback_fractindex").values(p.map((I,S)=>({id:_[S],track:I.id,device:localDevice,after_id:y==="random"?position.random(_.slice(0,S)):S>0&&b!=1?_[S-1]:v}))).execute(),!~E&&y==="random"&&await f.updateTable("devices").set({playback:I=>I.selectFrom("queue").select("id").$castTo().limit(1)}).execute()},async purge(f,p){p.length&&await f.deleteFrom("playback").where("id","in",p).execute()},async clear(f,p=localDevice){await f.deleteFrom("playback").where("device","=",p).execute(),await f.updateTable("devices").set({playback:-1,progress:0}).where("id","=",p).execute()},async sync(f,p){await f.updateTable("devices").where("id","=",localDevice).set({progress:p}).execute()},async rearrange(f,p,y=null){const{direction:b}=await f.selectFrom("devices").where("id","=",localDevice).select(["direction"]).executeTakeFirstOrThrow(),E=b!=1?y:y!=null?position.shift(y):position.last;await f.updateTable("playback_fractindex").set({after_id:E}).where("id","=",p).execute()},async redirect(f,p){const y=["forward","backward","shuffled"],{direction:b}=await f.selectFrom("devices").select("direction").where("id","=",localDevice).executeTakeFirstOrThrow(),E=y.indexOf(p);b!==E&&await f.updateTable("devices").set({direction:E}).where("id","=",localDevice).execute()},async repeat(f,p){const y=["none","single","all"];await f.updateTable("devices").set({repeat:y.indexOf(p)}).where("id","=",localDevice).execute()},async infinite(f,p){await f.updateTable("devices").set({infinite:p==null?sql`!infinite`:+p}).where("id","=",localDevice).execute()},async replicate(f,p){const y=uuid();await f.updateTable("devices").where("id","=",localDevice).set({playback:y,progress:b=>b.selectFrom("devices").where("id","=",p).select("progress")}).execute(),await f.deleteFrom("playback").where("device","=",localDevice).execute(),await f.insertInto("playback").expression(b=>b.selectFrom("playback").select(E=>E.case().when(_=>_.selectFrom("devices").whereRef("id","=","playback.device").select("devices.playback"),"=",E.ref("playback.id")).then(y).else(sql`ABS(RANDOM() % 4294967296)`).end().as("id")).select(sql`${localDevice}`.as("device")).select(["track","order","temp"]).where("device","=",p)).execute()}}),fields=["track.id","track.title","track.duration","track.album","track.artists","track.sources"];class StructError extends TypeError{constructor(f,p){let y;const{message:b,explanation:E,..._}=f,{path:v}=f,I=v.length===0?b:`At path: ${v.join(".")} -- ${b}`;super(E??I),E!=null&&(this.cause=I),Object.assign(this,_),this.name=this.constructor.name,this.failures=()=>y??(y=[f,...p()])}}function isIterable(m){return isObject$1(m)&&typeof m[Symbol.iterator]=="function"}function isObject$1(m){return typeof m=="object"&&m!=null}function print(m){return typeof m=="symbol"?m.toString():typeof m=="string"?JSON.stringify(m):`${m}`}function shiftIterator(m){const{done:f,value:p}=m.next();return f?void 0:p}function toFailure(m,f,p,y){if(m===!0)return;m===!1?m={}:typeof m=="string"&&(m={message:m});const{path:b,branch:E}=f,{type:_}=p,{refinement:v,message:I=`Expected a value of type \`${_}\`${v?` with refinement \`${v}\``:""}, but received: \`${print(y)}\``}=m;return{value:y,type:_,refinement:v,key:b[b.length-1],path:b,branch:E,...m,message:I}}function*toFailures(m,f,p,y){isIterable(m)||(m=[m]);for(const b of m){const E=toFailure(b,f,p,y);E&&(yield E)}}function*run(m,f,p={}){const{path:y=[],branch:b=[m],coerce:E=!1,mask:_=!1}=p,v={path:y,branch:b};if(E&&(m=f.coercer(m,v),_&&f.type!=="type"&&isObject$1(f.schema)&&isObject$1(m)&&!Array.isArray(m)))for(const S in m)f.schema[S]===void 0&&delete m[S];let I="valid";for(const S of f.validator(m,v))S.explanation=p.message,I="not_valid",yield[S,void 0];for(let[S,C,W]of f.entries(m,v)){const $=run(C,W,{path:S===void 0?y:[...y,S],branch:S===void 0?b:[...b,C],coerce:E,mask:_,message:p.message});for(const P of $)P[0]?(I=P[0].refinement!=null?"not_refined":"not_valid",yield[P[0],void 0]):E&&(C=P[1],S===void 0?m=C:m instanceof Map?m.set(S,C):m instanceof Set?m.add(C):isObject$1(m)&&(C!==void 0||S in m)&&(m[S]=C))}if(I!=="not_valid")for(const S of f.refiner(m,v))S.explanation=p.message,I="not_refined",yield[S,void 0];I==="valid"&&(yield[void 0,m])}class Struct{constructor(f){const{type:p,schema:y,validator:b,refiner:E,coercer:_=I=>I,entries:v=function*(){}}=f;this.type=p,this.schema=y,this.entries=v,this.coercer=_,b?this.validator=(I,S)=>{const C=b(I,S);return toFailures(C,S,this,I)}:this.validator=()=>[],E?this.refiner=(I,S)=>{const C=E(I,S);return toFailures(C,S,this,I)}:this.refiner=()=>[]}assert(f,p){return assert(f,this,p)}create(f,p){return create(f,this,p)}is(f){return is(f,this)}mask(f,p){return mask(f,this,p)}validate(f,p={}){return validate(f,this,p)}}function assert(m,f,p){const y=validate(m,f,{message:p});if(y[0])throw y[0]}function create(m,f,p){const y=validate(m,f,{coerce:!0,message:p});if(y[0])throw y[0];return y[1]}function mask(m,f,p){const y=validate(m,f,{coerce:!0,mask:!0,message:p});if(y[0])throw y[0];return y[1]}function is(m,f){return!validate(m,f)[0]}function validate(m,f,p={}){const y=run(m,f,p),b=shiftIterator(y);return b[0]?[new StructError(b[0],function*(){for(const _ of y)_[0]&&(yield _[0])}),void 0]:[void 0,b[1]]}function assign(...m){const f=m[0].type==="type",p=m.map(b=>b.schema),y=Object.assign({},...p);return f?type(y):object(y)}function define(m,f){return new Struct({type:m,schema:null,validator:f})}function omit(m,f){const{schema:p}=m,y={...p};for(const b of f)delete y[b];switch(m.type){case"type":return type(y);default:return object(y)}}function any(){return define("any",()=>!0)}function array(m){return new Struct({type:"array",schema:m,*entries(f){if(m&&Array.isArray(f))for(const[p,y]of f.entries())yield[p,y,m]},coercer(f){return Array.isArray(f)?f.slice():f},validator(f){return Array.isArray(f)||`Expected an array value, but received: ${print(f)}`}})}function instance$1(m){return define("instance",f=>f instanceof m||`Expected a \`${m.name}\` instance, but received: ${print(f)}`)}function integer(){return define("integer",m=>typeof m=="number"&&!isNaN(m)&&Number.isInteger(m)||`Expected an integer, but received: ${print(m)}`)}function literal(m){const f=print(m),p=typeof m;return new Struct({type:"literal",schema:p==="string"||p==="number"||p==="boolean"?m:null,validator(y){return y===m||`Expected the literal \`${f}\`, but received: ${print(y)}`}})}function never(){return define("never",()=>!1)}function nullable(m){return new Struct({...m,validator:(f,p)=>f===null||m.validator(f,p),refiner:(f,p)=>f===null||m.refiner(f,p)})}function number(){return define("number",m=>typeof m=="number"&&!isNaN(m)||`Expected a number, but received: ${print(m)}`)}function object(m){const f=m?Object.keys(m):[],p=never();return new Struct({type:"object",schema:m||null,*entries(y){if(m&&isObject$1(y)){const b=new Set(Object.keys(y));for(const E of f)b.delete(E),yield[E,y[E],m[E]];for(const E of b)yield[E,y[E],p]}},validator(y){return isObject$1(y)||`Expected an object, but received: ${print(y)}`},coercer(y){return isObject$1(y)?{...y}:y}})}function optional(m){return new Struct({...m,validator:(f,p)=>f===void 0||m.validator(f,p),refiner:(f,p)=>f===void 0||m.refiner(f,p)})}function string(){return define("string",m=>typeof m=="string"||`Expected a string, but received: ${print(m)}`)}function type(m){const f=Object.keys(m);return new Struct({type:"type",schema:m,*entries(p){if(isObject$1(p))for(const y of f)yield[y,p[y],m[y]]},validator(p){return isObject$1(p)||`Expected an object, but received: ${print(p)}`},coercer(p){return isObject$1(p)?{...p}:p}})}function union(m){const f=m.map(p=>p.type).join(" | ");return new Struct({type:"union",schema:null,coercer(p){for(const y of m){const[b,E]=y.validate(p,{coerce:!0});if(!b)return E}return p},validator(p,y){const b=[];for(const E of m){const[..._]=run(p,E,y),[v]=_;if(v[0])for(const[I]of _)I&&b.push(I);else return[]}return[`Expected the value to satisfy a union of \`${f}\`, but received: ${print(p)}`,...b]}})}const track$1=object({title:string(),duration:number()}),album=object({title:string(),year:integer()}),artist=object({title:string()}),playlist=object({title:string(),relevancy:number(),shared:nullable(string()),remote:nullable(string())});type({title:optional(string()),album:optional(type({title:optional(string())})),artists:optional(array(type({title:optional(string())})))});const media=object({sources:array(string()),arts:optional(array(string())),thumbnails:optional(array(nullable(string())))}),collection=m=>object({size:integer(),duration:number(),tracks:array(m)}),unique=m=>assign(m,object({id:integer()})),artistInfo=assign(artist,media),albumInfo=assign(album,assign(media,object({artists:array(artistInfo)}))),trackInfo=assign(track$1,assign(omit(media,["arts","thumbnails"]),object({album:omit(albumInfo,["artists"]),artists:array(artistInfo)}))),playlistInfo=playlist,track=assign(unique(trackInfo),object({entry:optional(number()),album:unique(trackInfo.schema.album),artists:array(unique(trackInfo.schema.artists.schema))}));assign(unique(albumInfo),object({artists:array(unique(albumInfo.schema.artists.schema)),collection:optional(collection(track))}));assign(unique(artistInfo),object({following:optional(union([literal(0),literal(1)])),collection:optional(collection(track))}));assign(unique(playlistInfo),object({collection:optional(collection(track))}));function has(m,f){return m!==null&&typeof m=="object"&&f in m&&m[f]!==void 0}var murmurhash={exports:{}};(function(m){(function(){const f=E=>new TextEncoder().encode(E);function p(E,_){typeof E=="string"&&(E=f(E));let v=E.length,I=_^v,S=0,C;for(;v>=4;)C=E[S]&255|(E[++S]&255)<<8|(E[++S]&255)<<16|(E[++S]&255)<<24,C=(C&65535)*1540483477+(((C>>>16)*1540483477&65535)<<16),C^=C>>>24,C=(C&65535)*1540483477+(((C>>>16)*1540483477&65535)<<16),I=(I&65535)*1540483477+(((I>>>16)*1540483477&65535)<<16)^C,v-=4,++S;switch(v){case 3:I^=(E[S+2]&255)<<16;case 2:I^=(E[S+1]&255)<<8;case 1:I^=E[S]&255,I=(I&65535)*1540483477+(((I>>>16)*1540483477&65535)<<16)}return I^=I>>>13,I=(I&65535)*1540483477+(((I>>>16)*1540483477&65535)<<16),I^=I>>>15,I>>>0}function y(E,_){typeof E=="string"&&(E=f(E));let v,I,S,C,W,$,P,U;for(v=E.length&3,I=E.length-v,S=_,W=3432918353,$=461845907,U=0;U<I;)P=E[U]&255|(E[++U]&255)<<8|(E[++U]&255)<<16|(E[++U]&255)<<24,++U,P=(P&65535)*W+(((P>>>16)*W&65535)<<16)&4294967295,P=P<<15|P>>>17,P=(P&65535)*$+(((P>>>16)*$&65535)<<16)&4294967295,S^=P,S=S<<13|S>>>19,C=(S&65535)*5+(((S>>>16)*5&65535)<<16)&4294967295,S=(C&65535)+27492+(((C>>>16)+58964&65535)<<16);switch(P=0,v){case 3:P^=(E[U+2]&255)<<16;case 2:P^=(E[U+1]&255)<<8;case 1:P^=E[U]&255,P=(P&65535)*W+(((P>>>16)*W&65535)<<16)&4294967295,P=P<<15|P>>>17,P=(P&65535)*$+(((P>>>16)*$&65535)<<16)&4294967295,S^=P}return S^=E.length,S^=S>>>16,S=(S&65535)*2246822507+(((S>>>16)*2246822507&65535)<<16)&4294967295,S^=S>>>13,S=(S&65535)*3266489909+(((S>>>16)*3266489909&65535)<<16)&4294967295,S^=S>>>16,S>>>0}const b=y;b.v2=p,b.v3=y,m.exports=b})()})(murmurhash);var murmurhashExports=murmurhash.exports;const hash=getDefaultExportFromCjs(murmurhashExports);function titled(m){return has(m,"title")?m.title:m}function compare$1(m,f){return typeof m=="string"&&typeof f=="string"?m.localeCompare(f):typeof m=="number"&&typeof f=="number"?m-f:has(m,"title")&&has(f,"title")?compare$1(clean(titled(m)),clean(titled(f))):0}function normalize(m){if(typeof m=="string")return clean(m);if(typeof m!="object")return m;const f={...m};for(const p in f)Array.isArray(f[p])?f[p]=f[p].map(normalize).sort(compare$1):f[p]=normalize(f[p]);return f}function stringify(m){return m=normalize(m),typeof m=="string"?m:typeof m!="object"?clean(String(m)):has(m,"artists")&&has(m,"title")&&has(m,"album")?`${m.artists.map(titled)} - ${m.title} - ${titled(m.album)}`:has(m,"artists")&&has(m,"title")?`${m.artists.map(titled)} - ${m.title}`:has(m,"title")?m.title:Array.isArray(m)?m.map(titled).toString():JSON.stringify(m)}function identify(m){return has(m,"id")?+m.id:hash(stringify(m))}const playlists$2=({store:m})=>m(f=>f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",p=>track$2(p).innerJoin("library","library.track","tracks.id").select(["library.playlist","library.id as entry"]).orderBy("library.order").orderBy("library.id")).selectFrom("track").fullJoin("playlists","playlists.id","track.playlist").where("playlists.id",">=",0).select(["playlists.id","playlists.title","playlists.relevancy","playlists.shared","playlists.remote",p=>json(p,{size:p.fn.count("track.duration"),duration:p.fn.coalesce(p.fn.sum("track.duration"),p.val(0)),tracks:groupJSON(p,{id:"track.id",entry:"track.entry",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("playlists.id").orderBy("playlists.order").orderBy("playlists.id").$castTo(),{async create(f,p){await f.insertInto("playlists").onConflict(y=>y.doNothing()).values({id:identify(p),order:APPEND,relevancy:1,...p}).execute()},async edit(f,p,y){await f.updateTable("playlists").where("id","=",p).set(y).execute()},async rearrange(f,p,y){await f.updateTable("playlists_fractindex").set({after_id:y||null}).where("id","=",p).execute()},async delete(f,p){await f.deleteFrom("playlists").where("id","=",p).execute()},get(f,p){return f.selectFrom("playlists").selectAll().where("id","=",p).executeTakeFirstOrThrow()}}),resources$1=({store:m})=>m(f=>f.with("source",source).with("asset",asset).selectFrom("source").leftJoin("asset","asset.owner","source.owner").select([p=>p.fn.coalesce("asset.arts",p.val("[]")).as("arts"),p=>p.fn.coalesce("asset.thumbnails",p.val("[]")).as("thumbnails"),p=>p.fn.coalesce("source.sources",p.val("[]")).as("sources")]).$castTo(),{async prioritize(f,p,y){const b=p==="art"?"assets":"sources";await f.updateTable(b).set({primary:sql`${sql.ref(p)} = ${y}`}).where("owner","=",E=>E.selectFrom(b).where(p,"=",y).select("owner")).execute()},get(f,p){return f.with("source",source).with("asset",asset).selectFrom("source").leftJoin("asset","asset.owner","source.owner").select([y=>y.fn.coalesce("asset.arts",y.val("[]")).as("arts"),y=>y.fn.coalesce("asset.thumbnails",y.val("[]")).as("thumbnails"),y=>y.fn.coalesce("source.sources",y.val("[]")).as("sources")]).where("source.owner","=",p).$castTo().executeTakeFirstOrThrow()}}),settings$2=({store:m})=>m(f=>f.selectFrom("settings").select(["key",sql`json_extract(value, '$')`.as("value")]),{async store(f,p,y,b="settings"){b!=="settings"&&(await f.schema.createTable(b).ifNotExists().addColumn("key","text",E=>E.primaryKey()).addColumn("value","text").execute(),await f.schema.createIndex(b+"_value").ifNotExists().on(b).column("value").execute()),await f.insertInto(b).onConflict(E=>E.doUpdateSet({value:JSON.stringify(y)})).values({key:p,value:JSON.stringify(y)}).execute()},async extract(f,p,y="settings"){return f.selectFrom(y).select("value").where("key","=",p).executeTakeFirstOrThrow().then(b=>JSON.parse(b.value))},async lookup(f,p,y="settings"){return f.selectFrom(y).select("key").where("value","=",JSON.stringify(p)).executeTakeFirstOrThrow().then(b=>b.key)}}),history$2=({store:m})=>m(f=>f.selectFrom("history").orderBy("date","desc").selectAll(),{async log(f,p){p.trim()&&await f.insertInto("history").onConflict(y=>y.doUpdateSet({date:Date.now()})).values({query:p,date:Date.now()}).execute()},async clear(f){await f.deleteFrom("history").execute()},get(f){return f.selectFrom("history").selectAll().orderBy("date","desc").execute()}}),artists$2=({store:m})=>m(f=>f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("artist").leftJoin("attribution","attribution.artist","artist.id").leftJoin("albums","albums.id","attribution.album").leftJoin("tracks","tracks.album","albums.id").leftJoin("track","track.id","tracks.id").select(["artist.id","artist.title","artist.following","artist.arts","artist.thumbnails","artist.sources",p=>json(p,{size:p.fn.count("track.duration"),duration:p.fn.coalesce(p.fn.sum("track.duration"),p.val(0)),tracks:groupJSON(p,{id:"track.id",entry:"track.id",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("artist.id").orderBy(p=>p.fn.count("track.duration"),"desc").orderBy("artist.title").$castTo(),{async push(f,p){await pushArtists(f,p)},async edit(f,p,y){await f.updateTable("artists").where("id","=",p).set(y)},async follow(f,p){await f.updateTable("artists").set({following:1}).where("id","=",p).execute()},async unfollow(f,p){await f.updateTable("artists").set({following:0}).where("id","=",p).execute()},async search(f,p,y=10,b=0){return p?f.with("source",source).with("asset",asset).with("artist",artist$1).selectFrom("artists_fts").where("artists_fts","match",sanitize(p)).orderBy("rank").innerJoin("artist","artist.id","artists_fts.rowid").selectAll().limit(y).offset(b).$castTo().execute():[]},get(f,p){return f.with("source",source).with("asset",asset).with("artist",artist$1).selectFrom("artist").where("artist.id","=",p).selectAll().$castTo().executeTakeFirstOrThrow()}}),library$2=({store:m})=>m(f=>f.selectFrom("library").selectAll(),{async push(f,p,y){p.length&&(await pushTracks(f,p),y!=null&&await f.insertInto("library").onConflict(b=>b.doNothing()).values(p.map(({id:b})=>({id:uuid(),order:APPEND,date:~~(Date.now()/1e3),track:b,playlist:y}))).execute())},async rearrange(f,p,y){await f.updateTable("library_fractindex").set({after_id:y||null}).where("id","=",p).execute()},async purge(f,p){const y=p.map(b=>f.deleteFrom("library").where("id","=",b).execute());await Promise.all(y)},async get(f,p){return p.length?f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources","library.id as entry"]).where("library.id","in",p).$castTo().execute():[]},async sample(f,p){const y=p,b=y*Math.sqrt(2*Math.PI)/2,E=sql`POW(ABS(RANDOM()) / 9223372036854775808,
        ${b} /
        EXP(-0.5 * POW(row_number() OVER (ORDER BY date DESC) / ${y},2)) *
        playlists.relevancy
      )`;return await f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").innerJoin("playlists","playlists.id","library.playlist").innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources"]).where("relevancy",">",0).orderBy(E,"desc").limit(p).execute()},async banned(f){return await f.selectFrom("library").leftJoin("playlists","playlists.id","library.playlist").select("library.track").where("relevancy","<",0).execute().then(p=>p.map(y=>y.track))}}),id=integer,boolean=integer,tracks$2=assign(unique(track$1),object({album:id()}));crr(tracks$2);index(tracks$2,"album");primary(tracks$2,"id");const albums$2=unique(album);crr(albums$2);primary(albums$2,"id");const artists$1=assign(unique(artist),object({following:boolean()}));crr(artists$1);primary(artists$1,"id");const attribution=object({album:id(),artist:id()});crr(attribution);index(attribution,"artist");primary(attribution,"album","artist");const sources=object({source:string(),owner:id(),primary:boolean()});crr(sources);primary(sources,"owner","source");const assets=object({art:string(),thumbnail:nullable(string()),owner:id(),primary:boolean()});crr(assets);primary(assets,"owner","art");const playlists$1=assign(unique(playlist),object({order:string()}));crr(playlists$1);primary(playlists$1,"id");ordered(playlists$1,"order");index(playlists$1,"order","id");const library$1=object({id:id(),playlist:id(),track:id(),date:integer(),order:string()});crr(library$1);primary(library$1,"id");index(library$1,"date");index(library$1,"track");index(library$1,"playlist");index(library$1,"order","id");ordered(library$1,"order","playlist");const playback$1=object({id:id(),device:instance$1(Uint8Array),track:id(),order:string(),temp:any()});crr(playback$1);primary(playback$1,"id");index(playback$1,"device");index(playback$1,"order","id");ordered(playback$1,"order","device");const devices=object({id:instance$1(Uint8Array),playback:id(),direction:integer(),infinite:integer(),progress:number(),repeat:integer()});crr(devices);primary(devices,"id");const settings$1=object({key:string(),value:string()});crr(settings$1);index(settings$1,"value");primary(settings$1,"key");const history$1=object({query:string(),date:integer()});crr(history$1);index(history$1,"date");primary(history$1,"query");const schema=object({tracks:tracks$2,albums:albums$2,attribution,artists:artists$1,sources,assets,library:library$1,playlists:playlists$1,playback:playback$1,devices,settings:settings$1,history:history$1}),tracks$1=({store:m})=>m(f=>f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").where("playlist",">=",0).innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources","library.id as entry","library.date"]).orderBy("library.date","desc").orderBy("library.id").$castTo(),{async edit(f,p,y){const b=await f.updateTable("tracks").where("id","=",p).set({...y,album:void 0}).returning("album").executeTakeFirst();b!=null&&b.album&&y.album&&await f.updateTable("albums").where("id","=",b.album).set(y.album).execute()},async search(f,p,y=10,b=0){return p?f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("tracks_fts").where("tracks_fts","match",sanitize(p)).orderBy("rank").innerJoin("track","track.id","rowid").selectAll().limit(y).offset(b).$castTo().execute():[]},get(f,p){return f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("track").selectAll().where("id","=",p).$castTo().executeTakeFirstOrThrow()}}),albums$1=({store:m})=>m(f=>f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("album").selectAll().orderBy("album.title"),{async push(f,p){await pushAlbums(f,p)},async search(f,p,y=10,b=0){return p?f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("albums_fts").where("albums_fts","match",sanitize(p)).orderBy("rank").innerJoin("album","album.id","albums_fts.rowid").selectAll().limit(y).offset(b).$castTo().execute():[]},get(f,p){return f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("album").selectAll().where("album.id","=",p).$castTo().executeTakeFirstOrThrow()}}),feed$1=({store:m})=>m(f=>f.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",p=>track$2(p).innerJoin("library","library.track","tracks.id").select(["library.playlist","library.id as entry"]).orderBy("library.order").orderBy("library.id")).selectFrom("track").fullJoin("playlists","playlists.id","track.playlist").where("playlists.id","<",0).select(["playlists.id","playlists.title","playlists.relevancy","playlists.shared","playlists.remote",p=>json(p,{size:p.fn.count("track.duration"),duration:p.fn.coalesce(p.fn.sum("track.duration"),p.val(0)),tracks:groupJSON(p,{id:"track.id",entry:"track.entry",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("playlists.id").orderBy("playlists.order").orderBy("playlists.id").$castTo(),{async clear(f,p){await f.deleteFrom("library").where("playlist","=",p).execute()},async get(f,p,y=-1){return f.selectFrom("library").where("playlist","=",p).select("id").limit(y).execute().then(b=>b.map(E=>E.id))}}),connections=new Map,stores=m=>({playlists:playlists$2(m),resources:resources$1(m),preceding:preceding$1(m),playback:playback$2(m),upcoming:upcoming$1(m),settings:settings$2(m),history:history$2(m),artists:artists$2(m),library:library$2(m),albums:albums$1(m),tracks:tracks$1(m),feed:feed$1(m)});function connect(m){if(!connections.has(m.name)){const f=database(m.local?nocrr(schema):schema,m);connections.set(m.name,{...f,...stores(f)});const p=Object.assign({"../sql/cascade.sql":__vite_glob_0_0,"../sql/fts.sql":__vite_glob_0_1,"../sql/playback.sql":__vite_glob_0_2,"../sql/playlists.sql":__vite_glob_0_3});m.local&&delete p["../sql/fts.sql"];const y=Object.values(p).flatMap(b=>b.split(/\r?\n\r?\n/)).map(b=>sql.raw(b));f.update(b=>Promise.all(y.map(E=>E.execute(b))))}return connections.get(m.name)}function nocrr(m){return{...m,schema:Object.fromEntries(Object.entries(m.schema).map(([f,p])=>[f,{...p,crr:!1}]))}}function identity(m){return m}function pipeFromArray(m){return m.length===0?identity:m.length===1?m[0]:function(p){return m.reduce((y,b)=>b(y),p)}}function observable(m){const f={subscribe(p){let y=null,b=!1,E=!1,_=!1;function v(){if(y===null){_=!0;return}E||(E=!0,typeof y=="function"?y():y&&y.unsubscribe())}return y=m({next(I){var S;b||(S=p.next)==null||S.call(p,I)},error(I){var S;b||(b=!0,(S=p.error)==null||S.call(p,I),v())},complete(){var I;b||(b=!0,(I=p.complete)==null||I.call(p),v())}}),_&&v(),{unsubscribe:v}},pipe(...p){return pipeFromArray(p)(f)}};return f}function share(m){return f=>{let p=0,y=null;const b=[];function E(){y||(y=f.subscribe({next(v){var I;for(const S of b)(I=S.next)==null||I.call(S,v)},error(v){var I;for(const S of b)(I=S.error)==null||I.call(S,v)},complete(){var v;for(const I of b)(v=I.complete)==null||v.call(I)}}))}function _(){if(p===0&&y){const v=y;y=null,v.unsubscribe()}}return{subscribe(v){return p++,b.push(v),E(),{unsubscribe(){p--,_();const I=b.findIndex(S=>S===v);I>-1&&b.splice(I,1)}}}}}}class ObservableAbortError extends Error{constructor(f){super(f),this.name="ObservableAbortError",Object.setPrototypeOf(this,ObservableAbortError.prototype)}}function observableToPromise(m){let f;return{promise:new Promise((y,b)=>{let E=!1;function _(){E||(E=!0,b(new ObservableAbortError("This operation was aborted.")),v.unsubscribe())}const v=m.subscribe({next(I){E=!0,y(I),_()},error(I){E=!0,b(I),_()},complete(){E=!0,_()}});f=_}),abort:f}}function createChain(m){return observable(f=>{function p(b=0,E=m.op){const _=m.links[b];if(!_)throw new Error("No more links to execute - did you forget to add an ending link?");return _({op:E,next(I){return p(b+1,I)}})}return p().subscribe(f)})}class TRPCClientError extends Error{static from(f,p={}){return f instanceof Error?f.name==="TRPCClientError"?f:new TRPCClientError(f.message,{...p,cause:f,result:null}):new TRPCClientError(f.error.message??"",{...p,cause:void 0,result:f})}constructor(f,p){var b,E;const y=p==null?void 0:p.cause;super(f,{cause:y}),this.meta=p==null?void 0:p.meta,this.cause=y,this.shape=(b=p==null?void 0:p.result)==null?void 0:b.error,this.data=(E=p==null?void 0:p.result)==null?void 0:E.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,TRPCClientError.prototype)}}function isObject(m){return!!m&&!Array.isArray(m)&&typeof m=="object"}function transformResultInner(m,f){if("error"in m){const y=f.transformer.deserialize(m.error);return{ok:!1,error:{...m,error:y}}}return{ok:!0,result:{...m.result,...(!m.result.type||m.result.type==="data")&&{type:"data",data:f.transformer.deserialize(m.result.data)}}}}function transformResult(m,f){let p;try{p=transformResultInner(m,f)}catch{throw new TRPCClientError("Unable to transform response from server")}if(!p.ok&&(!isObject(p.error.error)||typeof p.error.error.code!="number"))throw new TRPCClientError("Badly formatted response from server");if(p.ok&&!isObject(p.result))throw new TRPCClientError("Badly formatted response from server");return p}function invert(m){const f=Object.create(null);for(const p in m){const y=m[p];f[y]=p}return f}const TRPC_ERROR_CODES_BY_KEY={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};invert(TRPC_ERROR_CODES_BY_KEY);invert(TRPC_ERROR_CODES_BY_KEY);const noop=()=>{};function createInnerProxy(m,f){return new Proxy(noop,{get(y,b){if(!(typeof b!="string"||b==="then"))return createInnerProxy(m,[...f,b])},apply(y,b,E){const _=f[f.length-1]==="apply";return m({args:_?E.length>=2?E[1]:[]:E,path:_?f.slice(0,-1):f})}})}const createRecursiveProxy=m=>createInnerProxy(m,[]),createFlatProxy=m=>new Proxy(noop,{get(f,p){if(!(typeof p!="string"||p==="then"))return m(p)}});/* istanbul ignore next -- @preserve */const retryDelay=m=>m===0?0:Math.min(1e3*2**m,3e4);function createWSClient(m){const{url:f,WebSocket:p=WebSocket,retryDelayMs:y=retryDelay,onOpen:b,onClose:E}=m;/* istanbul ignore next -- @preserve */if(!p)throw new Error("No WebSocket implementation found - you probably don't want to use this on the server, but if you do you need to pass a `WebSocket`-ponyfill");let _=[];const v=Object.create(null);let I=0,S=null,C=null,W=V(),$="connecting";function P(){$!=="open"||S||(S=setTimeout(()=>{S=null,_.length===1?W.send(JSON.stringify(_.pop())):W.send(JSON.stringify(_)),_=[]}))}function U(){if(C||$==="closed")return;const de=y(I++);A(de)}function R(){$="connecting";const de=W;W=V(),x(de)}function A(de){C||($="connecting",C=setTimeout(R,de))}function x(de){Object.values(v).some(ue=>ue.ws===de)||de.close()}function D(){Object.values(v).forEach(de=>{de.type==="subscription"&&de.callbacks.complete()})}function q(de){_.some(he=>he.id===de.op.id)||Y(de.op,de.callbacks)}function V(){const de=typeof f=="function"?f():f,he=new p(de);clearTimeout(C),C=null,he.addEventListener("open",()=>{/* istanbul ignore next -- @preserve */he===W&&(I=0,$="open",b==null||b(),P())}),he.addEventListener("error",()=>{he===W&&U()});const ue=Z=>{if(Z.method==="reconnect"&&he===W){$==="open"&&(E==null||E()),R();for(const ie of Object.values(v))ie.type==="subscription"&&q(ie)}},_e=Z=>{var ee,se;const ie=Z.id!==null&&v[Z.id];if(ie){if((se=(ee=ie.callbacks).next)==null||se.call(ee,Z),ie.ws!==W&&he===W){const me=ie.ws;ie.ws=W,x(me)}"result"in Z&&Z.result.type==="stopped"&&he===W&&ie.callbacks.complete()}};return he.addEventListener("message",({data:Z})=>{const ie=JSON.parse(Z);"method"in ie?ue(ie):_e(ie),(he!==W||$==="closed")&&x(he)}),he.addEventListener("close",({code:Z})=>{var ie,ee,se,me;$==="open"&&(E==null||E({code:Z})),W===he&&U();for(const[ye,X]of Object.entries(v))if(X.ws===he){if($==="closed"){delete v[ye],(ee=(ie=X.callbacks).complete)==null||ee.call(ie);continue}X.type==="subscription"?q(X):(delete v[ye],(me=(se=X.callbacks).error)==null||me.call(se,TRPCClientError.from(new TRPCWebSocketClosedError("WebSocket closed prematurely"))))}}),he}function Y(de,he){const{type:ue,input:_e,path:Z,id:ie}=de,ee={id:ie,method:ue,params:{input:_e,path:Z}};return v[ie]={ws:W,type:ue,callbacks:he,op:de},_.push(ee),P(),()=>{var me,ye;const se=(me=v[ie])==null?void 0:me.callbacks;delete v[ie],_=_.filter(X=>X.id!==ie),(ye=se==null?void 0:se.complete)==null||ye.call(se),W.readyState===p.OPEN&&de.type==="subscription"&&(_.push({id:ie,method:"subscription.stop"}),P())}}return{close:()=>{$="closed",E==null||E(),D(),x(W),clearTimeout(C),C=null},request:Y,getConnection(){return W}}}class TRPCWebSocketClosedError extends Error{constructor(f){super(f),this.name="TRPCWebSocketClosedError",Object.setPrototypeOf(this,TRPCWebSocketClosedError.prototype)}}function wsLink(m){return f=>{const{client:p}=m;return({op:y})=>observable(b=>{const{type:E,path:_,id:v,context:I}=y,S=f.transformer.serialize(y.input),C=p.request({type:E,path:_,input:S,id:v,context:I},{error(W){b.error(W),C()},complete(){b.complete()},next(W){const $=transformResult(W,f);if(!$.ok){b.error(TRPCClientError.from($.error));return}b.next({result:$.result}),y.type!=="subscription"&&(C(),b.complete())}});return()=>{C()}})}}class TRPCUntypedClient{$request({type:f,input:p,path:y,context:b={}}){return createChain({links:this.links,op:{id:++this.requestId,type:f,path:y,input:p,context:b}}).pipe(share())}requestAsPromise(f){const p=this.$request(f),{promise:y,abort:b}=observableToPromise(p);return new Promise((_,v)=>{var I;(I=f.signal)==null||I.addEventListener("abort",b),y.then(S=>{_(S.result.data)}).catch(S=>{v(TRPCClientError.from(S))})})}query(f,p,y){return this.requestAsPromise({type:"query",path:f,input:p,context:y==null?void 0:y.context,signal:y==null?void 0:y.signal})}mutation(f,p,y){return this.requestAsPromise({type:"mutation",path:f,input:p,context:y==null?void 0:y.context,signal:y==null?void 0:y.signal})}subscription(f,p,y){return this.$request({type:"subscription",path:f,input:p,context:y==null?void 0:y.context}).subscribe({next(E){var _,v,I;E.result.type==="started"?(_=y.onStarted)==null||_.call(y):E.result.type==="stopped"?(v=y.onStopped)==null||v.call(y):(I=y.onData)==null||I.call(y,E.result.data)},error(E){var _;(_=y.onError)==null||_.call(y,E)},complete(){var E;(E=y.onComplete)==null||E.call(y)}})}constructor(f){this.requestId=0;const p=(()=>{const y=f.transformer;return y?"input"in y?f.transformer:{input:y,output:y}:{input:{serialize:b=>b,deserialize:b=>b},output:{serialize:b=>b,deserialize:b=>b}}})();this.runtime={transformer:{serialize:y=>p.input.serialize(y),deserialize:y=>p.output.deserialize(y)},combinedTransformer:p},this.links=f.links.map(y=>y(this.runtime))}}const clientCallTypeMap={query:"query",mutate:"mutation",subscribe:"subscription"},clientCallTypeToProcedureType=m=>clientCallTypeMap[m];function createTRPCClientProxy(m){return createFlatProxy(f=>m.hasOwnProperty(f)?m[f]:createRecursiveProxy(({path:p,args:y})=>{const b=[f,...p],E=clientCallTypeToProcedureType(b.pop()),_=b.join(".");return m[E](_,...y)}))}function createTRPCProxyClient(m){const f=new TRPCUntypedClient(m);return createTRPCClientProxy(f)}var go;const{sync,search:search$1,streams,expand,desource,transcribe}=createTRPCProxyClient({links:[(go=globalThis.localStorage)!=null&&go.getItem("remote")?wsLink({client:createWSClient({url:()=>localStorage.getItem("remote")})}):()=>()=>observable(()=>{})]}),{playlists,resources,preceding,playback,upcoming,settings,history,artists,library,albums,tracks,update,feed}=connect({name:"library.db",push:sync.push.mutate,pull:sync.pull.subscribe}),search=writable(""),extra=writable(null);function format(m,f=!1){if(!f){m=Math.round(+m),m<=0&&(m=0);const v=~~(m/3600);m-=v*3600;const I=~~(m/60);m-=I*60;const S=m,C=W=>W.toString().padStart(2,"0");return v?`${v}:${C(I)}:${C(S)}`:`${I}:${C(S)}`}const p=new Intl.RelativeTimeFormat("en"),y=Math.floor((Date.now()-+m)/1e3),b=Math.floor(y/60),E=Math.floor(b/60),_=Math.floor(E/24);return y<=1?"just now":y<60?p.format(-y,"seconds"):b<60?p.format(-b,"minutes"):E<24?p.format(-E,"hours"):p.format(-_,"days")}function compare(m){const f=new Date;return+m>+f?"In The Future":m.getFullYear()===f.getFullYear()?m.getMonth()===f.getMonth()?f.getDate()-m.getDate()===0?"Today":f.getDate()-m.getDate()===1?"Yesterday":f.getDate()-m.getDate()<7&&f.getDay()>m.getDay()?"This Week":f.getDate()-m.getDate()<7||f.getDate()-m.getDate()<14&&f.getDay()>=m.getDay()?"Last Week":"This Month":f.getMonth()-m.getMonth()===1?"Last Month":`In ${m.toLocaleString("default",{month:"long"})}`:m.getFullYear().toString()}const get_default_slot_changes=m=>({}),get_default_slot_context=m=>({slot:"after"});function create_default_slot_6(m){let f;return{c(){f=text(m[4])},l(p){f=claim_text(p,m[4])},m(p,y){insert_hydration(p,f,y)},p(p,y){y&16&&set_data(f,p[4])},d(p){p&&detach(f)}}}function create_default_slot_5(m){let f,p,y,b;return y=new Text({props:{secondary:!0,$$slots:{default:[create_default_slot_6]},$$scope:{ctx:m}}}),{c(){f=text(m[5]),p=space(),create_component(y.$$.fragment)},l(E){f=claim_text(E,m[5]),p=claim_space(E),claim_component(y.$$.fragment,E)},m(E,_){insert_hydration(E,f,_),insert_hydration(E,p,_),mount_component(y,E,_),b=!0},p(E,_){(!b||_&32)&&set_data(f,E[5]);const v={};_&1040&&(v.$$scope={dirty:_,ctx:E}),y.$set(v)},i(E){b||(transition_in(y.$$.fragment,E),b=!0)},o(E){transition_out(y.$$.fragment,E),b=!1},d(E){E&&detach(f),E&&detach(p),destroy_component(y,E)}}}function create_default_slot_4(m){var y;let f=((y=m[3])==null?void 0:y.artists.map(func).join(", "))+"",p;return{c(){p=text(f)},l(b){p=claim_text(b,f)},m(b,E){insert_hydration(b,p,E)},p(b,E){var _;E&8&&f!==(f=((_=b[3])==null?void 0:_.artists.map(func).join(", "))+"")&&set_data(p,f)},d(b){b&&detach(p)}}}function create_if_block(m){let f,p;return f=new When({props:{lg:!0,$$slots:{default:[create_default_slot_2]},$$scope:{ctx:m}}}),{c(){create_component(f.$$.fragment)},l(y){claim_component(f.$$.fragment,y)},m(y,b){mount_component(f,y,b),p=!0},p(y,b){const E={};b&1032&&(E.$$scope={dirty:b,ctx:y}),f.$set(E)},i(y){p||(transition_in(f.$$.fragment,y),p=!0)},o(y){transition_out(f.$$.fragment,y),p=!1},d(y){destroy_component(f,y)}}}function create_default_slot_3(m){var y;let f=((y=m[3])==null?void 0:y.album.title)+"",p;return{c(){p=text(f)},l(b){p=claim_text(b,f)},m(b,E){insert_hydration(b,p,E)},p(b,E){var _;E&8&&f!==(f=((_=b[3])==null?void 0:_.album.title)+"")&&set_data(p,f)},d(b){b&&detach(p)}}}function create_default_slot_2(m){let f,p;return f=new Text({props:{secondary:!0,sm:!0,loading:!m[3],$$slots:{default:[create_default_slot_3]},$$scope:{ctx:m}}}),{c(){create_component(f.$$.fragment)},l(y){claim_component(f.$$.fragment,y)},m(y,b){mount_component(f,y,b),p=!0},p(y,b){const E={};b&8&&(E.loading=!y[3]),b&1032&&(E.$$scope={dirty:b,ctx:y}),f.$set(E)},i(y){p||(transition_in(f.$$.fragment,y),p=!0)},o(y){transition_out(f.$$.fragment,y),p=!1},d(y){destroy_component(f,y)}}}function create_default_slot_1(m){let f,p,y,b,E,_,v=`scaleX(${m[1]})`,I;f=new Text({props:{accent:!0,loading:!m[3],$$slots:{default:[create_default_slot_5]},$$scope:{ctx:m}}}),y=new Text({props:{secondary:!0,sm:!0,loading:!m[3],$$slots:{default:[create_default_slot_4]},$$scope:{ctx:m}}});let S=!m[0]&&create_if_block(m);return{c(){create_component(f.$$.fragment),p=space(),create_component(y.$$.fragment),b=space(),S&&S.c(),E=space(),_=element("div"),this.h()},l(C){claim_component(f.$$.fragment,C),p=claim_space(C),claim_component(y.$$.fragment,C),b=claim_space(C),S&&S.l(C),E=claim_space(C),_=claim_element(C,"DIV",{class:!0}),children(_).forEach(detach),this.h()},h(){attr(_,"class","absolute bottom-0 left-0 h-0.5 w-full origin-left transform-gpu bg-highlight-200 transition-transform duration-1000"),set_style(_,"transform",v)},m(C,W){mount_component(f,C,W),insert_hydration(C,p,W),mount_component(y,C,W),insert_hydration(C,b,W),S&&S.m(C,W),insert_hydration(C,E,W),insert_hydration(C,_,W),I=!0},p(C,W){const $={};W&8&&($.loading=!C[3]),W&1072&&($.$$scope={dirty:W,ctx:C}),f.$set($);const P={};W&8&&(P.loading=!C[3]),W&1032&&(P.$$scope={dirty:W,ctx:C}),y.$set(P),C[0]?S&&(group_outros(),transition_out(S,1,1,()=>{S=null}),check_outros()):S?(S.p(C,W),W&1&&transition_in(S,1)):(S=create_if_block(C),S.c(),transition_in(S,1),S.m(E.parentNode,E)),W&2&&v!==(v=`scaleX(${C[1]})`)&&set_style(_,"transform",v)},i(C){I||(transition_in(f.$$.fragment,C),transition_in(y.$$.fragment,C),transition_in(S),I=!0)},o(C){transition_out(f.$$.fragment,C),transition_out(y.$$.fragment,C),transition_out(S),I=!1},d(C){destroy_component(f,C),C&&detach(p),destroy_component(y,C),C&&detach(b),S&&S.d(C),C&&detach(E),C&&detach(_)}}}function create_default_slot(m){var E;let f,p,y=`hue-rotate(${((E=m[3])==null?void 0:E.id)||0}deg)`,b;return p=new Icon({props:{name:"note"}}),{c(){f=element("div"),create_component(p.$$.fragment),this.h()},l(_){f=claim_element(_,"DIV",{class:!0});var v=children(f);claim_component(p.$$.fragment,v),v.forEach(detach),this.h()},h(){attr(f,"class","flex h-full w-full items-center justify-center bg-gradient-to-r from-rose-400 to-red-400 text-white"),set_style(f,"filter",y)},m(_,v){insert_hydration(_,f,v),mount_component(p,f,null),b=!0},p(_,v){var I;v&8&&y!==(y=`hue-rotate(${((I=_[3])==null?void 0:I.id)||0}deg)`)&&set_style(f,"filter",y)},i(_){b||(transition_in(p.$$.fragment,_),b=!0)},o(_){transition_out(p.$$.fragment,_),b=!1},d(_){_&&detach(f),destroy_component(p)}}}function create_before_slot(m){var y,b;let f,p;return f=new Image({props:{src:m[3]?((y=m[3].album.arts)==null?void 0:y[0])||"":void 0,thumbnail:m[3]?((b=m[3].album.thumbnails)==null?void 0:b[0])||"":void 0,slot:"before",$$slots:{default:[create_default_slot]},$$scope:{ctx:m}}}),{c(){create_component(f.$$.fragment)},l(E){claim_component(f.$$.fragment,E)},m(E,_){mount_component(f,E,_),p=!0},p(E,_){var I,S;const v={};_&8&&(v.src=E[3]?((I=E[3].album.arts)==null?void 0:I[0])||"":void 0),_&8&&(v.thumbnail=E[3]?((S=E[3].album.thumbnails)==null?void 0:S[0])||"":void 0),_&1032&&(v.$$scope={dirty:_,ctx:E}),f.$set(v)},i(E){p||(transition_in(f.$$.fragment,E),p=!0)},o(E){transition_out(f.$$.fragment,E),p=!1},d(E){destroy_component(f,E)}}}function create_after_slot(m){let f;const p=m[7].default,y=create_slot(p,m,m[10],get_default_slot_context);return{c(){y&&y.c()},l(b){y&&y.l(b)},m(b,E){y&&y.m(b,E),f=!0},p(b,E){y&&y.p&&(!f||E&1024)&&update_slot_base(y,p,b,b[10],f?get_slot_changes(p,b[10],E,get_default_slot_changes):get_all_dirty_from_scope(b[10]),get_default_slot_context)},i(b){f||(transition_in(y,b),f=!0)},o(b){transition_out(y,b),f=!1},d(b){y&&y.d(b)}}}function create_fragment(m){let f,p;return f=new Card({props:{sm:!0,flat:!0,flow:!m[0],interactive:!0,selected:m[2],$$slots:{after:[create_after_slot],before:[create_before_slot],default:[create_default_slot_1]},$$scope:{ctx:m}}}),f.$on("contextmenu",m[8]),f.$on("click",m[9]),{c(){create_component(f.$$.fragment)},l(y){claim_component(f.$$.fragment,y)},m(y,b){mount_component(f,y,b),p=!0},p(y,[b]){const E={};b&1&&(E.flow=!y[0]),b&4&&(E.selected=y[2]),b&1083&&(E.$$scope={dirty:b,ctx:y}),f.$set(E)},i(y){p||(transition_in(f.$$.fragment,y),p=!0)},o(y){transition_out(f.$$.fragment,y),p=!1},d(y){destroy_component(f,y)}}}const func=m=>m.title;function instance(m,f,p){let y,b,E,{$$slots:_={},$$scope:v}=f,{sm:I=!1}=f,{progress:S=0}=f,{selected:C=!1}=f,{track:W=void 0}=f;function $(U){bubble.call(this,m,U)}function P(U){bubble.call(this,m,U)}return m.$$set=U=>{"sm"in U&&p(0,I=U.sm),"progress"in U&&p(1,S=U.progress),"selected"in U&&p(2,C=U.selected),"track"in U&&p(3,W=U.track),"$$scope"in U&&p(10,v=U.$$scope)},m.$$.update=()=>{m.$$.dirty&8&&p(5,[y=void 0,...b]=(W==null?void 0:W.title.split("("))||[],y,(p(6,b),p(3,W))),m.$$.dirty&64&&p(4,E=b.length?"("+b.join("("):"")},[I,S,C,W,E,y,b,_,$,P,v]}class Track extends SvelteComponent{constructor(f){super(),init$1(this,f,instance,create_fragment,safe_not_equal,{sm:0,progress:1,selected:2,track:3})}}export{Card as C,Image as I,Portal as P,Realm as R,Track as T,Virtual as V,When as W,streams as a,search$1 as b,capitalize as c,albums as d,extra as e,artists as f,expand as g,history as h,initRealm as i,playback as j,feed as k,library as l,intersection as m,Text as n,format as o,playlists as p,hold as q,ready as r,search as s,tracks as t,compare as u,upcoming as v,desource as w};
