var ca=Object.defineProperty;var Lo=r=>{throw TypeError(r)};var da=(r,e,t)=>e in r?ca(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var oe=(r,e,t)=>da(r,typeof e!="symbol"?e+"":e,t),Ui=(r,e,t)=>e.has(r)||Lo("Cannot "+t);var i=(r,e,t)=>(Ui(r,e,"read from private field"),t?t.call(r):e.get(r)),I=(r,e,t)=>e.has(r)?Lo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),x=(r,e,t,n)=>(Ui(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),G=(r,e,t)=>(Ui(r,e,"access private method"),t);import{T as run_all,s as safe_not_equal,y as create_slot,e as element,c as claim_element,b as children,f as detach,r as attr,D as toggle_class,i as insert_hydration,z as update_slot_base,A as get_all_dirty_from_scope,B as get_slot_changes,W as setContext,C as empty$1,n as noop$2,G as getContext,a as space,g as claim_space,K as set_style,h as append_hydration,F as listen,S as action_destroyer,k as component_subscribe,H as createEventDispatcher,q as onMount,N as tick,m as set_store_value,v as binding_callbacks,ab as compute_slots,I as assign$1,J as set_dynamic_element_data,x as bubble,af as src_url_equal,p as get_store_value,t as text,d as claim_text,j as set_data}from"./scheduler.DDjrWeav.js";import{b as transition_out,t as transition_in,S as SvelteComponent,i as init$1,g as group_outros,e as check_outros,c as create_component,a as claim_component,m as mount_component,d as destroy_component}from"./index.BWfIHt0K.js";import{w as writable,d as derived}from"./entry.DAW7C869.js";import{l as lock,b as unlock,a as getScrollParent,p as position$1,I as Icon,g as get_spread_update}from"./Spinner.svelte_svelte_type_style_lang.2WZ8O2CZ.js";const globals=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ensure_array_like(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function outro_and_destroy_block(r,e){transition_out(r,1,1,()=>{e.delete(r.key)})}function update_keyed_each(r,e,t,n,o,a,l,d,h,p,m,E){let A=r.length,L=a.length,S=A;const N={};for(;S--;)N[r[S].key]=S;const w=[],b=new Map,g=new Map,C=[];for(S=L;S--;){const F=E(o,a,S),fe=t(F);let $=l.get(fe);$?C.push(()=>$.p(F,e)):($=p(fe,F),$.c()),b.set(fe,w[S]=$),fe in N&&g.set(fe,Math.abs(S-N[fe]))}const k=new Set,X=new Set;function T(F){transition_in(F,1),F.m(d,m),l.set(F.key,F),m=F.first,L--}for(;A&&L;){const F=w[L-1],fe=r[A-1],$=F.key,K=fe.key;F===fe?(m=F.first,A--,L--):b.has(K)?!l.has($)||k.has($)?T(F):X.has(K)?A--:g.get($)>g.get(K)?(X.add($),T(F)):(k.add(K),A--):(h(fe,l),A--)}for(;A--;){const F=r[A];b.has(F.key)||h(F,l)}for(;L;)T(w[L-1]);return run_all(C),w}let observing=0,observer=null;const dispatch=r=>r.forEach(e=>{var t;(t=e.target)==null||t.dispatchEvent(new CustomEvent("resize",{detail:e}))});function resize(r){return observer||(observer=new ResizeObserver(dispatch)),observer.observe(r),observing+=1,{destroy(){observer==null||observer.unobserve(r),observing-=1,observing<=0&&(observer==null||observer.disconnect(),observer=null)}}}function drag(r,e="touchstart"){function t(l){do{if(l!=null&&l.draggable)return l;l=(l==null?void 0:l.parentElement)||null}while(l);return null}function n(l){const d=t(l.target);d&&(lock(),l.preventDefault(),d.dispatchEvent(new DragEvent("dragstart",{bubbles:!0})))}function o(l){l.preventDefault(),addEventListener("pointercancel",a),addEventListener("pointerup",a)}function a(){unlock(),removeEventListener("pointercancel",a),removeEventListener("pointerup",a),r.dispatchEvent(new DragEvent("dragend",{bubbles:!0}))}return r.addEventListener(e,n),r.addEventListener("dragstart",o),{destroy(){r.removeEventListener(e,n),r.removeEventListener("dragstart",o)}}}function hold(r,{touch:e=!0,mouse:t=!1,duration:n=300}={}){function o(a){const l=setTimeout(()=>{var p;d();const h=a instanceof TouchEvent?TouchEvent:MouseEvent;(p=a.target)==null||p.dispatchEvent(new h("hold",a))},n),d=()=>{clearTimeout(l),e&&(r.removeEventListener("touchcancel",d),r.removeEventListener("touchmove",d),r.removeEventListener("touchend",d)),t&&(r.removeEventListener("mousemove",d),r.removeEventListener("mouseup",d))};e&&(r.addEventListener("touchcancel",d,{once:!0}),r.addEventListener("touchend",d,{once:!0}),r.addEventListener("touchmove",d,{once:!0,passive:!0})),t&&(r.addEventListener("mousemove",d,{once:!0}),r.addEventListener("mouseup",d,{once:!0}))}return e&&r.addEventListener("touchstart",o,{passive:!0}),t&&r.addEventListener("mousedown",o),{destroy(){r.removeEventListener("touchstart",o),r.removeEventListener("mousedown",o)}}}function create_fragment$7(r){let e,t,n;const o=r[6].default,a=create_slot(o,r,r[5],null);return{c(){e=element("div"),a&&a.c(),this.h()},l(l){e=claim_element(l,"DIV",{class:!0});var d=children(e);a&&a.l(d),d.forEach(detach),this.h()},h(){attr(e,"class",t=r[0]?"contents":"hidden"),toggle_class(e,"sm:contents",!r[0]&&r[1]),toggle_class(e,"md:contents",!r[0]&&r[2]),toggle_class(e,"lg:contents",!r[0]&&r[3]),toggle_class(e,"xl:contents",!r[0]&&r[4]),toggle_class(e,"sm:hidden",r[0]&&r[1]),toggle_class(e,"md:hidden",r[0]&&r[2]),toggle_class(e,"lg:hidden",r[0]&&r[3]),toggle_class(e,"xl:hidden",r[0]&&r[4])},m(l,d){insert_hydration(l,e,d),a&&a.m(e,null),n=!0},p(l,[d]){a&&a.p&&(!n||d&32)&&update_slot_base(a,o,l,l[5],n?get_slot_changes(o,l[5],d,null):get_all_dirty_from_scope(l[5]),null),(!n||d&1&&t!==(t=l[0]?"contents":"hidden"))&&attr(e,"class",t),(!n||d&3)&&toggle_class(e,"sm:contents",!l[0]&&l[1]),(!n||d&5)&&toggle_class(e,"md:contents",!l[0]&&l[2]),(!n||d&9)&&toggle_class(e,"lg:contents",!l[0]&&l[3]),(!n||d&17)&&toggle_class(e,"xl:contents",!l[0]&&l[4]),(!n||d&3)&&toggle_class(e,"sm:hidden",l[0]&&l[1]),(!n||d&5)&&toggle_class(e,"md:hidden",l[0]&&l[2]),(!n||d&9)&&toggle_class(e,"lg:hidden",l[0]&&l[3]),(!n||d&17)&&toggle_class(e,"xl:hidden",l[0]&&l[4])},i(l){n||(transition_in(a,l),n=!0)},o(l){transition_out(a,l),n=!1},d(l){l&&detach(e),a&&a.d(l)}}}function instance$8(r,e,t){let{$$slots:n={},$$scope:o}=e,{not:a=!1}=e,{sm:l=!1}=e,{md:d=!1}=e,{lg:h=!1}=e,{xl:p=!1}=e;return r.$$set=m=>{"not"in m&&t(0,a=m.not),"sm"in m&&t(1,l=m.sm),"md"in m&&t(2,d=m.md),"lg"in m&&t(3,h=m.lg),"xl"in m&&t(4,p=m.xl),"$$scope"in m&&t(5,o=m.$$scope)},[a,l,d,h,p,o,n]}class When extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$8,create_fragment$7,safe_not_equal,{not:0,sm:1,md:2,lg:3,xl:4})}}function create_fragment$6(r){let e;const t=r[1].default,n=create_slot(t,r,r[0],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,[a]){n&&n.p&&(!e||a&1)&&update_slot_base(n,t,o,o[0],e?get_slot_changes(t,o[0],a,null):get_all_dirty_from_scope(o[0]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}const initRealm=()=>({ssr:"",claimed:new Set,mounted:new Set,claim:new Set,destroy:new Set,mount:new Set,target:void 0});function instance$7(r,e,t){let{$$slots:n={},$$scope:o}=e;return setContext("realm",{}),r.$$set=l=>{"$$scope"in l&&t(0,o=l.$$scope)},[o,n]}class Realm extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$7,create_fragment$6,safe_not_equal,{})}}function create_key_block(r){let e;const t=r[4].default,n=create_slot(t,r,r[3],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,a){n&&n.p&&(!e||a&8)&&update_slot_base(n,t,o,o[3],e?get_slot_changes(t,o[3],a,null):get_all_dirty_from_scope(o[3]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_fragment$5(r){let e=r[0],t,n,o=create_key_block(r);return{c(){o.c(),t=empty$1()},l(a){o.l(a),t=empty$1()},m(a,l){o.m(a,l),insert_hydration(a,t,l),n=!0},p(a,[l]){l&1&&safe_not_equal(e,e=a[0])?(group_outros(),transition_out(o,1,1,noop$2),check_outros(),o=create_key_block(a),o.c(),transition_in(o,1),o.m(t.parentNode,t)):o.p(a,l)},i(a){n||(transition_in(o),n=!0)},o(a){transition_out(o),n=!1},d(a){a&&detach(t),o.d(a)}}}function instance$6($$self,$$props,$$invalidate){let{$$slots:slots={},$$scope}=$$props,{to=""}=$$props,{unique=""}=$$props;const realm=getContext("realm");if(!realm)throw new Error("A portal should exists within a realm!");realm[to]||(realm[to]=initRealm());const target=eval("slots");if(target.default){const[r]=target.default;target.default[0]=(...e)=>{const t=r(...e),n=realm[to];let o=!0,a=!0;function l(p){if(!p||n.claimed.has(unique))return a=!1;t.l(p),unique&&n.claimed.add(unique)}function d(p,m){if(n.mounted.has(unique))return o=!1;a&&t.m(p,m),unique&&n.mounted.add(unique)}function h(p){o&&n.mounted.delete(unique),a&&n.claimed.delete(unique),o&&t.d(p),n.claim.delete(l),n.mount.delete(d),n.destroy.delete(h)}return n.claim.add(l),n.mount.add(d),n.destroy.add(h),{...t,d:h,l:()=>{},m:()=>n.target&&d.apply(null,n.target)}}}return $$self.$$set=r=>{"to"in r&&$$invalidate(0,to=r.to),"unique"in r&&$$invalidate(1,unique=r.unique),"$$scope"in r&&$$invalidate(3,$$scope=r.$$scope)},$$self.$$.update=()=>{$$self.$$.dirty&5&&(realm[to]||$$invalidate(2,realm[to]=initRealm(),realm))},[to,unique,realm,$$scope,slots]}class Portal extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$6,create_fragment$5,safe_not_equal,{to:0,unique:1})}}function minmax(r,e,t,n){return r<e?n??e:r>t?n??t:r}const{Map:Map_1,window:window_1}=globals,get_default_slot_changes_1=r=>({item:r[0]&2048}),get_default_slot_context_1=r=>({item:r[11].data,index:NaN});function get_each_context(r,e,t){const n=r.slice();return n[52]=e[t],n[54]=t,n}const get_default_slot_changes$1=r=>({item:r[0]&16384,index:r[0]&16640}),get_default_slot_context$1=r=>({item:r[52],index:r[8]+r[54]});function create_each_block(r,e){let t,n,o,a;const l=e[40].default,d=create_slot(l,e,e[42],get_default_slot_context$1);return{key:r,first:null,c(){t=element("div"),d&&d.c(),n=space(),this.h()},l(h){t=claim_element(h,"DIV",{draggable:!0,style:!0});var p=children(t);d&&d.l(p),n=claim_space(p),p.forEach(detach),this.h()},h(){var h,p;attr(t,"draggable",o=e[2]&&e[1](e[52])!=null?"true":void 0),set_style(t,"overflow-anchor","none"),toggle_class(t,"invisible",((h=e[11])==null?void 0:h.owner)===e[3]&&((p=e[11])==null?void 0:p.key)===e[1](e[52])),this.first=t},m(h,p){insert_hydration(h,t,p),d&&d.m(t,null),append_hydration(t,n),a=!0},p(h,p){var m,E;e=h,d&&d.p&&(!a||p[0]&16640|p[1]&2048)&&update_slot_base(d,l,e,e[42],a?get_slot_changes(l,e[42],p,get_default_slot_changes$1):get_all_dirty_from_scope(e[42]),get_default_slot_context$1),(!a||p[0]&16390&&o!==(o=e[2]&&e[1](e[52])!=null?"true":void 0))&&attr(t,"draggable",o),(!a||p[0]&18442)&&toggle_class(t,"invisible",((m=e[11])==null?void 0:m.owner)===e[3]&&((E=e[11])==null?void 0:E.key)===e[1](e[52]))},i(h){a||(transition_in(d,h),a=!0)},o(h){transition_out(d,h),a=!1},d(h){h&&detach(t),d&&d.d(h)}}}function create_if_block$3(r){let e,t;return e=new Portal({props:{to:"overlay",$$slots:{default:[create_default_slot$1]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const a={};o[0]&2297|o[1]&2048&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_1$2(r){let e,t=`translate3d(
          ${r[11].back?r[11].back.x:r[7].x+Math.max(r[11].offset.x,-r[4].width/r[6]+r[0])}px,
          ${r[11].back?r[11].back.y:r[7].y+Math.max(r[11].offset.y,-r[5]+r[0])}px, 0)`,n=`${r[4].width/r[6]-r[0]}px`,o=`${r[5]-r[0]}px`,a;const l=r[40].default,d=create_slot(l,r,r[42],get_default_slot_context_1);return{c(){e=element("div"),d&&d.c(),this.h()},l(h){e=claim_element(h,"DIV",{class:!0});var p=children(e);d&&d.l(p),p.forEach(detach),this.h()},h(){attr(e,"class","absolute will-change-transform contain-[size_layout]"),toggle_class(e,"transition-transform",r[11].back),set_style(e,"transform",t),set_style(e,"width",n),set_style(e,"height",o)},m(h,p){insert_hydration(h,e,p),d&&d.m(e,null),a=!0},p(h,p){d&&d.p&&(!a||p[0]&2048|p[1]&2048)&&update_slot_base(d,l,h,h[42],a?get_slot_changes(l,h[42],p,get_default_slot_changes_1):get_all_dirty_from_scope(h[42]),get_default_slot_context_1),(!a||p[0]&2048)&&toggle_class(e,"transition-transform",h[11].back),p[0]&2289&&t!==(t=`translate3d(
          ${h[11].back?h[11].back.x:h[7].x+Math.max(h[11].offset.x,-h[4].width/h[6]+h[0])}px,
          ${h[11].back?h[11].back.y:h[7].y+Math.max(h[11].offset.y,-h[5]+h[0])}px, 0)`)&&set_style(e,"transform",t),p[0]&81&&n!==(n=`${h[4].width/h[6]-h[0]}px`)&&set_style(e,"width",n),p[0]&33&&o!==(o=`${h[5]-h[0]}px`)&&set_style(e,"height",o)},i(h){a||(transition_in(d,h),a=!0)},o(h){transition_out(d,h),a=!1},d(h){h&&detach(e),d&&d.d(h)}}}function create_default_slot$1(r){var o;let e,t,n=((o=r[11])==null?void 0:o.owner)===r[3]&&create_if_block_1$2(r);return{c(){n&&n.c(),e=empty$1()},l(a){n&&n.l(a),e=empty$1()},m(a,l){n&&n.m(a,l),insert_hydration(a,e,l),t=!0},p(a,l){var d;((d=a[11])==null?void 0:d.owner)===a[3]?n?(n.p(a,l),l[0]&2056&&transition_in(n,1)):(n=create_if_block_1$2(a),n.c(),transition_in(n,1),n.m(e.parentNode,e)):n&&(group_outros(),transition_out(n,1,1,()=>{n=null}),check_outros())},i(a){t||(transition_in(n),t=!0)},o(a){transition_out(n),t=!1},d(a){a&&detach(e),n&&n.d(a)}}}function create_fragment$4(r){let e,t,n=[],o=new Map_1,a=`translate3d(0,${Math.ceil(r[8]/r[6])*r[5]}px,0)`,l=`${r[0]}px`,d,h=`${r[10]}px`,p,m,E,A=ensure_array_like(r[14]);const L=N=>N[12][(N[8]+N[54])%N[9]]??N[54];for(let N=0;N<A.length;N+=1){let w=get_each_context(r,A,N),b=L(w);o.set(b,n[N]=create_each_block(b,w))}let S=r[2]&&create_if_block$3(r);return{c(){e=element("div"),t=element("div");for(let N=0;N<n.length;N+=1)n[N].c();d=space(),S&&S.c(),this.h()},l(N){e=claim_element(N,"DIV",{class:!0});var w=children(e);t=claim_element(w,"DIV",{class:!0});var b=children(t);for(let g=0;g<n.length;g+=1)n[g].l(b);b.forEach(detach),d=claim_space(w),S&&S.l(w),w.forEach(detach),this.h()},h(){attr(t,"class","grid auto-rows-max will-change-transform contain-layout"),toggle_class(t,"pointer-events-none",!!r[11]),set_style(t,"transform",a),set_style(t,"grid-template-columns",r[13]),set_style(t,"gap",l),attr(e,"class","shrink-0 contain-[size_layout]"),set_style(e,"height",h)},m(N,w){insert_hydration(N,e,w),append_hydration(e,t);for(let b=0;b<n.length;b+=1)n[b]&&n[b].m(t,null);r[41](t),append_hydration(e,d),S&&S.m(e,null),p=!0,m||(E=[listen(window_1,"dragstart",r[15]),listen(window_1,"dragend",r[16]),action_destroyer(drag.call(null,t,"hold")),action_destroyer(hold.call(null,t))],m=!0)},p(N,w){w[0]&23310|w[1]&2048&&(A=ensure_array_like(N[14]),group_outros(),n=update_keyed_each(n,w,L,1,N,A,o,t,outro_and_destroy_block,create_each_block,null,get_each_context),check_outros()),(!p||w[0]&2048)&&toggle_class(t,"pointer-events-none",!!N[11]),w[0]&352&&a!==(a=`translate3d(0,${Math.ceil(N[8]/N[6])*N[5]}px,0)`)&&set_style(t,"transform",a),w[0]&8192&&set_style(t,"grid-template-columns",N[13]),w[0]&1&&l!==(l=`${N[0]}px`)&&set_style(t,"gap",l),N[2]?S?(S.p(N,w),w[0]&4&&transition_in(S,1)):(S=create_if_block$3(N),S.c(),transition_in(S,1),S.m(e,null)):S&&(group_outros(),transition_out(S,1,1,()=>{S=null}),check_outros()),w[0]&1024&&h!==(h=`${N[10]}px`)&&set_style(e,"height",h)},i(N){if(!p){for(let w=0;w<A.length;w+=1)transition_in(n[w]);transition_in(S),p=!0}},o(N){for(let w=0;w<n.length;w+=1)transition_out(n[w]);transition_out(S),p=!1},d(N){N&&detach(e);for(let w=0;w<n.length;w+=1)n[w].d();r[41](null),S&&S.d(),m=!1,run_all(E)}}}let transfer=writable(null);function instance$5(r,e,t){let n,o,a,l,d,h,p,m,E,A,L,S,N,w,b,g,C,k,X,T;component_subscribe(r,transfer,V=>t(11,T=V));let{$$slots:F={},$$scope:fe}=e;const $=createEventDispatcher();let{gap:K=0}=e,{items:Q}=e,{move:te=!1}=e,{fixed:ue=!1}=e,{overthrow:Y=1}=e,{prerender:be=1}=e,{columns:Ae=1}=e,{key:M=V=>V}=e,{animate:ne=!1}=e,{sortable:we=!1}=e,{container:Te=void 0}=e,le=null,rt={x:0,y:0},dt=new DOMRect,nt=new DOMRect,Xt=!0,Yt=1,J=0,Ee=0;function Kn(V){!A&&V.length&&tick().then(Ce);const me=new Map,Re=Array.from({length:m}),qe=new Set(E);for(let Be=0;Be<V.length;Be++){const dr=M(V[Be]);if(dr==null||(me.set(dr,Be),Be<d||Be>=h))continue;const bt=A==null?void 0:A.get(dr);if(bt==null||bt<d||bt>=h||(Re[Be%m]=E[bt%m],qe.delete(E[bt%m]),bt===Be||!ne)||(T==null?void 0:T.owner)===le&&dr===(T==null?void 0:T.key))continue;const Ci=~~(bt/J)-~~(Be/J),Ri=~~(bt%J)-~~(Be%J);Qr(bt,Ri,Ci)}const Je=[...qe];return t(12,E=Re.map(Be=>Be??Je.shift())),me}function Qr(V,me,Re){const qe=le==null?void 0:le.children.item(V-d),Je=[`translate3d(${me*100}%,${Re*100}%,0)`,"translate3d(0,0,0)"];qe==null||qe.animate({transform:Je,zIndex:["100","100"]},{easing:"ease",composite:"accumulate",duration:L})}function Ce(){var qe;if(!Te||!le)return;t(4,nt=(qe=le.parentElement)==null?void 0:qe.getBoundingClientRect()),t(26,dt=Te.getBoundingClientRect()),t(4,nt.y+=rt.y,nt),t(28,Ee=nt.y-dt.y-dt.height/2),t(4,nt.width+=K,nt);const V=le.firstElementChild;if(!V)return;const{width:me,height:Re}=V.getBoundingClientRect();!me||!Re||(t(6,J=~~(nt.width/(me+K))),t(5,Yt=Re+K))}let Me,kt,se={x:0,y:0};async function Gn({target:V}){if(Ce(),await tick(),!we||!le||!V||T||V.parentElement!==le||Q[X]==null||M(Q[X])==null)return;kt=X,Me=te?-1:kt;const me=V.getBoundingClientRect();me.x-=se.x,me.y-=se.y,set_store_value(transfer,T={group:we===!0?le:we,key:M(Q[X]),data:Q[X],owner:le,offset:me},T)}function gt(V,me=!1){if(!we||!T||ue||M(Q[V])==null)return;if(!Number.isInteger(V)){Me!=null&&T.owner!==le&&(gt(Me,!0),Me=void 0);return}if(M(Q[V])===T.key)return;V<0&&!Q.length&&(V=0);const Re=Q.findIndex(qe=>M(qe)===(T==null?void 0:T.key));Re!==V&&(!me&&Me==null&&(Me=Re,kt=Re),~Re&&Q.splice(Re,1),~V&&Q.splice(V,0,T.data),requestAnimationFrame(()=>t(17,Q))),!me&&le&&set_store_value(transfer,T.owner=le,T)}async function vi(){if(!we||!T||kt==null)return;const V=Q.findIndex(me=>M(me)===(T==null?void 0:T.key));if(T.owner===le&&~V){const me=le.children.item(V-d);me&&(set_store_value(transfer,T.back=me.getBoundingClientRect(),T),set_store_value(transfer,T.group=Math.random().toString(),T),await new Promise(Re=>setTimeout(Re,150)))}if(kt!==V){const me=T.data,Re=Q[V-1],qe=(+!!~kt<<1)+ +!!~V,Je=[void 0,"push","purge","rearrange"][qe];Je&&$("edit",{action:Je,index:V,after:Re,item:me})}kt=void 0,Me=void 0,T.owner===le&&set_store_value(transfer,T=null,T)}onMount(()=>{function V(qe){const Je=qe.currentTarget;t(25,rt.x=Je.scrollLeft,rt),t(25,rt.y=Je.scrollTop,rt)}Te||t(18,Te=getScrollParent(le));const me=we&&position$1.subscribe(qe=>t(7,se=qe));Te.addEventListener("scroll",V,{passive:!0}),Te.addEventListener("resize",Ce);const{destroy:Re}=resize(Te);return t(27,Xt=!1),()=>{Te==null||Te.removeEventListener("scroll",V),Te==null||Te.removeEventListener("resize",Ce),me&&me(),Re()}});function zr(V){binding_callbacks[V?"unshift":"push"](()=>{le=V,t(3,le)})}return r.$$set=V=>{"gap"in V&&t(0,K=V.gap),"items"in V&&t(17,Q=V.items),"move"in V&&t(19,te=V.move),"fixed"in V&&t(20,ue=V.fixed),"overthrow"in V&&t(21,Y=V.overthrow),"prerender"in V&&t(22,be=V.prerender),"columns"in V&&t(23,Ae=V.columns),"key"in V&&t(1,M=V.key),"animate"in V&&t(24,ne=V.animate),"sortable"in V&&t(2,we=V.sortable),"container"in V&&t(18,Te=V.container),"$$scope"in V&&t(42,fe=V.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&67108960&&t(38,n=Math.ceil(dt.height/Yt)*J),r.$$.dirty[0]&96|r.$$.dirty[1]&128&&t(39,o=n/J*Yt),r.$$.dirty[0]&131072|r.$$.dirty[1]&128&&t(36,a=Math.max(Math.ceil(Q.length/n)-2,1)),r.$$.dirty[0]&301989888|r.$$.dirty[1]&288&&t(37,l=minmax(~~((rt.y-Ee)/o),1,a)),r.$$.dirty[0]&2097152|r.$$.dirty[1]&192&&t(8,d=Math.max(l-Y,0)*n),r.$$.dirty[0]&6291456|r.$$.dirty[1]&192&&t(35,h=Math.max((l+Y+1)*n,be)),r.$$.dirty[0]&131328|r.$$.dirty[1]&16&&t(14,p=Q.slice(d,h)),r.$$.dirty[0]&2097152|r.$$.dirty[1]&128&&t(9,m=(Y*2+1)*n),r.$$.dirty[0]&512&&t(12,E=Array.from({length:m}).map((V,me)=>me)),r.$$.dirty[0]&131072&&(A=Kn(Q)),r.$$.dirty[0]&16777216&&(L=ne===!0?300:ne||0),r.$$.dirty[0]&131169&&t(10,S=Math.ceil(Q.length/J)*Yt-K),r.$$.dirty[0]&8388608&&t(13,N=Number.isInteger(Ae)?`repeat(${Ae},1fr)`:`repeat(auto-fill,minmax(min(100%,${Ae}),1fr))`),r.$$.dirty[0]&1024&&Number.isFinite(S)&&(requestAnimationFrame(Ce),t(27,Xt=!1)),r.$$.dirty[0]&134217728|r.$$.dirty[1]&96&&!Xt&&l===a&&($("end"),t(27,Xt=!0)),r.$$.dirty[0]&12&&t(30,w=we===!0?le:we),r.$$.dirty[0]&100663441&&t(34,b=minmax(se.y+K/2,dt.top,dt.bottom,NaN)+rt.y-nt.y),r.$$.dirty[0]&33554577&&t(33,g=minmax(se.x+K/2,nt.left,nt.right-K-1,NaN)+rt.x-nt.x),r.$$.dirty[0]&32|r.$$.dirty[1]&8&&t(32,C=Math.floor(b/Yt)),r.$$.dirty[0]&80|r.$$.dirty[1]&4&&t(31,k=Math.floor(g/(nt.width/J))),r.$$.dirty[0]&131136|r.$$.dirty[1]&3&&t(29,X=minmax(C*J+k,0,Q.length-1)),r.$$.dirty[0]&1610614784&&(T==null?void 0:T.group)===w&&gt(X)},[K,M,we,le,nt,Yt,J,se,d,m,S,T,E,N,p,Gn,vi,Q,Te,te,ue,Y,be,Ae,ne,rt,dt,Xt,Ee,X,w,k,C,g,b,h,a,l,n,o,F,zr,fe]}class Virtual extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$5,create_fragment$4,safe_not_equal,{gap:0,items:17,move:19,fixed:20,overthrow:21,prerender:22,columns:23,key:1,animate:24,sortable:2,container:18},null,[-1,-1])}}const get_after_slot_changes=r=>({}),get_after_slot_context=r=>({}),get_before_slot_changes=r=>({}),get_before_slot_context=r=>({});function create_if_block_1$1(r){let e,t;const n=r[9].before,o=create_slot(n,r,r[8],get_before_slot_context);return{c(){e=element("div"),o&&o.c(),this.h()},l(a){e=claim_element(a,"DIV",{class:!0});var l=children(e);o&&o.l(l),l.forEach(detach),this.h()},h(){attr(e,"class","z-20 flex items-center")},m(a,l){insert_hydration(a,e,l),o&&o.m(e,null),t=!0},p(a,l){o&&o.p&&(!t||l&256)&&update_slot_base(o,n,a,a[8],t?get_slot_changes(n,a[8],l,get_before_slot_changes):get_all_dirty_from_scope(a[8]),get_before_slot_context)},i(a){t||(transition_in(o,a),t=!0)},o(a){transition_out(o,a),t=!1},d(a){a&&detach(e),o&&o.d(a)}}}function create_if_block$2(r){let e;return{c(){e=element("hr"),this.h()},l(t){e=claim_element(t,"HR",{"aria-hidden":!0,class:!0}),this.h()},h(){attr(e,"aria-hidden",""),attr(e,"class","absolute bottom-0 h-[1px] w-full border-none bg-content/10 group-last-of-type:opacity-0")},m(t,n){insert_hydration(t,e,n)},d(t){t&&detach(e)}}}function create_dynamic_element(r){let e,t,n,o,a,l,d,h,p,m,E,A,L,S,N,w,b,g,C,k,X,T,F,fe,$=r[7].before&&create_if_block_1$1(r);const K=r[9].default,Q=create_slot(K,r,r[8],null);let te=r[2]&&(r[1]||r[0])&&create_if_block$2();S=new Icon({props:{name:"circle"}}),b=new Icon({props:{name:"target"}});const ue=r[9].after,Y=create_slot(ue,r,r[8],get_after_slot_context);let be=[{role:k=r[5]?"link":"button"},{tabindex:"0"},{href:r[5]},{draggable:"false"},{class:X="group relative z-10 flex w-full items-center gap-4 overflow-hidden px-4 outline-2 -outline-offset-2 outline-primary-600 contain-inline-size focus-visible:outline "+(r[4]?"cursor-pointer touch-manipulation select-none "+(r[2]?"":"transition-transform active:scale-95"):"")+" "+(r[0]?"focus-visible:z-50":r[1]?"rounded-lg py-1 focus-visible:z-50":"rounded-2xl py-4")+" "+(r[2]?"bg-surface":"bg-surface-100 shadow-[0_0_20px_-4px] shadow-black/20 dark:shadow-none")}],Ae={};for(let M=0;M<be.length;M+=1)Ae=assign$1(Ae,be[M]);return{c(){e=element(r[4]?r[5]?"a":"button":"article"),t=element("div"),n=space(),o=element("div"),l=space(),$&&$.c(),d=space(),h=element("div"),Q&&Q.c(),p=space(),te&&te.c(),E=space(),A=element("div"),L=element("div"),create_component(S.$$.fragment),N=space(),w=element("div"),create_component(b.$$.fragment),g=space(),C=element("div"),Y&&Y.c(),this.h()},l(M){e=claim_element(M,((r[4]?r[5]?"a":"button":"article")||"null").toUpperCase(),{role:!0,tabindex:!0,href:!0,draggable:!0,class:!0});var ne=children(e);t=claim_element(ne,"DIV",{"aria-hidden":!0,class:!0}),children(t).forEach(detach),n=claim_space(ne),o=claim_element(ne,"DIV",{"aria-hidden":!0,class:!0}),children(o).forEach(detach),l=claim_space(ne),$&&$.l(ne),d=claim_space(ne),h=claim_element(ne,"DIV",{class:!0});var we=children(h);Q&&Q.l(we),p=claim_space(we),te&&te.l(we),we.forEach(detach),E=claim_space(ne),A=claim_element(ne,"DIV",{class:!0});var Te=children(A);L=claim_element(Te,"DIV",{class:!0});var le=children(L);claim_component(S.$$.fragment,le),le.forEach(detach),N=claim_space(Te),w=claim_element(Te,"DIV",{class:!0});var rt=children(w);claim_component(b.$$.fragment,rt),rt.forEach(detach),g=claim_space(Te),C=claim_element(Te,"DIV",{class:!0});var dt=children(C);Y&&Y.l(dt),dt.forEach(detach),Te.forEach(detach),ne.forEach(detach),this.h()},h(){attr(t,"aria-hidden",""),attr(t,"class","pointer-events-none absolute inset-0 -z-10 bg-primary-200/30 opacity-0 transition-opacity"),toggle_class(t,"opacity-100",r[6]===!0),attr(o,"aria-hidden",""),attr(o,"class",a="pointer-events-none absolute inset-0 z-0 bg-highlight opacity-0 "+(r[4]?"group-hover:opacity-30 "+(r[2]?"dark:group-hover:opacity-50":"dark:group-hover:opacity-10"):"")),attr(h,"class",m="z-10 grid w-full grid-cols-1 items-baseline overflow-hidden contain-inline-size "+(r[1]||r[0]?"justify-start gap-0.5":"place-items-center justify-center gap-2")+" "+((r[1]||r[0])&&r[3]?"lg:auto-cols-fr lg:grid-flow-col lg:gap-4":"")),attr(L,"class","flex justify-center text-primary-600 opacity-0 transition-opacity"),toggle_class(L,"opacity-100",r[6]),attr(w,"class","flex scale-0 justify-center text-primary-600 transition-transform"),toggle_class(w,"scale-100",r[6]===!0),attr(C,"class","opacity-0 transition-opacity"),toggle_class(C,"opacity-100",!r[6]),attr(A,"class","z-20 grid items-center [&>*]:col-start-1 [&>*]:row-start-1"),set_dynamic_element_data(r[4]?r[5]?"a":"button":"article")(e,Ae)},m(M,ne){insert_hydration(M,e,ne),append_hydration(e,t),append_hydration(e,n),append_hydration(e,o),append_hydration(e,l),$&&$.m(e,null),append_hydration(e,d),append_hydration(e,h),Q&&Q.m(h,null),append_hydration(h,p),te&&te.m(h,null),append_hydration(e,E),append_hydration(e,A),append_hydration(A,L),mount_component(S,L,null),append_hydration(A,N),append_hydration(A,w),mount_component(b,w,null),append_hydration(A,g),append_hydration(A,C),Y&&Y.m(C,null),T=!0,F||(fe=[listen(e,"click",r[10]),listen(e,"contextmenu",r[11])],F=!0)},p(M,ne){(!T||ne&64)&&toggle_class(t,"opacity-100",M[6]===!0),(!T||ne&20&&a!==(a="pointer-events-none absolute inset-0 z-0 bg-highlight opacity-0 "+(M[4]?"group-hover:opacity-30 "+(M[2]?"dark:group-hover:opacity-50":"dark:group-hover:opacity-10"):"")))&&attr(o,"class",a),M[7].before?$?($.p(M,ne),ne&128&&transition_in($,1)):($=create_if_block_1$1(M),$.c(),transition_in($,1),$.m(e,d)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros()),Q&&Q.p&&(!T||ne&256)&&update_slot_base(Q,K,M,M[8],T?get_slot_changes(K,M[8],ne,null):get_all_dirty_from_scope(M[8]),null),M[2]&&(M[1]||M[0])?te||(te=create_if_block$2(),te.c(),te.m(h,null)):te&&(te.d(1),te=null),(!T||ne&11&&m!==(m="z-10 grid w-full grid-cols-1 items-baseline overflow-hidden contain-inline-size "+(M[1]||M[0]?"justify-start gap-0.5":"place-items-center justify-center gap-2")+" "+((M[1]||M[0])&&M[3]?"lg:auto-cols-fr lg:grid-flow-col lg:gap-4":"")))&&attr(h,"class",m),(!T||ne&64)&&toggle_class(L,"opacity-100",M[6]),(!T||ne&64)&&toggle_class(w,"scale-100",M[6]===!0),Y&&Y.p&&(!T||ne&256)&&update_slot_base(Y,ue,M,M[8],T?get_slot_changes(ue,M[8],ne,get_after_slot_changes):get_all_dirty_from_scope(M[8]),get_after_slot_context),(!T||ne&64)&&toggle_class(C,"opacity-100",!M[6]),set_dynamic_element_data(M[4]?M[5]?"a":"button":"article")(e,Ae=get_spread_update(be,[(!T||ne&32&&k!==(k=M[5]?"link":"button"))&&{role:k},{tabindex:"0"},(!T||ne&32)&&{href:M[5]},{draggable:"false"},(!T||ne&23&&X!==(X="group relative z-10 flex w-full items-center gap-4 overflow-hidden px-4 outline-2 -outline-offset-2 outline-primary-600 contain-inline-size focus-visible:outline "+(M[4]?"cursor-pointer touch-manipulation select-none "+(M[2]?"":"transition-transform active:scale-95"):"")+" "+(M[0]?"focus-visible:z-50":M[1]?"rounded-lg py-1 focus-visible:z-50":"rounded-2xl py-4")+" "+(M[2]?"bg-surface":"bg-surface-100 shadow-[0_0_20px_-4px] shadow-black/20 dark:shadow-none")))&&{class:X}]))},i(M){T||(transition_in($),transition_in(Q,M),transition_in(S.$$.fragment,M),transition_in(b.$$.fragment,M),transition_in(Y,M),T=!0)},o(M){transition_out($),transition_out(Q,M),transition_out(S.$$.fragment,M),transition_out(b.$$.fragment,M),transition_out(Y,M),T=!1},d(M){M&&detach(e),$&&$.d(),Q&&Q.d(M),te&&te.d(),destroy_component(S),destroy_component(b),Y&&Y.d(M),F=!1,run_all(fe)}}}function create_fragment$3(r){let e=r[4]?r[5]?"a":"button":"article",t,n,o=(r[4]?r[5]?"a":"button":"article")&&create_dynamic_element(r);return{c(){o&&o.c(),t=empty$1()},l(a){o&&o.l(a),t=empty$1()},m(a,l){o&&o.m(a,l),insert_hydration(a,t,l),n=!0},p(a,[l]){!a[4]||a[5],e?safe_not_equal(e,a[4]?a[5]?"a":"button":"article")?(o.d(1),o=create_dynamic_element(a),e=a[4]?a[5]?"a":"button":"article",o.c(),o.m(t.parentNode,t)):o.p(a,l):(o=create_dynamic_element(a),e=a[4]?a[5]?"a":"button":"article",o.c(),o.m(t.parentNode,t))},i(a){n||(transition_in(o,a),n=!0)},o(a){transition_out(o,a),n=!1},d(a){a&&detach(t),o&&o.d(a)}}}function instance$4(r,e,t){let{$$slots:n={},$$scope:o}=e;const a=compute_slots(n);let{xs:l=!1}=e,{sm:d=!1}=e,{flat:h=!1}=e,{flow:p=!1}=e,{interactive:m=!1}=e,{href:E=void 0}=e,{selected:A=!1}=e;function L(N){bubble.call(this,r,N)}function S(N){bubble.call(this,r,N)}return r.$$set=N=>{"xs"in N&&t(0,l=N.xs),"sm"in N&&t(1,d=N.sm),"flat"in N&&t(2,h=N.flat),"flow"in N&&t(3,p=N.flow),"interactive"in N&&t(4,m=N.interactive),"href"in N&&t(5,E=N.href),"selected"in N&&t(6,A=N.selected),"$$scope"in N&&t(8,o=N.$$scope)},[l,d,h,p,m,E,A,a,o,n,L,S]}class Card extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$4,create_fragment$3,safe_not_equal,{xs:0,sm:1,flat:2,flow:3,interactive:4,href:5,selected:6})}}function create_fragment$2(r){let e,t,n;const o=r[6].default,a=create_slot(o,r,r[5],null);return{c(){e=element("span"),a&&a.c(),this.h()},l(l){e=claim_element(l,"SPAN",{class:!0});var d=children(e);a&&a.l(d),d.forEach(detach),this.h()},h(){attr(e,"class",t="w-max max-w-full overflow-hidden text-ellipsis whitespace-nowrap rounded-md text-left [&>*]:align-bottom "+(r[1]?"animate-pulse bg-highlight text-transparent":"")+" "+(r[2]?"font-medium":"font-normal")),toggle_class(e,"text-content-200",r[0]),toggle_class(e,"ml-4",r[3]),toggle_class(e,"text-sm",r[4])},m(l,d){insert_hydration(l,e,d),a&&a.m(e,null),n=!0},p(l,[d]){a&&a.p&&(!n||d&32)&&update_slot_base(a,o,l,l[5],n?get_slot_changes(o,l[5],d,null):get_all_dirty_from_scope(l[5]),null),(!n||d&6&&t!==(t="w-max max-w-full overflow-hidden text-ellipsis whitespace-nowrap rounded-md text-left [&>*]:align-bottom "+(l[1]?"animate-pulse bg-highlight text-transparent":"")+" "+(l[2]?"font-medium":"font-normal")))&&attr(e,"class",t),(!n||d&7)&&toggle_class(e,"text-content-200",l[0]),(!n||d&14)&&toggle_class(e,"ml-4",l[3]),(!n||d&22)&&toggle_class(e,"text-sm",l[4])},i(l){n||(transition_in(a,l),n=!0)},o(l){transition_out(a,l),n=!1},d(l){l&&detach(e),a&&a.d(l)}}}function instance$3(r,e,t){let{$$slots:n={},$$scope:o}=e,{secondary:a=!1}=e,{loading:l=!1}=e,{accent:d=!1}=e,{indent:h=!1}=e,{sm:p=!1}=e;return r.$$set=m=>{"secondary"in m&&t(0,a=m.secondary),"loading"in m&&t(1,l=m.loading),"accent"in m&&t(2,d=m.accent),"indent"in m&&t(3,h=m.indent),"sm"in m&&t(4,p=m.sm),"$$scope"in m&&t(5,o=m.$$scope)},[a,l,d,h,p,o,n]}class Text extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$3,create_fragment$2,safe_not_equal,{secondary:0,loading:1,accent:2,indent:3,sm:4})}}function create_if_block_1(r){let e;const t=r[7].default,n=create_slot(t,r,r[6],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,a){n&&n.p&&(!e||a&64)&&update_slot_base(n,t,o,o[6],e?get_slot_changes(t,o[6],a,null):get_all_dirty_from_scope(o[6]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_if_block$1(r){let e,t,n,o,a,l;return{c(){e=element("img"),this.h()},l(d){e=claim_element(d,"IMG",{alt:!0,src:!0,class:!0,loading:!0,width:!0,height:!0,draggable:!0}),this.h()},h(){attr(e,"alt",r[3]),src_url_equal(e.src,t=r[2]<100/devicePixelRatio?r[0]:r[1])||attr(e,"src",t),attr(e,"class","opacity-0 transition-opacity duration-500"),attr(e,"loading","lazy"),attr(e,"width",n=r[2]+"px"),attr(e,"height",o=r[2]+"px"),attr(e,"draggable","false"),toggle_class(e,"opacity-100",r[5]==="ok")},m(d,h){insert_hydration(d,e,h),r[8](e),a||(l=[listen(e,"load",r[9]),listen(e,"error",r[10])],a=!0)},p(d,h){h&8&&attr(e,"alt",d[3]),h&7&&!src_url_equal(e.src,t=d[2]<100/devicePixelRatio?d[0]:d[1])&&attr(e,"src",t),h&4&&n!==(n=d[2]+"px")&&attr(e,"width",n),h&4&&o!==(o=d[2]+"px")&&attr(e,"height",o),h&32&&toggle_class(e,"opacity-100",d[5]==="ok")},i:noop$2,o:noop$2,d(d){d&&detach(e),r[8](null),a=!1,run_all(l)}}}function create_fragment$1(r){let e,t,n,o,a=`${r[2]}px`,l=`${r[2]}px`,d;const h=[create_if_block$1,create_if_block_1],p=[];function m(E,A){return E[1]&&E[5]!=="error"?0:E[5]==="error"?1:-1}return~(t=m(r))&&(n=p[t]=h[t](r)),{c(){e=element("div"),n&&n.c(),this.h()},l(E){e=claim_element(E,"DIV",{class:!0});var A=children(e);n&&n.l(A),A.forEach(detach),this.h()},h(){attr(e,"class",o="overflow-hidden "+(r[2]>200?"rounded-2xl":"rounded")+" bg-highlight-100"),toggle_class(e,"animate-pulse",r[5]==="loading"),set_style(e,"height",a),set_style(e,"width",l)},m(E,A){insert_hydration(E,e,A),~t&&p[t].m(e,null),d=!0},p(E,[A]){let L=t;t=m(E),t===L?~t&&p[t].p(E,A):(n&&(group_outros(),transition_out(p[L],1,1,()=>{p[L]=null}),check_outros()),~t?(n=p[t],n?n.p(E,A):(n=p[t]=h[t](E),n.c()),transition_in(n,1),n.m(e,null)):n=null),(!d||A&4&&o!==(o="overflow-hidden "+(E[2]>200?"rounded-2xl":"rounded")+" bg-highlight-100"))&&attr(e,"class",o),(!d||A&36)&&toggle_class(e,"animate-pulse",E[5]==="loading"),A&4&&a!==(a=`${E[2]}px`)&&set_style(e,"height",a),A&4&&l!==(l=`${E[2]}px`)&&set_style(e,"width",l)},i(E){d||(transition_in(n),d=!0)},o(E){transition_out(n),d=!1},d(E){E&&detach(e),~t&&p[t].d()}}}function instance$2(r,e,t){let n,{$$slots:o={},$$scope:a}=e,{thumbnail:l=void 0}=e,{src:d=void 0}=e,{size:h=48}=e,{alt:p=""}=e,m;onMount(()=>(m!=null&&m.complete&&t(4,m.style.opacity="1",m),!1));function E(S){binding_callbacks[S?"unshift":"push"](()=>{m=S,t(4,m)})}const A=()=>t(5,n="ok"),L=()=>t(5,n="error");return r.$$set=S=>{"thumbnail"in S&&t(0,l=S.thumbnail),"src"in S&&t(1,d=S.src),"size"in S&&t(2,h=S.size),"alt"in S&&t(3,p=S.alt),"$$scope"in S&&t(6,a=S.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(5,n=d===""||d===null?"error":"loading")},[l,d,h,p,m,n,a,o,E,A,L]}class Image extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$2,create_fragment$1,safe_not_equal,{thumbnail:0,src:1,size:2,alt:3})}}function capitalize(r,e=!0){return r&&(e?r.replace(/\b\w/g,t=>t.toUpperCase()):r.replace(/\b\w/,t=>t.toUpperCase()))}function clean(r){return r.normalize().trim().toLowerCase().replace(/\s+/g," ")}const __vite_glob_0_0=`CREATE TRIGGER IF NOT EXISTS cascade_playlists_library
AFTER DELETE ON playlists
FOR EACH ROW
BEGIN
  DELETE FROM library WHERE playlist = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_library_tracks
AFTER DELETE ON library
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM library 
    WHERE track = OLD.track 
  UNION ALL SELECT 1 FROM playback
    WHERE track = OLD.track
  LIMIT 1
)
BEGIN
  DELETE FROM tracks WHERE id = OLD.track;
END;

CREATE TRIGGER IF NOT EXISTS cascade_playback_tracks
AFTER DELETE ON playback
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM library
    WHERE track = OLD.track
  UNION ALL SELECT 1 FROM playback
    WHERE track = OLD.track
  LIMIT 1
)
BEGIN
  DELETE FROM tracks WHERE id = OLD.track;
END;

CREATE TRIGGER IF NOT EXISTS cascade_tracks_albums
AFTER DELETE ON tracks
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM tracks WHERE album = OLD.album LIMIT 1
)
BEGIN
  DELETE FROM albums WHERE id = OLD.album;
END;

CREATE TRIGGER IF NOT EXISTS cascade_albums_attribution
AFTER DELETE ON albums
FOR EACH ROW
BEGIN
  DELETE FROM attribution WHERE album = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_attribution_artists
AFTER DELETE ON attribution
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM attribution
    WHERE artist = OLD.artist
)
BEGIN
  DELETE FROM artists WHERE id = OLD.artist;
END;

CREATE TRIGGER IF NOT EXISTS cascade_tracks_resources
AFTER DELETE ON tracks
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_albums_resources
AFTER DELETE ON albums
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
  DELETE FROM assets WHERE owner = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_artists_resources
AFTER DELETE ON artists
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
  DELETE FROM assets WHERE owner = OLD.id;
END;
`,__vite_glob_0_1=`CREATE VIRTUAL TABLE IF NOT EXISTS tracks_fts USING fts5 (
  title,
  album,
  artists,
  content='',
  tokenize='trigram'
);

CREATE VIRTUAL TABLE IF NOT EXISTS albums_fts USING fts5 (
  title,
  artists,
  content='',
  tokenize='trigram'
);

CREATE VIRTUAL TABLE IF NOT EXISTS artists_fts USING fts5 (
  title,
  content='',
  tokenize='trigram'
);

---------------------------- Artists Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_artists_insert AFTER INSERT ON artists BEGIN
  -- Update artists index
  INSERT INTO artists_fts(rowid,title) VALUES (NEW.id, NEW.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title,
      CASE WHEN EXISTS (SELECT 1 FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id) THEN albums.title ELSE NULL END,
      (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS fts_artists_update AFTER UPDATE OF title ON artists WHEN (OLD.title IS NOT NEW.title) BEGIN
  -- Update artists index
  INSERT INTO artists_fts(artists_fts,rowid,title) VALUES ('delete', OLD.id, OLD.title);
  INSERT INTO artists_fts(rowid,title) VALUES (NEW.id, NEW.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(CASE WHEN artists.id = OLD.id THEN OLD.title ELSE title END) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = OLD.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(CASE WHEN artists.id = OLD.id THEN OLD.title ELSE title END) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = OLD.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS fts_artists_delete BEFORE DELETE ON artists BEGIN
  -- Update artists index
  INSERT INTO artists_fts(artists_fts,rowid,title) VALUES ('delete', OLD.id, OLD.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = OLD.id;
END;

---------------------------- Albums Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_albums_insert AFTER INSERT ON albums BEGIN
  -- Update albums index
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT NEW.id, NEW.title, group_concat(artists.title)
    FROM attribution
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE attribution.album = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, NULL, NULL
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS albums_fts_update AFTER UPDATE OF title ON albums WHEN (OLD.title IS NOT NEW.title) BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', OLD.id, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
    WHERE attribution.album = OLD.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT NEW.id, NEW.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
    WHERE attribution.album = OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = OLD.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, NEW.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS albums_fts_delete BEFORE DELETE ON albums BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', OLD.id, OLD.title, group_concat(artists.title)
    FROM attribution
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE attribution.album = OLD.id
    GROUP BY OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = OLD.id;
END;

---------------------------- Attribution Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_attribution_insert AFTER INSERT ON attribution
  WHEN EXISTS (SELECT 1 FROM artists WHERE id = NEW.artist) AND EXISTS (SELECT 1 FROM albums WHERE id = NEW.album)
BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, NULL, NULL
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT  tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
END;

CREATE TRIGGER IF NOT EXISTS fts_attribution_delete BEFORE DELETE ON attribution BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = OLD.album AND attribution.artist = OLD.artist;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = OLD.album AND attribution.artist = OLD.artist;
END;

---------------------------- Tracks Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_tracks_insert AFTER INSERT ON tracks BEGIN
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT NEW.id, NEW.title, albums.title, group_concat(artists.title)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE albums.id = NEW.album;
END;

CREATE TRIGGER IF NOT EXISTS fts_tracks_update AFTER UPDATE OF title ON tracks WHEN (OLD.title IS NOT NEW.title) BEGIN
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', OLD.id, OLD.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
    WHERE albums.id = OLD.album;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT NEW.id, NEW.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
    WHERE albums.id = NEW.album;
END;

CREATE TRIGGER IF NOT EXISTS fts_tracks_delete BEFORE DELETE ON tracks BEGIN
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', OLD.id, OLD.title, albums.title, group_concat(artists.title)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE albums.id = OLD.album
    GROUP BY OLD.id;
END;`,__vite_glob_0_2=`INSERT OR IGNORE INTO devices VALUES (crsql_site_id(), -1, 0, 0, 0, 0);

CREATE VIEW IF NOT EXISTS queue AS
  WITH ordered AS
    (SELECT playback.*, row_number() OVER (
      ORDER BY
        CASE WHEN "direction" != 1 THEN "order" ELSE NULL END ASC,
        CASE WHEN "direction" = 1 THEN "order" ELSE NULL END DESC,
        CASE WHEN "direction" != 1 THEN "playback"."id" ELSE NULL END ASC,
        CASE WHEN "direction" = 1 THEN "playback"."id" ELSE NULL END DESC
    ) as position FROM devices INNER JOIN playback ON playback.device = devices.id
    WHERE devices.id = crsql_site_id())
  SELECT id, device, track, 
    (position - 
      (SELECT position FROM ordered WHERE id = (SELECT playback FROM devices WHERE id = device))
    ) as position
  FROM ordered;

CREATE TRIGGER IF NOT EXISTS playback_started
BEFORE INSERT ON playback
FOR EACH ROW
WHEN NEW.device = crsql_site_id()
BEGIN
  UPDATE devices SET playback = NEW.id WHERE id = NEW.device AND playback IS -1;
END;

CREATE TRIGGER IF NOT EXISTS playback_finised
BEFORE UPDATE OF progress ON devices
FOR EACH ROW
WHEN NEW.progress >= 1 AND NEW.id = crsql_site_id()
BEGIN
  INSERT INTO library SELECT ABS(RANDOM() % 4294967296), -1, track, UNIXEPOCH(), -1 FROM playback WHERE id = NEW.playback;
  UPDATE devices SET 
    playback = CASE WHEN NEW.repeat = 2 AND NOT EXISTS (SELECT 1 FROM queue WHERE position > 0)
      THEN IFNULL((SELECT id FROM queue LIMIT 1), playback)
      WHEN NEW.repeat = 1 THEN playback
      ELSE IFNULL((SELECT id FROM queue WHERE position = 1), playback)
    END,
    progress = 0
  WHERE id = NEW.id;
  SELECT RAISE(IGNORE);
END;

CREATE TRIGGER IF NOT EXISTS playback_backtracked
BEFORE UPDATE OF progress ON devices
FOR EACH ROW
WHEN NEW.progress < 0 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE devices SET 
    playback = IFNULL((SELECT id FROM queue WHERE position = -1), playback),
    progress = 0
  WHERE id = NEW.id;
  SELECT RAISE(IGNORE);
END;

CREATE TRIGGER IF NOT EXISTS playback_shuffled
AFTER UPDATE OF direction ON devices
FOR EACH ROW
WHEN NEW.direction = 2 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE playback SET "temp"="order" WHERE
    (SELECT id FROM queue WHERE position = 0) != id AND device = NEW.id;
  UPDATE playback SET
    "order"=(SELECT "order" FROM playback WHERE "temp" IS NULL)||trim(hex(randomblob(2)),'0')
  WHERE "temp" IS NOT NULL;
END;

CREATE TRIGGER IF NOT EXISTS playback_unshuffled
AFTER UPDATE OF direction ON devices
FOR EACH ROW
WHEN OLD.direction = 2 AND NEW.direction != 2 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE playback SET
    "order"="temp",
    "temp"=NULL
  WHERE "temp" IS NOT NULL AND device = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS playback_purged
BEFORE DELETE ON playback
FOR EACH ROW
WHEN (OLD.id = (SELECT playback FROM devices WHERE id = crsql_site_id()))
BEGIN
  UPDATE devices SET 
    playback = (SELECT id FROM queue WHERE position = 1),
    progress = 0
  WHERE id = OLD.device;
END;`,__vite_glob_0_3=`INSERT OR IGNORE INTO playlists (id, title, "order", relevancy, shared, remote) VALUES
  (-1, 'Listened', 1, 0, NULL, NULL),
  (-2, 'Recommended', 1, -1, NULL, NULL),
  (-3, 'Blocked', 1, -1, NULL, NULL),
  (-4, 'Followed', 1, 0, NULL, NULL);`,types={boolean:"?",number:"+",string:"'",object:"&",bigint:"^",null:"!","?":"boolean","+":"number","'":"string","^":"bigint","&":"object","!":"null"},encoders={any:r=>{var e;return typeof r in types&&r!=null?types[typeof r]+((e=encoders[typeof r])==null?void 0:e.call(encoders,r))||r.toString():"!"},object:r=>btoa(String.fromCharCode.apply(null,r)),number:r=>r.toString(),string:r=>r.replaceAll(",",",,").replaceAll("*","**"),bigint:r=>r.toString(),boolean:r=>(+r).toString()},decoders={any:r=>{var e;return(e=decoders[types[r[0]]])==null?void 0:e.call(decoders,r.slice(1))},object:r=>Uint8Array.from([...atob(r)].map(e=>e.charCodeAt(0))),number:r=>parseFloat(r),string:r=>r.replaceAll(",,",",").replaceAll("**","*"),bigint:r=>BigInt(r),boolean:r=>!!+r,null:()=>null};function encode$1(r,e){var o;const t=[],n={};for(const a of r)for(const[l,d]of e){const h=encoders[d](a[l]);if(((o=n[l])==null?void 0:o[0])!==h){const p=[h,1];t.push(p),n[l]=p}else n[l][1]+=1}return t.map(([a,l])=>(l>1?"*"+String.fromCharCode(l+43):",")+a).join("")}function decode$1(r,e){const t=[];for(let l=0;l<r.length;){let d=l-1;do d=[",","*"].map(m=>r.indexOf(m,d+2)).filter(m=>~m).reduce((m,E)=>Math.min(m,E),1/0);while(r[d+1]===r[d]&&d!==1/0);let h=r.slice(l,d);const p=h[0]===",";t.push([h.slice(p?1:2),p?1:h.charCodeAt(1)-43]),l=d}const n=t.slice(0,e.length),o=[];let a=e.length;e:for(;;){const l={};for(let d=0;d<e.length;d++){if(!n[d])break e;const[h,p]=e[d];l[h]=decoders[p](n[d][0]),n[d][1]-=1,n[d][1]||(n[d]=t[a++])}o.push(l)}return o}function chunk(r,{size:e=1e3,strict:t=!0}={}){var o;if(r.length<=e)return[r];const n=[];for(let a=0;a<r.length;){const l=r[a].db_version,d=(o=r[a+e])==null?void 0:o.db_version,h=m=>m.db_version===d;let p=1/0;l===d?t?p=a+e:p=r.findLastIndex(h,a+e)+1:d!=null&&(p=r.findIndex(h,a)),n.push(r.slice(a,p)),a=p}return n}function isUndefined(r){return typeof r>"u"||r===void 0}function isString(r){return typeof r=="string"}function isNumber(r){return typeof r=="number"}function isBoolean(r){return typeof r=="boolean"}function isNull(r){return r===null}function isDate(r){return r instanceof Date}function isBigInt(r){return typeof r=="bigint"}function isFunction(r){return typeof r=="function"}function isObject$3(r){return typeof r=="object"&&r!==null}function freeze(r){return Object.freeze(r)}function asArray(r){return isReadonlyArray(r)?r:[r]}function isReadonlyArray(r){return Array.isArray(r)}function noop$1(r){return r}const AlterTableNode=freeze({is(r){return r.kind==="AlterTableNode"},create(r){return freeze({kind:"AlterTableNode",table:r})},cloneWithTableProps(r,e){return freeze({...r,...e})},cloneWithColumnAlteration(r,e){return freeze({...r,columnAlterations:r.columnAlterations?[...r.columnAlterations,e]:[e]})}}),IdentifierNode=freeze({is(r){return r.kind==="IdentifierNode"},create(r){return freeze({kind:"IdentifierNode",name:r})}}),CreateIndexNode=freeze({is(r){return r.kind==="CreateIndexNode"},create(r){return freeze({kind:"CreateIndexNode",name:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})},cloneWithColumns(r,e){return freeze({...r,columns:[...r.columns||[],...e]})}}),CreateSchemaNode=freeze({is(r){return r.kind==="CreateSchemaNode"},create(r,e){return freeze({kind:"CreateSchemaNode",schema:IdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),ON_COMMIT_ACTIONS=["preserve rows","delete rows","drop"],CreateTableNode=freeze({is(r){return r.kind==="CreateTableNode"},create(r){return freeze({kind:"CreateTableNode",table:r,columns:freeze([])})},cloneWithColumn(r,e){return freeze({...r,columns:freeze([...r.columns,e])})},cloneWithConstraint(r,e){return freeze({...r,constraints:r.constraints?freeze([...r.constraints,e]):freeze([e])})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):freeze([e])})},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):freeze([e])})},cloneWith(r,e){return freeze({...r,...e})}}),SchemableIdentifierNode=freeze({is(r){return r.kind==="SchemableIdentifierNode"},create(r){return freeze({kind:"SchemableIdentifierNode",identifier:IdentifierNode.create(r)})},createWithSchema(r,e){return freeze({kind:"SchemableIdentifierNode",schema:IdentifierNode.create(r),identifier:IdentifierNode.create(e)})}}),DropIndexNode=freeze({is(r){return r.kind==="DropIndexNode"},create(r,e){return freeze({kind:"DropIndexNode",name:SchemableIdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),DropSchemaNode=freeze({is(r){return r.kind==="DropSchemaNode"},create(r,e){return freeze({kind:"DropSchemaNode",schema:IdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),DropTableNode=freeze({is(r){return r.kind==="DropTableNode"},create(r,e){return freeze({kind:"DropTableNode",table:r,...e})},cloneWith(r,e){return freeze({...r,...e})}}),AliasNode=freeze({is(r){return r.kind==="AliasNode"},create(r,e){return freeze({kind:"AliasNode",node:r,alias:e})}}),TableNode=freeze({is(r){return r.kind==="TableNode"},create(r){return freeze({kind:"TableNode",table:SchemableIdentifierNode.create(r)})},createWithSchema(r,e){return freeze({kind:"TableNode",table:SchemableIdentifierNode.createWithSchema(r,e)})}});function isOperationNodeSource(r){return isObject$3(r)&&isFunction(r.toOperationNode)}function isExpression(r){return isObject$3(r)&&"expressionType"in r&&isOperationNodeSource(r)}function isAliasedExpression(r){return isObject$3(r)&&"expression"in r&&isString(r.alias)&&isOperationNodeSource(r)}const SelectModifierNode=freeze({is(r){return r.kind==="SelectModifierNode"},create(r,e){return freeze({kind:"SelectModifierNode",modifier:r,of:e})},createWithExpression(r){return freeze({kind:"SelectModifierNode",rawModifier:r})}}),AndNode=freeze({is(r){return r.kind==="AndNode"},create(r,e){return freeze({kind:"AndNode",left:r,right:e})}}),OrNode=freeze({is(r){return r.kind==="OrNode"},create(r,e){return freeze({kind:"OrNode",left:r,right:e})}}),OnNode=freeze({is(r){return r.kind==="OnNode"},create(r){return freeze({kind:"OnNode",on:r})},cloneWithOperation(r,e,t){return freeze({...r,on:e==="And"?AndNode.create(r.on,t):OrNode.create(r.on,t)})}}),JoinNode=freeze({is(r){return r.kind==="JoinNode"},create(r,e){return freeze({kind:"JoinNode",joinType:r,table:e,on:void 0})},createWithOn(r,e,t){return freeze({kind:"JoinNode",joinType:r,table:e,on:OnNode.create(t)})},cloneWithOn(r,e){return freeze({...r,on:r.on?OnNode.cloneWithOperation(r.on,"And",e):OnNode.create(e)})}}),BinaryOperationNode=freeze({is(r){return r.kind==="BinaryOperationNode"},create(r,e,t){return freeze({kind:"BinaryOperationNode",leftOperand:r,operator:e,rightOperand:t})}}),COMPARISON_OPERATORS=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],ARITHMETIC_OPERATORS=["+","-","*","/","%","^","&","|","#","<<",">>"],JSON_OPERATORS=["->","->>"],BINARY_OPERATORS=[...COMPARISON_OPERATORS,...ARITHMETIC_OPERATORS,"&&","||"],UNARY_FILTER_OPERATORS=["exists","not exists"],UNARY_OPERATORS=["not","-",...UNARY_FILTER_OPERATORS],OPERATORS=[...BINARY_OPERATORS,...JSON_OPERATORS,...UNARY_OPERATORS,"between","between symmetric"],OperatorNode=freeze({is(r){return r.kind==="OperatorNode"},create(r){return freeze({kind:"OperatorNode",operator:r})}});function isJSONOperator(r){return isString(r)&&JSON_OPERATORS.includes(r)}const ColumnNode=freeze({is(r){return r.kind==="ColumnNode"},create(r){return freeze({kind:"ColumnNode",column:IdentifierNode.create(r)})}}),SelectAllNode=freeze({is(r){return r.kind==="SelectAllNode"},create(){return freeze({kind:"SelectAllNode"})}}),ReferenceNode=freeze({is(r){return r.kind==="ReferenceNode"},create(r,e){return freeze({kind:"ReferenceNode",table:e,column:r})},createSelectAll(r){return freeze({kind:"ReferenceNode",table:r,column:SelectAllNode.create()})}});var jr;class DynamicReferenceBuilder{constructor(e){I(this,jr);x(this,jr,e)}get dynamicReference(){return i(this,jr)}get refType(){}toOperationNode(){return parseSimpleReferenceExpression(i(this,jr))}}jr=new WeakMap;function isDynamicReferenceBuilder(r){return isObject$3(r)&&isOperationNodeSource(r)&&isString(r.dynamicReference)}const OrderByItemNode=freeze({is(r){return r.kind==="OrderByItemNode"},create(r,e){return freeze({kind:"OrderByItemNode",orderBy:r,direction:e})}}),RawNode=freeze({is(r){return r.kind==="RawNode"},create(r,e){return freeze({kind:"RawNode",sqlFragments:freeze(r),parameters:freeze(e)})},createWithSql(r){return RawNode.create([r],[])},createWithChild(r){return RawNode.create(["",""],[r])},createWithChildren(r){return RawNode.create(new Array(r.length+1).fill(""),r)}});function isOrderByDirection(r){return r==="asc"||r==="desc"}function parseOrderBy(r){if(r.length===2)return[parseOrderByItem(r[0],r[1])];if(r.length===1){const[e]=r;return Array.isArray(e)?e.map(t=>parseOrderByItem(t)):[parseOrderByItem(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${r.length}`)}function parseOrderByItem(r,e){const t=parseOrderByExpression(r);if(OrderByItemNode.is(t)){if(e)throw new Error("Cannot specify direction twice!");return t}return OrderByItemNode.create(t,parseOrderByDirectionExpression(e))}function parseOrderByExpression(r){if(isExpressionOrFactory(r))return parseExpression(r);if(isDynamicReferenceBuilder(r))return r.toOperationNode();const[e,t]=r.split(" ");if(t){if(!isOrderByDirection(t))throw new Error(`Invalid order by direction: ${t}`);return OrderByItemNode.create(parseStringReference(e),parseOrderByDirectionExpression(t))}return parseStringReference(r)}function parseOrderByDirectionExpression(r){if(r)return r==="asc"||r==="desc"?RawNode.createWithSql(r):r.toOperationNode()}const JSONReferenceNode=freeze({is(r){return r.kind==="JSONReferenceNode"},create(r,e){return freeze({kind:"JSONReferenceNode",reference:r,traversal:e})},cloneWithTraversal(r,e){return freeze({...r,traversal:e})}}),JSONOperatorChainNode=freeze({is(r){return r.kind==="JSONOperatorChainNode"},create(r){return freeze({kind:"JSONOperatorChainNode",operator:r,values:freeze([])})},cloneWithValue(r,e){return freeze({...r,values:freeze([...r.values,e])})}}),JSONPathNode=freeze({is(r){return r.kind==="JSONPathNode"},create(r){return freeze({kind:"JSONPathNode",inOperator:r,pathLegs:freeze([])})},cloneWithLeg(r,e){return freeze({...r,pathLegs:freeze([...r.pathLegs,e])})}});function parseSimpleReferenceExpression(r){return isString(r)?parseStringReference(r):r.toOperationNode()}function parseReferenceExpressionOrList(r){return isReadonlyArray(r)?r.map(e=>parseReferenceExpression(e)):[parseReferenceExpression(r)]}function parseReferenceExpression(r){return isExpressionOrFactory(r)?parseExpression(r):parseSimpleReferenceExpression(r)}function parseJSONReference(r,e){const t=parseStringReference(r);if(isJSONOperator(e))return JSONReferenceNode.create(t,JSONOperatorChainNode.create(OperatorNode.create(e)));const n=e.slice(0,-1);if(isJSONOperator(n))return JSONReferenceNode.create(t,JSONPathNode.create(OperatorNode.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function parseStringReference(r){const e=".";if(!r.includes(e))return ReferenceNode.create(ColumnNode.create(r));const t=r.split(e).map(trim$2);if(t.length===3)return parseStringReferenceWithTableAndSchema(t);if(t.length===2)return parseStringReferenceWithTable(t);throw new Error(`invalid column reference ${r}`)}function parseAliasedStringReference(r){const e=" as ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$2);return AliasNode.create(parseStringReference(t),IdentifierNode.create(n))}else return parseStringReference(r)}function parseColumnName(r){return ColumnNode.create(r)}function parseOrderedColumnName(r){const e=" ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$2);if(!isOrderByDirection(n))throw new Error(`invalid order direction "${n}" next to "${t}"`);return parseOrderBy([t,n])[0]}else return parseColumnName(r)}function parseStringReferenceWithTableAndSchema(r){const[e,t,n]=r;return ReferenceNode.create(ColumnNode.create(n),TableNode.createWithSchema(e,t))}function parseStringReferenceWithTable(r){const[e,t]=r;return ReferenceNode.create(ColumnNode.create(t),TableNode.create(e))}function trim$2(r){return r.trim()}const PrimitiveValueListNode=freeze({is(r){return r.kind==="PrimitiveValueListNode"},create(r){return freeze({kind:"PrimitiveValueListNode",values:freeze([...r])})}}),ValueListNode=freeze({is(r){return r.kind==="ValueListNode"},create(r){return freeze({kind:"ValueListNode",values:freeze(r)})}}),ValueNode=freeze({is(r){return r.kind==="ValueNode"},create(r){return freeze({kind:"ValueNode",value:r})},createImmediate(r){return freeze({kind:"ValueNode",value:r,immediate:!0})}});function parseValueExpressionOrList(r){return isReadonlyArray(r)?parseValueExpressionList(r):parseValueExpression(r)}function parseValueExpression(r){return isExpressionOrFactory(r)?parseExpression(r):ValueNode.create(r)}function isSafeImmediateValue(r){return isNumber(r)||isBoolean(r)||isNull(r)}function parseSafeImmediateValue(r){if(!isSafeImmediateValue(r))throw new Error(`unsafe immediate value ${JSON.stringify(r)}`);return ValueNode.createImmediate(r)}function parseValueExpressionList(r){return r.some(isExpressionOrFactory)?ValueListNode.create(r.map(e=>parseValueExpression(e))):PrimitiveValueListNode.create(r)}const ParensNode=freeze({is(r){return r.kind==="ParensNode"},create(r){return freeze({kind:"ParensNode",node:r})}});function parseValueBinaryOperationOrExpression(r){if(r.length===3)return parseValueBinaryOperation(r[0],r[1],r[2]);if(r.length===1)return parseValueExpression(r[0]);throw new Error(`invalid arguments: ${JSON.stringify(r)}`)}function parseValueBinaryOperation(r,e,t){return isIsOperator(e)&&needsIsOperator(t)?BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),ValueNode.createImmediate(t)):BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),parseValueExpressionOrList(t))}function parseReferentialBinaryOperation(r,e,t){return BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),parseReferenceExpression(t))}function parseFilterObject(r,e){return parseFilterList(Object.entries(r).filter(([,t])=>!isUndefined(t)).map(([t,n])=>parseValueBinaryOperation(t,needsIsOperator(n)?"is":"=",n)),e)}function parseFilterList(r,e,t=!0){const n=e==="and"?AndNode.create:OrNode.create;if(r.length===0)return BinaryOperationNode.create(ValueNode.createImmediate(1),OperatorNode.create("="),ValueNode.createImmediate(e==="and"?1:0));let o=toOperationNode(r[0]);for(let a=1;a<r.length;++a)o=n(o,toOperationNode(r[a]));return r.length>1&&t?ParensNode.create(o):o}function isIsOperator(r){return r==="is"||r==="is not"}function needsIsOperator(r){return isNull(r)||isBoolean(r)}function parseOperator(r){if(isString(r)&&OPERATORS.includes(r))return OperatorNode.create(r);if(isOperationNodeSource(r))return r.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(r)}`)}function toOperationNode(r){return isOperationNodeSource(r)?r.toOperationNode():r}const OrderByNode=freeze({is(r){return r.kind==="OrderByNode"},create(r){return freeze({kind:"OrderByNode",items:freeze([...r])})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),PartitionByNode=freeze({is(r){return r.kind==="PartitionByNode"},create(r){return freeze({kind:"PartitionByNode",items:freeze(r)})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),OverNode=freeze({is(r){return r.kind==="OverNode"},create(){return freeze({kind:"OverNode"})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithPartitionByItems(r,e){return freeze({...r,partitionBy:r.partitionBy?PartitionByNode.cloneWithItems(r.partitionBy,e):PartitionByNode.create(e)})}}),FromNode=freeze({is(r){return r.kind==="FromNode"},create(r){return freeze({kind:"FromNode",froms:freeze(r)})},cloneWithFroms(r,e){return freeze({...r,froms:freeze([...r.froms,...e])})}}),GroupByNode=freeze({is(r){return r.kind==="GroupByNode"},create(r){return freeze({kind:"GroupByNode",items:freeze(r)})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),HavingNode=freeze({is(r){return r.kind==="HavingNode"},create(r){return freeze({kind:"HavingNode",having:r})},cloneWithOperation(r,e,t){return freeze({...r,having:e==="And"?AndNode.create(r.having,t):OrNode.create(r.having,t)})}}),SelectQueryNode=freeze({is(r){return r.kind==="SelectQueryNode"},create(r){return freeze({kind:"SelectQueryNode",...r&&{with:r}})},createFrom(r,e){return freeze({kind:"SelectQueryNode",from:FromNode.create(r),...e&&{with:e}})},cloneWithSelections(r,e){return freeze({...r,selections:r.selections?freeze([...r.selections,...e]):freeze(e)})},cloneWithDistinctOn(r,e){return freeze({...r,distinctOn:r.distinctOn?freeze([...r.distinctOn,...e]):freeze(e)})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):freeze([e])})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithGroupByItems(r,e){return freeze({...r,groupBy:r.groupBy?GroupByNode.cloneWithItems(r.groupBy,e):GroupByNode.create(e)})},cloneWithLimit(r,e){return freeze({...r,limit:e})},cloneWithOffset(r,e){return freeze({...r,offset:e})},cloneWithFetch(r,e){return freeze({...r,fetch:e})},cloneWithHaving(r,e){return freeze({...r,having:r.having?HavingNode.cloneWithOperation(r.having,"And",e):HavingNode.create(e)})},cloneWithSetOperations(r,e){return freeze({...r,setOperations:r.setOperations?freeze([...r.setOperations,...e]):freeze([...e])})},cloneWithoutSelections(r){return freeze({...r,selections:[]})},cloneWithoutLimit(r){return freeze({...r,limit:void 0})},cloneWithoutOffset(r){return freeze({...r,offset:void 0})},cloneWithoutOrderBy(r){return freeze({...r,orderBy:void 0})},cloneWithoutGroupBy(r){return freeze({...r,groupBy:void 0})}});function preventAwait(r,e){Object.defineProperties(r.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var Tt;const Sn=class Sn{constructor(e){I(this,Tt);x(this,Tt,freeze(e))}on(...e){return new Sn({...i(this,Tt),joinNode:JoinNode.cloneWithOn(i(this,Tt).joinNode,parseValueBinaryOperationOrExpression(e))})}onRef(e,t,n){return new Sn({...i(this,Tt),joinNode:JoinNode.cloneWithOn(i(this,Tt).joinNode,parseReferentialBinaryOperation(e,t,n))})}onTrue(){return new Sn({...i(this,Tt),joinNode:JoinNode.cloneWithOn(i(this,Tt).joinNode,RawNode.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return i(this,Tt).joinNode}};Tt=new WeakMap;let JoinBuilder=Sn;preventAwait(JoinBuilder,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const PartitionByItemNode=freeze({is(r){return r.kind==="PartitionByItemNode"},create(r){return freeze({kind:"PartitionByItemNode",partitionBy:r})}});function parsePartitionBy(r){return parseReferenceExpressionOrList(r).map(PartitionByItemNode.create)}var Er;const ci=class ci{constructor(e){I(this,Er);x(this,Er,freeze(e))}orderBy(e,t){return new ci({overNode:OverNode.cloneWithOrderByItems(i(this,Er).overNode,parseOrderBy([e,t]))})}partitionBy(e){return new ci({overNode:OverNode.cloneWithPartitionByItems(i(this,Er).overNode,parsePartitionBy(e))})}$call(e){return e(this)}toOperationNode(){return i(this,Er).overNode}};Er=new WeakMap;let OverBuilder=ci;preventAwait(OverBuilder,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const SelectionNode=freeze({is(r){return r.kind==="SelectionNode"},create(r){return freeze({kind:"SelectionNode",selection:r})},createSelectAll(){return freeze({kind:"SelectionNode",selection:SelectAllNode.create()})},createSelectAllFromTable(r){return freeze({kind:"SelectionNode",selection:ReferenceNode.createSelectAll(r)})}});function parseSelectArg(r){return isFunction(r)?parseSelectArg(r(expressionBuilder())):isReadonlyArray(r)?r.map(e=>parseSelectExpression(e)):[parseSelectExpression(r)]}function parseSelectExpression(r){return isString(r)?SelectionNode.create(parseAliasedStringReference(r)):isDynamicReferenceBuilder(r)?SelectionNode.create(r.toOperationNode()):SelectionNode.create(parseAliasedExpression(r))}function parseSelectAll(r){return r?Array.isArray(r)?r.map(parseSelectAllArg):[parseSelectAllArg(r)]:[SelectionNode.createSelectAll()]}function parseSelectAllArg(r){if(isString(r))return SelectionNode.createSelectAllFromTable(parseTable(r));throw new Error(`invalid value selectAll expression: ${JSON.stringify(r)}`)}const ValuesNode=freeze({is(r){return r.kind==="ValuesNode"},create(r){return freeze({kind:"ValuesNode",values:freeze(r)})}}),DefaultInsertValueNode=freeze({is(r){return r.kind==="DefaultInsertValueNode"},create(){return freeze({kind:"DefaultInsertValueNode"})}});function parseInsertExpression(r){const e=isFunction(r)?r(expressionBuilder()):r,t=isReadonlyArray(e)?e:freeze([e]);return parseInsertColumnsAndValues(t)}function parseInsertColumnsAndValues(r){const e=parseColumnNamesAndIndexes(r);return[freeze([...e.keys()].map(ColumnNode.create)),ValuesNode.create(r.map(t=>parseRowValues(t,e)))]}function parseColumnNamesAndIndexes(r){const e=new Map;for(const t of r){const n=Object.keys(t);for(const o of n)!e.has(o)&&t[o]!==void 0&&e.set(o,e.size)}return e}function parseRowValues(r,e){const t=Object.keys(r),n=Array.from({length:e.size});let o=!1;for(const l of t){const d=e.get(l);if(isUndefined(d))continue;const h=r[l];(isUndefined(h)||isExpressionOrFactory(h))&&(o=!0),n[d]=h}if(t.length<e.size||o){const l=DefaultInsertValueNode.create();return ValueListNode.create(n.map(d=>isUndefined(d)?l:parseValueExpression(d)))}return PrimitiveValueListNode.create(n)}const InsertQueryNode=freeze({is(r){return r.kind==="InsertQueryNode"},create(r,e,t){return freeze({kind:"InsertQueryNode",into:r,...e&&{with:e},replace:t})},createWithoutInto(){return freeze({kind:"InsertQueryNode"})},cloneWith(r,e){return freeze({...r,...e})}}),UpdateQueryNode=freeze({is(r){return r.kind==="UpdateQueryNode"},create(r,e){return freeze({kind:"UpdateQueryNode",table:r,...e&&{with:e}})},createWithoutTable(){return freeze({kind:"UpdateQueryNode"})},cloneWithFromItems(r,e){return freeze({...r,from:r.from?FromNode.cloneWithFroms(r.from,e):FromNode.create(e)})},cloneWithUpdates(r,e){return freeze({...r,updates:r.updates?freeze([...r.updates,...e]):e})},cloneWithLimit(r,e){return freeze({...r,limit:e})}}),UsingNode=freeze({is(r){return r.kind==="UsingNode"},create(r){return freeze({kind:"UsingNode",tables:freeze(r)})},cloneWithTables(r,e){return freeze({...r,tables:freeze([...r.tables,...e])})}}),DeleteQueryNode=freeze({is(r){return r.kind==="DeleteQueryNode"},create(r,e){return freeze({kind:"DeleteQueryNode",from:FromNode.create(r),...e&&{with:e}})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithoutOrderBy(r){return freeze({...r,orderBy:void 0})},cloneWithLimit(r,e){return freeze({...r,limit:e})},cloneWithoutLimit(r){return freeze({...r,limit:void 0})},cloneWithUsing(r,e){return freeze({...r,using:r.using!==void 0?UsingNode.cloneWithTables(r.using,e):UsingNode.create(e)})}}),WhereNode=freeze({is(r){return r.kind==="WhereNode"},create(r){return freeze({kind:"WhereNode",where:r})},cloneWithOperation(r,e,t){return freeze({...r,where:e==="And"?AndNode.create(r.where,t):OrNode.create(r.where,t)})}}),ReturningNode=freeze({is(r){return r.kind==="ReturningNode"},create(r){return freeze({kind:"ReturningNode",selections:freeze(r)})},cloneWithSelections(r,e){return freeze({...r,selections:r.selections?freeze([...r.selections,...e]):freeze(e)})}}),ExplainNode=freeze({is(r){return r.kind==="ExplainNode"},create(r,e){return freeze({kind:"ExplainNode",format:r,options:e})}}),WhenNode=freeze({is(r){return r.kind==="WhenNode"},create(r){return freeze({kind:"WhenNode",condition:r})},cloneWithResult(r,e){return freeze({...r,result:e})}}),MergeQueryNode=freeze({is(r){return r.kind==="MergeQueryNode"},create(r,e){return freeze({kind:"MergeQueryNode",into:r,...e&&{with:e}})},cloneWithUsing(r,e){return freeze({...r,using:e})},cloneWithWhen(r,e){return freeze({...r,whens:r.whens?freeze([...r.whens,e]):freeze([e])})},cloneWithThen(r,e){return freeze({...r,whens:r.whens?freeze([...r.whens.slice(0,-1),WhenNode.cloneWithResult(r.whens[r.whens.length-1],e)]):void 0})}}),OutputNode=freeze({is(r){return r.kind==="OutputNode"},create(r){return freeze({kind:"OutputNode",selections:freeze(r)})},cloneWithSelections(r,e){return freeze({...r,selections:r.selections?freeze([...r.selections,...e]):freeze(e)})}}),QueryNode=freeze({is(r){return SelectQueryNode.is(r)||InsertQueryNode.is(r)||UpdateQueryNode.is(r)||DeleteQueryNode.is(r)||MergeQueryNode.is(r)},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):freeze([e])})},cloneWithWhere(r,e){return freeze({...r,where:r.where?WhereNode.cloneWithOperation(r.where,"And",e):WhereNode.create(e)})},cloneWithJoin(r,e){return freeze({...r,joins:r.joins?freeze([...r.joins,e]):freeze([e])})},cloneWithReturning(r,e){return freeze({...r,returning:r.returning?ReturningNode.cloneWithSelections(r.returning,e):ReturningNode.create(e)})},cloneWithoutReturning(r){return freeze({...r,returning:void 0})},cloneWithoutWhere(r){return freeze({...r,where:void 0})},cloneWithExplain(r,e,t){return freeze({...r,explain:ExplainNode.create(e,t==null?void 0:t.toOperationNode())})},cloneWithTop(r,e){return freeze({...r,top:e})},cloneWithOutput(r,e){return freeze({...r,output:r.output?OutputNode.cloneWithSelections(r.output,e):OutputNode.create(e)})}}),ColumnUpdateNode=freeze({is(r){return r.kind==="ColumnUpdateNode"},create(r,e){return freeze({kind:"ColumnUpdateNode",column:r,value:e})}});function parseUpdate(...r){return r.length===2?[ColumnUpdateNode.create(parseReferenceExpression(r[0]),parseValueExpression(r[1]))]:parseUpdateObjectExpression(r[0])}function parseUpdateObjectExpression(r){const e=isFunction(r)?r(expressionBuilder()):r;return Object.entries(e).filter(([t,n])=>n!==void 0).map(([t,n])=>ColumnUpdateNode.create(ColumnNode.create(t),parseValueExpression(n)))}const OnDuplicateKeyNode=freeze({is(r){return r.kind==="OnDuplicateKeyNode"},create(r){return freeze({kind:"OnDuplicateKeyNode",updates:r})}});class InsertResult{constructor(e,t){oe(this,"insertId");oe(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=t}}class NoResultError extends Error{constructor(t){super("no result");oe(this,"node");this.node=t}}function isNoResultErrorConstructor(r){return Object.prototype.hasOwnProperty.call(r,"prototype")}const OnConflictNode=freeze({is(r){return r.kind==="OnConflictNode"},create(){return freeze({kind:"OnConflictNode"})},cloneWith(r,e){return freeze({...r,...e})},cloneWithIndexWhere(r,e){return freeze({...r,indexWhere:r.indexWhere?WhereNode.cloneWithOperation(r.indexWhere,"And",e):WhereNode.create(e)})},cloneWithIndexOrWhere(r,e){return freeze({...r,indexWhere:r.indexWhere?WhereNode.cloneWithOperation(r.indexWhere,"Or",e):WhereNode.create(e)})},cloneWithUpdateWhere(r,e){return freeze({...r,updateWhere:r.updateWhere?WhereNode.cloneWithOperation(r.updateWhere,"And",e):WhereNode.create(e)})},cloneWithUpdateOrWhere(r,e){return freeze({...r,updateWhere:r.updateWhere?WhereNode.cloneWithOperation(r.updateWhere,"Or",e):WhereNode.create(e)})},cloneWithoutIndexWhere(r){return freeze({...r,indexWhere:void 0})},cloneWithoutUpdateWhere(r){return freeze({...r,updateWhere:void 0})}});var _e;const Qt=class Qt{constructor(e){I(this,_e);x(this,_e,freeze(e))}column(e){const t=ColumnNode.create(e);return new Qt({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{columns:i(this,_e).onConflictNode.columns?freeze([...i(this,_e).onConflictNode.columns,t]):freeze([t])})})}columns(e){const t=e.map(ColumnNode.create);return new Qt({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{columns:i(this,_e).onConflictNode.columns?freeze([...i(this,_e).onConflictNode.columns,...t]):freeze(t)})})}constraint(e){return new Qt({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{constraint:IdentifierNode.create(e)})})}expression(e){return new Qt({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new Qt({...i(this,_e),onConflictNode:OnConflictNode.cloneWithIndexWhere(i(this,_e).onConflictNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new Qt({...i(this,_e),onConflictNode:OnConflictNode.cloneWithIndexWhere(i(this,_e).onConflictNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new Qt({...i(this,_e),onConflictNode:OnConflictNode.cloneWithoutIndexWhere(i(this,_e).onConflictNode)})}doNothing(){return new OnConflictDoNothingBuilder({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new OnConflictUpdateBuilder({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{updates:parseUpdateObjectExpression(e)})})}$call(e){return e(this)}};_e=new WeakMap;let OnConflictBuilder=Qt;preventAwait(OnConflictBuilder,"don't await OnConflictBuilder instances.");var Ln;class OnConflictDoNothingBuilder{constructor(e){I(this,Ln);x(this,Ln,freeze(e))}toOperationNode(){return i(this,Ln).onConflictNode}}Ln=new WeakMap;preventAwait(OnConflictDoNothingBuilder,"don't await OnConflictDoNothingBuilder instances.");var It;const vn=class vn{constructor(e){I(this,It);x(this,It,freeze(e))}where(...e){return new vn({...i(this,It),onConflictNode:OnConflictNode.cloneWithUpdateWhere(i(this,It).onConflictNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new vn({...i(this,It),onConflictNode:OnConflictNode.cloneWithUpdateWhere(i(this,It).onConflictNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new vn({...i(this,It),onConflictNode:OnConflictNode.cloneWithoutUpdateWhere(i(this,It).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return i(this,It).onConflictNode}};It=new WeakMap;let OnConflictUpdateBuilder=vn;preventAwait(OnConflictUpdateBuilder,"don't await OnConflictUpdateBuilder instances.");const TopNode=freeze({is(r){return r.kind==="TopNode"},create(r,e){return freeze({kind:"TopNode",expression:r,modifiers:e})}});function parseTop(r,e){if(!isNumber(r)&&!isBigInt(r))throw new Error(`Invalid top expression: ${r}`);if(!isUndefined(e)&&!isTopModifiers(e))throw new Error(`Invalid top modifiers: ${e}`);return TopNode.create(r,e)}function isTopModifiers(r){return r==="percent"||r==="with ties"||r==="percent with ties"}var Z;const Le=class Le{constructor(e){I(this,Z);x(this,Z,freeze(e))}values(e){const[t,n]=parseInsertExpression(e);return new Le({...i(this,Z),queryNode:InsertQueryNode.cloneWith(i(this,Z).queryNode,{columns:t,values:n})})}columns(e){return new Le({...i(this,Z),queryNode:InsertQueryNode.cloneWith(i(this,Z).queryNode,{columns:freeze(e.map(ColumnNode.create))})})}expression(e){return new Le({...i(this,Z),queryNode:InsertQueryNode.cloneWith(i(this,Z).queryNode,{values:parseExpression(e)})})}defaultValues(){return new Le({...i(this,Z),queryNode:InsertQueryNode.cloneWith(i(this,Z).queryNode,{defaultValues:!0})})}modifyEnd(e){return new Le({...i(this,Z),queryNode:QueryNode.cloneWithEndModifier(i(this,Z).queryNode,e.toOperationNode())})}ignore(){return new Le({...i(this,Z),queryNode:InsertQueryNode.cloneWith(i(this,Z).queryNode,{ignore:!0})})}top(e,t){return new Le({...i(this,Z),queryNode:QueryNode.cloneWithTop(i(this,Z).queryNode,parseTop(e,t))})}onConflict(e){return new Le({...i(this,Z),queryNode:InsertQueryNode.cloneWith(i(this,Z).queryNode,{onConflict:e(new OnConflictBuilder({onConflictNode:OnConflictNode.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Le({...i(this,Z),queryNode:InsertQueryNode.cloneWith(i(this,Z).queryNode,{onDuplicateKey:OnDuplicateKeyNode.create(parseUpdateObjectExpression(e))})})}returning(e){return new Le({...i(this,Z),queryNode:QueryNode.cloneWithReturning(i(this,Z).queryNode,parseSelectArg(e))})}returningAll(){return new Le({...i(this,Z),queryNode:QueryNode.cloneWithReturning(i(this,Z).queryNode,parseSelectAll())})}output(e){return new Le({...i(this,Z),queryNode:QueryNode.cloneWithOutput(i(this,Z).queryNode,parseSelectArg(e))})}outputAll(e){return new Le({...i(this,Z),queryNode:QueryNode.cloneWithOutput(i(this,Z).queryNode,parseSelectAll(e))})}clearReturning(){return new Le({...i(this,Z),queryNode:QueryNode.cloneWithoutReturning(i(this,Z).queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new Le({...i(this,Z)})}$castTo(){return new Le(i(this,Z))}$narrowType(){return new Le(i(this,Z))}$assertType(){return new Le(i(this,Z))}withPlugin(e){return new Le({...i(this,Z),executor:i(this,Z).executor.withPlugin(e)})}toOperationNode(){return i(this,Z).executor.transformQuery(i(this,Z).queryNode,i(this,Z).queryId)}compile(){return i(this,Z).executor.compileQuery(this.toOperationNode(),i(this,Z).queryId)}async execute(){const e=this.compile(),t=await i(this,Z).executor.executeQuery(e,i(this,Z).queryId),{adapter:n}=i(this,Z).executor,o=e.query;return o.returning&&n.supportsReturning||o.output&&n.supportsOutput?t.rows:[new InsertResult(t.insertId,t.numAffectedRows??t.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,Z).executor.stream(t,e,i(this,Z).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new Le({...i(this,Z),queryNode:QueryNode.cloneWithExplain(i(this,Z).queryNode,e,t)}).execute()}};Z=new WeakMap;let InsertQueryBuilder=Le;preventAwait(InsertQueryBuilder,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class DeleteResult{constructor(e){oe(this,"numDeletedRows");this.numDeletedRows=e}}const LimitNode=freeze({is(r){return r.kind==="LimitNode"},create(r){return freeze({kind:"LimitNode",limit:r})}});var H;const ge=class ge{constructor(e){I(this,H);x(this,H,freeze(e))}where(...e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithWhere(i(this,H).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new ge({...i(this,H),queryNode:QueryNode.cloneWithWhere(i(this,H).queryNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new ge({...i(this,H),queryNode:QueryNode.cloneWithoutWhere(i(this,H).queryNode)})}top(e,t){return new ge({...i(this,H),queryNode:QueryNode.cloneWithTop(i(this,H).queryNode,parseTop(e,t))})}using(e){return new ge({...i(this,H),queryNode:DeleteQueryNode.cloneWithUsing(i(this,H).queryNode,parseTableExpressionOrList(e))})}innerJoin(...e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithJoin(i(this,H).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithJoin(i(this,H).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithJoin(i(this,H).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithJoin(i(this,H).queryNode,parseJoin("FullJoin",e))})}returning(e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithReturning(i(this,H).queryNode,parseSelectArg(e))})}returningAll(e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithReturning(i(this,H).queryNode,parseSelectAll(e))})}output(e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithOutput(i(this,H).queryNode,parseSelectArg(e))})}outputAll(e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithOutput(i(this,H).queryNode,parseSelectAll(e))})}clearReturning(){return new ge({...i(this,H),queryNode:QueryNode.cloneWithoutReturning(i(this,H).queryNode)})}clearLimit(){return new ge({...i(this,H),queryNode:DeleteQueryNode.cloneWithoutLimit(i(this,H).queryNode)})}clearOrderBy(){return new ge({...i(this,H),queryNode:DeleteQueryNode.cloneWithoutOrderBy(i(this,H).queryNode)})}orderBy(e,t){return new ge({...i(this,H),queryNode:DeleteQueryNode.cloneWithOrderByItems(i(this,H).queryNode,parseOrderBy([e,t]))})}limit(e){return new ge({...i(this,H),queryNode:DeleteQueryNode.cloneWithLimit(i(this,H).queryNode,LimitNode.create(parseValueExpression(e)))})}modifyEnd(e){return new ge({...i(this,H),queryNode:QueryNode.cloneWithEndModifier(i(this,H).queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,t){return e?t(this):new ge({...i(this,H)})}$castTo(){return new ge(i(this,H))}$narrowType(){return new ge(i(this,H))}$assertType(){return new ge(i(this,H))}withPlugin(e){return new ge({...i(this,H),executor:i(this,H).executor.withPlugin(e)})}toOperationNode(){return i(this,H).executor.transformQuery(i(this,H).queryNode,i(this,H).queryId)}compile(){return i(this,H).executor.compileQuery(this.toOperationNode(),i(this,H).queryId)}async execute(){const e=this.compile(),t=await i(this,H).executor.executeQuery(e,i(this,H).queryId),{adapter:n}=i(this,H).executor,o=e.query;return o.returning&&n.supportsReturning||o.output&&n.supportsOutput?t.rows:[new DeleteResult(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,H).executor.stream(t,e,i(this,H).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new ge({...i(this,H),queryNode:QueryNode.cloneWithExplain(i(this,H).queryNode,e,t)}).execute()}};H=new WeakMap;let DeleteQueryBuilder=ge;preventAwait(DeleteQueryBuilder,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class UpdateResult{constructor(e,t){oe(this,"numUpdatedRows");oe(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=t}}var j;const Se=class Se{constructor(e){I(this,j);x(this,j,freeze(e))}where(...e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithWhere(i(this,j).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new Se({...i(this,j),queryNode:QueryNode.cloneWithWhere(i(this,j).queryNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new Se({...i(this,j),queryNode:QueryNode.cloneWithoutWhere(i(this,j).queryNode)})}top(e,t){return new Se({...i(this,j),queryNode:QueryNode.cloneWithTop(i(this,j).queryNode,parseTop(e,t))})}from(e){return new Se({...i(this,j),queryNode:UpdateQueryNode.cloneWithFromItems(i(this,j).queryNode,parseTableExpressionOrList(e))})}innerJoin(...e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithJoin(i(this,j).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithJoin(i(this,j).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithJoin(i(this,j).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithJoin(i(this,j).queryNode,parseJoin("FullJoin",e))})}limit(e){return new Se({...i(this,j),queryNode:UpdateQueryNode.cloneWithLimit(i(this,j).queryNode,LimitNode.create(parseValueExpression(e)))})}set(...e){return new Se({...i(this,j),queryNode:UpdateQueryNode.cloneWithUpdates(i(this,j).queryNode,parseUpdate(...e))})}returning(e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithReturning(i(this,j).queryNode,parseSelectArg(e))})}returningAll(e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithReturning(i(this,j).queryNode,parseSelectAll(e))})}output(e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithOutput(i(this,j).queryNode,parseSelectArg(e))})}outputAll(e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithOutput(i(this,j).queryNode,parseSelectAll(e))})}modifyEnd(e){return new Se({...i(this,j),queryNode:QueryNode.cloneWithEndModifier(i(this,j).queryNode,e.toOperationNode())})}clearReturning(){return new Se({...i(this,j),queryNode:QueryNode.cloneWithoutReturning(i(this,j).queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new Se({...i(this,j)})}$castTo(){return new Se(i(this,j))}$narrowType(){return new Se(i(this,j))}$assertType(){return new Se(i(this,j))}withPlugin(e){return new Se({...i(this,j),executor:i(this,j).executor.withPlugin(e)})}toOperationNode(){return i(this,j).executor.transformQuery(i(this,j).queryNode,i(this,j).queryId)}compile(){return i(this,j).executor.compileQuery(this.toOperationNode(),i(this,j).queryId)}async execute(){const e=this.compile(),t=await i(this,j).executor.executeQuery(e,i(this,j).queryId),{adapter:n}=i(this,j).executor,o=e.query;return o.returning&&n.supportsReturning||o.output&&n.supportsOutput?t.rows:[new UpdateResult(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,j).executor.stream(t,e,i(this,j).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new Se({...i(this,j),queryNode:QueryNode.cloneWithExplain(i(this,j).queryNode,e,t)}).execute()}};j=new WeakMap;let UpdateQueryBuilder=Se;preventAwait(UpdateQueryBuilder,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const CommonTableExpressionNameNode=freeze({is(r){return r.kind==="CommonTableExpressionNameNode"},create(r,e){return freeze({kind:"CommonTableExpressionNameNode",table:TableNode.create(r),columns:e?freeze(e.map(ColumnNode.create)):void 0})}}),CommonTableExpressionNode=freeze({is(r){return r.kind==="CommonTableExpressionNode"},create(r,e){return freeze({kind:"CommonTableExpressionNode",name:r,expression:e})},cloneWith(r,e){return freeze({...r,...e})}});var Pt;const di=class di{constructor(e){I(this,Pt);x(this,Pt,freeze(e))}materialized(){return new di({...i(this,Pt),node:CommonTableExpressionNode.cloneWith(i(this,Pt).node,{materialized:!0})})}notMaterialized(){return new di({...i(this,Pt),node:CommonTableExpressionNode.cloneWith(i(this,Pt).node,{materialized:!1})})}toOperationNode(){return i(this,Pt).node}};Pt=new WeakMap;let CTEBuilder=di;preventAwait(CTEBuilder,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function parseCommonTableExpression(r,e){const t=e(createQueryCreator()).toOperationNode();return isFunction(r)?r(cteBuilderFactory(t)).toOperationNode():CommonTableExpressionNode.create(parseCommonTableExpressionName(r),t)}function cteBuilderFactory(r){return e=>new CTEBuilder({node:CommonTableExpressionNode.create(parseCommonTableExpressionName(e),r)})}function parseCommonTableExpressionName(r){if(r.includes("(")){const e=r.split(/[\(\)]/),t=e[0],n=e[1].split(",").map(o=>o.trim());return CommonTableExpressionNameNode.create(t,n)}else return CommonTableExpressionNameNode.create(r)}const WithNode=freeze({is(r){return r.kind==="WithNode"},create(r,e){return freeze({kind:"WithNode",expressions:freeze([r]),...e})},cloneWithExpression(r,e){return freeze({...r,expressions:freeze([...r.expressions,e])})}}),CHARS=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function randomString(r){let e="";for(let t=0;t<r;++t)e+=randomChar();return e}function randomChar(){return CHARS[~~(Math.random()*CHARS.length)]}function createQueryId(){return new LazyQueryId}var Kr;class LazyQueryId{constructor(){I(this,Kr)}get queryId(){return i(this,Kr)===void 0&&x(this,Kr,randomString(8)),i(this,Kr)}}Kr=new WeakMap;function requireAllProps(r){return r}var fi;class OperationNodeTransformer{constructor(){oe(this,"nodeStack",[]);I(this,fi,freeze({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const t=this.transformNodeImpl(e);return this.nodeStack.pop(),freeze(t)}transformNodeImpl(e){return i(this,fi)[e.kind](e)}transformNodeList(e){return e&&freeze(e.map(t=>this.transformNode(t)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations),fetch:this.transformNode(e.fetch),top:this.transformNode(e.top)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:freeze([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues,top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),explain:this.transformNode(e.explain),limit:this.transformNode(e.limit),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,orderBy:this.transformNode(e.orderBy),filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformMergeQuery(e){return{kind:"MergeQueryNode",into:this.transformNode(e.into),using:this.transformNode(e.using),whens:this.transformNodeList(e.whens),with:this.transformNode(e.with),top:this.transformNode(e.top),endModifiers:this.transformNodeList(e.endModifiers),output:this.transformNode(e.output)}}transformMatched(e){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformCast(e){return{kind:"CastNode",expression:this.transformNode(e.expression),dataType:this.transformNode(e.dataType)}}transformFetch(e){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount),modifier:e.modifier}}transformTop(e){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e){return{kind:"OutputNode",selections:this.transformNodeList(e.selections)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}fi=new WeakMap;const ROOT_OPERATION_NODES=freeze({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0});var Gr,gr,_r,Pe,Wo,Do,Bo,Ur,$i,Fo;class WithSchemaTransformer extends OperationNodeTransformer{constructor(t){super();I(this,Pe);I(this,Gr);I(this,gr,new Set);I(this,_r,new Set);x(this,Gr,t)}transformNodeImpl(t){if(!G(this,Pe,Wo).call(this,t))return super.transformNodeImpl(t);const n=G(this,Pe,Bo).call(this,t);for(const l of n)i(this,_r).add(l);const o=G(this,Pe,Do).call(this,t);for(const l of o)i(this,gr).add(l);const a=super.transformNodeImpl(t);for(const l of o)i(this,gr).delete(l);for(const l of n)i(this,_r).delete(l);return a}transformSchemableIdentifier(t){const n=super.transformSchemableIdentifier(t);return n.schema||!i(this,gr).has(t.identifier.name)?n:{...n,schema:IdentifierNode.create(i(this,Gr))}}transformReferences(t){const n=super.transformReferences(t);return n.table.table.schema?n:{...n,table:TableNode.createWithSchema(i(this,Gr),n.table.table.identifier.name)}}}Gr=new WeakMap,gr=new WeakMap,_r=new WeakMap,Pe=new WeakSet,Wo=function(t){return t.kind in ROOT_OPERATION_NODES},Do=function(t){const n=new Set;if("name"in t&&t.name&&SchemableIdentifierNode.is(t.name)&&G(this,Pe,$i).call(this,t.name,n),"from"in t&&t.from)for(const o of t.from.froms)G(this,Pe,Ur).call(this,o,n);if("into"in t&&t.into&&G(this,Pe,Ur).call(this,t.into,n),"table"in t&&t.table&&G(this,Pe,Ur).call(this,t.table,n),"joins"in t&&t.joins)for(const o of t.joins)G(this,Pe,Ur).call(this,o.table,n);return"using"in t&&t.using&&G(this,Pe,Ur).call(this,t.using,n),n},Bo=function(t){const n=new Set;return"with"in t&&t.with&&G(this,Pe,Fo).call(this,t.with,n),n},Ur=function(t,n){const o=TableNode.is(t)?t:AliasNode.is(t)&&TableNode.is(t.node)?t.node:null;o&&G(this,Pe,$i).call(this,o.table,n)},$i=function(t,n){const o=t.identifier.name;!i(this,gr).has(o)&&!i(this,_r).has(o)&&n.add(o)},Fo=function(t,n){for(const o of t.expressions){const a=o.name.table.table.identifier.name;i(this,_r).has(a)||n.add(a)}};var qn;class WithSchemaPlugin{constructor(e){I(this,qn);x(this,qn,new WithSchemaTransformer(e))}transformQuery(e){return i(this,qn).transformNode(e.node)}async transformResult(e){return e.result}}qn=new WeakMap;const MatchedNode=freeze({is(r){return r.kind==="MatchedNode"},create(r,e=!1){return freeze({kind:"MatchedNode",not:r,bySource:e})}});function parseMergeWhen(r,e,t){return WhenNode.create(parseFilterList([MatchedNode.create(!r.isMatched,r.bySource),...e&&e.length>0?[e.length===3&&t?parseReferentialBinaryOperation(e[0],e[1],e[2]):parseValueBinaryOperationOrExpression(e)]:[]],"and",!1))}function parseMergeThen(r){return isString(r)?RawNode.create([r],[]):isOperationNodeSource(r)?r.toOperationNode():r}var Wn,Xr,Yr;class Deferred{constructor(){I(this,Wn);I(this,Xr);I(this,Yr);oe(this,"resolve",e=>{i(this,Xr)&&i(this,Xr).call(this,e)});oe(this,"reject",e=>{i(this,Yr)&&i(this,Yr).call(this,e)});x(this,Wn,new Promise((e,t)=>{x(this,Yr,t),x(this,Xr,e)}))}get promise(){return i(this,Wn)}}Wn=new WeakMap,Xr=new WeakMap,Yr=new WeakMap;const LOGGED_MESSAGES=new Set;function logOnce(r){LOGGED_MESSAGES.has(r)||(LOGGED_MESSAGES.add(r),console.log(r))}const NO_PLUGINS=freeze([]);var Or,Dn,Vi;class QueryExecutorBase{constructor(e=NO_PLUGINS){I(this,Dn);I(this,Or);x(this,Or,e)}get plugins(){return i(this,Or)}transformQuery(e,t){for(const n of i(this,Or)){const o=n.transformQuery({node:e,queryId:t});if(o.kind===e.kind)e=o;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${o.kind}`].join(" "))}return e}async executeQuery(e,t){return await this.provideConnection(async n=>{const o=await n.executeQuery(e),a=await G(this,Dn,Vi).call(this,o,t);return warnOfOutdatedDriverOrPlugins(o,a),a})}async*stream(e,t,n){const o=new Deferred,a=new Deferred;this.provideConnection(async d=>(o.resolve(d),await a.promise)).catch(d=>o.reject(d));const l=await o.promise;try{for await(const d of l.streamQuery(e,t))yield await G(this,Dn,Vi).call(this,d,n)}finally{a.resolve()}}}Or=new WeakMap,Dn=new WeakSet,Vi=async function(e,t){for(const n of i(this,Or))e=await n.transformResult({result:e,queryId:t});return e};function warnOfOutdatedDriverOrPlugins(r,e){const{numAffectedRows:t}=r;t===void 0&&r.numUpdatedOrDeletedRows===void 0||t!==void 0&&e.numAffectedRows!==void 0||logOnce("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class NoopQueryExecutor extends QueryExecutorBase{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new NoopQueryExecutor([...this.plugins,e])}withPlugins(e){return new NoopQueryExecutor([...this.plugins,...e])}withPluginAtFront(e){return new NoopQueryExecutor([e,...this.plugins])}withoutPlugins(){return new NoopQueryExecutor([])}}const NOOP_QUERY_EXECUTOR=new NoopQueryExecutor;class MergeResult{constructor(e){oe(this,"numChangedRows");this.numChangedRows=e}}var ct;const Vr=class Vr{constructor(e){I(this,ct);x(this,ct,freeze(e))}modifyEnd(e){return new Vr({...i(this,ct),queryNode:QueryNode.cloneWithEndModifier(i(this,ct).queryNode,e.toOperationNode())})}top(e,t){return new Vr({...i(this,ct),queryNode:QueryNode.cloneWithTop(i(this,ct).queryNode,parseTop(e,t))})}using(...e){return new WheneableMergeQueryBuilder({...i(this,ct),queryNode:MergeQueryNode.cloneWithUsing(i(this,ct).queryNode,parseJoin("Using",e))})}output(e){return new Vr({...i(this,ct),queryNode:QueryNode.cloneWithOutput(i(this,ct).queryNode,parseSelectArg(e))})}outputAll(e){return new Vr({...i(this,ct),queryNode:QueryNode.cloneWithOutput(i(this,ct).queryNode,parseSelectAll(e))})}};ct=new WeakMap;let MergeQueryBuilder=Vr;preventAwait(MergeQueryBuilder,"don't await MergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var ve,Nt,ui,pr;const mr=class mr{constructor(e){I(this,Nt);I(this,ve);x(this,ve,freeze(e))}modifyEnd(e){return new mr({...i(this,ve),queryNode:QueryNode.cloneWithEndModifier(i(this,ve).queryNode,e.toOperationNode())})}top(e,t){return new mr({...i(this,ve),queryNode:QueryNode.cloneWithTop(i(this,ve).queryNode,parseTop(e,t))})}whenMatched(){return G(this,Nt,ui).call(this,[])}whenMatchedAnd(...e){return G(this,Nt,ui).call(this,e)}whenMatchedAndRef(e,t,n){return G(this,Nt,ui).call(this,[e,t,n],!0)}whenNotMatched(){return G(this,Nt,pr).call(this,[])}whenNotMatchedAnd(...e){return G(this,Nt,pr).call(this,e)}whenNotMatchedAndRef(e,t,n){return G(this,Nt,pr).call(this,[e,t,n],!0)}whenNotMatchedBySource(){return G(this,Nt,pr).call(this,[],!1,!0)}whenNotMatchedBySourceAnd(...e){return G(this,Nt,pr).call(this,e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,n){return G(this,Nt,pr).call(this,[e,t,n],!0,!0)}output(e){return new mr({...i(this,ve),queryNode:QueryNode.cloneWithOutput(i(this,ve).queryNode,parseSelectArg(e))})}outputAll(e){return new mr({...i(this,ve),queryNode:QueryNode.cloneWithOutput(i(this,ve).queryNode,parseSelectAll(e))})}$call(e){return e(this)}$if(e,t){return e?t(this):new mr({...i(this,ve)})}toOperationNode(){return i(this,ve).executor.transformQuery(i(this,ve).queryNode,i(this,ve).queryId)}compile(){return i(this,ve).executor.compileQuery(this.toOperationNode(),i(this,ve).queryId)}async execute(){const e=this.compile(),t=await i(this,ve).executor.executeQuery(e,i(this,ve).queryId);return e.query.output&&i(this,ve).executor.adapter.supportsOutput?t.rows:[new MergeResult(t.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}};ve=new WeakMap,Nt=new WeakSet,ui=function(e,t){return new MatchedThenableMergeQueryBuilder({...i(this,ve),queryNode:MergeQueryNode.cloneWithWhen(i(this,ve).queryNode,parseMergeWhen({isMatched:!0},e,t))})},pr=function(e,t=!1,n=!1){const o={...i(this,ve),queryNode:MergeQueryNode.cloneWithWhen(i(this,ve).queryNode,parseMergeWhen({isMatched:!1,bySource:n},e,t))},a=n?MatchedThenableMergeQueryBuilder:NotMatchedThenableMergeQueryBuilder;return new a(o)};let WheneableMergeQueryBuilder=mr;preventAwait(WheneableMergeQueryBuilder,"don't await WheneableMergeQueryBuilder instances directly. To execute the query you need to call `execute`.");var St;class MatchedThenableMergeQueryBuilder{constructor(e){I(this,St);x(this,St,freeze(e))}thenDelete(){return new WheneableMergeQueryBuilder({...i(this,St),queryNode:MergeQueryNode.cloneWithThen(i(this,St).queryNode,parseMergeThen("delete"))})}thenDoNothing(){return new WheneableMergeQueryBuilder({...i(this,St),queryNode:MergeQueryNode.cloneWithThen(i(this,St).queryNode,parseMergeThen("do nothing"))})}thenUpdate(e){return new WheneableMergeQueryBuilder({...i(this,St),queryNode:MergeQueryNode.cloneWithThen(i(this,St).queryNode,parseMergeThen(e(new UpdateQueryBuilder({queryId:i(this,St).queryId,executor:NOOP_QUERY_EXECUTOR,queryNode:UpdateQueryNode.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(t=>t.set(...e))}}St=new WeakMap;preventAwait(MatchedThenableMergeQueryBuilder,"don't await MatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var nr;class NotMatchedThenableMergeQueryBuilder{constructor(e){I(this,nr);x(this,nr,freeze(e))}thenDoNothing(){return new WheneableMergeQueryBuilder({...i(this,nr),queryNode:MergeQueryNode.cloneWithThen(i(this,nr).queryNode,parseMergeThen("do nothing"))})}thenInsertValues(e){const[t,n]=parseInsertExpression(e);return new WheneableMergeQueryBuilder({...i(this,nr),queryNode:MergeQueryNode.cloneWithThen(i(this,nr).queryNode,parseMergeThen(InsertQueryNode.cloneWith(InsertQueryNode.createWithoutInto(),{columns:t,values:n})))})}}nr=new WeakMap;preventAwait(NotMatchedThenableMergeQueryBuilder,"don't await NotMatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var he;const Nr=class Nr{constructor(e){I(this,he);x(this,he,freeze(e))}selectFrom(e){return createSelectQueryBuilder({queryId:createQueryId(),executor:i(this,he).executor,queryNode:SelectQueryNode.createFrom(parseTableExpressionOrList(e),i(this,he).withNode)})}selectNoFrom(e){return createSelectQueryBuilder({queryId:createQueryId(),executor:i(this,he).executor,queryNode:SelectQueryNode.cloneWithSelections(SelectQueryNode.create(i(this,he).withNode),parseSelectArg(e))})}insertInto(e){return new InsertQueryBuilder({queryId:createQueryId(),executor:i(this,he).executor,queryNode:InsertQueryNode.create(parseTable(e),i(this,he).withNode)})}replaceInto(e){return new InsertQueryBuilder({queryId:createQueryId(),executor:i(this,he).executor,queryNode:InsertQueryNode.create(parseTable(e),i(this,he).withNode,!0)})}deleteFrom(e){return new DeleteQueryBuilder({queryId:createQueryId(),executor:i(this,he).executor,queryNode:DeleteQueryNode.create(parseTableExpressionOrList(e),i(this,he).withNode)})}updateTable(e){return new UpdateQueryBuilder({queryId:createQueryId(),executor:i(this,he).executor,queryNode:UpdateQueryNode.create(parseTableExpression(e),i(this,he).withNode)})}mergeInto(e){return new MergeQueryBuilder({queryId:createQueryId(),executor:i(this,he).executor,queryNode:MergeQueryNode.create(parseAliasedTable(e),i(this,he).withNode)})}with(e,t){const n=parseCommonTableExpression(e,t);return new Nr({...i(this,he),withNode:i(this,he).withNode?WithNode.cloneWithExpression(i(this,he).withNode,n):WithNode.create(n)})}withRecursive(e,t){const n=parseCommonTableExpression(e,t);return new Nr({...i(this,he),withNode:i(this,he).withNode?WithNode.cloneWithExpression(i(this,he).withNode,n):WithNode.create(n,{recursive:!0})})}withPlugin(e){return new Nr({...i(this,he),executor:i(this,he).executor.withPlugin(e)})}withoutPlugins(){return new Nr({...i(this,he),executor:i(this,he).executor.withoutPlugins()})}withSchema(e){return new Nr({...i(this,he),executor:i(this,he).executor.withPluginAtFront(new WithSchemaPlugin(e))})}};he=new WeakMap;let QueryCreator=Nr;function createQueryCreator(){return new QueryCreator({executor:NOOP_QUERY_EXECUTOR})}function createJoinBuilder(r,e){return new JoinBuilder({joinNode:JoinNode.create(r,parseTableExpression(e))})}function createOverBuilder(){return new OverBuilder({overNode:OverNode.create()})}function parseJoin(r,e){if(e.length===3)return parseSingleOnJoin(r,e[0],e[1],e[2]);if(e.length===2)return parseCallbackJoin(r,e[0],e[1]);throw new Error("not implemented")}function parseCallbackJoin(r,e,t){return t(createJoinBuilder(r,e)).toOperationNode()}function parseSingleOnJoin(r,e,t,n){return JoinNode.createWithOn(r,parseTableExpression(e),parseReferentialBinaryOperation(t,"=",n))}const OffsetNode=freeze({is(r){return r.kind==="OffsetNode"},create(r){return freeze({kind:"OffsetNode",offset:r})}}),GroupByItemNode=freeze({is(r){return r.kind==="GroupByItemNode"},create(r){return freeze({kind:"GroupByItemNode",groupBy:r})}});function parseGroupBy(r){return r=isFunction(r)?r(expressionBuilder()):r,parseReferenceExpressionOrList(r).map(GroupByItemNode.create)}const SetOperationNode=freeze({is(r){return r.kind==="SetOperationNode"},create(r,e,t){return freeze({kind:"SetOperationNode",operator:r,expression:e,all:t})}});function parseSetOperations(r,e,t){return isFunction(e)&&(e=e(createExpressionBuilder())),isReadonlyArray(e)||(e=[e]),e.map(n=>SetOperationNode.create(r,parseExpression(n),t))}var Mt;const hi=class hi{constructor(e){I(this,Mt);x(this,Mt,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}or(...e){return new OrWrapper(OrNode.create(i(this,Mt),parseValueBinaryOperationOrExpression(e)))}and(...e){return new AndWrapper(AndNode.create(i(this,Mt),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new hi(i(this,Mt))}$notNull(){return new hi(i(this,Mt))}toOperationNode(){return i(this,Mt)}};Mt=new WeakMap;let ExpressionWrapper=hi;var Zr,ir;class AliasedExpressionWrapper{constructor(e,t){I(this,Zr);I(this,ir);x(this,Zr,e),x(this,ir,t)}get expression(){return i(this,Zr)}get alias(){return i(this,ir)}toOperationNode(){return AliasNode.create(i(this,Zr).toOperationNode(),isOperationNodeSource(i(this,ir))?i(this,ir).toOperationNode():IdentifierNode.create(i(this,ir)))}}Zr=new WeakMap,ir=new WeakMap;var Tr;const pi=class pi{constructor(e){I(this,Tr);x(this,Tr,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}or(...e){return new pi(OrNode.create(i(this,Tr),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new pi(i(this,Tr))}toOperationNode(){return ParensNode.create(i(this,Tr))}};Tr=new WeakMap;let OrWrapper=pi;var Ir;const mi=class mi{constructor(e){I(this,Ir);x(this,Ir,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}and(...e){return new mi(AndNode.create(i(this,Ir),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new mi(i(this,Ir))}toOperationNode(){return ParensNode.create(i(this,Ir))}};Ir=new WeakMap;let AndWrapper=mi;const FetchNode={is(r){return r.kind==="FetchNode"},create(r,e){return{kind:"FetchNode",rowCount:ValueNode.create(r),modifier:e}}};function parseFetch(r,e){if(!isNumber(r)&&!isBigInt(r))throw new Error(`Invalid fetch row count: ${r}`);if(!isFetchModifier(e))throw new Error(`Invalid fetch modifier: ${e}`);return FetchNode.create(r,e)}function isFetchModifier(r){return r==="only"||r==="with ties"}var D;const ee=class ee{constructor(e){I(this,D);x(this,D,freeze(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithWhere(i(this,D).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new ee({...i(this,D),queryNode:QueryNode.cloneWithWhere(i(this,D).queryNode,parseReferentialBinaryOperation(e,t,n))})}having(...e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithHaving(i(this,D).queryNode,parseValueBinaryOperationOrExpression(e))})}havingRef(e,t,n){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithHaving(i(this,D).queryNode,parseReferentialBinaryOperation(e,t,n))})}select(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithSelections(i(this,D).queryNode,parseSelectArg(e))})}distinctOn(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithDistinctOn(i(this,D).queryNode,parseReferenceExpressionOrList(e))})}modifyFront(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithFrontModifier(i(this,D).queryNode,SelectModifierNode.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithEndModifier(i(this,D).queryNode,SelectModifierNode.createWithExpression(e.toOperationNode()))})}distinct(){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithFrontModifier(i(this,D).queryNode,SelectModifierNode.create("Distinct"))})}forUpdate(e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithEndModifier(i(this,D).queryNode,SelectModifierNode.create("ForUpdate",e?asArray(e).map(parseTable):void 0))})}forShare(e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithEndModifier(i(this,D).queryNode,SelectModifierNode.create("ForShare",e?asArray(e).map(parseTable):void 0))})}forKeyShare(e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithEndModifier(i(this,D).queryNode,SelectModifierNode.create("ForKeyShare",e?asArray(e).map(parseTable):void 0))})}forNoKeyUpdate(e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithEndModifier(i(this,D).queryNode,SelectModifierNode.create("ForNoKeyUpdate",e?asArray(e).map(parseTable):void 0))})}skipLocked(){return new ee({...i(this,D),queryNode:QueryNode.cloneWithEndModifier(i(this,D).queryNode,SelectModifierNode.create("SkipLocked"))})}noWait(){return new ee({...i(this,D),queryNode:QueryNode.cloneWithEndModifier(i(this,D).queryNode,SelectModifierNode.create("NoWait"))})}selectAll(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithSelections(i(this,D).queryNode,parseSelectAll(e))})}innerJoin(...e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithJoin(i(this,D).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithJoin(i(this,D).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithJoin(i(this,D).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithJoin(i(this,D).queryNode,parseJoin("FullJoin",e))})}innerJoinLateral(...e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithJoin(i(this,D).queryNode,parseJoin("LateralInnerJoin",e))})}leftJoinLateral(...e){return new ee({...i(this,D),queryNode:QueryNode.cloneWithJoin(i(this,D).queryNode,parseJoin("LateralLeftJoin",e))})}orderBy(...e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithOrderByItems(i(this,D).queryNode,parseOrderBy(e))})}groupBy(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithGroupByItems(i(this,D).queryNode,parseGroupBy(e))})}limit(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithLimit(i(this,D).queryNode,LimitNode.create(parseValueExpression(e)))})}offset(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithOffset(i(this,D).queryNode,OffsetNode.create(parseValueExpression(e)))})}fetch(e,t="only"){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithFetch(i(this,D).queryNode,parseFetch(e,t))})}top(e,t){return new ee({...i(this,D),queryNode:QueryNode.cloneWithTop(i(this,D).queryNode,parseTop(e,t))})}union(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,D).queryNode,parseSetOperations("union",e,!1))})}unionAll(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,D).queryNode,parseSetOperations("union",e,!0))})}intersect(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,D).queryNode,parseSetOperations("intersect",e,!1))})}intersectAll(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,D).queryNode,parseSetOperations("intersect",e,!0))})}except(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,D).queryNode,parseSetOperations("except",e,!1))})}exceptAll(e){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,D).queryNode,parseSetOperations("except",e,!0))})}as(e){return new AliasedSelectQueryBuilderImpl(this,e)}clearSelect(){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithoutSelections(i(this,D).queryNode)})}clearWhere(){return new ee({...i(this,D),queryNode:QueryNode.cloneWithoutWhere(i(this,D).queryNode)})}clearLimit(){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithoutLimit(i(this,D).queryNode)})}clearOffset(){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithoutOffset(i(this,D).queryNode)})}clearOrderBy(){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithoutOrderBy(i(this,D).queryNode)})}clearGroupBy(){return new ee({...i(this,D),queryNode:SelectQueryNode.cloneWithoutGroupBy(i(this,D).queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new ee({...i(this,D)})}$castTo(){return new ee(i(this,D))}$narrowType(){return new ee(i(this,D))}$assertType(){return new ee(i(this,D))}$asTuple(){return new ExpressionWrapper(this.toOperationNode())}withPlugin(e){return new ee({...i(this,D),executor:i(this,D).executor.withPlugin(e)})}toOperationNode(){return i(this,D).executor.transformQuery(i(this,D).queryNode,i(this,D).queryId)}compile(){return i(this,D).executor.compileQuery(this.toOperationNode(),i(this,D).queryId)}async execute(){const e=this.compile();return(await i(this,D).executor.executeQuery(e,i(this,D).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,D).executor.stream(t,e,i(this,D).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new ee({...i(this,D),queryNode:QueryNode.cloneWithExplain(i(this,D).queryNode,e,t)}).execute()}};D=new WeakMap;let SelectQueryBuilderImpl=ee;preventAwait(SelectQueryBuilderImpl,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function createSelectQueryBuilder(r){return new SelectQueryBuilderImpl(r)}var en,tn;class AliasedSelectQueryBuilderImpl{constructor(e,t){I(this,en);I(this,tn);x(this,en,e),x(this,tn,t)}get expression(){return i(this,en)}get alias(){return i(this,tn)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return AliasNode.create(i(this,en).toOperationNode(),IdentifierNode.create(i(this,tn)))}}en=new WeakMap,tn=new WeakMap;preventAwait(AliasedSelectQueryBuilderImpl,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const AggregateFunctionNode=freeze({is(r){return r.kind==="AggregateFunctionNode"},create(r,e=[]){return freeze({kind:"AggregateFunctionNode",func:r,aggregated:e})},cloneWithDistinct(r){return freeze({...r,distinct:!0})},cloneWithOrderBy(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithFilter(r,e){return freeze({...r,filter:r.filter?WhereNode.cloneWithOperation(r.filter,"And",e):WhereNode.create(e)})},cloneWithOrFilter(r,e){return freeze({...r,filter:r.filter?WhereNode.cloneWithOperation(r.filter,"Or",e):WhereNode.create(e)})},cloneWithOver(r,e){return freeze({...r,over:e})}}),FunctionNode=freeze({is(r){return r.kind==="FunctionNode"},create(r,e){return freeze({kind:"FunctionNode",func:r,arguments:e})}});var je;const zt=class zt{constructor(e){I(this,je);x(this,je,freeze(e))}get expressionType(){}as(e){return new AliasedAggregateFunctionBuilder(this,e)}distinct(){return new zt({...i(this,je),aggregateFunctionNode:AggregateFunctionNode.cloneWithDistinct(i(this,je).aggregateFunctionNode)})}orderBy(e,t){return new zt({...i(this,je),aggregateFunctionNode:AggregateFunctionNode.cloneWithOrderBy(i(this,je).aggregateFunctionNode,parseOrderBy([e,t]))})}filterWhere(...e){return new zt({...i(this,je),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(i(this,je).aggregateFunctionNode,parseValueBinaryOperationOrExpression(e))})}filterWhereRef(e,t,n){return new zt({...i(this,je),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(i(this,je).aggregateFunctionNode,parseReferentialBinaryOperation(e,t,n))})}over(e){const t=createOverBuilder();return new zt({...i(this,je),aggregateFunctionNode:AggregateFunctionNode.cloneWithOver(i(this,je).aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new zt(i(this,je))}$notNull(){return new zt(i(this,je))}toOperationNode(){return i(this,je).aggregateFunctionNode}};je=new WeakMap;let AggregateFunctionBuilder=zt;preventAwait(AggregateFunctionBuilder,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var rn,nn;class AliasedAggregateFunctionBuilder{constructor(e,t){I(this,rn);I(this,nn);x(this,rn,e),x(this,nn,t)}get expression(){return i(this,rn)}get alias(){return i(this,nn)}toOperationNode(){return AliasNode.create(i(this,rn).toOperationNode(),IdentifierNode.create(i(this,nn)))}}rn=new WeakMap,nn=new WeakMap;function createFunctionModule(){const r=(t,n)=>new ExpressionWrapper(FunctionNode.create(t,parseReferenceExpressionOrList(n??[]))),e=(t,n)=>new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create(t,n?parseReferenceExpressionOrList(n):void 0)});return Object.assign(r,{agg:e,avg(t){return e("avg",[t])},coalesce(...t){return r("coalesce",t)},count(t){return e("count",[t])},countAll(t){return new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create("count",parseSelectAll(t))})},max(t){return e("max",[t])},min(t){return e("min",[t])},sum(t){return e("sum",[t])},any(t){return r("any",[t])},jsonAgg(t){return new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create("json_agg",[isString(t)?parseTable(t):t.toOperationNode()])})},toJson(t){return new ExpressionWrapper(FunctionNode.create("to_json",[isString(t)?parseTable(t):t.toOperationNode()]))}})}const UnaryOperationNode=freeze({is(r){return r.kind==="UnaryOperationNode"},create(r,e){return freeze({kind:"UnaryOperationNode",operator:r,operand:e})}});function parseUnaryOperation(r,e){return UnaryOperationNode.create(OperatorNode.create(r),parseReferenceExpression(e))}const CaseNode=freeze({is(r){return r.kind==="CaseNode"},create(r){return freeze({kind:"CaseNode",value:r})},cloneWithWhen(r,e){return freeze({...r,when:freeze(r.when?[...r.when,e]:[e])})},cloneWithThen(r,e){return freeze({...r,when:r.when?freeze([...r.when.slice(0,-1),WhenNode.cloneWithResult(r.when[r.when.length-1],e)]):void 0})},cloneWith(r,e){return freeze({...r,...e})}});var sn;class CaseBuilder{constructor(e){I(this,sn);x(this,sn,freeze(e))}when(...e){return new CaseThenBuilder({...i(this,sn),node:CaseNode.cloneWithWhen(i(this,sn).node,WhenNode.create(parseValueBinaryOperationOrExpression(e)))})}}sn=new WeakMap;var on;class CaseThenBuilder{constructor(e){I(this,on);x(this,on,freeze(e))}then(e){return new CaseWhenBuilder({...i(this,on),node:CaseNode.cloneWithThen(i(this,on).node,isSafeImmediateValue(e)?parseSafeImmediateValue(e):parseValueExpression(e))})}}on=new WeakMap;var Wt;class CaseWhenBuilder{constructor(e){I(this,Wt);x(this,Wt,freeze(e))}when(...e){return new CaseThenBuilder({...i(this,Wt),node:CaseNode.cloneWithWhen(i(this,Wt).node,WhenNode.create(parseValueBinaryOperationOrExpression(e)))})}else(e){return new CaseEndBuilder({...i(this,Wt),node:CaseNode.cloneWith(i(this,Wt).node,{else:isSafeImmediateValue(e)?parseSafeImmediateValue(e):parseValueExpression(e)})})}end(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,Wt).node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,Wt).node,{isStatement:!0}))}}Wt=new WeakMap;var an;class CaseEndBuilder{constructor(e){I(this,an);x(this,an,freeze(e))}end(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,an).node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,an).node,{isStatement:!0}))}}an=new WeakMap;const JSONPathLegNode=freeze({is(r){return r.kind==="JSONPathLegNode"},create(r,e){return freeze({kind:"JSONPathLegNode",type:r,value:e})}});var Dt,Bn,Ji;class JSONPathBuilder{constructor(e){I(this,Bn);I(this,Dt);x(this,Dt,e)}at(e){return G(this,Bn,Ji).call(this,"ArrayLocation",e)}key(e){return G(this,Bn,Ji).call(this,"Member",e)}}Dt=new WeakMap,Bn=new WeakSet,Ji=function(e,t){return JSONReferenceNode.is(i(this,Dt))?new TraversedJSONPathBuilder(JSONReferenceNode.cloneWithTraversal(i(this,Dt),JSONPathNode.is(i(this,Dt).traversal)?JSONPathNode.cloneWithLeg(i(this,Dt).traversal,JSONPathLegNode.create(e,t)):JSONOperatorChainNode.cloneWithValue(i(this,Dt).traversal,ValueNode.createImmediate(t)))):new TraversedJSONPathBuilder(JSONPathNode.cloneWithLeg(i(this,Dt),JSONPathLegNode.create(e,t)))};var Sr;const Ni=class Ni extends JSONPathBuilder{constructor(t){super(t);I(this,Sr);x(this,Sr,t)}get expressionType(){}as(t){return new AliasedJSONPathBuilder(this,t)}$castTo(){return new Ni(i(this,Sr))}$notNull(){return new Ni(i(this,Sr))}toOperationNode(){return i(this,Sr)}};Sr=new WeakMap;let TraversedJSONPathBuilder=Ni;var un,sr;class AliasedJSONPathBuilder{constructor(e,t){I(this,un);I(this,sr);x(this,un,e),x(this,sr,t)}get expression(){return i(this,un)}get alias(){return i(this,sr)}toOperationNode(){return AliasNode.create(i(this,un).toOperationNode(),isOperationNodeSource(i(this,sr))?i(this,sr).toOperationNode():IdentifierNode.create(i(this,sr)))}}un=new WeakMap,sr=new WeakMap;const TupleNode=freeze({is(r){return r.kind==="TupleNode"},create(r){return freeze({kind:"TupleNode",values:freeze(r)})}}),SIMPLE_COLUMN_DATA_TYPES=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],COLUMN_DATA_TYPE_REGEX=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],DataTypeNode=freeze({is(r){return r.kind==="DataTypeNode"},create(r){return freeze({kind:"DataTypeNode",dataType:r})}});function isColumnDataType(r){return!!(SIMPLE_COLUMN_DATA_TYPES.includes(r)||COLUMN_DATA_TYPE_REGEX.some(e=>e.test(r)))}function parseDataTypeExpression(r){if(isOperationNodeSource(r))return r.toOperationNode();if(isColumnDataType(r))return DataTypeNode.create(r);throw new Error(`invalid column data type ${JSON.stringify(r)}`)}const CastNode=freeze({is(r){return r.kind==="CastNode"},create(r,e){return freeze({kind:"CastNode",expression:r,dataType:e})}});function createExpressionBuilder(r=NOOP_QUERY_EXECUTOR){function e(o,a,l){return new ExpressionWrapper(parseValueBinaryOperation(o,a,l))}function t(o,a){return new ExpressionWrapper(parseUnaryOperation(o,a))}const n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(o){return createSelectQueryBuilder({queryId:createQueryId(),executor:r,queryNode:SelectQueryNode.createFrom(parseTableExpressionOrList(o))})},case(o){return new CaseBuilder({node:CaseNode.create(isUndefined(o)?void 0:parseReferenceExpression(o))})},ref(o,a){return isUndefined(a)?new ExpressionWrapper(parseStringReference(o)):new JSONPathBuilder(parseJSONReference(o,a))},jsonPath(){return new JSONPathBuilder(JSONPathNode.create())},table(o){return new ExpressionWrapper(parseTable(o))},val(o){return new ExpressionWrapper(parseValueExpression(o))},refTuple(...o){return new ExpressionWrapper(TupleNode.create(o.map(parseReferenceExpression)))},tuple(...o){return new ExpressionWrapper(TupleNode.create(o.map(parseValueExpression)))},lit(o){return new ExpressionWrapper(parseSafeImmediateValue(o))},unary:t,not(o){return t("not",o)},exists(o){return t("exists",o)},neg(o){return t("-",o)},between(o,a,l){return new ExpressionWrapper(BinaryOperationNode.create(parseReferenceExpression(o),OperatorNode.create("between"),AndNode.create(parseValueExpression(a),parseValueExpression(l))))},betweenSymmetric(o,a,l){return new ExpressionWrapper(BinaryOperationNode.create(parseReferenceExpression(o),OperatorNode.create("between symmetric"),AndNode.create(parseValueExpression(a),parseValueExpression(l))))},and(o){return isReadonlyArray(o)?new ExpressionWrapper(parseFilterList(o,"and")):new ExpressionWrapper(parseFilterObject(o,"and"))},or(o){return isReadonlyArray(o)?new ExpressionWrapper(parseFilterList(o,"or")):new ExpressionWrapper(parseFilterObject(o,"or"))},parens(...o){const a=parseValueBinaryOperationOrExpression(o);return ParensNode.is(a)?new ExpressionWrapper(a):new ExpressionWrapper(ParensNode.create(a))},cast(o,a){return new ExpressionWrapper(CastNode.create(parseReferenceExpression(o),parseDataTypeExpression(a)))},withSchema(o){return createExpressionBuilder(r.withPluginAtFront(new WithSchemaPlugin(o)))}});return n.fn=createFunctionModule(),n.eb=n,n}function expressionBuilder(r){return createExpressionBuilder()}function parseExpression(r){if(isOperationNodeSource(r))return r.toOperationNode();if(isFunction(r))return r(expressionBuilder()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(r)}`)}function parseAliasedExpression(r){if(isOperationNodeSource(r))return r.toOperationNode();if(isFunction(r))return r(expressionBuilder()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(r)}`)}function isExpressionOrFactory(r){return isExpression(r)||isAliasedExpression(r)||isFunction(r)}function parseTableExpressionOrList(r){return isReadonlyArray(r)?r.map(e=>parseTableExpression(e)):[parseTableExpression(r)]}function parseTableExpression(r){return isString(r)?parseAliasedTable(r):parseAliasedExpression(r)}function parseAliasedTable(r){const e=" as ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$1);return AliasNode.create(parseTable(t),IdentifierNode.create(n))}else return parseTable(r)}function parseTable(r){const e=".";if(r.includes(e)){const[t,n]=r.split(e).map(trim$1);return TableNode.createWithSchema(t,n)}else return TableNode.create(r)}function trim$1(r){return r.trim()}const AddColumnNode=freeze({is(r){return r.kind==="AddColumnNode"},create(r){return freeze({kind:"AddColumnNode",column:r})}}),ColumnDefinitionNode=freeze({is(r){return r.kind==="ColumnDefinitionNode"},create(r,e){return freeze({kind:"ColumnDefinitionNode",column:ColumnNode.create(r),dataType:e})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):[e]})},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):[e]})},cloneWith(r,e){return freeze({...r,...e})}}),DropColumnNode=freeze({is(r){return r.kind==="DropColumnNode"},create(r){return freeze({kind:"DropColumnNode",column:ColumnNode.create(r)})}}),RenameColumnNode=freeze({is(r){return r.kind==="RenameColumnNode"},create(r,e){return freeze({kind:"RenameColumnNode",column:ColumnNode.create(r),renameTo:ColumnNode.create(e)})}}),CheckConstraintNode=freeze({is(r){return r.kind==="CheckConstraintNode"},create(r,e){return freeze({kind:"CheckConstraintNode",expression:r,name:e?IdentifierNode.create(e):void 0})}}),ON_MODIFY_FOREIGN_ACTIONS=["no action","restrict","cascade","set null","set default"],ReferencesNode=freeze({is(r){return r.kind==="ReferencesNode"},create(r,e){return freeze({kind:"ReferencesNode",table:r,columns:freeze([...e])})},cloneWithOnDelete(r,e){return freeze({...r,onDelete:e})},cloneWithOnUpdate(r,e){return freeze({...r,onUpdate:e})}});function parseDefaultValueExpression(r){return isOperationNodeSource(r)?r.toOperationNode():ValueNode.createImmediate(r)}const GeneratedNode=freeze({is(r){return r.kind==="GeneratedNode"},create(r){return freeze({kind:"GeneratedNode",...r})},createWithExpression(r){return freeze({kind:"GeneratedNode",always:!0,expression:r})},cloneWith(r,e){return freeze({...r,...e})}}),DefaultValueNode=freeze({is(r){return r.kind==="DefaultValueNode"},create(r){return freeze({kind:"DefaultValueNode",defaultValue:r})}});function parseOnModifyForeignAction(r){if(ON_MODIFY_FOREIGN_ACTIONS.includes(r))return r;throw new Error(`invalid OnModifyForeignAction ${r}`)}var pe;const We=class We{constructor(e){I(this,pe);x(this,pe,e)}autoIncrement(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{autoIncrement:!0}))}identity(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{identity:!0}))}primaryKey(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{primaryKey:!0}))}references(e){const t=parseStringReference(e);if(!t.table||SelectAllNode.is(t.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{references:ReferencesNode.create(t.table,[t.column])}))}onDelete(e){if(!i(this,pe).references)throw new Error("on delete constraint can only be added for foreign keys");return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{references:ReferencesNode.cloneWithOnDelete(i(this,pe).references,parseOnModifyForeignAction(e))}))}onUpdate(e){if(!i(this,pe).references)throw new Error("on update constraint can only be added for foreign keys");return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{references:ReferencesNode.cloneWithOnUpdate(i(this,pe).references,parseOnModifyForeignAction(e))}))}unique(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{unique:!0}))}notNull(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{notNull:!0}))}unsigned(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{unsigned:!0}))}defaultTo(e){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{defaultTo:DefaultValueNode.create(parseDefaultValueExpression(e))}))}check(e){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{check:CheckConstraintNode.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{generated:GeneratedNode.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{generated:GeneratedNode.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{generated:GeneratedNode.create({identity:!0,byDefault:!0})}))}stored(){if(!i(this,pe).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{generated:GeneratedNode.cloneWith(i(this,pe).generated,{stored:!0})}))}modifyFront(e){return new We(ColumnDefinitionNode.cloneWithFrontModifier(i(this,pe),e.toOperationNode()))}nullsNotDistinct(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{nullsNotDistinct:!0}))}ifNotExists(){return new We(ColumnDefinitionNode.cloneWith(i(this,pe),{ifNotExists:!0}))}modifyEnd(e){return new We(ColumnDefinitionNode.cloneWithEndModifier(i(this,pe),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return i(this,pe)}};pe=new WeakMap;let ColumnDefinitionBuilder=We;preventAwait(ColumnDefinitionBuilder,"don't await ColumnDefinitionBuilder instances directly.");const ModifyColumnNode=freeze({is(r){return r.kind==="ModifyColumnNode"},create(r){return freeze({kind:"ModifyColumnNode",column:r})}}),ForeignKeyConstraintNode=freeze({is(r){return r.kind==="ForeignKeyConstraintNode"},create(r,e,t,n){return freeze({kind:"ForeignKeyConstraintNode",columns:r,references:ReferencesNode.create(e,t),name:n?IdentifierNode.create(n):void 0})},cloneWith(r,e){return freeze({...r,...e})}});var vr;const yi=class yi{constructor(e){I(this,vr);x(this,vr,e)}onDelete(e){return new yi(ForeignKeyConstraintNode.cloneWith(i(this,vr),{onDelete:parseOnModifyForeignAction(e)}))}onUpdate(e){return new yi(ForeignKeyConstraintNode.cloneWith(i(this,vr),{onUpdate:parseOnModifyForeignAction(e)}))}$call(e){return e(this)}toOperationNode(){return i(this,vr)}};vr=new WeakMap;let ForeignKeyConstraintBuilder=yi;preventAwait(ForeignKeyConstraintBuilder,"don't await ForeignKeyConstraintBuilder instances directly.");const AddConstraintNode=freeze({is(r){return r.kind==="AddConstraintNode"},create(r){return freeze({kind:"AddConstraintNode",constraint:r})}}),UniqueConstraintNode=freeze({is(r){return r.kind==="UniqueConstraintNode"},create(r,e,t){return freeze({kind:"UniqueConstraintNode",columns:freeze(r.map(ColumnNode.create)),name:e?IdentifierNode.create(e):void 0,nullsNotDistinct:t})},cloneWith(r,e){return freeze({...r,...e})}}),DropConstraintNode=freeze({is(r){return r.kind==="DropConstraintNode"},create(r){return freeze({kind:"DropConstraintNode",constraintName:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}}),AlterColumnNode=freeze({is(r){return r.kind==="AlterColumnNode"},create(r,e,t){return freeze({kind:"AlterColumnNode",column:ColumnNode.create(r),[e]:t})}});var Ut;class AlterColumnBuilder{constructor(e){I(this,Ut);x(this,Ut,e)}setDataType(e){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,Ut),"dataType",parseDataTypeExpression(e)))}setDefault(e){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,Ut),"setDefault",parseDefaultValueExpression(e)))}dropDefault(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,Ut),"dropDefault",!0))}setNotNull(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,Ut),"setNotNull",!0))}dropNotNull(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,Ut),"dropNotNull",!0))}$call(e){return e(this)}}Ut=new WeakMap;preventAwait(AlterColumnBuilder,"don't await AlterColumnBuilder instances");var Fn;class AlteredColumnBuilder{constructor(e){I(this,Fn);x(this,Fn,e)}toOperationNode(){return i(this,Fn)}}Fn=new WeakMap;preventAwait(AlteredColumnBuilder,"don't await AlteredColumnBuilder instances");var vt;class AlterTableExecutor{constructor(e){I(this,vt);x(this,vt,freeze(e))}toOperationNode(){return i(this,vt).executor.transformQuery(i(this,vt).node,i(this,vt).queryId)}compile(){return i(this,vt).executor.compileQuery(this.toOperationNode(),i(this,vt).queryId)}async execute(){await i(this,vt).executor.executeQuery(this.compile(),i(this,vt).queryId)}}vt=new WeakMap;preventAwait(AlterTableExecutor,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var tt;const bi=class bi{constructor(e){I(this,tt);x(this,tt,freeze(e))}onDelete(e){return new bi({...i(this,tt),constraintBuilder:i(this,tt).constraintBuilder.onDelete(e)})}onUpdate(e){return new bi({...i(this,tt),constraintBuilder:i(this,tt).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return i(this,tt).executor.transformQuery(AlterTableNode.cloneWithTableProps(i(this,tt).node,{addConstraint:AddConstraintNode.create(i(this,tt).constraintBuilder.toOperationNode())}),i(this,tt).queryId)}compile(){return i(this,tt).executor.compileQuery(this.toOperationNode(),i(this,tt).queryId)}async execute(){await i(this,tt).executor.executeQuery(this.compile(),i(this,tt).queryId)}};tt=new WeakMap;let AlterTableAddForeignKeyConstraintBuilder=bi;preventAwait(AlterTableAddForeignKeyConstraintBuilder,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var Qe;const Cn=class Cn{constructor(e){I(this,Qe);x(this,Qe,freeze(e))}ifExists(){return new Cn({...i(this,Qe),node:AlterTableNode.cloneWithTableProps(i(this,Qe).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,Qe).node.dropConstraint,{ifExists:!0})})})}cascade(){return new Cn({...i(this,Qe),node:AlterTableNode.cloneWithTableProps(i(this,Qe).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,Qe).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new Cn({...i(this,Qe),node:AlterTableNode.cloneWithTableProps(i(this,Qe).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,Qe).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return i(this,Qe).executor.transformQuery(i(this,Qe).node,i(this,Qe).queryId)}compile(){return i(this,Qe).executor.compileQuery(this.toOperationNode(),i(this,Qe).queryId)}async execute(){await i(this,Qe).executor.executeQuery(this.compile(),i(this,Qe).queryId)}};Qe=new WeakMap;let AlterTableDropConstraintBuilder=Cn;preventAwait(AlterTableDropConstraintBuilder,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const PrimaryConstraintNode=freeze({is(r){return r.kind==="PrimaryKeyConstraintNode"},create(r,e){return freeze({kind:"PrimaryKeyConstraintNode",columns:freeze(r.map(ColumnNode.create)),name:e?IdentifierNode.create(e):void 0})}}),AddIndexNode=freeze({is(r){return r.kind==="AddIndexNode"},create(r){return freeze({kind:"AddIndexNode",name:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})},cloneWithColumns(r,e){return freeze({...r,columns:[...r.columns||[],...e]})}});var Oe;const yr=class yr{constructor(e){I(this,Oe);x(this,Oe,freeze(e))}unique(){return new yr({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWith(i(this,Oe).node.addIndex,{unique:!0})})})}column(e){return new yr({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,Oe).node.addIndex,[parseOrderedColumnName(e)])})})}columns(e){return new yr({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,Oe).node.addIndex,e.map(parseOrderedColumnName))})})}expression(e){return new yr({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,Oe).node.addIndex,[e.toOperationNode()])})})}using(e){return new yr({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWith(i(this,Oe).node.addIndex,{using:RawNode.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return i(this,Oe).executor.transformQuery(i(this,Oe).node,i(this,Oe).queryId)}compile(){return i(this,Oe).executor.compileQuery(this.toOperationNode(),i(this,Oe).queryId)}async execute(){await i(this,Oe).executor.executeQuery(this.compile(),i(this,Oe).queryId)}};Oe=new WeakMap;let AlterTableAddIndexBuilder=yr;preventAwait(AlterTableAddIndexBuilder,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var ln;const Yi=class Yi{constructor(e){I(this,ln);x(this,ln,e)}toOperationNode(){return i(this,ln)}nullsNotDistinct(){return new Yi(UniqueConstraintNode.cloneWith(i(this,ln),{nullsNotDistinct:!0}))}};ln=new WeakMap;let UniqueConstraintNodeBuilder=Yi;preventAwait(UniqueConstraintNodeBuilder,"don't await UniqueConstraintNodeBuilder instances directly.");var de;class AlterTableBuilder{constructor(e){I(this,de);x(this,de,freeze(e))}renameTo(e){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{renameTo:parseTable(e)})})}setSchema(e){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{setSchema:IdentifierNode.create(e)})})}alterColumn(e,t){const n=t(new AlterColumnBuilder(e));return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,n.toOperationNode())})}dropColumn(e){return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,DropColumnNode.create(e))})}renameColumn(e,t){return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,RenameColumnNode.create(e,t))})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,AddColumnNode.create(o.toOperationNode()))})}modifyColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,ModifyColumnNode.create(o.toOperationNode()))})}addUniqueConstraint(e,t,n=noop$1){const o=n(new UniqueConstraintNodeBuilder(UniqueConstraintNode.create(t,e)));return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{addConstraint:AddConstraintNode.create(o.toOperationNode())})})}addCheckConstraint(e,t){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{addConstraint:AddConstraintNode.create(CheckConstraintNode.create(t.toOperationNode(),e))})})}addForeignKeyConstraint(e,t,n,o){return new AlterTableAddForeignKeyConstraintBuilder({...i(this,de),constraintBuilder:new ForeignKeyConstraintBuilder(ForeignKeyConstraintNode.create(t.map(ColumnNode.create),parseTable(n),o.map(ColumnNode.create),e))})}addPrimaryKeyConstraint(e,t){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{addConstraint:AddConstraintNode.create(PrimaryConstraintNode.create(t,e))})})}dropConstraint(e){return new AlterTableDropConstraintBuilder({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{dropConstraint:DropConstraintNode.create(e)})})}addIndex(e){return new AlterTableAddIndexBuilder({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{addIndex:AddIndexNode.create(e)})})}dropIndex(e){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{dropIndex:DropIndexNode.create(e)})})}$call(e){return e(this)}}de=new WeakMap;preventAwait(AlterTableBuilder,"don't await AlterTableBuilder instances");var De;const br=class br{constructor(e){I(this,De);x(this,De,freeze(e))}alterColumn(e,t){const n=t(new AlterColumnBuilder(e));return new br({...i(this,De),node:AlterTableNode.cloneWithColumnAlteration(i(this,De).node,n.toOperationNode())})}dropColumn(e){return new br({...i(this,De),node:AlterTableNode.cloneWithColumnAlteration(i(this,De).node,DropColumnNode.create(e))})}renameColumn(e,t){return new br({...i(this,De),node:AlterTableNode.cloneWithColumnAlteration(i(this,De).node,RenameColumnNode.create(e,t))})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new br({...i(this,De),node:AlterTableNode.cloneWithColumnAlteration(i(this,De).node,AddColumnNode.create(o.toOperationNode()))})}modifyColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new br({...i(this,De),node:AlterTableNode.cloneWithColumnAlteration(i(this,De).node,ModifyColumnNode.create(o.toOperationNode()))})}toOperationNode(){return i(this,De).executor.transformQuery(i(this,De).node,i(this,De).queryId)}compile(){return i(this,De).executor.compileQuery(this.toOperationNode(),i(this,De).queryId)}async execute(){await i(this,De).executor.executeQuery(this.compile(),i(this,De).queryId)}};De=new WeakMap;let AlterTableColumnAlteringBuilder=br;preventAwait(AlterTableColumnAlteringBuilder,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class ImmediateValueTransformer extends OperationNodeTransformer{transformValue(e){return{...super.transformValue(e),immediate:!0}}}var ye;const Ot=class Ot{constructor(e){I(this,ye);x(this,ye,freeze(e))}ifNotExists(){return new Ot({...i(this,ye),node:CreateIndexNode.cloneWith(i(this,ye).node,{ifNotExists:!0})})}unique(){return new Ot({...i(this,ye),node:CreateIndexNode.cloneWith(i(this,ye).node,{unique:!0})})}nullsNotDistinct(){return new Ot({...i(this,ye),node:CreateIndexNode.cloneWith(i(this,ye).node,{nullsNotDistinct:!0})})}on(e){return new Ot({...i(this,ye),node:CreateIndexNode.cloneWith(i(this,ye).node,{table:parseTable(e)})})}column(e){return new Ot({...i(this,ye),node:CreateIndexNode.cloneWithColumns(i(this,ye).node,[parseOrderedColumnName(e)])})}columns(e){return new Ot({...i(this,ye),node:CreateIndexNode.cloneWithColumns(i(this,ye).node,e.map(parseOrderedColumnName))})}expression(e){return new Ot({...i(this,ye),node:CreateIndexNode.cloneWithColumns(i(this,ye).node,[e.toOperationNode()])})}using(e){return new Ot({...i(this,ye),node:CreateIndexNode.cloneWith(i(this,ye).node,{using:RawNode.createWithSql(e)})})}where(...e){const t=new ImmediateValueTransformer;return new Ot({...i(this,ye),node:QueryNode.cloneWithWhere(i(this,ye).node,t.transformNode(parseValueBinaryOperationOrExpression(e)))})}$call(e){return e(this)}toOperationNode(){return i(this,ye).executor.transformQuery(i(this,ye).node,i(this,ye).queryId)}compile(){return i(this,ye).executor.compileQuery(this.toOperationNode(),i(this,ye).queryId)}async execute(){await i(this,ye).executor.executeQuery(this.compile(),i(this,ye).queryId)}};ye=new WeakMap;let CreateIndexBuilder=Ot;preventAwait(CreateIndexBuilder,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var ht;const Zi=class Zi{constructor(e){I(this,ht);x(this,ht,freeze(e))}ifNotExists(){return new Zi({...i(this,ht),node:CreateSchemaNode.cloneWith(i(this,ht).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,ht).executor.transformQuery(i(this,ht).node,i(this,ht).queryId)}compile(){return i(this,ht).executor.compileQuery(this.toOperationNode(),i(this,ht).queryId)}async execute(){await i(this,ht).executor.executeQuery(this.compile(),i(this,ht).queryId)}};ht=new WeakMap;let CreateSchemaBuilder=Zi;preventAwait(CreateSchemaBuilder,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function parseOnCommitAction(r){if(ON_COMMIT_ACTIONS.includes(r))return r;throw new Error(`invalid OnCommitAction ${r}`)}var ce;const ft=class ft{constructor(e){I(this,ce);x(this,ce,freeze(e))}temporary(){return new ft({...i(this,ce),node:CreateTableNode.cloneWith(i(this,ce).node,{temporary:!0})})}onCommit(e){return new ft({...i(this,ce),node:CreateTableNode.cloneWith(i(this,ce).node,{onCommit:parseOnCommitAction(e)})})}ifNotExists(){return new ft({...i(this,ce),node:CreateTableNode.cloneWith(i(this,ce).node,{ifNotExists:!0})})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new ft({...i(this,ce),node:CreateTableNode.cloneWithColumn(i(this,ce).node,o.toOperationNode())})}addPrimaryKeyConstraint(e,t){return new ft({...i(this,ce),node:CreateTableNode.cloneWithConstraint(i(this,ce).node,PrimaryConstraintNode.create(t,e))})}addUniqueConstraint(e,t,n=noop$1){const o=n(new UniqueConstraintNodeBuilder(UniqueConstraintNode.create(t,e)));return new ft({...i(this,ce),node:CreateTableNode.cloneWithConstraint(i(this,ce).node,o.toOperationNode())})}addCheckConstraint(e,t){return new ft({...i(this,ce),node:CreateTableNode.cloneWithConstraint(i(this,ce).node,CheckConstraintNode.create(t.toOperationNode(),e))})}addForeignKeyConstraint(e,t,n,o,a=noop$1){const l=a(new ForeignKeyConstraintBuilder(ForeignKeyConstraintNode.create(t.map(ColumnNode.create),parseTable(n),o.map(ColumnNode.create),e)));return new ft({...i(this,ce),node:CreateTableNode.cloneWithConstraint(i(this,ce).node,l.toOperationNode())})}modifyFront(e){return new ft({...i(this,ce),node:CreateTableNode.cloneWithFrontModifier(i(this,ce).node,e.toOperationNode())})}modifyEnd(e){return new ft({...i(this,ce),node:CreateTableNode.cloneWithEndModifier(i(this,ce).node,e.toOperationNode())})}as(e){return new ft({...i(this,ce),node:CreateTableNode.cloneWith(i(this,ce).node,{selectQuery:parseExpression(e)})})}$call(e){return e(this)}toOperationNode(){return i(this,ce).executor.transformQuery(i(this,ce).node,i(this,ce).queryId)}compile(){return i(this,ce).executor.compileQuery(this.toOperationNode(),i(this,ce).queryId)}async execute(){await i(this,ce).executor.executeQuery(this.compile(),i(this,ce).queryId)}};ce=new WeakMap;let CreateTableBuilder=ft;preventAwait(CreateTableBuilder,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var Ke;const Rn=class Rn{constructor(e){I(this,Ke);x(this,Ke,freeze(e))}on(e){return new Rn({...i(this,Ke),node:DropIndexNode.cloneWith(i(this,Ke).node,{table:parseTable(e)})})}ifExists(){return new Rn({...i(this,Ke),node:DropIndexNode.cloneWith(i(this,Ke).node,{ifExists:!0})})}cascade(){return new Rn({...i(this,Ke),node:DropIndexNode.cloneWith(i(this,Ke).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Ke).executor.transformQuery(i(this,Ke).node,i(this,Ke).queryId)}compile(){return i(this,Ke).executor.compileQuery(this.toOperationNode(),i(this,Ke).queryId)}async execute(){await i(this,Ke).executor.executeQuery(this.compile(),i(this,Ke).queryId)}};Ke=new WeakMap;let DropIndexBuilder=Rn;preventAwait(DropIndexBuilder,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var st;const wi=class wi{constructor(e){I(this,st);x(this,st,freeze(e))}ifExists(){return new wi({...i(this,st),node:DropSchemaNode.cloneWith(i(this,st).node,{ifExists:!0})})}cascade(){return new wi({...i(this,st),node:DropSchemaNode.cloneWith(i(this,st).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,st).executor.transformQuery(i(this,st).node,i(this,st).queryId)}compile(){return i(this,st).executor.compileQuery(this.toOperationNode(),i(this,st).queryId)}async execute(){await i(this,st).executor.executeQuery(this.compile(),i(this,st).queryId)}};st=new WeakMap;let DropSchemaBuilder=wi;preventAwait(DropSchemaBuilder,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var ot;const Ei=class Ei{constructor(e){I(this,ot);x(this,ot,freeze(e))}ifExists(){return new Ei({...i(this,ot),node:DropTableNode.cloneWith(i(this,ot).node,{ifExists:!0})})}cascade(){return new Ei({...i(this,ot),node:DropTableNode.cloneWith(i(this,ot).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,ot).executor.transformQuery(i(this,ot).node,i(this,ot).queryId)}compile(){return i(this,ot).executor.compileQuery(this.toOperationNode(),i(this,ot).queryId)}async execute(){await i(this,ot).executor.executeQuery(this.compile(),i(this,ot).queryId)}};ot=new WeakMap;let DropTableBuilder=Ei;preventAwait(DropTableBuilder,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const CreateViewNode=freeze({is(r){return r.kind==="CreateViewNode"},create(r){return freeze({kind:"CreateViewNode",name:SchemableIdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}});var gi;class ImmediateValuePlugin{constructor(){I(this,gi,new ImmediateValueTransformer)}transformQuery(e){return i(this,gi).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}gi=new WeakMap;var ke;const rr=class rr{constructor(e){I(this,ke);x(this,ke,freeze(e))}temporary(){return new rr({...i(this,ke),node:CreateViewNode.cloneWith(i(this,ke).node,{temporary:!0})})}materialized(){return new rr({...i(this,ke),node:CreateViewNode.cloneWith(i(this,ke).node,{materialized:!0})})}ifNotExists(){return new rr({...i(this,ke),node:CreateViewNode.cloneWith(i(this,ke).node,{ifNotExists:!0})})}orReplace(){return new rr({...i(this,ke),node:CreateViewNode.cloneWith(i(this,ke).node,{orReplace:!0})})}columns(e){return new rr({...i(this,ke),node:CreateViewNode.cloneWith(i(this,ke).node,{columns:e.map(parseColumnName)})})}as(e){const t=e.withPlugin(new ImmediateValuePlugin).toOperationNode();return new rr({...i(this,ke),node:CreateViewNode.cloneWith(i(this,ke).node,{as:t})})}$call(e){return e(this)}toOperationNode(){return i(this,ke).executor.transformQuery(i(this,ke).node,i(this,ke).queryId)}compile(){return i(this,ke).executor.compileQuery(this.toOperationNode(),i(this,ke).queryId)}async execute(){await i(this,ke).executor.executeQuery(this.compile(),i(this,ke).queryId)}};ke=new WeakMap;let CreateViewBuilder=rr;preventAwait(CreateViewBuilder,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const DropViewNode=freeze({is(r){return r.kind==="DropViewNode"},create(r){return freeze({kind:"DropViewNode",name:SchemableIdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}});var Ge;const xn=class xn{constructor(e){I(this,Ge);x(this,Ge,freeze(e))}materialized(){return new xn({...i(this,Ge),node:DropViewNode.cloneWith(i(this,Ge).node,{materialized:!0})})}ifExists(){return new xn({...i(this,Ge),node:DropViewNode.cloneWith(i(this,Ge).node,{ifExists:!0})})}cascade(){return new xn({...i(this,Ge),node:DropViewNode.cloneWith(i(this,Ge).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Ge).executor.transformQuery(i(this,Ge).node,i(this,Ge).queryId)}compile(){return i(this,Ge).executor.compileQuery(this.toOperationNode(),i(this,Ge).queryId)}async execute(){await i(this,Ge).executor.executeQuery(this.compile(),i(this,Ge).queryId)}};Ge=new WeakMap;let DropViewBuilder=xn;preventAwait(DropViewBuilder,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const CreateTypeNode=freeze({is(r){return r.kind==="CreateTypeNode"},create(r){return freeze({kind:"CreateTypeNode",name:r})},cloneWithEnum(r,e){return freeze({...r,enum:ValueListNode.create(e.map(t=>ValueNode.createImmediate(t)))})}});var pt;const es=class es{constructor(e){I(this,pt);x(this,pt,freeze(e))}toOperationNode(){return i(this,pt).executor.transformQuery(i(this,pt).node,i(this,pt).queryId)}asEnum(e){return new es({...i(this,pt),node:CreateTypeNode.cloneWithEnum(i(this,pt).node,e)})}$call(e){return e(this)}compile(){return i(this,pt).executor.compileQuery(this.toOperationNode(),i(this,pt).queryId)}async execute(){await i(this,pt).executor.executeQuery(this.compile(),i(this,pt).queryId)}};pt=new WeakMap;let CreateTypeBuilder=es;preventAwait(CreateTypeBuilder,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const DropTypeNode=freeze({is(r){return r.kind==="DropTypeNode"},create(r){return freeze({kind:"DropTypeNode",name:r})},cloneWith(r,e){return freeze({...r,...e})}});var mt;const ts=class ts{constructor(e){I(this,mt);x(this,mt,freeze(e))}ifExists(){return new ts({...i(this,mt),node:DropTypeNode.cloneWith(i(this,mt).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,mt).executor.transformQuery(i(this,mt).node,i(this,mt).queryId)}compile(){return i(this,mt).executor.compileQuery(this.toOperationNode(),i(this,mt).queryId)}async execute(){await i(this,mt).executor.executeQuery(this.compile(),i(this,mt).queryId)}};mt=new WeakMap;let DropTypeBuilder=ts;preventAwait(DropTypeBuilder,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function parseSchemableIdentifier(r){const e=".";if(r.includes(e)){const t=r.split(e).map(trim);if(t.length===2)return SchemableIdentifierNode.createWithSchema(t[0],t[1]);throw new Error(`invalid schemable identifier ${r}`)}else return SchemableIdentifierNode.create(r)}function trim(r){return r.trim()}var $e;const An=class An{constructor(e){I(this,$e);x(this,$e,e)}createTable(e){return new CreateTableBuilder({queryId:createQueryId(),executor:i(this,$e),node:CreateTableNode.create(parseTable(e))})}dropTable(e){return new DropTableBuilder({queryId:createQueryId(),executor:i(this,$e),node:DropTableNode.create(parseTable(e))})}createIndex(e){return new CreateIndexBuilder({queryId:createQueryId(),executor:i(this,$e),node:CreateIndexNode.create(e)})}dropIndex(e){return new DropIndexBuilder({queryId:createQueryId(),executor:i(this,$e),node:DropIndexNode.create(e)})}createSchema(e){return new CreateSchemaBuilder({queryId:createQueryId(),executor:i(this,$e),node:CreateSchemaNode.create(e)})}dropSchema(e){return new DropSchemaBuilder({queryId:createQueryId(),executor:i(this,$e),node:DropSchemaNode.create(e)})}alterTable(e){return new AlterTableBuilder({queryId:createQueryId(),executor:i(this,$e),node:AlterTableNode.create(parseTable(e))})}createView(e){return new CreateViewBuilder({queryId:createQueryId(),executor:i(this,$e),node:CreateViewNode.create(e)})}dropView(e){return new DropViewBuilder({queryId:createQueryId(),executor:i(this,$e),node:DropViewNode.create(e)})}createType(e){return new CreateTypeBuilder({queryId:createQueryId(),executor:i(this,$e),node:CreateTypeNode.create(parseSchemableIdentifier(e))})}dropType(e){return new DropTypeBuilder({queryId:createQueryId(),executor:i(this,$e),node:DropTypeNode.create(parseSchemableIdentifier(e))})}withPlugin(e){return new An(i(this,$e).withPlugin(e))}withoutPlugins(){return new An(i(this,$e).withoutPlugins())}withSchema(e){return new An(i(this,$e).withPluginAtFront(new WithSchemaPlugin(e)))}};$e=new WeakMap;let SchemaModule=An;class DynamicModule{ref(e){return new DynamicReferenceBuilder(e)}}var cn;class DefaultConnectionProvider{constructor(e){I(this,cn);x(this,cn,e)}async provideConnection(e){const t=await i(this,cn).acquireConnection();try{return await e(t)}finally{await i(this,cn).releaseConnection(t)}}}cn=new WeakMap;var Bt,Ft,$t;const wr=class wr extends QueryExecutorBase{constructor(t,n,o,a=[]){super(a);I(this,Bt);I(this,Ft);I(this,$t);x(this,Bt,t),x(this,Ft,n),x(this,$t,o)}get adapter(){return i(this,Ft)}compileQuery(t){return i(this,Bt).compileQuery(t)}provideConnection(t){return i(this,$t).provideConnection(t)}withPlugins(t){return new wr(i(this,Bt),i(this,Ft),i(this,$t),[...this.plugins,...t])}withPlugin(t){return new wr(i(this,Bt),i(this,Ft),i(this,$t),[...this.plugins,t])}withPluginAtFront(t){return new wr(i(this,Bt),i(this,Ft),i(this,$t),[t,...this.plugins])}withConnectionProvider(t){return new wr(i(this,Bt),i(this,Ft),t,[...this.plugins])}withoutPlugins(){return new wr(i(this,Bt),i(this,Ft),i(this,$t),[])}};Bt=new WeakMap,Ft=new WeakMap,$t=new WeakMap;let DefaultQueryExecutor=wr;function performanceNow(){return typeof performance<"u"&&isFunction(performance.now)?performance.now():Date.now()}var Ct,or,Vt,dn,Jt,Qn,yt,Qo,zo,Po,Mo,Hi;class RuntimeDriver{constructor(e,t){I(this,yt);I(this,Ct);I(this,or);I(this,Vt);I(this,dn);I(this,Jt);I(this,Qn,new WeakSet);x(this,dn,!1),x(this,Ct,e),x(this,or,t)}async init(){if(i(this,Jt))throw new Error("driver has already been destroyed");i(this,Vt)||x(this,Vt,i(this,Ct).init().then(()=>{x(this,dn,!0)}).catch(e=>(x(this,Vt,void 0),Promise.reject(e)))),await i(this,Vt)}async acquireConnection(){if(i(this,Jt))throw new Error("driver has already been destroyed");i(this,dn)||await this.init();const e=await i(this,Ct).acquireConnection();return i(this,Qn).has(e)||(G(this,yt,Qo).call(this)&&G(this,yt,zo).call(this,e),i(this,Qn).add(e)),e}async releaseConnection(e){await i(this,Ct).releaseConnection(e)}beginTransaction(e,t){return i(this,Ct).beginTransaction(e,t)}commitTransaction(e){return i(this,Ct).commitTransaction(e)}rollbackTransaction(e){return i(this,Ct).rollbackTransaction(e)}async destroy(){i(this,Vt)&&(await i(this,Vt),i(this,Jt)||x(this,Jt,i(this,Ct).destroy().catch(e=>(x(this,Jt,void 0),Promise.reject(e)))),await i(this,Jt))}}Ct=new WeakMap,or=new WeakMap,Vt=new WeakMap,dn=new WeakMap,Jt=new WeakMap,Qn=new WeakMap,yt=new WeakSet,Qo=function(){return i(this,or).isLevelEnabled("query")||i(this,or).isLevelEnabled("error")},zo=function(e){const t=e.executeQuery;e.executeQuery=async n=>{let o;const a=performanceNow();try{return await t.call(e,n)}catch(l){throw o=l,await G(this,yt,Po).call(this,l,n,a),l}finally{o||await G(this,yt,Mo).call(this,n,a)}}},Po=async function(e,t,n){await i(this,or).error(()=>({level:"error",error:e,query:t,queryDurationMillis:G(this,yt,Hi).call(this,n)}))},Mo=async function(e,t){await i(this,or).query(()=>({level:"query",query:e,queryDurationMillis:G(this,yt,Hi).call(this,t)}))},Hi=function(e){return performanceNow()-e};const ignoreError=()=>{};var zn,ar,_i,Uo;class SingleConnectionProvider{constructor(e){I(this,_i);I(this,zn);I(this,ar);x(this,zn,e)}async provideConnection(e){for(;i(this,ar);)await i(this,ar).catch(ignoreError);return x(this,ar,G(this,_i,Uo).call(this,e).finally(()=>{x(this,ar,void 0)})),i(this,ar)}}zn=new WeakMap,ar=new WeakMap,_i=new WeakSet,Uo=async function(e){return await e(i(this,zn))};const TRANSACTION_ISOLATION_LEVELS=["read uncommitted","read committed","repeatable read","serializable","snapshot"];freeze(["query","error"]);var ur,Cr;class Log{constructor(e){I(this,ur);I(this,Cr);isFunction(e)?(x(this,Cr,e),x(this,ur,freeze({query:!0,error:!0}))):(x(this,Cr,defaultLogger),x(this,ur,freeze({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return i(this,ur)[e]}async query(e){i(this,ur).query&&await i(this,Cr).call(this,e())}async error(e){i(this,ur).error&&await i(this,Cr).call(this,e())}}ur=new WeakMap,Cr=new WeakMap;function defaultLogger(r){r.level==="query"?(console.log(`kysely:query: ${r.query.sql}`),console.log(`kysely:query: duration: ${r.queryDurationMillis.toFixed(1)}ms`)):r.level==="error"&&(r.error instanceof Error?console.error(`kysely:error: ${r.error.stack??r.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:r.error,query:r.query.sql,queryDurationMillis:r.queryDurationMillis})}`))}function isCompilable(r){return isObject$3(r)&&isFunction(r.compile)}var Xe;const Jr=class Jr extends QueryCreator{constructor(t){let n,o;if(isKyselyProps(t))n={executor:t.executor},o={...t};else{const a=t.dialect,l=a.createDriver(),d=a.createQueryCompiler(),h=a.createAdapter(),p=new Log(t.log??[]),m=new RuntimeDriver(l,p),E=new DefaultConnectionProvider(m),A=new DefaultQueryExecutor(d,h,E,t.plugins??[]);n={executor:A},o={config:t,executor:A,dialect:a,driver:m}}super(n);I(this,Xe);x(this,Xe,freeze(o))}get schema(){return new SchemaModule(i(this,Xe).executor)}get dynamic(){return new DynamicModule}get introspection(){return i(this,Xe).dialect.createIntrospector(this.withoutPlugins())}case(t){return new CaseBuilder({node:CaseNode.create(isUndefined(t)?void 0:parseExpression(t))})}get fn(){return createFunctionModule()}transaction(){return new TransactionBuilder({...i(this,Xe)})}connection(){return new ConnectionBuilder({...i(this,Xe)})}withPlugin(t){return new Jr({...i(this,Xe),executor:i(this,Xe).executor.withPlugin(t)})}withoutPlugins(){return new Jr({...i(this,Xe),executor:i(this,Xe).executor.withoutPlugins()})}withSchema(t){return new Jr({...i(this,Xe),executor:i(this,Xe).executor.withPluginAtFront(new WithSchemaPlugin(t))})}withTables(){return new Jr({...i(this,Xe)})}async destroy(){await i(this,Xe).driver.destroy()}get isTransaction(){return!1}getExecutor(){return i(this,Xe).executor}executeQuery(t,n=createQueryId()){const o=isCompilable(t)?t.compile():t;return this.getExecutor().executeQuery(o,n)}};Xe=new WeakMap;let Kysely=Jr;var Rt;const Hr=class Hr extends Kysely{constructor(t){super(t);I(this,Rt);x(this,Rt,t)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(t){return new Hr({...i(this,Rt),executor:i(this,Rt).executor.withPlugin(t)})}withoutPlugins(){return new Hr({...i(this,Rt),executor:i(this,Rt).executor.withoutPlugins()})}withSchema(t){return new Hr({...i(this,Rt),executor:i(this,Rt).executor.withPluginAtFront(new WithSchemaPlugin(t))})}withTables(){return new Hr({...i(this,Rt)})}};Rt=new WeakMap;let Transaction=Hr;function isKyselyProps(r){return isObject$3(r)&&isObject$3(r.config)&&isObject$3(r.driver)&&isObject$3(r.executor)&&isObject$3(r.dialect)}var Rr;class ConnectionBuilder{constructor(e){I(this,Rr);x(this,Rr,freeze(e))}async execute(e){return i(this,Rr).executor.provideConnection(async t=>{const n=i(this,Rr).executor.withConnectionProvider(new SingleConnectionProvider(t)),o=new Kysely({...i(this,Rr),executor:n});return await e(o)})}}Rr=new WeakMap;preventAwait(ConnectionBuilder,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var xt;const rs=class rs{constructor(e){I(this,xt);x(this,xt,freeze(e))}setIsolationLevel(e){return new rs({...i(this,xt),isolationLevel:e})}async execute(e){const{isolationLevel:t,...n}=i(this,xt),o={isolationLevel:t};return validateTransactionSettings(o),i(this,xt).executor.provideConnection(async a=>{const l=i(this,xt).executor.withConnectionProvider(new SingleConnectionProvider(a)),d=new Transaction({...n,executor:l});try{await i(this,xt).driver.beginTransaction(a,o);const h=await e(d);return await i(this,xt).driver.commitTransaction(a),h}catch(h){throw await i(this,xt).driver.rollbackTransaction(a),h}})}};xt=new WeakMap;let TransactionBuilder=rs;preventAwait(TransactionBuilder,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function validateTransactionSettings(r){if(r.isolationLevel&&!TRANSACTION_ISOLATION_LEVELS.includes(r.isolationLevel))throw new Error(`invalid transaction isolation level ${r.isolationLevel}`)}var at,Et,li,ji,Ki;const kn=class kn{constructor(e){I(this,Et);I(this,at);x(this,at,freeze(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new AliasedRawBuilderImpl(this,e)}$castTo(){return new kn({...i(this,at)})}$notNull(){return new kn(i(this,at))}withPlugin(e){return new kn({...i(this,at),plugins:i(this,at).plugins!==void 0?freeze([...i(this,at).plugins,e]):freeze([e])})}toOperationNode(){return G(this,Et,ji).call(this,G(this,Et,li).call(this))}compile(e){return G(this,Et,Ki).call(this,G(this,Et,li).call(this,e))}async execute(e){const t=G(this,Et,li).call(this,e);return t.executeQuery(G(this,Et,Ki).call(this,t),i(this,at).queryId)}};at=new WeakMap,Et=new WeakSet,li=function(e){const t=e!==void 0?e.getExecutor():NOOP_QUERY_EXECUTOR;return i(this,at).plugins!==void 0?t.withPlugins(i(this,at).plugins):t},ji=function(e){return e.transformQuery(i(this,at).rawNode,i(this,at).queryId)},Ki=function(e){return e.compileQuery(G(this,Et,ji).call(this,e),i(this,at).queryId)};let RawBuilderImpl=kn;function createRawBuilder(r){return new RawBuilderImpl(r)}preventAwait(RawBuilderImpl,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var xr,lr;class AliasedRawBuilderImpl{constructor(e,t){I(this,xr);I(this,lr);x(this,xr,e),x(this,lr,t)}get expression(){return i(this,xr)}get alias(){return i(this,lr)}get rawBuilder(){return i(this,xr)}toOperationNode(){return AliasNode.create(i(this,xr).toOperationNode(),isOperationNodeSource(i(this,lr))?i(this,lr).toOperationNode():IdentifierNode.create(i(this,lr)))}}xr=new WeakMap,lr=new WeakMap;preventAwait(AliasedRawBuilderImpl,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const sql=Object.assign((r,...e)=>createRawBuilder({queryId:createQueryId(),rawNode:RawNode.create(r,(e==null?void 0:e.map(parseParameter))??[])}),{ref(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseStringReference(r))})},val(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseValueExpression(r))})},value(r){return this.val(r)},table(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseTable(r))})},id(...r){const e=new Array(r.length+1).fill(".");return e[0]="",e[e.length-1]="",createRawBuilder({queryId:createQueryId(),rawNode:RawNode.create(e,r.map(IdentifierNode.create))})},lit(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(ValueNode.createImmediate(r))})},literal(r){return this.lit(r)},raw(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithSql(r)})},join(r,e=sql`, `){const t=new Array(2*r.length-1),n=e.toOperationNode();for(let o=0;o<r.length;++o)t[2*o]=parseParameter(r[o]),o!==r.length-1&&(t[2*o+1]=n);return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChildren(t)})}});function parseParameter(r){return isOperationNodeSource(r)?r.toOperationNode():parseValueExpression(r)}var Oi;class OperationNodeVisitor{constructor(){oe(this,"nodeStack",[]);I(this,Oi,freeze({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this)}));oe(this,"visitNode",e=>{this.nodeStack.push(e),i(this,Oi)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Oi=new WeakMap;var fn,Ar;class DefaultQueryCompiler extends OperationNodeVisitor{constructor(){super(...arguments);I(this,fn,"");I(this,Ar,[])}get numParameters(){return i(this,Ar).length}compileQuery(t){return x(this,fn,""),x(this,Ar,[]),this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(t),freeze({query:t,sql:this.getSql(),parameters:[...i(this,Ar)]})}getSql(){return i(this,fn)}visitSelectQuery(t){var o,a;const n=this.parentNode!==void 0&&!ParensNode.is(this.parentNode)&&!InsertQueryNode.is(this.parentNode)&&!CreateTableNode.is(this.parentNode)&&!CreateViewNode.is(this.parentNode)&&!SetOperationNode.is(this.parentNode);this.parentNode===void 0&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("select"),t.distinctOn&&(this.append(" "),this.compileDistinctOn(t.distinctOn)),(o=t.frontModifiers)!=null&&o.length&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.top&&(this.append(" "),this.visitNode(t.top)),t.selections&&(this.append(" "),this.compileList(t.selections)),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.groupBy&&(this.append(" "),this.visitNode(t.groupBy)),t.having&&(this.append(" "),this.visitNode(t.having)),t.setOperations&&(this.append(" "),this.compileList(t.setOperations," ")),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.offset&&(this.append(" "),this.visitNode(t.offset)),t.fetch&&(this.append(" "),this.visitNode(t.fetch)),(a=t.endModifiers)!=null&&a.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...t.endModifiers])," ")),n&&this.append(")")}visitFrom(t){this.append("from "),this.compileList(t.froms)}visitSelection(t){this.visitNode(t.selection)}visitColumn(t){this.visitNode(t.column)}compileDistinctOn(t){this.append("distinct on ("),this.compileList(t),this.append(")")}compileList(t,n=", "){const o=t.length-1;for(let a=0;a<=o;a++)this.visitNode(t[a]),a<o&&this.append(n)}visitWhere(t){this.append("where "),this.visitNode(t.where)}visitHaving(t){this.append("having "),this.visitNode(t.having)}visitInsertQuery(t){var a;const n=this.nodeStack.find(QueryNode.is),o=n!==t;!o&&t.explain&&(this.visitNode(t.explain),this.append(" ")),o&&!MergeQueryNode.is(n)&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append(t.replace?"replace":"insert"),t.ignore&&this.append(" ignore"),t.top&&(this.append(" "),this.visitNode(t.top)),t.into&&(this.append(" into "),this.visitNode(t.into)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.output&&(this.append(" "),this.visitNode(t.output)),t.values&&(this.append(" "),this.visitNode(t.values)),t.defaultValues&&(this.append(" "),this.append("default values")),t.onConflict&&(this.append(" "),this.visitNode(t.onConflict)),t.onDuplicateKey&&(this.append(" "),this.visitNode(t.onDuplicateKey)),t.returning&&(this.append(" "),this.visitNode(t.returning)),o&&!MergeQueryNode.is(n)&&this.append(")"),(a=t.endModifiers)!=null&&a.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitValues(t){this.append("values "),this.compileList(t.values)}visitDeleteQuery(t){var o;const n=this.nodeStack.find(QueryNode.is)!==t;!n&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("delete "),t.top&&(this.visitNode(t.top),this.append(" ")),this.visitNode(t.from),t.output&&(this.append(" "),this.visitNode(t.output)),t.using&&(this.append(" "),this.visitNode(t.using)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.returning&&(this.append(" "),this.visitNode(t.returning)),n&&this.append(")"),(o=t.endModifiers)!=null&&o.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitReturning(t){this.append("returning "),this.compileList(t.selections)}visitAlias(t){this.visitNode(t.node),this.append(" as "),this.visitNode(t.alias)}visitReference(t){t.table&&(this.visitNode(t.table),this.append(".")),this.visitNode(t.column)}visitSelectAll(t){this.append("*")}visitIdentifier(t){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(t),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(t){if(!isString(t.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(t.name))}visitAnd(t){this.visitNode(t.left),this.append(" and "),this.visitNode(t.right)}visitOr(t){this.visitNode(t.left),this.append(" or "),this.visitNode(t.right)}visitValue(t){t.immediate?this.appendImmediateValue(t.value):this.appendValue(t.value)}visitValueList(t){this.append("("),this.compileList(t.values),this.append(")")}visitTuple(t){this.append("("),this.compileList(t.values),this.append(")")}visitPrimitiveValueList(t){this.append("(");const{values:n}=t;for(let o=0;o<n.length;++o)this.appendValue(n[o]),o!==n.length-1&&this.append(", ");this.append(")")}visitParens(t){this.append("("),this.visitNode(t.node),this.append(")")}visitJoin(t){this.append(JOIN_TYPE_SQL[t.joinType]),this.append(" "),this.visitNode(t.table),t.on&&(this.append(" "),this.visitNode(t.on))}visitOn(t){this.append("on "),this.visitNode(t.on)}visitRaw(t){const{sqlFragments:n,parameters:o}=t;for(let a=0;a<n.length;++a)this.append(n[a]),o.length>a&&this.visitNode(o[a])}visitOperator(t){this.append(t.operator)}visitTable(t){this.visitNode(t.table)}visitSchemableIdentifier(t){t.schema&&(this.visitNode(t.schema),this.append(".")),this.visitNode(t.identifier)}visitCreateTable(t){this.append("create "),t.frontModifiers&&t.frontModifiers.length>0&&(this.compileList(t.frontModifiers," "),this.append(" ")),t.temporary&&this.append("temporary "),this.append("table "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.table),t.selectQuery?(this.append(" as "),this.visitNode(t.selectQuery)):(this.append(" ("),this.compileList([...t.columns,...t.constraints??[]]),this.append(")"),t.onCommit&&(this.append(" on commit "),this.append(t.onCommit)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," ")))}visitColumnDefinition(t){t.ifNotExists&&this.append("if not exists "),this.visitNode(t.column),this.append(" "),this.visitNode(t.dataType),t.unsigned&&this.append(" unsigned"),t.frontModifiers&&t.frontModifiers.length>0&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.generated&&(this.append(" "),this.visitNode(t.generated)),t.identity&&this.append(" identity"),t.defaultTo&&(this.append(" "),this.visitNode(t.defaultTo)),t.notNull&&this.append(" not null"),t.unique&&this.append(" unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.primaryKey&&this.append(" primary key"),t.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),t.references&&(this.append(" "),this.visitNode(t.references)),t.check&&(this.append(" "),this.visitNode(t.check)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(t){this.append("references "),this.visitNode(t.table),this.append(" ("),this.compileList(t.columns),this.append(")"),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate))}visitDropTable(t){this.append("drop table "),t.ifExists&&this.append("if exists "),this.visitNode(t.table),t.cascade&&this.append(" cascade")}visitDataType(t){this.append(t.dataType)}visitOrderBy(t){this.append("order by "),this.compileList(t.items)}visitOrderByItem(t){this.visitNode(t.orderBy),t.direction&&(this.append(" "),this.visitNode(t.direction))}visitGroupBy(t){this.append("group by "),this.compileList(t.items)}visitGroupByItem(t){this.visitNode(t.groupBy)}visitUpdateQuery(t){var a;const n=this.nodeStack.find(QueryNode.is),o=n!==t;!o&&t.explain&&(this.visitNode(t.explain),this.append(" ")),o&&!MergeQueryNode.is(n)&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("update "),t.top&&(this.visitNode(t.top),this.append(" ")),t.table&&(this.visitNode(t.table),this.append(" ")),this.append("set "),t.updates&&this.compileList(t.updates),t.output&&(this.append(" "),this.visitNode(t.output)),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.returning&&(this.append(" "),this.visitNode(t.returning)),o&&!MergeQueryNode.is(n)&&this.append(")"),(a=t.endModifiers)!=null&&a.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitColumnUpdate(t){this.visitNode(t.column),this.append(" = "),this.visitNode(t.value)}visitLimit(t){this.append("limit "),this.visitNode(t.limit)}visitOffset(t){this.append("offset "),this.visitNode(t.offset)}visitOnConflict(t){this.append("on conflict"),t.columns?(this.append(" ("),this.compileList(t.columns),this.append(")")):t.constraint?(this.append(" on constraint "),this.visitNode(t.constraint)):t.indexExpression&&(this.append(" ("),this.visitNode(t.indexExpression),this.append(")")),t.indexWhere&&(this.append(" "),this.visitNode(t.indexWhere)),t.doNothing===!0?this.append(" do nothing"):t.updates&&(this.append(" do update set "),this.compileList(t.updates),t.updateWhere&&(this.append(" "),this.visitNode(t.updateWhere)))}visitOnDuplicateKey(t){this.append("on duplicate key update "),this.compileList(t.updates)}visitCreateIndex(t){this.append("create "),t.unique&&this.append("unique "),this.append("index "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.using&&(this.append(" using "),this.visitNode(t.using)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.where&&(this.append(" "),this.visitNode(t.where))}visitDropIndex(t){this.append("drop index "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.cascade&&this.append(" cascade")}visitCreateSchema(t){this.append("create schema "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.schema)}visitDropSchema(t){this.append("drop schema "),t.ifExists&&this.append("if exists "),this.visitNode(t.schema),t.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("primary key ("),this.compileList(t.columns),this.append(")")}visitUniqueConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(t.columns),this.append(")")}visitCheckConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("check ("),this.visitNode(t.expression),this.append(")")}visitForeignKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("foreign key ("),this.compileList(t.columns),this.append(") "),this.visitNode(t.references),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate))}visitList(t){this.compileList(t.items)}visitWith(t){this.append("with "),t.recursive&&this.append("recursive "),this.compileList(t.expressions)}visitCommonTableExpression(t){this.visitNode(t.name),this.append(" as "),isBoolean(t.materialized)&&(t.materialized||this.append("not "),this.append("materialized ")),this.visitNode(t.expression)}visitCommonTableExpressionName(t){this.visitNode(t.table),t.columns&&(this.append("("),this.compileList(t.columns),this.append(")"))}visitAlterTable(t){this.append("alter table "),this.visitNode(t.table),this.append(" "),t.renameTo&&(this.append("rename to "),this.visitNode(t.renameTo)),t.setSchema&&(this.append("set schema "),this.visitNode(t.setSchema)),t.addConstraint&&this.visitNode(t.addConstraint),t.dropConstraint&&this.visitNode(t.dropConstraint),t.columnAlterations&&this.compileColumnAlterations(t.columnAlterations),t.addIndex&&this.visitNode(t.addIndex),t.dropIndex&&this.visitNode(t.dropIndex)}visitAddColumn(t){this.append("add column "),this.visitNode(t.column)}visitRenameColumn(t){this.append("rename column "),this.visitNode(t.column),this.append(" to "),this.visitNode(t.renameTo)}visitDropColumn(t){this.append("drop column "),this.visitNode(t.column)}visitAlterColumn(t){this.append("alter column "),this.visitNode(t.column),this.append(" "),t.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(t.dataType),t.dataTypeExpression&&(this.append("using "),this.visitNode(t.dataTypeExpression))),t.setDefault&&(this.append("set default "),this.visitNode(t.setDefault)),t.dropDefault&&this.append("drop default"),t.setNotNull&&this.append("set not null"),t.dropNotNull&&this.append("drop not null")}visitModifyColumn(t){this.append("modify column "),this.visitNode(t.column)}visitAddConstraint(t){this.append("add "),this.visitNode(t.constraint)}visitDropConstraint(t){this.append("drop constraint "),t.ifExists&&this.append("if exists "),this.visitNode(t.constraintName),t.modifier==="cascade"?this.append(" cascade"):t.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(t){this.append(t.operator),this.append(" "),t.all&&this.append("all "),this.visitNode(t.expression)}visitCreateView(t){this.append("create "),t.orReplace&&this.append("or replace "),t.materialized&&this.append("materialized "),t.temporary&&this.append("temporary "),this.append("view "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),this.append(" "),t.columns&&(this.append("("),this.compileList(t.columns),this.append(") ")),t.as&&(this.append("as "),this.visitNode(t.as))}visitDropView(t){this.append("drop "),t.materialized&&this.append("materialized "),this.append("view "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.cascade&&this.append(" cascade")}visitGenerated(t){this.append("generated "),t.always&&this.append("always "),t.byDefault&&this.append("by default "),this.append("as "),t.identity&&this.append("identity"),t.expression&&(this.append("("),this.visitNode(t.expression),this.append(")")),t.stored&&this.append(" stored")}visitDefaultValue(t){this.append("default "),this.visitNode(t.defaultValue)}visitSelectModifier(t){t.rawModifier?this.visitNode(t.rawModifier):this.append(SELECT_MODIFIER_SQL[t.modifier]),t.of&&(this.append(" of "),this.compileList(t.of,", "))}visitCreateType(t){this.append("create type "),this.visitNode(t.name),t.enum&&(this.append(" as enum "),this.visitNode(t.enum))}visitDropType(t){this.append("drop type "),t.ifExists&&this.append("if exists "),this.visitNode(t.name)}visitExplain(t){this.append("explain"),(t.options||t.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),t.options&&(this.visitNode(t.options),t.format&&this.append(this.getExplainOptionsDelimiter())),t.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(t.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(t){this.append("default")}visitAggregateFunction(t){this.append(t.func),this.append("("),t.distinct&&this.append("distinct "),this.compileList(t.aggregated),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),this.append(")"),t.filter&&(this.append(" filter("),this.visitNode(t.filter),this.append(")")),t.over&&(this.append(" "),this.visitNode(t.over))}visitOver(t){this.append("over("),t.partitionBy&&(this.visitNode(t.partitionBy),t.orderBy&&this.append(" ")),t.orderBy&&this.visitNode(t.orderBy),this.append(")")}visitPartitionBy(t){this.append("partition by "),this.compileList(t.items)}visitPartitionByItem(t){this.visitNode(t.partitionBy)}visitBinaryOperation(t){this.visitNode(t.leftOperand),this.append(" "),this.visitNode(t.operator),this.append(" "),this.visitNode(t.rightOperand)}visitUnaryOperation(t){this.visitNode(t.operator),this.isMinusOperator(t.operator)||this.append(" "),this.visitNode(t.operand)}isMinusOperator(t){return OperatorNode.is(t)&&t.operator==="-"}visitUsing(t){this.append("using "),this.compileList(t.tables)}visitFunction(t){this.append(t.func),this.append("("),this.compileList(t.arguments),this.append(")")}visitCase(t){this.append("case"),t.value&&(this.append(" "),this.visitNode(t.value)),t.when&&(this.append(" "),this.compileList(t.when," ")),t.else&&(this.append(" else "),this.visitNode(t.else)),this.append(" end"),t.isStatement&&this.append(" case")}visitWhen(t){this.append("when "),this.visitNode(t.condition),t.result&&(this.append(" then "),this.visitNode(t.result))}visitJSONReference(t){this.visitNode(t.reference),this.visitNode(t.traversal)}visitJSONPath(t){t.inOperator&&this.visitNode(t.inOperator),this.append("'$");for(const n of t.pathLegs)this.visitNode(n);this.append("'")}visitJSONPathLeg(t){const n=t.type==="ArrayLocation";this.append(n?"[":"."),this.append(String(t.value)),n&&this.append("]")}visitJSONOperatorChain(t){for(let n=0,o=t.values.length;n<o;n++)n===o-1?this.visitNode(t.operator):this.append("->"),this.visitNode(t.values[n])}visitMergeQuery(t){var n;t.with&&(this.visitNode(t.with),this.append(" ")),this.append("merge "),t.top&&(this.visitNode(t.top),this.append(" ")),this.append("into "),this.visitNode(t.into),t.using&&(this.append(" "),this.visitNode(t.using)),t.whens&&(this.append(" "),this.compileList(t.whens," ")),t.output&&(this.append(" "),this.visitNode(t.output)),(n=t.endModifiers)!=null&&n.length&&(this.append(" "),this.compileList(t.endModifiers," "))}visitMatched(t){t.not&&this.append("not "),this.append("matched"),t.bySource&&this.append(" by source")}visitAddIndex(t){this.append("add "),t.unique&&this.append("unique "),this.append("index "),this.visitNode(t.name),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.using&&(this.append(" using "),this.visitNode(t.using))}visitCast(t){this.append("cast("),this.visitNode(t.expression),this.append(" as "),this.visitNode(t.dataType),this.append(")")}visitFetch(t){this.append("fetch next "),this.visitNode(t.rowCount),this.append(` rows ${t.modifier}`)}visitOutput(t){this.append("output "),this.compileList(t.selections)}visitTop(t){this.append(`top(${t.expression})`),t.modifiers&&this.append(` ${t.modifiers}`)}append(t){x(this,fn,i(this,fn)+t)}appendValue(t){this.addParameter(t),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(t){const n=this.getLeftIdentifierWrapper(),o=this.getRightIdentifierWrapper();let a="";for(const l of t)a+=l,l===n?a+=n:l===o&&(a+=o);return a}addParameter(t){i(this,Ar).push(t)}appendImmediateValue(t){if(isString(t))this.append(`'${t}'`);else if(isNumber(t)||isBoolean(t))this.append(t.toString());else if(isNull(t))this.append("null");else if(isDate(t))this.appendImmediateValue(t.toISOString());else if(isBigInt(t))this.appendImmediateValue(t.toString());else throw new Error(`invalid immediate value ${t}`)}sortSelectModifiers(t){return t.sort((n,o)=>n.modifier&&o.modifier?SELECT_MODIFIER_PRIORITY[n.modifier]-SELECT_MODIFIER_PRIORITY[o.modifier]:1),freeze(t)}compileColumnAlterations(t){this.compileList(t)}announcesNewColumnDataType(){return!0}}fn=new WeakMap,Ar=new WeakMap;const SELECT_MODIFIER_SQL=freeze({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),SELECT_MODIFIER_PRIORITY=freeze({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),JOIN_TYPE_SQL=freeze({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",Using:"using"}),CompiledQuery=freeze({raw(r,e=[]){return freeze({sql:r,query:RawNode.createWithSql(r),parameters:freeze(e)})}});class DialectAdapterBase{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}var Ht,Pn,hn,pn;class SqliteDriver{constructor(e){I(this,Ht);I(this,Pn,new ConnectionMutex);I(this,hn);I(this,pn);x(this,Ht,freeze({...e}))}async init(){x(this,hn,isFunction(i(this,Ht).database)?await i(this,Ht).database():i(this,Ht).database),x(this,pn,new SqliteConnection(i(this,hn))),i(this,Ht).onCreateConnection&&await i(this,Ht).onCreateConnection(i(this,pn))}async acquireConnection(){return await i(this,Pn).lock(),i(this,pn)}async beginTransaction(e){await e.executeQuery(CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(CompiledQuery.raw("rollback"))}async releaseConnection(){i(this,Pn).unlock()}async destroy(){var e;(e=i(this,hn))==null||e.close()}}Ht=new WeakMap,Pn=new WeakMap,hn=new WeakMap,pn=new WeakMap;var mn;class SqliteConnection{constructor(e){I(this,mn);x(this,mn,e)}executeQuery(e){const{sql:t,parameters:n}=e,o=i(this,mn).prepare(t);if(o.reader)return Promise.resolve({rows:o.all(n)});{const{changes:a,lastInsertRowid:l}=o.run(n),d=a!=null?BigInt(a):void 0;return Promise.resolve({numUpdatedOrDeletedRows:d,numAffectedRows:d,insertId:l!=null?BigInt(l):void 0,rows:[]})}}async*streamQuery(e,t){const{sql:n,parameters:o,query:a}=e,l=i(this,mn).prepare(n);if(SelectQueryNode.is(a)){const d=l.iterate(o);for(const h of d)yield{rows:[h]}}else throw new Error("Sqlite driver only supports streaming of select queries")}}mn=new WeakMap;var kr,Nn;class ConnectionMutex{constructor(){I(this,kr);I(this,Nn)}async lock(){for(;i(this,kr);)await i(this,kr);x(this,kr,new Promise(e=>{x(this,Nn,e)}))}unlock(){const e=i(this,Nn);x(this,kr,void 0),x(this,Nn,void 0),e==null||e()}}kr=new WeakMap,Nn=new WeakMap;const ID_WRAP_REGEX=/"/g;class SqliteQueryCompiler extends DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(ID_WRAP_REGEX,'""')}visitDefaultInsertValue(e){this.append("null")}}const DEFAULT_MIGRATION_TABLE="kysely_migration",DEFAULT_MIGRATION_LOCK_TABLE="kysely_migration_lock";freeze({__noMigrations__:!0});var yn,Ti,$o;class SqliteIntrospector{constructor(e){I(this,Ti);I(this,yn);x(this,yn,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let t=i(this,yn).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(t=t.where("name","!=",DEFAULT_MIGRATION_TABLE).where("name","!=",DEFAULT_MIGRATION_LOCK_TABLE));const n=await t.execute();return Promise.all(n.map(({name:o})=>G(this,Ti,$o).call(this,o)))}async getMetadata(e){return{tables:await this.getTables(e)}}}yn=new WeakMap,Ti=new WeakSet,$o=async function(e){var l,d,h,p,m,E;const t=i(this,yn),n=await t.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),o=(E=(m=(p=(h=(d=(l=n.sql)==null?void 0:l.split(/[\(\),]/))==null?void 0:d.find(A=>A.toLowerCase().includes("autoincrement")))==null?void 0:h.trimStart())==null?void 0:p.split(/\s+/))==null?void 0:m[0])==null?void 0:E.replace(/["`]/g,""),a=await t.selectFrom(sql`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:n.type==="view",columns:a.map(A=>({name:A.name,dataType:A.type,isNullable:!A.notnull,isAutoIncrementing:A.name===o,hasDefaultValue:A.dflt_value!=null,comment:void 0}))}};class SqliteAdapter extends DialectAdapterBase{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}var Mn;class SqliteDialect{constructor(e){I(this,Mn);x(this,Mn,freeze({...e}))}createDriver(){return new SqliteDriver(i(this,Mn))}createQueryCompiler(){return new SqliteQueryCompiler}createAdapter(){return new SqliteAdapter}createIntrospector(e){return new SqliteIntrospector(e)}}Mn=new WeakMap;const schema$1=[["site_id","object"],["cid","string"],["pk","object"],["table","string"],["val","any"],["db_version","number"],["col_version","number"],["cl","number"],["seq","number"]];function encode(r){return encode$1(r,schema$1)}function decode(r){return decode$1(r,schema$1)}function toBytes(r){return Uint8Array.from([...r].map(e=>e.charCodeAt(0)))}function fromBytes(r){return String.fromCharCode(...r)}function selectVersion(){const r=sql`SELECT 
    crsql_db_version() as current,
    IFNULL(MAX(version), 0) as synced
  FROM "__crstore_sync"`;return{execute:()=>r.execute(this).then(e=>e.rows[0])}}function updateVersion(r){return this.updateTable("__crstore_sync").set({version:r??sql`crsql_db_version()`})}function selectClient(){const r=sql`SELECT crsql_site_id() as client`;return{execute:()=>r.execute(this).then(e=>fromBytes(e.rows[0].client))}}function changesSince(r,{filter:e=void 0,chunk:t=!1}={}){let n=this.selectFrom("crsql_changes").select(sql`crsql_site_id()`.as("site_id")).select(["cid","pk","table","val","db_version","col_version","cl","seq"]).where("db_version",">",r).$if(!r,o=>o.where("cid","!=","__crsql_del")).$if(e===null,o=>o.where("site_id","is",sql`crsql_site_id()`)).$if(typeof e=="string",o=>o.where("site_id","is not",toBytes(e))).$castTo();return{execute:()=>n.execute().then(o=>t?chunk(o,{strict:!1}).map(encode):encode(o))}}function insertChanges(r){const e=async t=>{if(!r.length)return;const n=chunk(decode(r)).map(o=>t.insertInto("crsql_changes").values(o).execute());await Promise.all(n),await updateVersion.bind(t)().execute()};return{execute:()=>this.isTransaction?e(this):this.transaction().execute(e)}}function resolveChanges(r){return{execute:()=>applyOperation.bind(this)(e=>insertChanges.bind(e)(r).execute()).execute().then(e=>e.changes)}}function applyOperation(r,...e){return{execute:()=>this.transaction().execute(async t=>{const{current:n}=await selectVersion.bind(t)().execute(),o=await r(t,...e),a=await changesSince.bind(t)(n).execute();return{result:o,changes:a}})}}function finalize(){const r=sql`select crsql_finalize();`;return{execute:()=>r.execute(this)}}function affectedTables(r){var e,t,n,o;if(typeof r=="string")return[...new Set(decode(r).map(a=>a.table))];if(r.kind==="TableNode")return[r.table.identifier.name];if(r.kind==="ReferenceNode"&&r.table)return[r.table.table.identifier.name];if(r.kind==="AliasNode")return affectedTables(r.node);if(r.kind==="SelectQueryNode"){const a=[...((e=r.from)==null?void 0:e.froms)||[],...((t=r.joins)==null?void 0:t.map(l=>l.table))||[],...((n=r.selections)==null?void 0:n.map(l=>l.selection))||[],...((o=r.with)==null?void 0:o.expressions.map(l=>l.expression))||[]].flatMap(affectedTables);return[...new Set(a)]}return[]}const wasmUrl=""+new URL("../assets/crsqlite.CabMYEmC.wasm",import.meta.url).href;var Module=(()=>{var r=import.meta.url;return function(e={}){var t=e,n,o;t.ready=new Promise((s,u)=>{n=s,o=u});var a=Object.assign({},t),l="./this.program",d=(s,u)=>{throw u},h=typeof window=="object",p=typeof importScripts=="function",m="",E;(h||p)&&(p?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),r&&(m=r),m.indexOf("blob:")!==0?m=m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):m="",p&&(E=s=>{var u=new XMLHttpRequest;return u.open("GET",s,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}));var A=t.print||console.log.bind(console),L=t.printErr||console.error.bind(console);Object.assign(t,a),a=null,t.thisProgram&&(l=t.thisProgram),t.quit&&(d=t.quit);var S;t.wasmBinary&&(S=t.wasmBinary);var N=t.noExitRuntime||!0;typeof WebAssembly!="object"&&we("no native wasm support detected");var w,b=!1,g,C,k,X,T,F,fe,$;function K(){var s=w.buffer;t.HEAP8=C=new Int8Array(s),t.HEAP16=X=new Int16Array(s),t.HEAPU8=k=new Uint8Array(s),t.HEAPU16=new Uint16Array(s),t.HEAP32=T=new Int32Array(s),t.HEAPU32=F=new Uint32Array(s),t.HEAPF32=fe=new Float32Array(s),t.HEAPF64=$=new Float64Array(s)}var Q=[],te=[],ue=[],Y=[],be=0;function Ae(){var s=t.preRun.shift();Q.unshift(s)}var M=0,ne=null;function we(s){throw t.onAbort&&t.onAbort(s),s="Aborted("+s+")",L(s),b=!0,g=1,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),o(s),s}function Te(s){return s.startsWith("data:application/octet-stream;base64,")}var le;if(t.locateFile){if(le="crsqlite.wasm",!Te(le)){var rt=le;le=t.locateFile?t.locateFile(rt,m):m+rt}}else le=new URL(""+new URL("../assets/crsqlite.CabMYEmC.wasm",import.meta.url).href,import.meta.url).href;function dt(s){if(s==le&&S)return new Uint8Array(S);if(E)return E(s);throw"both async and sync fetching of the wasm failed"}function nt(s){return S||!h&&!p||typeof fetch!="function"?Promise.resolve().then(()=>dt(s)):fetch(s,{credentials:"same-origin"}).then(u=>{if(!u.ok)throw"failed to load wasm binary file at '"+s+"'";return u.arrayBuffer()}).catch(()=>dt(s))}function Xt(s,u,c){return nt(s).then(f=>WebAssembly.instantiate(f,u)).then(f=>f).then(c,f=>{L(`failed to asynchronously prepare wasm: ${f}`),we(f)})}function Yt(s,u){var c=le;return S||typeof WebAssembly.instantiateStreaming!="function"||Te(c)||typeof fetch!="function"?Xt(c,s,u):fetch(c,{credentials:"same-origin"}).then(f=>WebAssembly.instantiateStreaming(f,s).then(u,function(y){return L(`wasm streaming compile failed: ${y}`),L("falling back to ArrayBuffer instantiation"),Xt(c,s,u)}))}var J,Ee;function Kn(s){this.name="ExitStatus",this.message=`Program terminated with exit(${s})`,this.status=s}var Qr=s=>{for(;0<s.length;)s.shift()(t)};function Ce(s,u="i8"){switch(u.endsWith("*")&&(u="*"),u){case"i1":return C[s>>0];case"i8":return C[s>>0];case"i16":return X[s>>1];case"i32":return T[s>>2];case"i64":we("to do getValue(i64) use WASM_BIGINT");case"float":return fe[s>>2];case"double":return $[s>>3];case"*":return F[s>>2];default:we(`invalid type for getValue: ${u}`)}}function Me(s,u,c="i8"){switch(c.endsWith("*")&&(c="*"),c){case"i1":C[s>>0]=u;break;case"i8":C[s>>0]=u;break;case"i16":X[s>>1]=u;break;case"i32":T[s>>2]=u;break;case"i64":we("to do setValue(i64) use WASM_BIGINT");case"float":fe[s>>2]=u;break;case"double":$[s>>3]=u;break;case"*":F[s>>2]=u;break;default:we(`invalid type for setValue: ${c}`)}}var kt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,se=(s,u,c)=>{var f=u+c;for(c=u;s[c]&&!(c>=f);)++c;if(16<c-u&&s.buffer&&kt)return kt.decode(s.subarray(u,c));for(f="";u<c;){var y=s[u++];if(y&128){var O=s[u++]&63;if((y&224)==192)f+=String.fromCharCode((y&31)<<6|O);else{var _=s[u++]&63;y=(y&240)==224?(y&15)<<12|O<<6|_:(y&7)<<18|O<<12|_<<6|s[u++]&63,65536>y?f+=String.fromCharCode(y):(y-=65536,f+=String.fromCharCode(55296|y>>10,56320|y&1023))}}else f+=String.fromCharCode(y)}return f},Gn=(s,u)=>{for(var c=0,f=s.length-1;0<=f;f--){var y=s[f];y==="."?s.splice(f,1):y===".."?(s.splice(f,1),c++):c&&(s.splice(f,1),c--)}if(u)for(;c;c--)s.unshift("..");return s},gt=s=>{var u=s.charAt(0)==="/",c=s.substr(-1)==="/";return(s=Gn(s.split("/").filter(f=>!!f),!u).join("/"))||u||(s="."),s&&c&&(s+="/"),(u?"/":"")+s},vi=s=>{var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=u[0],u=u[1],!s&&!u?".":(u&&(u=u.substr(0,u.length-1)),s+u)},zr=s=>{if(s==="/")return"/";s=gt(s),s=s.replace(/\/$/,"");var u=s.lastIndexOf("/");return u===-1?s:s.substr(u+1)},V=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);we("initRandomDevice")},me=s=>(me=V())(s);function Re(){for(var s="",u=!1,c=arguments.length-1;-1<=c&&!u;c--){if(u=0<=c?arguments[c]:"/",typeof u!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!u)return"";s=u+"/"+s,u=u.charAt(0)==="/"}return s=Gn(s.split("/").filter(f=>!!f),!u).join("/"),(u?"/":"")+s||"."}var qe=[],Je=s=>{for(var u=0,c=0;c<s.length;++c){var f=s.charCodeAt(c);127>=f?u++:2047>=f?u+=2:55296<=f&&57343>=f?(u+=4,++c):u+=3}return u},Be=(s,u,c,f)=>{if(!(0<f))return 0;var y=c;f=c+f-1;for(var O=0;O<s.length;++O){var _=s.charCodeAt(O);if(55296<=_&&57343>=_){var W=s.charCodeAt(++O);_=65536+((_&1023)<<10)|W&1023}if(127>=_){if(c>=f)break;u[c++]=_}else{if(2047>=_){if(c+1>=f)break;u[c++]=192|_>>6}else{if(65535>=_){if(c+2>=f)break;u[c++]=224|_>>12}else{if(c+3>=f)break;u[c++]=240|_>>18,u[c++]=128|_>>12&63}u[c++]=128|_>>6&63}u[c++]=128|_&63}}return u[c]=0,c-y},dr=[];function bt(s,u){dr[s]={input:[],Ub:[],ec:u},Li(s,Ci)}var Ci={open(s){var u=dr[s.node.ic];if(!u)throw new B(43);s.Vb=u,s.seekable=!1},close(s){s.Vb.ec.lc(s.Vb)},lc(s){s.Vb.ec.lc(s.Vb)},read(s,u,c,f){if(!s.Vb||!s.Vb.ec.Ac)throw new B(60);for(var y=0,O=0;O<f;O++){try{var _=s.Vb.ec.Ac(s.Vb)}catch{throw new B(29)}if(_===void 0&&y===0)throw new B(6);if(_==null)break;y++,u[c+O]=_}return y&&(s.node.timestamp=Date.now()),y},write(s,u,c,f){if(!s.Vb||!s.Vb.ec.uc)throw new B(60);try{for(var y=0;y<f;y++)s.Vb.ec.uc(s.Vb,u[c+y])}catch{throw new B(29)}return f&&(s.node.timestamp=Date.now()),y}},Ri={Ac(){e:{if(!qe.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){var u=null;break e}u=Array(Je(s)+1),s=Be(s,u,0,u.length),u.length=s,qe=u}u=qe.shift()}return u},uc(s,u){u===null||u===10?(A(se(s.Ub,0)),s.Ub=[]):u!=0&&s.Ub.push(u)},lc(s){s.Ub&&0<s.Ub.length&&(A(se(s.Ub,0)),s.Ub=[])},ad(){return{Xc:25856,Zc:5,Wc:191,Yc:35387,Vc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},bd(){return 0},cd(){return[24,80]}},Xo={uc(s,u){u===null||u===10?(L(se(s.Ub,0)),s.Ub=[]):u!=0&&s.Ub.push(u)},lc(s){s.Ub&&0<s.Ub.length&&(L(se(s.Ub,0)),s.Ub=[])}};function ns(s,u){var c=s.Qb?s.Qb.length:0;c>=u||(u=Math.max(u,c*(1048576>c?2:1.125)>>>0),c!=0&&(u=Math.max(u,256)),c=s.Qb,s.Qb=new Uint8Array(u),0<s.Sb&&s.Qb.set(c.subarray(0,s.Sb),0))}var ae={Yb:null,Xb(){return ae.createNode(null,"/",16895,0)},createNode(s,u,c,f){if((c&61440)===24576||(c&61440)===4096)throw new B(63);return ae.Yb||(ae.Yb={dir:{node:{Wb:ae.Fb.Wb,Tb:ae.Fb.Tb,fc:ae.Fb.fc,mc:ae.Fb.mc,Ec:ae.Fb.Ec,rc:ae.Fb.rc,pc:ae.Fb.pc,Dc:ae.Fb.Dc,qc:ae.Fb.qc},stream:{bc:ae.Pb.bc}},file:{node:{Wb:ae.Fb.Wb,Tb:ae.Fb.Tb},stream:{bc:ae.Pb.bc,read:ae.Pb.read,write:ae.Pb.write,xc:ae.Pb.xc,nc:ae.Pb.nc,oc:ae.Pb.oc}},link:{node:{Wb:ae.Fb.Wb,Tb:ae.Fb.Tb,jc:ae.Fb.jc},stream:{}},yc:{node:{Wb:ae.Fb.Wb,Tb:ae.Fb.Tb},stream:ta}}),c=us(s,u,c,f),wt(c.mode)?(c.Fb=ae.Yb.dir.node,c.Pb=ae.Yb.dir.stream,c.Qb={}):(c.mode&61440)===32768?(c.Fb=ae.Yb.file.node,c.Pb=ae.Yb.file.stream,c.Sb=0,c.Qb=null):(c.mode&61440)===40960?(c.Fb=ae.Yb.link.node,c.Pb=ae.Yb.link.stream):(c.mode&61440)===8192&&(c.Fb=ae.Yb.yc.node,c.Pb=ae.Yb.yc.stream),c.timestamp=Date.now(),s&&(s.Qb[u]=c,s.timestamp=c.timestamp),c},$c(s){return s.Qb?s.Qb.subarray?s.Qb.subarray(0,s.Sb):new Uint8Array(s.Qb):new Uint8Array(0)},Fb:{Wb(s){var u={};return u.Kc=(s.mode&61440)===8192?s.id:1,u.Bc=s.id,u.mode=s.mode,u.Qc=1,u.uid=0,u.Nc=0,u.ic=s.ic,wt(s.mode)?u.size=4096:(s.mode&61440)===32768?u.size=s.Sb:(s.mode&61440)===40960?u.size=s.link.length:u.size=0,u.Gc=new Date(s.timestamp),u.Pc=new Date(s.timestamp),u.Jc=new Date(s.timestamp),u.Hc=4096,u.Ic=Math.ceil(u.size/u.Hc),u},Tb(s,u){if(u.mode!==void 0&&(s.mode=u.mode),u.timestamp!==void 0&&(s.timestamp=u.timestamp),u.size!==void 0&&(u=u.size,s.Sb!=u))if(u==0)s.Qb=null,s.Sb=0;else{var c=s.Qb;s.Qb=new Uint8Array(u),c&&s.Qb.set(c.subarray(0,Math.min(u,s.Sb))),s.Sb=u}},fc(){throw Ai[44]},mc(s,u,c,f){return ae.createNode(s,u,c,f)},Ec(s,u,c){if(wt(s.mode)){try{var f=fr(u,c)}catch{}if(f)for(var y in f.Qb)throw new B(55)}delete s.parent.Qb[s.name],s.parent.timestamp=Date.now(),s.name=c,u.Qb[c]=s,u.timestamp=s.parent.timestamp,s.parent=u},rc(s,u){delete s.Qb[u],s.timestamp=Date.now()},pc(s,u){var c=fr(s,u),f;for(f in c.Qb)throw new B(55);delete s.Qb[u],s.timestamp=Date.now()},Dc(s){var u=[".",".."],c;for(c in s.Qb)s.Qb.hasOwnProperty(c)&&u.push(c);return u},qc(s,u,c){return s=ae.createNode(s,u,41471,0),s.link=c,s},jc(s){if((s.mode&61440)!==40960)throw new B(28);return s.link}},Pb:{read(s,u,c,f,y){var O=s.node.Qb;if(y>=s.node.Sb)return 0;if(s=Math.min(s.node.Sb-y,f),8<s&&O.subarray)u.set(O.subarray(y,y+s),c);else for(f=0;f<s;f++)u[c+f]=O[y+f];return s},write(s,u,c,f,y,O){if(u.buffer===C.buffer&&(O=!1),!f)return 0;if(s=s.node,s.timestamp=Date.now(),u.subarray&&(!s.Qb||s.Qb.subarray)){if(O)return s.Qb=u.subarray(c,c+f),s.Sb=f;if(s.Sb===0&&y===0)return s.Qb=u.slice(c,c+f),s.Sb=f;if(y+f<=s.Sb)return s.Qb.set(u.subarray(c,c+f),y),f}if(ns(s,y+f),s.Qb.subarray&&u.subarray)s.Qb.set(u.subarray(c,c+f),y);else for(O=0;O<f;O++)s.Qb[y+O]=u[c+O];return s.Sb=Math.max(s.Sb,y+f),f},bc(s,u,c){if(c===1?u+=s.position:c===2&&(s.node.mode&61440)===32768&&(u+=s.node.Sb),0>u)throw new B(28);return u},xc(s,u,c){ns(s.node,u+c),s.node.Sb=Math.max(s.node.Sb,u+c)},nc(s,u,c,f,y){if((s.node.mode&61440)!==32768)throw new B(43);if(s=s.node.Qb,y&2||s.buffer!==C.buffer){if((0<c||c+u<s.length)&&(s.subarray?s=s.subarray(c,c+u):s=Array.prototype.slice.call(s,c,c+u)),c=!0,u=65536*Math.ceil(u/65536),(y=Oo(65536,u))?(k.fill(0,y,y+u),u=y):u=0,!u)throw new B(48);C.set(s,u)}else c=!1,u=s.byteOffset;return{Rc:u,Fc:c}},oc(s,u,c,f){return ae.Pb.write(s,u,0,f,c,!1),0}}},Yo=(s,u)=>{var c=0;return s&&(c|=365),u&&(c|=146),c},xi=null,ss={},_n=[],Zo=1,Zt=null,os=!0,B=null,Ai={};function ut(s,u={}){if(s=Re(s),!s)return{path:"",node:null};if(u=Object.assign({zc:!0,vc:0},u),8<u.vc)throw new B(32);s=s.split("/").filter(_=>!!_);for(var c=xi,f="/",y=0;y<s.length;y++){var O=y===s.length-1;if(O&&u.parent)break;if(c=fr(c,s[y]),f=gt(f+"/"+s[y]),c.cc&&(!O||O&&u.zc)&&(c=c.cc.root),!O||u.ac){for(O=0;(c.mode&61440)===40960;)if(c=ms(f),f=Re(vi(f),c),c=ut(f,{vc:u.vc+1}).node,40<O++)throw new B(32)}}return{path:f,node:c}}function Xn(s){for(var u;;){if(s===s.parent)return s=s.Xb.Cc,u?s[s.length-1]!=="/"?`${s}/${u}`:s+u:s;u=u?`${s.name}/${u}`:s.name,s=s.parent}}function ki(s,u){for(var c=0,f=0;f<u.length;f++)c=(c<<5)-c+u.charCodeAt(f)|0;return(s+c>>>0)%Zt.length}function as(s){var u=ki(s.parent.id,s.name);if(Zt[u]===s)Zt[u]=s.dc;else for(u=Zt[u];u;){if(u.dc===s){u.dc=s.dc;break}u=u.dc}}function fr(s,u){var c;if(c=(c=Pr(s,"x"))?c:s.Fb.fc?0:2)throw new B(c,s);for(c=Zt[ki(s.id,u)];c;c=c.dc){var f=c.name;if(c.parent.id===s.id&&f===u)return c}return s.Fb.fc(s,u)}function us(s,u,c,f){return s=new wo(s,u,c,f),u=ki(s.parent.id,s.name),s.dc=Zt[u],Zt[u]=s}function wt(s){return(s&61440)===16384}function ls(s){var u=["r","w","rw"][s&3];return s&512&&(u+="w"),u}function Pr(s,u){if(os)return 0;if(!u.includes("r")||s.mode&292){if(u.includes("w")&&!(s.mode&146)||u.includes("x")&&!(s.mode&73))return 2}else return 2;return 0}function cs(s,u){try{return fr(s,u),20}catch{}return Pr(s,"wx")}function ds(s,u,c){try{var f=fr(s,u)}catch(y){return y.Rb}if(s=Pr(s,"wx"))return s;if(c){if(!wt(f.mode))return 54;if(f===f.parent||Xn(f)==="/")return 10}else if(wt(f.mode))return 31;return 0}function ea(){for(var s=0;4096>=s;s++)if(!_n[s])return s;throw new B(33)}function it(s){if(s=_n[s],!s)throw new B(8);return s}function fs(s,u=-1){return Tn||(Tn=function(){this.kc={}},Tn.prototype={},Object.defineProperties(Tn.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.kc.flags},set(c){this.kc.flags=c}},position:{get(){return this.kc.position},set(c){this.kc.position=c}}})),s=Object.assign(new Tn,s),u==-1&&(u=ea()),s.Zb=u,_n[u]=s}var ta={open(s){s.Pb=ss[s.node.ic].Pb,s.Pb.open&&s.Pb.open(s)},bc(){throw new B(70)}};function Li(s,u){ss[s]={Pb:u}}function hs(s,u){var c=u==="/",f=!u;if(c&&xi)throw new B(10);if(!c&&!f){var y=ut(u,{zc:!1});if(u=y.path,y=y.node,y.cc)throw new B(10);if(!wt(y.mode))throw new B(54)}u={type:s,ed:{},Cc:u,Oc:[]},s=s.Xb(u),s.Xb=u,u.root=s,c?xi=s:y&&(y.cc=u,y.Xb&&y.Xb.Oc.push(u))}function qi(s,u,c){var f=ut(s,{parent:!0}).node;if(s=zr(s),!s||s==="."||s==="..")throw new B(28);var y=cs(f,s);if(y)throw new B(y);if(!f.Fb.mc)throw new B(63);return f.Fb.mc(f,s,u,c)}function Lt(s,u){return qi(s,(u!==void 0?u:511)&1023|16384,0)}function Yn(s,u,c){typeof c>"u"&&(c=u,u=438),qi(s,u|8192,c)}function Wi(s,u){if(!Re(s))throw new B(44);var c=ut(u,{parent:!0}).node;if(!c)throw new B(44);u=zr(u);var f=cs(c,u);if(f)throw new B(f);if(!c.Fb.qc)throw new B(63);c.Fb.qc(c,u,s)}function ps(s){var u=ut(s,{parent:!0}).node;s=zr(s);var c=fr(u,s),f=ds(u,s,!0);if(f)throw new B(f);if(!u.Fb.pc)throw new B(63);if(c.cc)throw new B(10);u.Fb.pc(u,s),as(c)}function ms(s){if(s=ut(s).node,!s)throw new B(44);if(!s.Fb.jc)throw new B(28);return Re(Xn(s.parent),s.Fb.jc(s))}function Zn(s,u){if(s=ut(s,{ac:!u}).node,!s)throw new B(44);if(!s.Fb.Wb)throw new B(63);return s.Fb.Wb(s)}function Ns(s){return Zn(s,!0)}function ys(s,u){if(s=typeof s=="string"?ut(s,{ac:!0}).node:s,!s.Fb.Tb)throw new B(63);s.Fb.Tb(s,{mode:u&4095|s.mode&-4096,timestamp:Date.now()})}function bs(s,u){if(0>u)throw new B(28);if(s=typeof s=="string"?ut(s,{ac:!0}).node:s,!s.Fb.Tb)throw new B(63);if(wt(s.mode))throw new B(31);if((s.mode&61440)!==32768)throw new B(28);var c=Pr(s,"w");if(c)throw new B(c);s.Fb.Tb(s,{size:u,timestamp:Date.now()})}function ei(s,u,c){if(s==="")throw new B(44);if(typeof u=="string"){var f={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[u];if(typeof f>"u")throw Error(`Unknown file open mode: ${u}`);u=f}if(c=u&64?(typeof c>"u"?438:c)&4095|32768:0,typeof s=="object")var y=s;else{s=gt(s);try{y=ut(s,{ac:!(u&131072)}).node}catch{}}if(f=!1,u&64)if(y){if(u&128)throw new B(20)}else y=qi(s,c,0),f=!0;if(!y)throw new B(44);if((y.mode&61440)===8192&&(u&=-513),u&65536&&!wt(y.mode))throw new B(54);if(!f&&(c=y?(y.mode&61440)===40960?32:wt(y.mode)&&(ls(u)!=="r"||u&512)?31:Pr(y,ls(u)):44))throw new B(c);return u&512&&!f&&bs(y,0),u&=-131713,y=fs({node:y,path:Xn(y),flags:u,seekable:!0,position:0,Pb:y.Pb,Uc:[],error:!1}),y.Pb.open&&y.Pb.open(y),!t.logReadFiles||u&1||(ti||(ti={}),s in ti||(ti[s]=1)),y}function ws(s,u,c){if(s.Zb===null)throw new B(8);if(!s.seekable||!s.Pb.bc)throw new B(70);if(c!=0&&c!=1&&c!=2)throw new B(28);s.position=s.Pb.bc(s,u,c),s.Uc=[]}function Es(){B||(B=function(s,u){this.name="ErrnoError",this.node=u,this.Sc=function(c){this.Rb=c},this.Sc(s),this.message="FS error"},B.prototype=Error(),B.prototype.constructor=B,[44].forEach(s=>{Ai[s]=new B(s),Ai[s].stack="<generic error, no stack>"}))}var gs;function On(s,u,c){s=gt("/dev/"+s);var f=Yo(!!u,!!c);Di||(Di=64);var y=Di++<<8|0;Li(y,{open(O){O.seekable=!1},close(){c&&c.buffer&&c.buffer.length&&c(10)},read(O,_,W,v){for(var R=0,z=0;z<v;z++){try{var q=u()}catch{throw new B(29)}if(q===void 0&&R===0)throw new B(6);if(q==null)break;R++,_[W+z]=q}return R&&(O.node.timestamp=Date.now()),R},write(O,_,W,v){for(var R=0;R<v;R++)try{c(_[W+R])}catch{throw new B(29)}return v&&(O.node.timestamp=Date.now()),R}}),Yn(s,f,y)}var Di,Ie={},Tn,ti;function hr(s,u,c){if(u.charAt(0)==="/")return u;if(s=s===-100?"/":it(s).path,u.length==0){if(!c)throw new B(44);return s}return gt(s+"/"+u)}function ri(s,u,c){try{var f=s(u)}catch(O){if(O&&O.node&&gt(u)!==gt(Xn(O.node)))return-54;throw O}T[c>>2]=f.Kc,T[c+4>>2]=f.mode,F[c+8>>2]=f.Qc,T[c+12>>2]=f.uid,T[c+16>>2]=f.Nc,T[c+20>>2]=f.ic,Ee=[f.size>>>0,(J=f.size,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],T[c+24>>2]=Ee[0],T[c+28>>2]=Ee[1],T[c+32>>2]=4096,T[c+36>>2]=f.Ic,s=f.Gc.getTime(),u=f.Pc.getTime();var y=f.Jc.getTime();return Ee=[Math.floor(s/1e3)>>>0,(J=Math.floor(s/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],T[c+40>>2]=Ee[0],T[c+44>>2]=Ee[1],F[c+48>>2]=s%1e3*1e3,Ee=[Math.floor(u/1e3)>>>0,(J=Math.floor(u/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],T[c+56>>2]=Ee[0],T[c+60>>2]=Ee[1],F[c+64>>2]=u%1e3*1e3,Ee=[Math.floor(y/1e3)>>>0,(J=Math.floor(y/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],T[c+72>>2]=Ee[0],T[c+76>>2]=Ee[1],F[c+80>>2]=y%1e3*1e3,Ee=[f.Bc>>>0,(J=f.Bc,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],T[c+88>>2]=Ee[0],T[c+92>>2]=Ee[1],0}var ni=void 0;function ii(){var s=T[ni>>2];return ni+=4,s}var In=(s,u)=>u+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*u:NaN,ra=[0,31,60,91,121,152,182,213,244,274,305,335],na=[0,31,59,90,120,151,181,212,243,273,304,334],_s=s=>{var u=Je(s)+1,c=Pi(u);return c&&Be(s,k,c,u),c},Bi={},Os=()=>{if(!Fi){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"},u;for(u in Bi)Bi[u]===void 0?delete s[u]:s[u]=Bi[u];var c=[];for(u in s)c.push(`${u}=${s[u]}`);Fi=c}return Fi},Fi;function Ts(){}function Is(){}function Ss(){}function vs(){}function Cs(){}function Rs(){}function xs(){}function As(){}function ks(){}function Ls(){}function qs(){}function Ws(){}function Ds(){}function Bs(){}function Fs(){}function Qs(){}function zs(){}function Ps(){}function Ms(){}function Us(){}function $s(){}function Vs(){}function Js(){}function Hs(){}function js(){}function Ks(){}function Gs(){}function Xs(){}function Ys(){}function Zs(){}function eo(){}function ro(){}function no(){}function io(){}function so(){}function oo(){}function ao(){}function uo(){}function lo(){}function co(){}var fo=s=>{g=s,N||0<be||(t.onExit&&t.onExit(s),b=!0),d(s,new Kn(s))},Qi=s=>{s instanceof Kn||s=="unwind"||d(1,s)},si=s=>{try{s()}catch(u){we(u)}};function ia(s){var u={},c;for(c in s)(function(f){var y=s[f];u[f]=typeof y=="function"?function(){oi.push(f);try{return y.apply(null,arguments)}finally{b||(oi.pop()===f||we(),qt&&er===1&&oi.length===0&&(er=0,si(Co),typeof Fibers<"u"&&Fibers.fd()))}}:y})(c);return u}var er=0,qt=null,ho=0,oi=[],po={},mo={},sa=0,zi=null,oa=[];function aa(){return new Promise((s,u)=>{zi={resolve:s,reject:u}})}function ua(){var s=Pi(16396),u=s+12;F[s>>2]=u,F[s+4>>2]=u+16384,u=oi[0];var c=po[u];return c===void 0&&(c=sa++,po[u]=c,mo[c]=u),T[s+8>>2]=c,s}function No(s){if(!b){if(er===0){var u=!1,c=!1;s((f=0)=>{if(!b&&(ho=f,u=!0,c)){er=2,si(()=>Ro(qt)),typeof Browser<"u"&&Browser.tc.Mc&&Browser.tc.resume(),f=!1;try{var y=(0,U[mo[T[qt+8>>2]]])()}catch(W){y=W,f=!0}var O=!1;if(!qt){var _=zi;_&&(zi=null,(f?_.reject:_.resolve)(y),O=!0)}if(f&&!O)throw y}}),c=!0,u||(er=1,qt=ua(),typeof Browser<"u"&&Browser.tc.Mc&&Browser.tc.pause(),si(()=>vo(qt)))}else er===2?(er=0,si(xo),go(qt),qt=null,oa.forEach(f=>{if(!b)try{if(f(),!(N||0<be))try{g=f=g,fo(f)}catch(y){Qi(y)}}catch(y){Qi(y)}})):we(`invalid state: ${er}`);return ho}}function yo(s){return No(u=>{s().then(u)})}var bo={},_t=(s,u,c,f,y)=>{function O(q){return--be,v!==0&&So(v),u==="string"?q?se(k,q):"":u==="boolean"?!!q:q}var _={string:q=>{var P=0;if(q!=null&&q!==0){P=Je(q)+1;var ie=Mi(P);Be(q,k,ie,P),P=ie}return P},array:q=>{var P=Mi(q.length);return C.set(q,P),P}};s=t["_"+s];var W=[],v=0;if(f)for(var R=0;R<f.length;R++){var z=_[c[R]];z?(v===0&&(v=Io()),W[R]=z(f[R])):W[R]=f[R]}return c=qt,f=s.apply(null,W),y=y&&y.async,be+=1,qt!=c?aa().then(O):(f=O(f),y?Promise.resolve(f):f)};function wo(s,u,c,f){s||(s=this),this.parent=s,this.Xb=s.Xb,this.cc=null,this.id=Zo++,this.name=u,this.mode=c,this.Fb={},this.Pb={},this.ic=f}Object.defineProperties(wo.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),Es(),Zt=Array(4096),hs(ae,"/"),Lt("/tmp"),Lt("/home"),Lt("/home/web_user"),function(){Lt("/dev"),Li(259,{read:()=>0,write:(f,y,O,_)=>_}),Yn("/dev/null",259),bt(1280,Ri),bt(1536,Xo),Yn("/dev/tty",1280),Yn("/dev/tty1",1536);var s=new Uint8Array(1024),u=0,c=()=>(u===0&&(u=me(s).byteLength),s[--u]);On("random",c),On("urandom",c),Lt("/dev/shm"),Lt("/dev/shm/tmp")}(),function(){Lt("/proc");var s=Lt("/proc/self");Lt("/proc/self/fd"),hs({Xb(){var u=us(s,"fd",16895,73);return u.Fb={fc(c,f){var y=it(+f);return c={parent:null,Xb:{Cc:"fake"},Fb:{jc:()=>y.path}},c.parent=c}},u}},"/proc/self/fd")}(),function(){const s=new Map;t.setAuthorizer=function(u,c,f){return c?s.set(u,{f:c,wc:f}):s.delete(u),_t("set_authorizer","number",["number"],[u])},Ts=function(u,c,f,y,O,_){if(s.has(u)){const{f:W,wc:v}=s.get(u);return W(v,c,f?f?se(k,f):"":null,y?y?se(k,y):"":null,O?O?se(k,O):"":null,_?_?se(k,_):"":null)}return 0}}(),function(){function s(f,y){const O=[];for(let _=0;f[y+_]!=0;++_){if(1e3<_)throw Error("C-string never terminated after 1k characters");O.push(f[y+_])}return String.fromCharCode(...O)}const u=new Map,c=new Map;t.updateHook=function(f,y){const O=u.size;return u.set(O,y),_t("update_hook","void",["number","number"],[f,O])},t.createFunction=function(f,y,O,_,W,v){const R=u.size;return u.set(R,{f:v,$b:W}),_t("create_function","number","number string number number number number".split(" "),[f,y,O,_,R,0])},t.createAggregate=function(f,y,O,_,W,v,R){const z=u.size;return u.set(z,{step:v,Lc:R,$b:W}),_t("create_function","number","number string number number number number".split(" "),[f,y,O,_,z,1])},t.getFunctionUserData=function(f){return c.get(f)},Rs=function(f,y,O,_,W,v){f=u.get(f);const R=k;W=BigInt(v)<<32n|BigInt(W)&4294967295n,f(y,s(R,O),s(R,_),W)},Ss=function(f,y,O,_){f=u.get(f),c.set(y,f.$b),f.f(y,new Uint32Array(k.buffer,_,O)),c.delete(y)},Cs=function(f,y,O,_){f=u.get(f),c.set(y,f.$b),f.step(y,new Uint32Array(k.buffer,_,O)),c.delete(y)},Is=function(f,y){f=u.get(f),c.set(y,f.$b),f.Lc(y),c.delete(y)}}(),function(){const s=new Map;t.progressHandler=function(u,c,f,y){return f?s.set(u,{f,wc:y}):s.delete(u),_t("progress_handler",null,["number","number"],[u,c])},vs=function(u){if(s.has(u)){const{f:c,wc:f}=s.get(u);return c(f)}return 0}}(),function(){function s(v,R){const z=`get${v}`,q=`set${v}`;return new Proxy(new DataView(k.buffer,R,v==="Int32"?4:8),{get(P,ie){if(ie===z)return function(Ne,Ue){if(!Ue)throw Error("must be little endian");return P[ie](Ne,Ue)};if(ie===q)return function(Ne,Ue,Fe){if(!Fe)throw Error("must be little endian");return P[ie](Ne,Ue,Fe)};if(typeof ie=="string"&&ie.match(/^(get)|(set)/))throw Error("invalid type");return P[ie]}})}const u=typeof bo=="object",c=new Map,f=new Map,y=new Map,O=u?new Set:null,_=u?new Set:null,W=new Map;Js=function(v,R,z,q){W.set(v?se(k,v):"",{size:R,hc:Array.from(new Uint32Array(k.buffer,q,z))})},t.createModule=function(v,R,z,q){u&&(z.handleAsync=yo);const P=c.size;return c.set(P,{module:z,$b:q}),q=0,z.xCreate&&(q|=1),z.xConnect&&(q|=2),z.xBestIndex&&(q|=4),z.xDisconnect&&(q|=8),z.xDestroy&&(q|=16),z.xOpen&&(q|=32),z.xClose&&(q|=64),z.xFilter&&(q|=128),z.xNext&&(q|=256),z.xEof&&(q|=512),z.xColumn&&(q|=1024),z.xRowid&&(q|=2048),z.xUpdate&&(q|=4096),z.xBegin&&(q|=8192),z.xSync&&(q|=16384),z.xCommit&&(q|=32768),z.xRollback&&(q|=65536),z.xFindFunction&&(q|=131072),z.xRename&&(q|=262144),_t("create_module","number",["number","string","number","number"],[v,R,P,q])},Ds=function(v,R,z,q,P,ie){if(R=c.get(R),f.set(P,R),u){O.delete(P);for(const Ne of O)f.delete(Ne)}return q=Array.from(new Uint32Array(k.buffer,q,z)).map(Ne=>Ne?se(k,Ne):""),R.module.xCreate(v,R.$b,q,P,s("Int32",ie))},Ws=function(v,R,z,q,P,ie){if(R=c.get(R),f.set(P,R),u){O.delete(P);for(const Ne of O)f.delete(Ne)}return q=Array.from(new Uint32Array(k.buffer,q,z)).map(Ne=>Ne?se(k,Ne):""),R.module.xConnect(v,R.$b,q,P,s("Int32",ie))},As=function(v,R){var z=f.get(v),q=W.get("sqlite3_index_info").hc;const P={};P.nConstraint=Ce(R+q[0],"i32"),P.aConstraint=[];for(var ie=Ce(R+q[1],"*"),Ne=W.get("sqlite3_index_constraint").size,Ue=0;Ue<P.nConstraint;++Ue){var Fe=P.aConstraint,lt=Fe.push,He=ie+Ue*Ne,Mr=W.get("sqlite3_index_constraint").hc,tr={};tr.iColumn=Ce(He+Mr[0],"i32"),tr.op=Ce(He+Mr[1],"i8"),tr.usable=!!Ce(He+Mr[2],"i8"),lt.call(Fe,tr)}for(P.nOrderBy=Ce(R+q[2],"i32"),P.aOrderBy=[],ie=Ce(R+q[3],"*"),Ne=W.get("sqlite3_index_orderby").size,Ue=0;Ue<P.nOrderBy;++Ue)Fe=P.aOrderBy,lt=Fe.push,He=ie+Ue*Ne,Mr=W.get("sqlite3_index_orderby").hc,tr={},tr.iColumn=Ce(He+Mr[0],"i32"),tr.desc=!!Ce(He+Mr[1],"i8"),lt.call(Fe,tr);for(P.aConstraintUsage=[],ie=0;ie<P.nConstraint;++ie)P.aConstraintUsage.push({argvIndex:0,omit:!1});for(P.idxNum=Ce(R+q[5],"i32"),P.idxStr=null,P.orderByConsumed=!!Ce(R+q[8],"i8"),P.estimatedCost=Ce(R+q[9],"double"),P.estimatedRows=Ce(R+q[10],"i32"),P.idxFlags=Ce(R+q[11],"i32"),P.colUsed=Ce(R+q[12],"i32"),v=z.module.xBestIndex(v,P),z=W.get("sqlite3_index_info").hc,q=Ce(R+z[4],"*"),ie=W.get("sqlite3_index_constraint_usage").size,lt=0;lt<P.nConstraint;++lt)Ne=q+lt*ie,Fe=P.aConstraintUsage[lt],He=W.get("sqlite3_index_constraint_usage").hc,Me(Ne+He[0],Fe.argvIndex,"i32"),Me(Ne+He[1],Fe.omit?1:0,"i8");return Me(R+z[5],P.idxNum,"i32"),typeof P.idxStr=="string"&&(q=Je(P.idxStr),ie=_t("sqlite3_malloc","number",["number"],[q+1]),Be(P.idxStr,k,ie,q+1),Me(R+z[6],ie,"*"),Me(R+z[7],1,"i32")),Me(R+z[8],P.orderByConsumed,"i32"),Me(R+z[9],P.estimatedCost,"double"),Me(R+z[10],P.estimatedRows,"i32"),Me(R+z[11],P.idxFlags,"i32"),v},Fs=function(v){const R=f.get(v);return u?O.add(v):f.delete(v),R.module.xDisconnect(v)},Bs=function(v){const R=f.get(v);return u?O.add(v):f.delete(v),R.module.xDestroy(v)},Ms=function(v,R){const z=f.get(v);if(y.set(R,z),u){_.delete(R);for(const q of _)y.delete(q)}return z.module.xOpen(v,R)},ks=function(v){const R=y.get(v);return u?_.add(v):y.delete(v),R.module.xClose(v)},Qs=function(v){return y.get(v).module.xEof(v)?1:0},zs=function(v,R,z,q,P){const ie=y.get(v);return z=z?z?se(k,z):"":null,P=new Uint32Array(k.buffer,P,q),ie.module.xFilter(v,R,z,P)},Ps=function(v){return y.get(v).module.xNext(v)},Ls=function(v,R,z){return y.get(v).module.xColumn(v,R,z)},Vs=function(v,R){return y.get(v).module.xRowid(v,s("BigInt64",R))},js=function(v,R,z,q){const P=f.get(v);return z=new Uint32Array(k.buffer,z,R),P.module.xUpdate(v,z,s("BigInt64",q))},xs=function(v){return f.get(v).module.xBegin(v)},Hs=function(v){return f.get(v).module.xSync(v)},qs=function(v){return f.get(v).module.xCommit(v)},$s=function(v){return f.get(v).module.xRollback(v)},Us=function(v,R){const z=f.get(v);return R=R?se(k,R):"",z.module.xRename(v,R)}}(),function(){function s(_,W){const v=`get${_}`,R=`set${_}`;return new Proxy(new DataView(k.buffer,W,_==="Int32"?4:8),{get(z,q){if(q===v)return function(P,ie){if(!ie)throw Error("must be little endian");return z[q](P,ie)};if(q===R)return function(P,ie,Ne){if(!Ne)throw Error("must be little endian");return z[q](P,ie,Ne)};if(typeof q=="string"&&q.match(/^(get)|(set)/))throw Error("invalid type");return z[q]}})}function u(_){return _>>=2,F[_]+F[_+1]*2**32}const c=typeof bo=="object",f=new Map,y=new Map;t.registerVFS=function(_,W){if(_t("sqlite3_vfs_find","number",["string"],[_.name]))throw Error(`VFS '${_.name}' already registered`);c&&(_.handleAsync=yo);var v=_.dd??64;const R=t._malloc(4);return W=_t("register_vfs","number",["string","number","number","number"],[_.name,v,W?1:0,R]),W||(v=Ce(R,"*"),f.set(v,_)),t._free(R),W};const O=c?new Set:null;Xs=function(_){const W=y.get(_);return c?O.add(_):y.delete(_),W.xClose(_)},so=function(_,W,v,R){return y.get(_).xRead(_,k.subarray(W,W+v),u(R))},co=function(_,W,v,R){return y.get(_).xWrite(_,k.subarray(W,W+v),u(R))},uo=function(_,W){return y.get(_).xTruncate(_,u(W))},ao=function(_,W){return y.get(_).xSync(_,W)},ro=function(_,W){const v=y.get(_);return W=s("BigInt64",W),v.xFileSize(_,W)},no=function(_,W){return y.get(_).xLock(_,W)},lo=function(_,W){return y.get(_).xUnlock(_,W)},Gs=function(_,W){const v=y.get(_);return W=s("Int32",W),v.xCheckReservedLock(_,W)},eo=function(_,W,v){const R=y.get(_);return v=new DataView(k.buffer,v),R.xFileControl(_,W,v)},oo=function(_){return y.get(_).xSectorSize(_)},Zs=function(_){return y.get(_).xDeviceCharacteristics(_)},io=function(_,W,v,R,z){if(_=f.get(_),y.set(v,_),c){O.delete(v);for(var q of O)y.delete(q)}if(q=null,R&64){q=1;const P=[];for(;q;){const ie=k[W++];if(ie)P.push(ie);else switch(k[W]||(q=null),q){case 1:P.push(63),q=2;break;case 2:P.push(61),q=3;break;case 3:P.push(38),q=2}}q=new TextDecoder().decode(new Uint8Array(P))}else W&&(q=W?se(k,W):"");return z=s("Int32",z),_.xOpen(q,v,R,z)},Ys=function(_,W,v){return f.get(_).xDelete(W?se(k,W):"",v)},Ks=function(_,W,v,R){return _=f.get(_),R=s("Int32",R),_.xAccess(W?se(k,W):"",v,R)}}();var la={a:(s,u,c,f)=>{we(`Assertion failed: ${s?se(k,s):""}, at: `+[u?u?se(k,u):"":"unknown filename",c,f?f?se(k,f):"":"unknown function"])},L:function(s,u){try{return s=s?se(k,s):"",ys(s,u),0}catch(c){if(typeof Ie>"u"||c.name!=="ErrnoError")throw c;return-c.Rb}},N:function(s,u,c){try{if(u=u?se(k,u):"",u=hr(s,u),c&-8)return-28;var f=ut(u,{ac:!0}).node;return f?(s="",c&4&&(s+="r"),c&2&&(s+="w"),c&1&&(s+="x"),s&&Pr(f,s)?-2:0):-44}catch(y){if(typeof Ie>"u"||y.name!=="ErrnoError")throw y;return-y.Rb}},M:function(s,u){try{var c=it(s);return ys(c.node,u),0}catch(f){if(typeof Ie>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},K:function(s){try{var u=it(s).node,c=typeof u=="string"?ut(u,{ac:!0}).node:u;if(!c.Fb.Tb)throw new B(63);return c.Fb.Tb(c,{timestamp:Date.now()}),0}catch(f){if(typeof Ie>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},b:function(s,u,c){ni=c;try{var f=it(s);switch(u){case 0:var y=ii();if(0>y)return-28;for(;_n[y];)y++;return fs(f,y).Zb;case 1:case 2:return 0;case 3:return f.flags;case 4:return y=ii(),f.flags|=y,0;case 5:return y=ii(),X[y+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return T[Eo()>>2]=28,-1;default:return-28}}catch(O){if(typeof Ie>"u"||O.name!=="ErrnoError")throw O;return-O.Rb}},J:function(s,u){try{var c=it(s);return ri(Zn,c.path,u)}catch(f){if(typeof Ie>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},n:function(s,u,c){u=In(u,c);try{if(isNaN(u))return 61;var f=it(s);if(!(f.flags&2097155))throw new B(28);return bs(f.node,u),0}catch(y){if(typeof Ie>"u"||y.name!=="ErrnoError")throw y;return-y.Rb}},D:function(s,u){try{if(u===0)return-28;var c=Je("/")+1;return u<c?-68:(Be("/",k,s,u),c)}catch(f){if(typeof Ie>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},G:function(s,u){try{return s=s?se(k,s):"",ri(Ns,s,u)}catch(c){if(typeof Ie>"u"||c.name!=="ErrnoError")throw c;return-c.Rb}},A:function(s,u,c){try{return u=u?se(k,u):"",u=hr(s,u),u=gt(u),u[u.length-1]==="/"&&(u=u.substr(0,u.length-1)),Lt(u,c),0}catch(f){if(typeof Ie>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},F:function(s,u,c,f){try{u=u?se(k,u):"";var y=f&256;return u=hr(s,u,f&4096),ri(y?Ns:Zn,u,c)}catch(O){if(typeof Ie>"u"||O.name!=="ErrnoError")throw O;return-O.Rb}},z:function(s,u,c,f){ni=f;try{u=u?se(k,u):"",u=hr(s,u);var y=f?ii():0;return ei(u,c,y).Zb}catch(O){if(typeof Ie>"u"||O.name!=="ErrnoError")throw O;return-O.Rb}},w:function(s,u,c,f){try{if(u=u?se(k,u):"",u=hr(s,u),0>=f)return-28;var y=ms(u),O=Math.min(f,Je(y)),_=C[c+O];return Be(y,k,c,f+1),C[c+O]=_,O}catch(W){if(typeof Ie>"u"||W.name!=="ErrnoError")throw W;return-W.Rb}},v:function(s){try{return s=s?se(k,s):"",ps(s),0}catch(u){if(typeof Ie>"u"||u.name!=="ErrnoError")throw u;return-u.Rb}},H:function(s,u){try{return s=s?se(k,s):"",ri(Zn,s,u)}catch(c){if(typeof Ie>"u"||c.name!=="ErrnoError")throw c;return-c.Rb}},r:function(s,u,c){try{if(u=u?se(k,u):"",u=hr(s,u),c===0){s=u;var f=ut(s,{parent:!0}).node;if(!f)throw new B(44);var y=zr(s),O=fr(f,y),_=ds(f,y,!1);if(_)throw new B(_);if(!f.Fb.rc)throw new B(63);if(O.cc)throw new B(10);f.Fb.rc(f,y),as(O)}else c===512?ps(u):we("Invalid flags passed to unlinkat");return 0}catch(W){if(typeof Ie>"u"||W.name!=="ErrnoError")throw W;return-W.Rb}},q:function(s,u,c){try{if(u=u?se(k,u):"",u=hr(s,u,!0),c){var f=F[c>>2]+4294967296*T[c+4>>2],y=T[c+8>>2];O=1e3*f+y/1e6,c+=16,f=F[c>>2]+4294967296*T[c+4>>2],y=T[c+8>>2],_=1e3*f+y/1e6}else var O=Date.now(),_=O;s=O;var W=ut(u,{ac:!0}).node;return W.Fb.Tb(W,{timestamp:Math.max(s,_)}),0}catch(v){if(typeof Ie>"u"||v.name!=="ErrnoError")throw v;return-v.Rb}},k:function(s,u,c){s=new Date(1e3*In(s,u)),T[c>>2]=s.getSeconds(),T[c+4>>2]=s.getMinutes(),T[c+8>>2]=s.getHours(),T[c+12>>2]=s.getDate(),T[c+16>>2]=s.getMonth(),T[c+20>>2]=s.getFullYear()-1900,T[c+24>>2]=s.getDay(),u=s.getFullYear(),T[c+28>>2]=(u%4!==0||u%100===0&&u%400!==0?na:ra)[s.getMonth()]+s.getDate()-1|0,T[c+36>>2]=-(60*s.getTimezoneOffset()),u=new Date(s.getFullYear(),6,1).getTimezoneOffset();var f=new Date(s.getFullYear(),0,1).getTimezoneOffset();T[c+32>>2]=(u!=f&&s.getTimezoneOffset()==Math.min(f,u))|0},i:function(s,u,c,f,y,O,_,W){y=In(y,O);try{if(isNaN(y))return 61;var v=it(f);if(u&2&&!(c&2)&&(v.flags&2097155)!==2)throw new B(2);if((v.flags&2097155)===1)throw new B(2);if(!v.Pb.nc)throw new B(43);var R=v.Pb.nc(v,s,y,u,c),z=R.Rc;return T[_>>2]=R.Fc,F[W>>2]=z,0}catch(q){if(typeof Ie>"u"||q.name!=="ErrnoError")throw q;return-q.Rb}},j:function(s,u,c,f,y,O,_){O=In(O,_);try{if(isNaN(O))return 61;var W=it(y);if(c&2){if((W.node.mode&61440)!==32768)throw new B(43);f&2||W.Pb.oc&&W.Pb.oc(W,k.slice(s,s+u),O,u,f)}}catch(v){if(typeof Ie>"u"||v.name!=="ErrnoError")throw v;return-v.Rb}},s:(s,u,c)=>{function f(v){return(v=v.toTimeString().match(/\(([A-Za-z ]+)\)$/))?v[1]:"GMT"}var y=new Date().getFullYear(),O=new Date(y,0,1),_=new Date(y,6,1);y=O.getTimezoneOffset();var W=_.getTimezoneOffset();F[s>>2]=60*Math.max(y,W),T[u>>2]=+(y!=W),s=f(O),u=f(_),s=_s(s),u=_s(u),W<y?(F[c>>2]=s,F[c+4>>2]=u):(F[c>>2]=u,F[c+4>>2]=s)},e:()=>Date.now(),d:()=>performance.now(),t:(s,u,c)=>k.copyWithin(s,u,u+c),o:s=>{var u=k.length;if(s>>>=0,2147483648<s)return!1;for(var c=1;4>=c;c*=2){var f=u*(1+.2/c);f=Math.min(f,s+100663296);var y=Math;f=Math.max(s,f);e:{y=(y.min.call(y,2147483648,f+(65536-f%65536)%65536)-w.buffer.byteLength+65535)/65536;try{w.grow(y),K();var O=1;break e}catch{}O=void 0}if(O)return!0}return!1},B:(s,u)=>{var c=0;return Os().forEach((f,y)=>{var O=u+c;for(y=F[s+4*y>>2]=O,O=0;O<f.length;++O)C[y++>>0]=f.charCodeAt(O);C[y>>0]=0,c+=f.length+1}),0},C:(s,u)=>{var c=Os();F[s>>2]=c.length;var f=0;return c.forEach(y=>f+=y.length+1),F[u>>2]=f,0},f:function(s){try{var u=it(s);if(u.Zb===null)throw new B(8);u.sc&&(u.sc=null);try{u.Pb.close&&u.Pb.close(u)}catch(c){throw c}finally{_n[u.Zb]=null}return u.Zb=null,0}catch(c){if(typeof Ie>"u"||c.name!=="ErrnoError")throw c;return c.Rb}},p:function(s,u){try{var c=it(s);return C[u>>0]=c.Vb?2:wt(c.mode)?3:(c.mode&61440)===40960?7:4,X[u+2>>1]=0,Ee=[0,(J=0,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],T[u+8>>2]=Ee[0],T[u+12>>2]=Ee[1],Ee=[0,(J=0,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],T[u+16>>2]=Ee[0],T[u+20>>2]=Ee[1],0}catch(f){if(typeof Ie>"u"||f.name!=="ErrnoError")throw f;return f.Rb}},y:function(s,u,c,f){try{e:{var y=it(s);s=u;for(var O,_=u=0;_<c;_++){var W=F[s>>2],v=F[s+4>>2];s+=8;var R=y,z=W,q=v,P=O,ie=C;if(0>q||0>P)throw new B(28);if(R.Zb===null)throw new B(8);if((R.flags&2097155)===1)throw new B(8);if(wt(R.node.mode))throw new B(31);if(!R.Pb.read)throw new B(28);var Ne=typeof P<"u";if(!Ne)P=R.position;else if(!R.seekable)throw new B(70);var Ue=R.Pb.read(R,ie,z,q,P);Ne||(R.position+=Ue);var Fe=Ue;if(0>Fe){var lt=-1;break e}if(u+=Fe,Fe<v)break;typeof O<"u"&&(O+=Fe)}lt=u}return F[f>>2]=lt,0}catch(He){if(typeof Ie>"u"||He.name!=="ErrnoError")throw He;return He.Rb}},l:function(s,u,c,f,y){u=In(u,c);try{if(isNaN(u))return 61;var O=it(s);return ws(O,u,f),Ee=[O.position>>>0,(J=O.position,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],T[y>>2]=Ee[0],T[y+4>>2]=Ee[1],O.sc&&u===0&&f===0&&(O.sc=null),0}catch(_){if(typeof Ie>"u"||_.name!=="ErrnoError")throw _;return _.Rb}},E:function(s){try{var u=it(s);return No(c=>{var f=u.node.Xb;f.type.Tc?f.type.Tc(f,!1,y=>{c(y?29:0)}):c(0)})}catch(c){if(typeof Ie>"u"||c.name!=="ErrnoError")throw c;return c.Rb}},u:function(s,u,c,f){try{e:{var y=it(s);s=u;for(var O,_=u=0;_<c;_++){var W=F[s>>2],v=F[s+4>>2];s+=8;var R=y,z=W,q=v,P=O,ie=C;if(0>q||0>P)throw new B(28);if(R.Zb===null)throw new B(8);if(!(R.flags&2097155))throw new B(8);if(wt(R.node.mode))throw new B(31);if(!R.Pb.write)throw new B(28);R.seekable&&R.flags&1024&&ws(R,0,2);var Ne=typeof P<"u";if(!Ne)P=R.position;else if(!R.seekable)throw new B(70);var Ue=R.Pb.write(R,ie,z,q,P,void 0);Ne||(R.position+=Ue);var Fe=Ue;if(0>Fe){var lt=-1;break e}u+=Fe,typeof O<"u"&&(O+=Fe)}lt=u}return F[f>>2]=lt,0}catch(He){if(typeof Ie>"u"||He.name!=="ErrnoError")throw He;return He.Rb}},ta:Ts,P:Is,ia:Ss,da:vs,_:Cs,I:Rs,ma:xs,x:As,g:ks,pa:Ls,ka:qs,fa:Ws,ga:Ds,h:Bs,m:Fs,qa:Qs,sa:zs,ra:Ps,ea:Ms,ha:Us,ja:$s,oa:Vs,c:Js,la:Hs,na:js,ba:Ks,W:Gs,aa:Xs,ca:Ys,T:Zs,V:eo,Z:ro,Y:no,S:io,R:so,U:oo,$:ao,O:uo,X:lo,Q:co},U=function(){function s(c){if(c=c.exports,U=c=ia(c),w=U.ua,K(),te.unshift(U.va),M--,t.monitorRunDependencies&&t.monitorRunDependencies(M),M==0&&ne){var f=ne;ne=null,f()}return c}var u={a:la};if(M++,t.monitorRunDependencies&&t.monitorRunDependencies(M),t.instantiateWasm)try{return t.instantiateWasm(u,s)}catch(c){L(`Module.instantiateWasm callback failed with error: ${c}`),o(c)}return Yt(u,function(c){s(c.instance)}).catch(o),{}}();t._sqlite3_step=s=>(t._sqlite3_step=U.wa)(s),t._sqlite3_malloc=s=>(t._sqlite3_malloc=U.xa)(s),t._sqlite3_free=s=>(t._sqlite3_free=U.ya)(s),t._sqlite3_bind_blob=(s,u,c,f,y)=>(t._sqlite3_bind_blob=U.za)(s,u,c,f,y),t._sqlite3_bind_int=(s,u,c)=>(t._sqlite3_bind_int=U.Aa)(s,u,c),t._sqlite3_bind_int64=(s,u,c,f)=>(t._sqlite3_bind_int64=U.Ba)(s,u,c,f),t._sqlite3_bind_double=(s,u,c)=>(t._sqlite3_bind_double=U.Ca)(s,u,c),t._sqlite3_bind_null=(s,u)=>(t._sqlite3_bind_null=U.Da)(s,u),t._sqlite3_clear_bindings=s=>(t._sqlite3_clear_bindings=U.Ea)(s),t._sqlite3_bind_text=(s,u,c,f,y)=>(t._sqlite3_bind_text=U.Fa)(s,u,c,f,y),t._sqlite3_close=s=>(t._sqlite3_close=U.Ga)(s),t._sqlite3_column_type=(s,u)=>(t._sqlite3_column_type=U.Ha)(s,u),t._sqlite3_column_count=s=>(t._sqlite3_column_count=U.Ia)(s),t._sqlite3_column_text=(s,u)=>(t._sqlite3_column_text=U.Ja)(s,u),t._sqlite3_column_blob=(s,u)=>(t._sqlite3_column_blob=U.Ka)(s,u),t._sqlite3_column_bytes=(s,u)=>(t._sqlite3_column_bytes=U.La)(s,u),t._sqlite3_column_double=(s,u)=>(t._sqlite3_column_double=U.Ma)(s,u),t._sqlite3_column_int=(s,u)=>(t._sqlite3_column_int=U.Na)(s,u),t._sqlite3_column_int64=(s,u)=>(t._sqlite3_column_int64=U.Oa)(s,u),t._sqlite3_column_name=(s,u)=>(t._sqlite3_column_name=U.Pa)(s,u),t._sqlite3_declare_vtab=(s,u)=>(t._sqlite3_declare_vtab=U.Qa)(s,u),t._sqlite3_errmsg=s=>(t._sqlite3_errmsg=U.Ra)(s),t._sqlite3_exec=(s,u,c,f,y)=>(t._sqlite3_exec=U.Sa)(s,u,c,f,y),t._sqlite3_finalize=s=>(t._sqlite3_finalize=U.Ta)(s),t._sqlite3_prepare_v2=(s,u,c,f,y)=>(t._sqlite3_prepare_v2=U.Ua)(s,u,c,f,y),t._sqlite3_result_int=(s,u)=>(t._sqlite3_result_int=U.Va)(s,u),t._sqlite3_result_blob=(s,u,c,f)=>(t._sqlite3_result_blob=U.Wa)(s,u,c,f),t._sqlite3_result_int64=(s,u,c)=>(t._sqlite3_result_int64=U.Xa)(s,u,c),t._sqlite3_result_double=(s,u)=>(t._sqlite3_result_double=U.Ya)(s,u),t._sqlite3_result_null=s=>(t._sqlite3_result_null=U.Za)(s),t._sqlite3_result_error=(s,u,c)=>(t._sqlite3_result_error=U._a)(s,u,c),t._sqlite3_result_text=(s,u,c,f)=>(t._sqlite3_result_text=U.$a)(s,u,c,f),t._sqlite3_sql=s=>(t._sqlite3_sql=U.ab)(s),t._sqlite3_reset=s=>(t._sqlite3_reset=U.bb)(s),t._sqlite3_value_text=s=>(t._sqlite3_value_text=U.cb)(s),t._sqlite3_value_type=s=>(t._sqlite3_value_type=U.db)(s),t._sqlite3_value_bytes=s=>(t._sqlite3_value_bytes=U.eb)(s),t._sqlite3_value_blob=s=>(t._sqlite3_value_blob=U.fb)(s),t._sqlite3_value_int=s=>(t._sqlite3_value_int=U.gb)(s),t._sqlite3_value_int64=s=>(t._sqlite3_value_int64=U.hb)(s),t._sqlite3_value_double=s=>(t._sqlite3_value_double=U.ib)(s),t._sqlite3_get_autocommit=s=>(t._sqlite3_get_autocommit=U.jb)(s),t._sqlite3_vfs_find=s=>(t._sqlite3_vfs_find=U.kb)(s),t._sqlite3_data_count=s=>(t._sqlite3_data_count=U.lb)(s),t._sqlite3_bind_parameter_count=s=>(t._sqlite3_bind_parameter_count=U.mb)(s),t._sqlite3_bind_parameter_name=(s,u)=>(t._sqlite3_bind_parameter_name=U.nb)(s,u),t._sqlite3_libversion=()=>(t._sqlite3_libversion=U.ob)(),t._sqlite3_libversion_number=()=>(t._sqlite3_libversion_number=U.pb)(),t._sqlite3_changes=s=>(t._sqlite3_changes=U.qb)(s),t._sqlite3_limit=(s,u,c)=>(t._sqlite3_limit=U.rb)(s,u,c),t._sqlite3_open_v2=(s,u,c,f)=>(t._sqlite3_open_v2=U.sb)(s,u,c,f);var Eo=()=>(Eo=U.tb)(),Pi=t._malloc=s=>(Pi=t._malloc=U.ub)(s),go=t._free=s=>(go=t._free=U.vb)(s);t._RegisterExtensionFunctions=s=>(t._RegisterExtensionFunctions=U.wb)(s),t._set_authorizer=s=>(t._set_authorizer=U.xb)(s),t._create_function=(s,u,c,f,y,O)=>(t._create_function=U.yb)(s,u,c,f,y,O),t._update_hook=(s,u)=>(t._update_hook=U.zb)(s,u),t._create_module=(s,u,c,f)=>(t._create_module=U.Ab)(s,u,c,f),t._progress_handler=(s,u)=>(t._progress_handler=U.Bb)(s,u),t._register_vfs=(s,u,c,f)=>(t._register_vfs=U.Cb)(s,u,c,f),t._getSqliteFree=()=>(t._getSqliteFree=U.Db)();var _o=t._main=(s,u)=>(_o=t._main=U.Eb)(s,u),Oo=(s,u)=>(Oo=U.Gb)(s,u),To=()=>(To=U.Hb)(),Io=()=>(Io=U.Ib)(),So=s=>(So=U.Jb)(s),Mi=s=>(Mi=U.Kb)(s),vo=s=>(vo=U.Lb)(s),Co=()=>(Co=U.Mb)(),Ro=s=>(Ro=U.Nb)(s),xo=()=>(xo=U.Ob)();t.getTempRet0=To,t.ccall=_t,t.cwrap=(s,u,c,f)=>{var y=!c||c.every(O=>O==="number"||O==="boolean");return u!=="string"&&y&&!f?t["_"+s]:function(){return _t(s,u,c,arguments,f)}},t.setValue=Me,t.getValue=Ce,t.UTF8ToString=(s,u)=>s?se(k,s,u):"",t.stringToUTF8=(s,u,c)=>Be(s,k,u,c),t.lengthBytesUTF8=Je;var ai;ne=function s(){ai||Ao(),ai||(ne=s)};function Ao(){function s(){if(!ai&&(ai=!0,t.calledRun=!0,!b)){if(t.noFSInit||gs||(gs=!0,Es(),t.stdin=t.stdin,t.stdout=t.stdout,t.stderr=t.stderr,t.stdin?On("stdin",t.stdin):Wi("/dev/tty","/dev/stdin"),t.stdout?On("stdout",null,t.stdout):Wi("/dev/tty","/dev/stdout"),t.stderr?On("stderr",null,t.stderr):Wi("/dev/tty1","/dev/stderr"),ei("/dev/stdin",0),ei("/dev/stdout",1),ei("/dev/stderr",1)),os=!1,Qr(te),Qr(ue),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),ko){var u=_o;try{var c=u(0,0);g=c,fo(c)}catch(f){Qi(f)}}if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)u=t.postRun.shift(),Y.unshift(u);Qr(Y)}}if(!(0<M)){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Ae();Qr(Q),0<M||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),s()},1)):s())}}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();var ko=!0;return t.noInitialRun&&(ko=!1),Ao(),e.ready}})();const SQLITE_OK=0,SQLITE_BUSY=5,SQLITE_IOERR=10,SQLITE_NOTFOUND=12,SQLITE_CANTOPEN=14,SQLITE_MISUSE=21,SQLITE_RANGE=25,SQLITE_NOTICE=27,SQLITE_ROW=100,SQLITE_DONE=101,SQLITE_IOERR_LOCK=3850,SQLITE_IOERR_SHORT_READ=522,SQLITE_OPEN_READONLY=1,SQLITE_OPEN_READWRITE=2,SQLITE_OPEN_CREATE=4,SQLITE_OPEN_DELETEONCLOSE=8,SQLITE_OPEN_URI=64,SQLITE_LOCK_NONE=0,SQLITE_LOCK_SHARED=1,SQLITE_LOCK_RESERVED=2,SQLITE_LOCK_PENDING=3,SQLITE_LOCK_EXCLUSIVE=4,SQLITE_IOCAP_SAFE_APPEND=512,SQLITE_IOCAP_SEQUENTIAL=1024,SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN=2048,SQLITE_IOCAP_BATCH_ATOMIC=16384,SQLITE_INTEGER=1,SQLITE_FLOAT=2,SQLITE_TEXT=3,SQLITE_BLOB=4,SQLITE_NULL=5,SQLITE_UTF8=1,MAX_INT64=0x7fffffffffffffffn,MIN_INT64=-0x8000000000000000n;class SQLiteError extends Error{constructor(e,t){super(e),this.code=t}}const async=!0;function Factory(r){const e={},t=r._getSqliteFree(),n=r._malloc(8),o=[n,n+4];function a(N){if(typeof N!="string")return 0;const w=r.lengthBytesUTF8(N),b=r._sqlite3_malloc(w+1);return r.stringToUTF8(N,b,w+1),b}function l(N,w){return BigInt(w)<<32n|BigInt(N)&0xffffffffn}const d=function(){const N=BigInt(Number.MAX_SAFE_INTEGER)>>32n,w=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(b,g){return g>N||g<w?l(b,g):g*4294967296+(b&2147483647)-(b&2147483648)}}(),h=new Set;function p(N){if(!h.has(N))throw new SQLiteError("not a database",SQLITE_MISUSE)}const m=new Map;function E(N){if(!m.has(N))throw new SQLiteError("not a statement",SQLITE_MISUSE)}e.bind_collection=function(N,w){E(N);const b=Array.isArray(w),g=e.bind_parameter_count(N);for(let C=1;C<=g;++C){const k=b?C-1:e.bind_parameter_name(N,C),X=w[k];X!==void 0&&e.bind(N,C,X)}return SQLITE_OK},e.bind=function(N,w,b){switch(E(N),typeof b){case"number":return b===(b|0)?e.bind_int(N,w,b):e.bind_double(N,w,b);case"string":return e.bind_text(N,w,b);default:if(b instanceof Uint8Array||Array.isArray(b))return e.bind_blob(N,w,b);if(b===null)return e.bind_null(N,w);if(typeof b=="bigint")return e.bind_int64(N,w,b);if(b===void 0)return SQLITE_NOTICE;throw new Error("Unknown binding type "+typeof b)}},e.bind_blob=function(){const N="sqlite3_bind_blob",w=r.cwrap(N,...decl("nnnnn:n"));return function(b,g,C){E(b);const k=C.byteLength??C.length,X=r._sqlite3_malloc(k);r.HEAPU8.subarray(X).set(C);const T=w(b,g,X,k,t);return S(N,T,m.get(b))}}(),e.bind_parameter_count=function(){const w=r.cwrap("sqlite3_bind_parameter_count",...decl("n:n"));return function(b){return E(b),w(b)}}(),e.bind_double=function(){const N="sqlite3_bind_double",w=r.cwrap(N,...decl("nnn:n"));return function(b,g,C){E(b);const k=w(b,g,C);return S(N,k,m.get(b))}}(),e.bind_int=function(){const N="sqlite3_bind_int",w=r.cwrap(N,...decl("nnn:n"));return function(b,g,C){if(E(b),C>2147483647||C<-2147483648)return SQLITE_RANGE;const k=w(b,g,C);return S(N,k,m.get(b))}}(),e.bind_int64=function(){const N="sqlite3_bind_int64",w=r.cwrap(N,...decl("nnnn:n"));return function(b,g,C){if(E(b),C>MAX_INT64||C<MIN_INT64)return SQLITE_RANGE;const k=C&0xffffffffn,X=C>>32n,T=w(b,g,Number(k),Number(X));return S(N,T,m.get(b))}}(),e.bind_null=function(){const N="sqlite3_bind_null",w=r.cwrap(N,...decl("nn:n"));return function(b,g){E(b);const C=w(b,g);return S(N,C,m.get(b))}}(),e.bind_parameter_name=function(){const w=r.cwrap("sqlite3_bind_parameter_name",...decl("n:s"));return function(b,g){return E(b),w(b,g)}}(),e.bind_text=function(){const N="sqlite3_bind_text",w=r.cwrap(N,...decl("nnnnn:n"));return function(b,g,C){E(b);const k=a(C),X=w(b,g,k,-1,t);return S(N,X,m.get(b))}}(),e.changes=function(){const w=r.cwrap("sqlite3_changes",...decl("n:n"));return function(b){return p(b),w(b)}}(),e.close=function(){const N="sqlite3_close",w=r.cwrap(N,...decl("n:n"),{async});return async function(b){p(b);const g=await w(b);return h.delete(b),S(N,g,b)}}(),e.column=function(N,w){E(N);const b=e.column_type(N,w);switch(b){case SQLITE_BLOB:return e.column_blob(N,w);case SQLITE_FLOAT:return e.column_double(N,w);case SQLITE_INTEGER:const g=e.column_int(N,w),C=r.getTempRet0();return d(g,C);case SQLITE_NULL:return null;case SQLITE_TEXT:return e.column_text(N,w);default:throw new SQLiteError("unknown type",b)}},e.column_blob=function(){const w=r.cwrap("sqlite3_column_blob",...decl("nn:n"));return function(b,g){E(b);const C=e.column_bytes(b,g),k=w(b,g),X=r.HEAPU8.subarray(k,k+C),T=new ArrayBuffer(X.byteLength),F=new Uint8Array(T);return F.set(X),F}}(),e.column_bytes=function(){const w=r.cwrap("sqlite3_column_bytes",...decl("nn:n"));return function(b,g){return E(b),w(b,g)}}(),e.column_count=function(){const w=r.cwrap("sqlite3_column_count",...decl("n:n"));return function(b){return E(b),w(b)}}(),e.column_double=function(){const w=r.cwrap("sqlite3_column_double",...decl("nn:n"));return function(b,g){return E(b),w(b,g)}}(),e.column_int=function(){const w=r.cwrap("sqlite3_column_int64",...decl("nn:n"));return function(b,g){return E(b),w(b,g)}}(),e.column_int64=function(){const w=r.cwrap("sqlite3_column_int64",...decl("nn:n"));return function(b,g){E(b);const C=w(b,g),k=r.getTempRet0();return l(C,k)}}(),e.column_name=function(){const w=r.cwrap("sqlite3_column_name",...decl("nn:s"));return function(b,g){return E(b),w(b,g)}}(),e.column_names=function(N){const w=[],b=e.column_count(N);for(let g=0;g<b;++g)w.push(e.column_name(N,g));return w},e.column_text=function(){const w=r.cwrap("sqlite3_column_text",...decl("nn:s"));return function(b,g){return E(b),w(b,g)}}(),e.column_type=function(){const w=r.cwrap("sqlite3_column_type",...decl("nn:n"));return function(b,g){return E(b),w(b,g)}}(),e.update_hook=function(N,w){return p(N),r.updateHook(N,w),SQLITE_OK},e.create_function=function(N,w,b,g,C,k,X,T){if(p(N),k&&!X&&!T){const F=r.createFunction(N,w,b,g,C,k);return S("sqlite3_create_function",F,N)}if(!k&&X&&T){const F=r.createAggregate(N,w,b,g,C,X,T);return S("sqlite3_create_function",F,N)}throw new SQLiteError("invalid function combination",SQLITE_MISUSE)},e.create_module=function(N,w,b,g){p(N);const C=r.createModule(N,w,b,g);return S("sqlite3_create_module",C,N)},e.data_count=function(){const w=r.cwrap("sqlite3_data_count",...decl("n:n"));return function(b){return E(b),w(b)}}(),e.declare_vtab=function(){const w=r.cwrap("sqlite3_declare_vtab",...decl("ns:n"));return function(b,g){const C=w(b,g);return S("sqlite3_declare_vtab",C)}}(),e.exec=async function(N,w,b){for await(const g of e.statements(N,w)){let C;for(;await e.step(g)===SQLITE_ROW;)if(b){C=C??e.column_names(g);const k=e.row(g);await b(k,C)}}return SQLITE_OK},e.finalize=function(){const w=r.cwrap("sqlite3_finalize",...decl("n:n"),{async});return async function(b){if(!m.has(b))return SQLITE_MISUSE;const g=await w(b);return m.get(b),m.delete(b),g}}(),e.get_autocommit=function(){const w=r.cwrap("sqlite3_get_autocommit",...decl("n:n"));return function(b){return w(b)}}(),e.libversion=function(){const w=r.cwrap("sqlite3_libversion",...decl(":s"));return function(){return w()}}(),e.libversion_number=function(){const w=r.cwrap("sqlite3_libversion_number",...decl(":n"));return function(){return w()}}(),e.limit=function(){const w=r.cwrap("sqlite3_limit",...decl("nnn:n"));return function(b,g,C){return w(b,g,C)}}(),e.open_v2=function(){const N="sqlite3_open_v2",w=r.cwrap(N,...decl("snnn:n"),{async});return async function(b,g,C){g=g||SQLITE_OPEN_CREATE|SQLITE_OPEN_READWRITE,C=a(C);const k=await w(b,o[0],g,C),X=r.getValue(o[0],"*");return h.add(X),r._sqlite3_free(C),r.ccall("RegisterExtensionFunctions","void",["number"],[X]),S(N,k),X}}(),e.prepare_v2=function(){const N="sqlite3_prepare_v2",w=r.cwrap(N,...decl("nnnnn:n"),{async});return async function(b,g){const C=await w(b,g,-1,o[0],o[1]);S(N,C,b);const k=r.getValue(o[0],"*");return k?(m.set(k,b),{stmt:k,sql:r.getValue(o[1],"*")}):null}}(),e.progress_handler=function(N,w,b,g){p(N),r.progressHandler(N,w,b,g)},e.reset=function(){const N="sqlite3_reset",w=r.cwrap(N,...decl("n:n"),{async});return async function(b){E(b);const g=await w(b);return S(N,g,m.get(b))}}(),e.result=function(N,w){switch(typeof w){case"number":w===(w|0)?e.result_int(N,w):e.result_double(N,w);break;case"string":e.result_text(N,w);break;default:if(w instanceof Uint8Array||Array.isArray(w))e.result_blob(N,w);else if(w===null)e.result_null(N);else{if(typeof w=="bigint")return e.result_int64(N,w);console.warn("unknown result converted to null",w),e.result_null(N)}break}},e.result_blob=function(){const w=r.cwrap("sqlite3_result_blob",...decl("nnnn:n"));return function(b,g){const C=g.byteLength??g.length,k=r._sqlite3_malloc(C);r.HEAPU8.subarray(k).set(g),w(b,k,C,t)}}(),e.result_double=function(){const w=r.cwrap("sqlite3_result_double",...decl("nn:n"));return function(b,g){w(b,g)}}(),e.result_int=function(){const w=r.cwrap("sqlite3_result_int",...decl("nn:n"));return function(b,g){w(b,g)}}(),e.result_int64=function(){const w=r.cwrap("sqlite3_result_int64",...decl("nnn:n"));return function(b,g){if(g>MAX_INT64||g<MIN_INT64)return SQLITE_RANGE;const C=g&0xffffffffn,k=g>>32n;w(b,Number(C),Number(k))}}(),e.result_null=function(){const w=r.cwrap("sqlite3_result_null",...decl("n:n"));return function(b){w(b)}}(),e.result_text=function(){const w=r.cwrap("sqlite3_result_text",...decl("nnnn:n"));return function(b,g){const C=a(g);w(b,C,-1,t)}}(),e.row=function(N){const w=[],b=e.data_count(N);for(let g=0;g<b;++g){const C=e.column(N,g);w.push((C==null?void 0:C.buffer)===r.HEAPU8.buffer?C.slice():C)}return w},e.set_authorizer=function(N,w,b){p(N);const g=r.setAuthorizer(N,w,b);return S("sqlite3_set_authorizer",g,N)},e.sql=function(){const w=r.cwrap("sqlite3_sql",...decl("n:s"));return function(b){return E(b),w(b)}}(),e.statements=function(N,w){return async function*(){const b=e.str_new(N,w);let g={stmt:null,sql:e.str_value(b)};try{for(;g=await e.prepare_v2(N,g.sql);)yield g.stmt,e.finalize(g.stmt),g.stmt=null}finally{g!=null&&g.stmt&&e.finalize(g.stmt),e.str_finish(b)}}()},e.step=function(){const N="sqlite3_step",w=r.cwrap(N,...decl("n:n"),{async});return async function(b){E(b);const g=await w(b);return S(N,g,m.get(b),[SQLITE_ROW,SQLITE_DONE])}}();let A=0;const L=new Map;e.str_new=function(N,w=""){const b=r.lengthBytesUTF8(w),g=A++&4294967295,C={offset:r._sqlite3_malloc(b+1),bytes:b};return L.set(g,C),r.stringToUTF8(w,C.offset,C.bytes+1),g},e.str_appendall=function(N,w){if(!L.has(N))throw new SQLiteError("not a string",SQLITE_MISUSE);const b=L.get(N),g=r.lengthBytesUTF8(w),C=b.bytes+g,k=r._sqlite3_malloc(C+1);r.HEAPU8.subarray(k,k+C+1).set(r.HEAPU8.subarray(b.offset,b.offset+b.bytes)),r.stringToUTF8(w,k+b.bytes,g+1),r._sqlite3_free(b.offset),b.offset=k,b.bytes=C,L.set(N,b)},e.str_finish=function(N){if(!L.has(N))throw new SQLiteError("not a string",SQLITE_MISUSE);const w=L.get(N);L.delete(N),r._sqlite3_free(w.offset)},e.str_value=function(N){if(!L.has(N))throw new SQLiteError("not a string",SQLITE_MISUSE);return L.get(N).offset},e.user_data=function(N){return r.getFunctionUserData(N)},e.value=function(N){const w=e.value_type(N);switch(w){case SQLITE_BLOB:return e.value_blob(N);case SQLITE_FLOAT:return e.value_double(N);case SQLITE_INTEGER:const b=e.value_int(N),g=r.getTempRet0();return d(b,g);case SQLITE_NULL:return null;case SQLITE_TEXT:return e.value_text(N);default:throw new SQLiteError("unknown type",w)}},e.value_blob=function(){const w=r.cwrap("sqlite3_value_blob",...decl("n:n"));return function(b){const g=e.value_bytes(b),C=w(b);return r.HEAPU8.subarray(C,C+g)}}(),e.value_bytes=function(){const w=r.cwrap("sqlite3_value_bytes",...decl("n:n"));return function(b){return w(b)}}(),e.value_double=function(){const w=r.cwrap("sqlite3_value_double",...decl("n:n"));return function(b){return w(b)}}(),e.value_int=function(){const w=r.cwrap("sqlite3_value_int64",...decl("n:n"));return function(b){return w(b)}}(),e.value_int64=function(){const w=r.cwrap("sqlite3_value_int64",...decl("n:n"));return function(b){const g=w(b),C=r.getTempRet0();return l(g,C)}}(),e.value_text=function(){const w=r.cwrap("sqlite3_value_text",...decl("n:s"));return function(b){return w(b)}}(),e.value_type=function(){const w=r.cwrap("sqlite3_value_type",...decl("n:n"));return function(b){return w(b)}}(),e.vfs_register=function(N,w){const b=r.registerVFS(N,w);return S("sqlite3_vfs_register",b)};function S(N,w,b=null,g=[SQLITE_OK]){if(g.includes(w))return w;const C=b?r.ccall("sqlite3_errmsg","string",["number"],[b]):N;throw new SQLiteError(C,w)}return e}function decl(r){const e=[],t=r.match(/([ns@]*):([nsv@])/);switch(t[2]){case"n":e.push("number");break;case"s":e.push("string");break;case"v":e.push(null);break}const n=[];for(let o of t[1])switch(o){case"n":n.push("number");break;case"s":n.push("string");break}return e.push(n),e}class Base{constructor(){oe(this,"mxPathName",64)}xClose(e){return SQLITE_IOERR}xRead(e,t,n){return SQLITE_IOERR}xWrite(e,t,n){return SQLITE_IOERR}xTruncate(e,t){return SQLITE_IOERR}xSync(e,t){return SQLITE_OK}xFileSize(e,t){return SQLITE_IOERR}xLock(e,t){return SQLITE_OK}xUnlock(e,t){return SQLITE_OK}xCheckReservedLock(e,t){return t.setInt32(0,0,!0),SQLITE_OK}xFileControl(e,t,n){return SQLITE_NOTFOUND}xSectorSize(e){return 512}xDeviceCharacteristics(e){return 0}xOpen(e,t,n,o){return SQLITE_CANTOPEN}xDelete(e,t){return SQLITE_IOERR}xAccess(e,t,n){return SQLITE_IOERR}handleAsync(e){return e()}}const LOCK_TYPE_MASK=SQLITE_LOCK_NONE|SQLITE_LOCK_SHARED|SQLITE_LOCK_RESERVED|SQLITE_LOCK_PENDING|SQLITE_LOCK_EXCLUSIVE;var Ye,bn,Un,Gt,Gi,Vo,Jo;class WebLocksBase{constructor(){I(this,Gt);I(this,Ye,SQLITE_LOCK_NONE);oe(this,"timeoutMillis",0);I(this,bn,new Map);I(this,Un,Promise.resolve(0))}get state(){return i(this,Ye)}async lock(e){return G(this,Gt,Gi).call(this,G(this,Gt,Vo),e)}async unlock(e){return G(this,Gt,Gi).call(this,G(this,Gt,Jo),e)}async isSomewhereReserved(){throw new Error("unimplemented")}async _NONEtoSHARED(){}async _SHAREDtoEXCLUSIVE(){await this._SHAREDtoRESERVED(),await this._RESERVEDtoEXCLUSIVE()}async _SHAREDtoRESERVED(){}async _RESERVEDtoEXCLUSIVE(){}async _EXCLUSIVEtoRESERVED(){}async _EXCLUSIVEtoSHARED(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED()}async _EXCLUSIVEtoNONE(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _RESERVEDtoSHARED(){}async _RESERVEDtoNONE(){await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _SHAREDtoNONE(){}_acquireWebLock(e,t){return new Promise(async(n,o)=>{try{await navigator.locks.request(e,t,a=>{if(n(a),a)return new Promise(l=>i(this,bn).set(e,l))})}catch(a){o(a)}})}_releaseWebLock(e){var t;(t=i(this,bn).get(e))==null||t(),i(this,bn).delete(e)}async _pollWebLock(e){var n;return(n=(await navigator.locks.query()).held.find(({name:o})=>o===e))==null?void 0:n.mode}_getTimeoutSignal(){if(this.timeoutMillis){const e=new AbortController;return setTimeout(()=>e.abort(),this.timeoutMillis),e.signal}}}Ye=new WeakMap,bn=new WeakMap,Un=new WeakMap,Gt=new WeakSet,Gi=async function(e,t){const n=t&LOCK_TYPE_MASK;try{const o=()=>e.call(this,n);return await x(this,Un,i(this,Un).then(o,o)),x(this,Ye,n),SQLITE_OK}catch(o){return o.name==="AbortError"?SQLITE_BUSY:(console.error(o),SQLITE_IOERR_LOCK)}},Vo=async function(e){if(e===i(this,Ye))return SQLITE_OK;switch(i(this,Ye)){case SQLITE_LOCK_NONE:switch(e){case SQLITE_LOCK_SHARED:return this._NONEtoSHARED();default:throw new Error(`unexpected transition ${i(this,Ye)} -> ${e}`)}case SQLITE_LOCK_SHARED:switch(e){case SQLITE_LOCK_RESERVED:return this._SHAREDtoRESERVED();case SQLITE_LOCK_EXCLUSIVE:return this._SHAREDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${i(this,Ye)} -> ${e}`)}case SQLITE_LOCK_RESERVED:switch(e){case SQLITE_LOCK_EXCLUSIVE:return this._RESERVEDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${i(this,Ye)} -> ${e}`)}default:throw new Error(`unexpected transition ${i(this,Ye)} -> ${e}`)}},Jo=async function(e){if(e===i(this,Ye))return SQLITE_OK;switch(i(this,Ye)){case SQLITE_LOCK_EXCLUSIVE:switch(e){case SQLITE_LOCK_SHARED:return this._EXCLUSIVEtoSHARED();case SQLITE_LOCK_NONE:return this._EXCLUSIVEtoNONE();default:throw new Error(`unexpected transition ${i(this,Ye)} -> ${e}`)}case SQLITE_LOCK_RESERVED:switch(e){case SQLITE_LOCK_SHARED:return this._RESERVEDtoSHARED();case SQLITE_LOCK_NONE:return this._RESERVEDtoNONE();default:throw new Error(`unexpected transition ${i(this,Ye)} -> ${e}`)}case SQLITE_LOCK_SHARED:switch(e){case SQLITE_LOCK_NONE:return this._SHAREDtoNONE();default:throw new Error(`unexpected transition ${i(this,Ye)} -> ${e}`)}default:throw new Error(`unexpected transition ${i(this,Ye)} -> ${e}`)}};class WebLocksExclusive extends WebLocksBase{constructor(e){super(),this._lockName=e+"-outer",this._reservedName=e+"-reserved"}async isSomewhereReserved(){return await this._pollWebLock(this._reservedName)==="exclusive"}async _NONEtoSHARED(){await this._acquireWebLock(this._lockName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _SHAREDtoRESERVED(){await this._acquireWebLock(this._reservedName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _RESERVEDtoSHARED(){this._releaseWebLock(this._reservedName)}async _SHAREDtoNONE(){this._releaseWebLock(this._lockName)}}const MAX_TRANSACTION_LIFETIME_MILLIS=5e3;let nextTxId=0;const mapTxToId=new WeakMap;function log$2(...r){}var wn,En,$n,Ve,Vn,Lr,qr,Ii,Ho;class IDBContext{constructor(e,t={durability:"default"}){I(this,Ii);I(this,wn);I(this,En);I(this,$n);I(this,Ve,null);I(this,Vn,0);I(this,Lr,Promise.resolve());I(this,qr,Promise.resolve());x(this,En,Promise.resolve(e).then(n=>x(this,wn,n))),x(this,$n,t)}async close(){const e=i(this,wn)??await i(this,En);await i(this,Lr),await this.sync(),e.close()}async run(e,t){const n=i(this,Lr).then(()=>G(this,Ii,Ho).call(this,e,t));return x(this,Lr,n.catch(()=>{})),n}async sync(){await i(this,Lr),await i(this,qr),x(this,qr,Promise.resolve())}}wn=new WeakMap,En=new WeakMap,$n=new WeakMap,Ve=new WeakMap,Vn=new WeakMap,Lr=new WeakMap,qr=new WeakMap,Ii=new WeakSet,Ho=async function(e,t){var o,a;const n=i(this,wn)??await i(this,En);if(e==="readwrite"&&((o=i(this,Ve))==null?void 0:o.mode)==="readonly")x(this,Ve,null);else if(performance.now()-i(this,Vn)>MAX_TRANSACTION_LIFETIME_MILLIS){try{(a=i(this,Ve))==null||a.commit()}catch(l){if(l.name!=="InvalidStateError")throw l}await new Promise(l=>setTimeout(l)),x(this,Ve,null)}for(let l=0;l<2;++l){if(!i(this,Ve)){x(this,Ve,n.transaction(n.objectStoreNames,e,i(this,$n)));const d=x(this,Vn,performance.now());x(this,qr,i(this,qr).then(()=>new Promise((h,p)=>{i(this,Ve).addEventListener("complete",m=>{h(),i(this,Ve)===m.target&&x(this,Ve,null),log$2(`transaction ${mapTxToId.get(m.target)} complete`)}),i(this,Ve).addEventListener("abort",m=>{console.warn("tx abort",(performance.now()-d)/1e3);const E=m.target.error;p(E),i(this,Ve)===m.target&&x(this,Ve,null),log$2(`transaction ${mapTxToId.get(m.target)} aborted`,E)})}))),mapTxToId.set(i(this,Ve),nextTxId++)}try{const d=Object.fromEntries(Array.from(n.objectStoreNames,h=>[h,new ObjectStore(i(this,Ve).objectStore(h))]));return await t(d)}catch(d){if(x(this,Ve,null),l)throw d}}};function wrapRequest(r){return new Promise((e,t)=>{r.addEventListener("success",()=>e(r.result)),r.addEventListener("error",()=>t(r.error))})}var ze;class ObjectStore{constructor(e){I(this,ze);x(this,ze,e)}get(e){log$2(`get ${i(this,ze).name}`,e);const t=i(this,ze).get(e);return wrapRequest(t)}getAll(e,t){log$2(`getAll ${i(this,ze).name}`,e,t);const n=i(this,ze).getAll(e,t);return wrapRequest(n)}getKey(e){log$2(`getKey ${i(this,ze).name}`,e);const t=i(this,ze).getKey(e);return wrapRequest(t)}getAllKeys(e,t){log$2(`getAllKeys ${i(this,ze).name}`,e,t);const n=i(this,ze).getAllKeys(e,t);return wrapRequest(n)}put(e,t){log$2(`put ${i(this,ze).name}`,e,t);const n=i(this,ze).put(e,t);return wrapRequest(n)}delete(e){log$2(`delete ${i(this,ze).name}`,e);const t=i(this,ze).delete(e);return wrapRequest(t)}clear(){log$2(`clear ${i(this,ze).name}`);const e=i(this,ze).clear();return wrapRequest(e)}index(e){return new Index(i(this,ze).index(e))}}ze=new WeakMap;var Wr;class Index{constructor(e){I(this,Wr);x(this,Wr,e)}getAllKeys(e,t){log$2(`IDBIndex.getAllKeys ${i(this,Wr).objectStore.name}<${i(this,Wr).name}>`,e,t);const n=i(this,Wr).getAllKeys(e,t);return wrapRequest(n)}}Wr=new WeakMap;const SECTOR_SIZE=512,MAX_TASK_MILLIS=3e3,DEFAULT_OPTIONS={durability:"default",purge:"deferred",purgeAtLeast:16};function log$1(...r){}var cr,Ze,xe,Dr,Br,jt,et,Xi,jo,Ko,$r,Go;class IDBBatchAtomicVFS extends Base{constructor(t="wa-sqlite",n=DEFAULT_OPTIONS){super();I(this,et);I(this,cr);I(this,Ze,new Map);I(this,xe);I(this,Dr,new Set);I(this,Br,performance.now());I(this,jt,new Set);this.name=t,x(this,cr,Object.assign({},DEFAULT_OPTIONS,n)),x(this,xe,new IDBContext(openDatabase(t),{durability:i(this,cr).durability}))}async close(){var t;for(const n of i(this,Ze).keys())await this.xClose(n);await((t=i(this,xe))==null?void 0:t.close()),x(this,xe,null)}xOpen(t,n,o,a){return this.handleAsync(async()=>{t===null&&(t=`null_${n}`),log$1(`xOpen ${t} 0x${n.toString(16)} 0x${o.toString(16)}`);try{const l=new URL(t,"http://localhost/"),d={path:l.pathname,flags:o,block0:null,isMetadataChanged:!0,locks:new WebLocksExclusive(l.pathname)};return i(this,Ze).set(n,d),await i(this,xe).run("readwrite",async({blocks:h})=>{if(d.block0=await h.get(G(this,et,$r).call(this,d,0)),!d.block0)if(o&SQLITE_OPEN_CREATE)d.block0={path:d.path,offset:0,version:0,data:new Uint8Array(0),fileSize:0},h.put(d.block0);else throw new Error(`file not found: ${d.path}`)}),a.setInt32(0,o&SQLITE_OPEN_READONLY,!0),SQLITE_OK}catch(l){return console.error(l),SQLITE_CANTOPEN}})}xClose(t){return this.handleAsync(async()=>{try{const n=i(this,Ze).get(t);return n&&(log$1(`xClose ${n.path}`),i(this,Ze).delete(t),n.flags&SQLITE_OPEN_DELETEONCLOSE&&i(this,xe).run("readwrite",({blocks:o})=>{o.delete(IDBKeyRange.bound([n.path],[n.path,[]]))})),SQLITE_OK}catch(n){return console.error(n),SQLITE_IOERR}})}xRead(t,n,o){return this.handleAsync(async()=>{const a=i(this,Ze).get(t);log$1(`xRead ${a.path} ${n.byteLength} ${o}`);try{return await i(this,xe).run("readonly",async({blocks:d})=>{let h=0;for(;h<n.byteLength;){const p=o+h,m=p<a.block0.data.byteLength?a.block0:await d.get(G(this,et,$r).call(this,a,-p));if(!m||m.data.byteLength-m.offset<=p)return n.fill(0,h),SQLITE_IOERR_SHORT_READ;const E=n.subarray(h),A=p+m.offset,L=Math.min(Math.max(m.data.byteLength-A,0),E.byteLength);E.set(m.data.subarray(A,A+L)),h+=L}return SQLITE_OK})}catch(l){return console.error(l),SQLITE_IOERR}})}xWrite(t,n,o){const a=i(this,jt).has(t);if(a||performance.now()-i(this,Br)>MAX_TASK_MILLIS){const l=this.handleAsync(async()=>{this.handleAsync!==super.handleAsync&&i(this,jt).add(t),await new Promise(h=>setTimeout(h));const d=G(this,et,Xi).call(this,t,n,o);return x(this,Br,performance.now()),d});return a&&i(this,jt).delete(t),l}return G(this,et,Xi).call(this,t,n,o)}xTruncate(t,n){const o=i(this,Ze).get(t);log$1(`xTruncate ${o.path} ${n}`);try{Object.assign(o.block0,{fileSize:n,data:o.block0.data.slice(0,n)});const a=Object.assign({},o.block0);return i(this,xe).run("readwrite",({blocks:l})=>{l.delete(G(this,et,$r).call(this,o,-1/0,-n)),l.put(a)}),SQLITE_OK}catch(a){return console.error(a),SQLITE_IOERR}}xSync(t,n){const o=i(this,jt).has(t);if(o||i(this,cr).durability!=="relaxed"||performance.now()-i(this,Br)>MAX_TASK_MILLIS){const l=this.handleAsync(async()=>{this.handleAsync!==super.handleAsync&&i(this,jt).add(t);const d=await G(this,et,jo).call(this,t,n);return x(this,Br,performance.now()),d});return o&&i(this,jt).delete(t),l}const a=i(this,Ze).get(t);return log$1(`xSync ${a.path} ${n}`),SQLITE_OK}xFileSize(t,n){const o=i(this,Ze).get(t);return log$1(`xFileSize ${o.path}`),n.setBigInt64(0,BigInt(o.block0.fileSize),!0),SQLITE_OK}xLock(t,n){return this.handleAsync(async()=>{const o=i(this,Ze).get(t);log$1(`xLock ${o.path} ${n}`);try{const a=await o.locks.lock(n);return a===SQLITE_OK&&o.locks.state===SQLITE_LOCK_SHARED&&(o.block0=await i(this,xe).run("readonly",({blocks:l})=>l.get(G(this,et,$r).call(this,o,0)))),a}catch(a){return console.error(a),SQLITE_IOERR}})}xUnlock(t,n){return this.handleAsync(async()=>{const o=i(this,Ze).get(t);log$1(`xUnlock ${o.path} ${n}`);try{return o.locks.unlock(n)}catch(a){return console.error(a),SQLITE_IOERR}})}xCheckReservedLock(t,n){return this.handleAsync(async()=>{const o=i(this,Ze).get(t);log$1(`xCheckReservedLock ${o.path}`);const a=await o.locks.isSomewhereReserved();return n.setInt32(0,a?1:0,!0),SQLITE_OK})}xSectorSize(t){return SECTOR_SIZE}xDeviceCharacteristics(t){return SQLITE_IOCAP_BATCH_ATOMIC|SQLITE_IOCAP_SAFE_APPEND|SQLITE_IOCAP_SEQUENTIAL|SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN}xFileControl(t,n,o){const a=i(this,Ze).get(t);switch(log$1(`xFileControl ${a.path} ${n}`),n){case 11:return a.overwrite=!0,SQLITE_OK;case 21:if(a.overwrite)try{return this.handleAsync(async()=>(await G(this,et,Go).call(this,a),SQLITE_OK))}catch(l){return console.error(l),SQLITE_IOERR}if(a.isMetadataChanged)try{i(this,xe).run("readwrite",async({blocks:l})=>{await l.put(a.block0)}),a.isMetadataChanged=!1}catch(l){return console.error(l),SQLITE_IOERR}return SQLITE_OK;case 22:return a.overwrite=!1,SQLITE_OK;case 31:return this.handleAsync(async()=>{try{return a.block0.version--,a.changedPages=new Set,i(this,xe).run("readwrite",async({blocks:l})=>{const d=await l.index("version").getAllKeys(IDBKeyRange.bound([a.path],[a.path,a.block0.version]));for(const h of d)l.delete(h)}),SQLITE_OK}catch(l){return console.error(l),SQLITE_IOERR}});case 32:try{const l=Object.assign({},a.block0);l.data=l.data.slice();const d=a.changedPages;return a.changedPages=null,a.isMetadataChanged=!1,i(this,xe).run("readwrite",async({blocks:h})=>{h.put(l);const p=await h.get([a.path,"purge",0])??{path:a.path,offset:"purge",version:0,data:new Map,count:0};p.count+=d.size;for(const m of d)p.data.set(m,l.version);h.put(p),G(this,et,Ko).call(this,a.path,p.count)}),SQLITE_OK}catch(l){return console.error(l),SQLITE_IOERR}case 33:return this.handleAsync(async()=>{try{return a.changedPages=null,a.isMetadataChanged=!1,a.block0=await i(this,xe).run("readonly",({blocks:l})=>l.get([a.path,0,a.block0.version+1])),SQLITE_OK}catch(l){return console.error(l),SQLITE_IOERR}});default:return SQLITE_NOTFOUND}}xAccess(t,n,o){return this.handleAsync(async()=>{try{const a=new URL(t,"file://localhost/").pathname;log$1(`xAccess ${a} ${n}`);const l=await i(this,xe).run("readonly",({blocks:d})=>d.getKey(G(this,et,$r).call(this,{path:a},0)));return o.setInt32(0,l?1:0,!0),SQLITE_OK}catch(a){return console.error(a),SQLITE_IOERR}})}xDelete(t,n){return this.handleAsync(async()=>{const o=new URL(t,"file://localhost/").pathname;try{return i(this,xe).run("readwrite",({blocks:a})=>a.delete(IDBKeyRange.bound([o],[o,[]]))),n&&await i(this,xe).sync(),SQLITE_OK}catch(a){return console.error(a),SQLITE_IOERR}})}async purge(t){const n=Date.now();await i(this,xe).run("readwrite",async({blocks:o})=>{const a=await o.get([t,"purge",0]);if(a){for(const[l,d]of a.data)o.delete(IDBKeyRange.bound([t,l,d],[t,l,1/0],!0,!1));await o.delete([t,"purge",0])}log$1(`purge ${t} ${(a==null?void 0:a.data.size)??0} pages in ${Date.now()-n} ms`)})}}cr=new WeakMap,Ze=new WeakMap,xe=new WeakMap,Dr=new WeakMap,Br=new WeakMap,jt=new WeakMap,et=new WeakSet,Xi=function(t,n,o){const a=i(this,Ze).get(t);log$1(`xWrite ${a.path} ${n.byteLength} ${o}`);try{const l=a.block0.fileSize;a.block0.fileSize<o+n.byteLength&&(a.block0.fileSize=o+n.byteLength,a.isMetadataChanged=!0);const d=o===0?a.block0:{path:a.path,offset:-o,version:a.block0.version,data:null};return d.data=n.slice(),a.changedPages?(l===a.block0.fileSize&&a.changedPages.add(-o),o!==0&&i(this,xe).run("readwrite",({blocks:h})=>h.put(d))):i(this,xe).run("readwrite",({blocks:h})=>h.put(d)),a.isMetadataChanged=o===0?!1:a.isMetadataChanged,SQLITE_OK}catch(l){return console.error(l),SQLITE_IOERR}},jo=async function(t,n){const o=i(this,Ze).get(t);log$1(`xSync ${o.path} ${n}`);try{o.isMetadataChanged&&(i(this,xe).run("readwrite",async({blocks:a})=>{await a.put(o.block0)}),o.isMetadataChanged=!1),await i(this,xe).sync()}catch(a){return console.error(a),SQLITE_IOERR}return SQLITE_OK},Ko=function(t,n){i(this,cr).purge==="manual"||i(this,Dr).has(t)||n<i(this,cr).purgeAtLeast||(globalThis.requestIdleCallback?globalThis.requestIdleCallback(()=>{this.purge(t),i(this,Dr).delete(t)}):setTimeout(()=>{this.purge(t),i(this,Dr).delete(t)}),i(this,Dr).add(t))},$r=function(t,n,o=0){const a=!n||-n<t.block0.data.length?-1/0:t.block0.version;return IDBKeyRange.bound([t.path,n,a],[t.path,o,1/0])},Go=async function(t){const n=t.block0.data.length;if(n<18)return;const o=new DataView(t.block0.data.buffer,t.block0.data.byteOffset);let a=o.getUint16(16);if(a===1&&(a=65536),a===n)return;const l=Math.max(n,a),d=l/n,h=l/a,m=o.getUint32(28)*a,E=t.block0.version;await i(this,xe).run("readwrite",async({blocks:A})=>{const L=await A.index("version").getAllKeys(IDBKeyRange.bound([t.path,E+1],[t.path,1/0]));for(const S of L)A.delete(S);A.delete([t.path,"purge",0]);for(let S=0;S<m;S+=l){const N=await A.getAll(IDBKeyRange.lowerBound([t.path,-(S+l),1/0]),d);for(const w of N)A.delete([w.path,w.offset,w.version]);if(h===1){const w=new Uint8Array(a);for(const g of N)w.set(g.data,-(S+g.offset));const b={path:t.path,offset:-S,version:E,data:w};b.offset===0&&(b.fileSize=m,t.block0=b),A.put(b)}else{const w=N[0];for(let b=0;b<h;++b){const g=-(S+b*a);if(-g>=m)break;const C={path:w.path,offset:g,version:E,data:w.data.subarray(b*a,(b+1)*a)};C.offset===0&&(C.fileSize=m,t.block0=C),A.put(C)}}}})};function openDatabase(r){return new Promise((e,t)=>{const n=globalThis.indexedDB.open(r,5);n.addEventListener("upgradeneeded",function(){n.result.createObjectStore("blocks",{keyPath:["path","offset","version"]}).createIndex("version",["path","version"])}),n.addEventListener("success",()=>{e(n.result)}),n.addEventListener("error",()=>{t(n.error)})})}const E_CANCELED=new Error("request for lock canceled");var __awaiter$2=function(r,e,t,n){function o(a){return a instanceof t?a:new t(function(l){l(a)})}return new(t||(t=Promise))(function(a,l){function d(m){try{p(n.next(m))}catch(E){l(E)}}function h(m){try{p(n.throw(m))}catch(E){l(E)}}function p(m){m.done?a(m.value):o(m.value).then(d,h)}p((n=n.apply(r,e||[])).next())})};class Semaphore{constructor(e,t=E_CANCELED){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()})}runExclusive(e,t=1){return __awaiter$2(this,void 0,void 0,function*(){const[n,o]=yield this.acquire(t);try{return yield e(n)}finally{o()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){const n=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!n)continue;const o=this._value,a=t;this._value-=t,t=this._value+1,n.resolve([o,this._newReleaser(a)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}}var __awaiter$1=function(r,e,t,n){function o(a){return a instanceof t?a:new t(function(l){l(a)})}return new(t||(t=Promise))(function(a,l){function d(m){try{p(n.next(m))}catch(E){l(E)}}function h(m){try{p(n.throw(m))}catch(E){l(E)}}function p(m){m.done?a(m.value):o(m.value).then(d,h)}p((n=n.apply(r,e||[])).next())})};class Mutex{constructor(e){this._semaphore=new Semaphore(1,e)}acquire(){return __awaiter$1(this,void 0,void 0,function*(){const[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const isDebug=globalThis.__vlcn_wa_crsqlite_dbg;function log(...r){isDebug&&console.log("crsqlite-wasm: ",...r)}const re=/insert\s|update\s|delete\s/,txRe=/begin\s|commit\s|rollback\s|savepoint\s/;function computeCacheKey(r,e,t){const n=r.toLowerCase();if(txRe.exec(n)==null)return re.exec(n)!=null?(log("received write"),null):t!=null?n+"|"+e+"|"+t.map(a=>a!=null?a.toString():"null").join("|"):n}class Stmt{constructor(e,t,n,o,a,l,d){oe(this,"originDB");oe(this,"stmtFinalizer");oe(this,"cache");oe(this,"api");oe(this,"base");oe(this,"str");oe(this,"sql");oe(this,"mode","o");oe(this,"finalized",!1);oe(this,"bindings",[]);this.originDB=e,this.stmtFinalizer=t,this.cache=n,this.api=o,this.base=a,this.str=l,this.sql=d,t.set(a,this)}run(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),()=>(t.length>0&&this.bind(t),this.api.step(this.base).then(()=>this.api.reset(this.base))),(e==null?void 0:e.__mutex)||this.originDB.__mutex)}get(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),async()=>{t.length>0&&this.bind(t);let n=null,o=this.mode==="o"?this.api.column_names(this.base):null;if(await this.api.step(this.base)==SQLITE_ROW){const a=this.api.row(this.base);if(o!=null){const l={};for(let d=0;d<o.length;++d)l[o[d]]=a[d];n=l}else n=a}return await this.api.reset(this.base),n},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}all(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),async()=>{t.length>0&&this.bind(t);const n=[];let o=this.mode==="o"?this.api.column_names(this.base):null;for(;await this.api.step(this.base)==SQLITE_ROW;)if(o!=null){const a={};for(let l=0;l<o.length;++l)a[o[l]]=this.api.column(this.base,l);n.push(a)}else{n.push(this.api.row(this.base));continue}return await this.api.reset(this.base),n},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}async*iterate(e,...t){for(this.bind(t);await serialize(this.cache,void 0,()=>this.api.step(this.base),(e==null?void 0:e.__mutex)||this.originDB.__mutex)==SQLITE_ROW;)yield this.api.row(this.base);await serialize(this.cache,void 0,()=>this.api.reset(this.base),(e==null?void 0:e.__mutex)||this.originDB.__mutex)}raw(e){return e?this.mode="a":this.mode="o",this}bind(e){this.bindings=e;for(let t=0;t<e.length;++t)this.api.bind(this.base,t+1,e[t]);return this}finalize(e){return serialize(this.cache,void 0,()=>{if(!this.finalized)return this.finalized=!0,this.api.str_finish(this.str),this.stmtFinalizer.delete(this.base),this.api.finalize(this.base)},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}}class TX{constructor(e,t,n,o,a){oe(this,"api");oe(this,"db");oe(this,"__mutex");oe(this,"assertOpen");oe(this,"stmtFinalizer");oe(this,"cache",new Map);this.api=e,this.db=t,this.__mutex=n,this.assertOpen=o,this.stmtFinalizer=a}execMany(e){return this.assertOpen(),serialize(this.cache,null,()=>this.api.exec(this.db,e.join("")),this.__mutex)}exec(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"a",t),()=>this.statements(e,!1,t),this.__mutex)}execO(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"o",t),()=>this.statements(e,!0,t),this.__mutex)}execA(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"a",t),()=>this.statements(e,!1,t),this.__mutex)}prepare(e){return this.assertOpen(),serialize(this.cache,void 0,async()=>{const t=this.api.str_new(this.db,e),n=await this.api.prepare_v2(this.db,this.api.str_value(t));if(n==null)throw this.api.str_finish(t),new Error(`Could not prepare ${e}`);return new Stmt(this,this.stmtFinalizer,this.cache,this.api,n.stmt,t,e)},this.__mutex)}tx(e){this.assertOpen();const t="crsql"+crypto.randomUUID().replaceAll("-","");return serializeTx(async n=>{await n.exec("SAVEPOINT "+t);try{await e(n)}catch(o){throw await n.exec("ROLLBACK TO "+t),await n.exec("RELEASE "+t),o}await n.exec("RELEASE "+t)},this.__mutex,this)}imperativeTx(){return this.__mutex.acquire().then(e=>{const t=new Mutex;return[e,new TX(this.api,this.db,t,this.assertOpen,this.stmtFinalizer)]})}async statements(e,t,n){const o=[],a=this.api.str_new(this.db,e);let l={stmt:null,sql:this.api.str_value(a)};try{for(;l=await this.api.prepare_v2(this.db,l.sql);){const p=l.stmt,m=[],E=this.api.column_names(p);for(n&&this.bind(p,n);await this.api.step(p)===SQLITE_ROW;){const A=this.api.row(p);m.push(A)}E.length&&o.push({columns:E,rows:m}),this.api.finalize(l.stmt),l.stmt=null}}catch(p){throw console.error(`Failed running ${e}`,p),p}finally{l!=null&&l.stmt&&this.api.finalize(l.stmt),this.api.str_finish(a)}const d=o[0];if(d==null)return null;if(!t)return d.rows;const h=[];for(const p of d.rows){const m={};for(let E=0;E<d.columns.length;++E)m[d.columns[E]]=p[E];h.push(m)}return h}bind(e,t){for(let n=0;n<t.length;++n){const o=t[n];this.api.bind(e,n+1,typeof o=="boolean"?o&&1||0:o)}}}const topLevelMutex=new Mutex;topLevelMutex.name="topLevelMutex";function serialize(r,e,t,n){if(e===null)log("Cache clear"),r==null||r.clear();else if(e!==void 0){const a=r==null?void 0:r.get(e);if(a)return log("Cache hit",e),a}log("Enqueueing query ",e);const o=n.runExclusive(t);return e&&(r==null||r.set(e,o),o.finally(()=>r==null?void 0:r.delete(e)).catch(a=>{console.error(a)})),o}function serializeTx(r,e,t){return e.runExclusive(()=>{const n=new Mutex,o=new TX(t.api,t.db,n,t.assertOpen,t.stmtFinalizer);return r(o)})}function cryb64(r,e=0){let t=3735928559^e,n=1103547991^e;for(let o=0,a;o<r.length;o++)a=r.charCodeAt(o),t=Math.imul(t^a,2654435761),n=Math.imul(n^a,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296n*BigInt(n)+BigInt(t)}function firstPick(r){const e=r[0];if(e!=null)return e[Object.keys(e)[0]]}var gn,Fr,Kt,Jn,At,Hn,Si;class DB{constructor(e,t,n){oe(this,"api");oe(this,"db");oe(this,"filename");oe(this,"__mutex",topLevelMutex);oe(this,"stmtFinalizer",new Map);I(this,gn,null);I(this,Fr,null);oe(this,"cache",new Map);I(this,Kt,null);I(this,Jn,!1);I(this,At);I(this,Hn,()=>{if(i(this,Jn))throw new Error("The DB is closed")});I(this,Si,(e,t,n,o)=>{i(this,Kt)!=null&&i(this,Kt).forEach(a=>{try{a(e,t,n,o)}catch(l){console.error("Failed notifying a DB update listener"),console.error(l)}})});this.api=e,this.db=t,this.filename=n,x(this,At,new TX(e,t,topLevelMutex,i(this,Hn),this.stmtFinalizer))}get siteid(){return i(this,gn)}_setSiteid(e){if(i(this,gn))throw new Error("Site id already set");x(this,gn,e)}_setTablesUsedStmt(e){x(this,Fr,e)}get tablesUsedStmt(){if(i(this,Fr)==null)throw new Error("tablesUsedStmt not set");return i(this,Fr)}async automigrateTo(e,t){const n=cryb64(t),o=firstPick(await this.execA("SELECT value FROM crsql_master WHERE key = 'schema_name'")),a=firstPick(await this.execA("SELECT value FROM crsql_master WHERE key = 'schema_version'"));if(o===e&&BigInt(a||0)===n)return"noop";const l=o===void 0||o!==e?"apply":"migrate";return await this.tx(async d=>{if(a==null||o!==e){if(o!==e){const h=await d.execA("SELECT name FROM sqlite_master WHERE type = 'table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'crsql_%'");for(const p of h)await d.exec(`DROP TABLE [${p[0]}]`)}await d.exec(t)}else await d.exec("SELECT crsql_automigrate(?, 'SELECT crsql_finalize();')",[t]);await d.exec("INSERT OR REPLACE INTO crsql_master (key, value) VALUES (?, ?)",["schema_version",n]),await d.exec("INSERT OR REPLACE INTO crsql_master (key, value) VALUES (?, ?)",["schema_name",e])}),await this.exec("VACUUM;"),l}execMany(e){return i(this,At).execMany(e)}exec(e,t){return i(this,At).exec(e,t)}execO(e,t){return i(this,At).execO(e,t)}execA(e,t){return i(this,At).execA(e,t)}prepare(e){return i(this,At).prepare(e)}tx(e){return i(this,At).tx(e)}imperativeTx(){return i(this,At).imperativeTx()}async close(){var e;for(const t of this.stmtFinalizer.values())await t.finalize(this);return(e=i(this,Fr))==null||e.finalize(this),this.exec("SELECT crsql_finalize()").then(()=>(x(this,Jn,!0),serialize(this.cache,void 0,()=>this.api.close(this.db),this.__mutex)))}createFunction(e,t,n){i(this,Hn).call(this),this.api.create_function(this.db,e,t.length,SQLITE_UTF8,0,(o,a)=>{const l=[];for(let h=0;h<t.length;++h)l.push(this.api.value(a[h]));const d=t(...l);d!==void 0&&this.api.result(o,d)})}onUpdate(e){return i(this,Kt)==null&&(this.api.update_hook(this.db,i(this,Si)),x(this,Kt,new Set)),i(this,Kt).add(e),()=>{var t;return(t=i(this,Kt))==null?void 0:t.delete(e)}}}gn=new WeakMap,Fr=new WeakMap,Kt=new WeakMap,Jn=new WeakMap,At=new WeakMap,Hn=new WeakMap,Si=new WeakMap;let api=null;class SQLite3{constructor(e){oe(this,"base");this.base=e}open(e,t="c"){return serialize(null,void 0,()=>this.base.open_v2(e||":memory:",SQLITE_OPEN_CREATE|SQLITE_OPEN_READWRITE|SQLITE_OPEN_URI,e!=null?"idb-batch-atomic":void 0),topLevelMutex).then(n=>{const o=new DB(this.base,n,e||":memory:");return o.prepare(`SELECT tbl_name FROM tables_used(?) AS u
        JOIN sqlite_master ON sqlite_master.name = u.name
        WHERE u.schema = 'main'`).then(a=>{a.raw(!0),o._setTablesUsedStmt(a)}).then(()=>o.execA("select quote(crsql_site_id());")).then(a=>(o._setSiteid(a[0][0].replace(/'|X/g,"")),o))})}}async function initWasm(r){if(api!=null)return api;const e=await Module({locateFile(n){return r?r(n):new URL(""+new URL("../assets/crsqlite.CabMYEmC.wasm",import.meta.url).href,import.meta.url).href}}),t=Factory(e);return t.vfs_register(new IDBBatchAtomicVFS("idb-batch-atomic",{durability:"relaxed"})),api=new SQLite3(t),api}async function load(r,e){return{database:await(await initWasm(()=>e.wasm||wasmUrl)).open(r),env:"browser"}}class CRDialect extends SqliteDialect{constructor(t){super(t);oe(this,"database");this.database=async()=>typeof t.database=="function"?t.database():t.database}createDriver(){const t=this.database,n=mutex();let o,a;return{async init(){o=await t(),a={async executeQuery(l){return{rows:await o.execO(l.sql,l.parameters)}},async*streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}}},async acquireConnection(){return await n.lock(),a},async beginTransaction(l){await l.executeQuery(CompiledQuery.raw("begin"))},async commitTransaction(l){await l.executeQuery(CompiledQuery.raw("commit"))},async rollbackTransaction(l){await l.executeQuery(CompiledQuery.raw("rollback"))},async releaseConnection(){n.unlock()},async destroy(){o==null||o.close()}}}}function mutex(){let r,e;return{async lock(){for(;r;)await r;r=new Promise(t=>e=t)},unlock(){const t=e;r=void 0,e=void 0,t==null||t()}}}function json(r,e){const t=Object.entries(e).flatMap(([n,o])=>[sql.lit(n),typeof o=="string"?r.ref(o):o]);return sql`json_object(${sql.join(t)})`.withPlugin({transformQuery({node:n}){return{...n,json:!0}}}).$castTo()}function group(r,e){const t=typeof e=="string"?r.ref(e).toOperationNode():e.toOperationNode();return new AggregateFunctionBuilder({aggregateFunctionNode:{...AggregateFunctionNode.create("json_group_array",[t]),json:!0}})}function groupJSON(r,e){return group(r,json(r,e))}var jn;class JSONPlugin{constructor(){I(this,jn,new WeakMap)}transformQuery({node:e,queryId:t}){return e.kind!=="SelectQueryNode"||i(this,jn).set(t,new Set(this.getColumns(e))),e}async transformResult({result:e,queryId:t}){if(!Array.isArray(e.rows))return e;const n=i(this,jn).get(t);return n&&e.rows.forEach(o=>this.parseObject(o,n)),e}getColumns(e){var n,o;const t=[];for(const a in e)e[a]&&typeof e[a]=="object"&&(e[a].json===!0&&typeof((n=e.alias)==null?void 0:n.name)=="string"&&t.push((o=e.alias)==null?void 0:o.name),t.push(...this.getColumns(e[a])));return t}parseObject(e,t){for(const n in e)t.has(n)&&(e[n]=JSON.parse(String(e[n]))),typeof e[n]=="object"&&this.parseObject(e[n],t)}}jn=new WeakMap;function covert(r){const t={any:"blob",string:"text",number:"real",unknown:"blob",instance:"blob",bigint:"integer",integer:"integer",boolean:"boolean"}[r];if(t)return t;throw new Error(`Type "${r}" is not allowed in the database schema!`)}async function apply(r,{schema:e}){var t;for(const n in e){const o=e[n];let a=r.schema.createTable(n).ifNotExists();for(const l in o.schema){const{type:d}=o.schema[l];a=a.addColumn(l,(t=o.ordered)!=null&&t.find(([h])=>h===l)?"blob":covert(d),h=>{var p;return(p=o.primary)!=null&&p.includes(l)?h.notNull():h})}o.primary&&(a=a.addPrimaryKeyConstraint("primary_key",o.primary)),await a.execute();for(const l of o.indices||[])await r.schema.createIndex(`${n}_${l.join("_")}`).ifNotExists().on(n).columns(l).execute();o.crr&&await sql`SELECT crsql_as_crr(${n})`.execute(r);for(const l of o.ordered||[])await sql`SELECT crsql_fract_as_ordered(${n},${sql.join(l)})`.execute(r);await r.schema.createTable("__crstore_sync").ifNotExists().addColumn("version","integer").execute(),await sql`INSERT INTO __crstore_sync (version) SELECT 0
      WHERE NOT EXISTS (SELECT * FROM __crstore_sync)
    `.execute(r)}}function primary(r,...e){return r.primary=e,r}function crr(r){return r.crr=!0,r}function ordered(r,e,...t){return r.ordered||(r.ordered=[]),r.ordered.push([e,...t]),r}function index(r,...e){return r.indices||(r.indices=[]),r.indices.push(e),r}const connections$1=new Map,defaultPaths={};async function init(r,e,t=defaultPaths){if(connections$1.has(r))return connections$1.get(r);const{database:n,env:o}=await load(r,t),a=o==="browser"?CRDialect:SqliteDialect,l=new Kysely({dialect:new a({database:n}),plugins:[new JSONPlugin]}),d=l.destroy.bind(l);await l.transaction().execute(p=>apply(p,e));const h=Object.assign(l,{resolveChanges,applyOperation,insertChanges,updateVersion,selectVersion,selectClient,changesSince,async destroy(){return connections$1.delete(r),await finalize.bind(l)().execute(),d()}});return connections$1.set(r,h),h}const empty=[],ready=r=>r!==empty;function reactive(r,e=[]){const t=new Set,n={stop:void 0,start:void 0};let o,a=empty;function l(m){a=m,o&&t.forEach(E=>E(a))}function d(m){var E;return t.add(m),t.size===1&&(o=r(...e),n.stop=(E=n.start)==null?void 0:E.call(n,p)),m(a),()=>{var A;t.delete(m),t.size===0&&o&&(Promise.resolve(o).then(L=>L()),o=void 0,(A=n.stop)==null||A.call(n),n.stop=void 0)}}function h(m){var E;if(Array.isArray(m))return p(m);(E=n.stop)==null||E.call(n),n.start=m,o&&(n.stop=n.start(p))}function p(m){JSON.stringify(m)!==JSON.stringify(e)&&(e=m.slice(),o&&(Promise.resolve(o).then(E=>E()),o=r(...e)))}return{set:l,subscribe:d,bind:h}}const raf=globalThis.requestAnimationFrame||globalThis.setTimeout,error=Symbol("error");function queue(r,e){const t=new Map;let n;async function o(){return n||(n=new Promise(a=>raf(async()=>{const l=await r,d=new Map;await l.transaction().execute(async h=>{const p=e&&(await selectVersion.bind(h)().execute()).current;for(const[m,E]of t.entries()){const A=await E(h).catch(L=>({[error]:L}));d.set(m,A)}e==null||e(await changesSince.bind(h)(p).execute())}).catch(h=>{if(!String(h).includes("driver has already been destroyed"))throw h}),t.clear(),n=void 0,a(d)})))}return{enqueue(a,l,...d){return t.set(a,h=>l(h,...d)),o().then(h=>h.get(a)).then(h=>{if(h&&typeof h=="object"&&error in h)throw h[error];return h})}}}function database$1(r,{ssr:e=!1,name:t="crstore.db",paths:n=defaultPaths,error:o=void 0,push:a=void 0,pull:l=void 0,online:d=()=>{var h;return!!((h=globalThis.navigator)!=null&&h.onLine)}}={}){var fe;const p=!e&&!1?new Promise(()=>{}):init(t,r,n),m="BroadcastChannel"in globalThis?new globalThis.BroadcastChannel(`${t}-sync`):null,E=$=>T($.data,$.data[0]),A=queue(p,T),L=queue(p);m==null||m.addEventListener("message",E),(fe=globalThis.addEventListener)==null||fe.call(globalThis,"online",C);const S=new Map;let N=()=>{};C();async function w($,K){return L.enqueue(K,Q=>Q.getExecutor().executeQuery($,K)).then(Q=>Q.rows)}function b($,K,Q){const te=async(ue,Y)=>{try{if(Q&&Q.client===Y)return;await K(ue,Y)}catch(be){o==null||o(be)}};return $.forEach(ue=>{var Y;S.has(ue)||S.set(ue,new Set),(Y=S.get(ue))==null||Y.add(te)}),Q?p.then(async ue=>{const Y=await ue.changesSince(Q.version,{filter:Q.client,chunk:!0}).execute();Y.length&&Y.forEach(be=>te(be))}):te(""),()=>$.forEach(ue=>{var Y;return(Y=S.get(ue))==null?void 0:Y.delete(te)})}async function g(){if(!a||!d())return;const $=await p,{current:K,synced:Q}=await $.selectVersion().execute();if(K<=Q)return;const te=await $.changesSince(Q,{filter:null,chunk:!0}).execute();await Promise.all(te.map(a)),await $.updateVersion(K).execute()}async function C(){var te,ue;if((te=globalThis.removeEventListener)==null||te.call(globalThis,"offline",N),N(),!l||!d())return;const $=await p,{synced:K}=await $.selectVersion().execute(),Q=await $.selectClient().execute();await g(),N=l({version:K,client:Q},{async onData(Y){Y.length&&(await $.insertChanges(Y).execute(),await T(Y,Y[0]))}}).unsubscribe,(ue=globalThis.addEventListener)==null||ue.call(globalThis,"offline",N)}async function k($,...K){return A.enqueue({},$,...K)}async function X($){if(!$.length)return;const K=await p;await T(await K.resolveChanges($).execute(),$[0])}async function T($,K){var Y;if(!$.length)return;const Q=new Set,te=affectedTables($);(Y=S.get("*"))==null||Y.forEach(be=>Q.add(be)),te.forEach(be=>{var Ae;return(Ae=S.get(be))==null?void 0:Ae.forEach(M=>Q.add(M))});const ue=[...Q].map(be=>be($,K));K||(m==null||m.postMessage($),await g()),await Promise.all(ue)}async function F(){var $,K;N(),m==null||m.close(),S.clear(),($=globalThis.removeEventListener)==null||$.call(globalThis,"online",C),(K=globalThis.removeEventListener)==null||K.call(globalThis,"offline",N),m==null||m.removeEventListener("message",E),await p.then(Q=>Q.destroy())}return{close:F,merge:X,update:k,subscribe:b,connection:p,replica:store.bind({connection:p,subscribe:b,update:k,refresh:w})}}function store(r,e={},t=[]){const{connection:n,update:o,refresh:a}=this;let l=null,d=null;const{subscribe:h,set:p,bind:m}=reactive(async(...L)=>{const S=await n,N=r(S,...L).toOperationNode(),w=affectedTables(N),b=S.getExecutor();return d={queryId:Math.random().toString(36).slice(2)},l=b.compileQuery(b.transformQuery(N,d),d),this.subscribe(w,E)},t);async function E(){await n,!(!l||!d)&&p(await a(l,d))}const A={};for(const L in e)A[L]=(...S)=>o(e[L],...S);return{...A,subscribe:h,bind:m,update(L,...S){return L?o(L,...S):E()},then(L=N=>N,S){let N=[];const w=h(b=>N=b);return E().then(()=>(w(),L==null?void 0:L(N)),S)}}}const APPEND=1,source=r=>r.selectFrom(e=>e.selectFrom("sources").select(["owner","source"]).orderBy("sources.primary","desc").as("ordered")).select(["owner",e=>group(e,"source").as("sources")]).groupBy("owner").$castTo(),asset=r=>r.selectFrom(e=>e.selectFrom("assets").select(["owner","art","thumbnail"]).orderBy("assets.primary","desc").as("ordered")).select(["owner",e=>group(e,"art").as("arts"),e=>group(e,"thumbnail").as("thumbnails")]).groupBy("owner").$castTo(),artist$1=r=>r.selectFrom("artists").leftJoin("source","source.owner","artists.id").leftJoin("asset","asset.owner","artists.id").select(["artists.id","artists.title","artists.following",e=>e.fn.coalesce("asset.arts",e.val("[]")).as("arts"),e=>e.fn.coalesce("asset.thumbnails",e.val("[]")).as("thumbnails"),e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources")]).$castTo(),album$1=r=>r.selectFrom("albums").leftJoin("source","source.owner","albums.id").leftJoin("asset","asset.owner","albums.id").leftJoin("attribution","attribution.album","albums.id").innerJoin("artist","artist.id","attribution.artist").select(["albums.id","albums.title","albums.year",e=>e.fn.coalesce("asset.arts",e.val("[]")).as("arts"),e=>e.fn.coalesce("asset.thumbnails",e.val("[]")).as("thumbnails"),e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources"),e=>groupJSON(e,{id:"artist.id",title:"artist.title",arts:"artist.arts",thumbnails:"artist.thumbnails",sources:"artist.sources"}).filterWhere("artist.id","is not",null).as("artists")]).groupBy("albums.id").$castTo(),track$2=r=>r.selectFrom("tracks").leftJoin("source","source.owner","tracks.id").innerJoin("album","album.id","tracks.album").select(["tracks.id","tracks.title","tracks.duration","album.artists",e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources"),e=>json(e,{id:"album.id",title:"album.title",year:"album.year",arts:"album.arts",thumbnails:"album.thumbnails",sources:"album.sources"}).as("album")]).$castTo(),localDevice=sql`crsql_site_id()`,uuid=()=>Math.random()*2**32>>>0,sanitize=r=>r.replace(/-/g," ").split(/\s+/g).map(e=>`"${e.replace(/"/g,'""')}"`).join(" "),position={first:null,before:r=>r.selectFrom("queue").select("id").where("position","=",1).limit(1),shift:r=>e=>e.selectFrom("queue").select("id").whereRef(t=>t.selectFrom("queue").select(sql`position + 1`.as("position")).where("id","=",r),"=","position").limit(1),next:r=>r.selectFrom("devices").select("playback").where("id","=",localDevice).limit(1),last:r=>r.selectFrom("playback").select("id").where("device","=",localDevice).orderBy("order","desc").orderBy("id","desc").limit(1),random:r=>e=>e.selectFrom(t=>t.selectFrom("queue").select(["id","position"]).$if(!!r.length,n=>n.unionAll(sql`VALUES ${sql.raw(r.map(o=>`(${o}, 1)`).join(","))}`)).unionAll(sql`SELECT null,1 WHERE NOT EXISTS (SELECT 1 FROM queue WHERE position >= 0)`).as("data")).select("id").where("position",">=",0).orderBy(sql`random()`).limit(1)};async function pushTracks(r,e){e.length&&(await pushAlbums(r,e.map(t=>({...t.album,artists:t.artists}))),await r.insertInto("tracks").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,duration:t.duration,album:t.album.id}))).execute(),await pushResources(r,e))}async function pushAlbums(r,e){e.length&&(await pushArtists(r,e.flatMap(t=>t.artists)),e.find(t=>t.artists.length)&&await r.insertInto("attribution").onConflict(t=>t.doNothing()).values(e.flatMap(t=>t.artists.map(({id:n})=>({album:t.id,artist:n})))).execute(),await r.insertInto("albums").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,year:t.year}))).execute(),await pushResources(r,e))}async function pushArtists(r,e){e.length&&(await r.insertInto("artists").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,following:0}))).execute(),await pushResources(r,e))}async function pushResources(r,e){e.length&&(e.find(t=>t.sources.length)&&await r.insertInto("sources").onConflict(t=>t.doNothing()).values(e.flatMap(({id:t,sources:n})=>n.map((o,a)=>({owner:t,source:o,primary:+!a&&sql`NOT EXISTS (SELECT 1 FROM sources WHERE owner = ${t} AND "primary" = 1)`})))).execute(),e.find(t=>{var n;return(n=t.arts)==null?void 0:n.length})&&await r.insertInto("assets").onConflict(t=>t.doNothing()).values(e.flatMap(({id:t,arts:n,thumbnails:o})=>{if(!n)return[];const a=n.find((l,d)=>!!(o!=null&&o[d]))||n[0];return n.map((l,d)=>({owner:t,art:l,thumbnail:o==null?void 0:o[d],primary:+(l===a)&&sql`NOT EXISTS (SELECT 1 FROM assets WHERE owner = ${t} AND "primary" = 1)`}))})).execute())}const preceding$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).with("update",t=>t.selectFrom("playback").select(n=>n.selectFrom("devices").select("id").as("_"))).selectFrom("queue").innerJoin("track","track.id","queue.track").where("position","<",0).select("queue.id as entry").select(fields).$castTo()),upcoming$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).with("update",t=>t.selectFrom("playback").select(n=>n.selectFrom("devices").select("id").as("_"))).selectFrom("queue").innerJoin("track","track.id","queue.track").where("position",">",0).select("queue.id as entry").select(fields).$castTo()),playback$2=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("devices").innerJoin("playback","playback.id","devices.playback").innerJoin("track","track.id","playback.track").select(["direction","repeat","infinite","device","progress"]).select(t=>json(t,{entry:"playback.id",id:"track.id",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).as("track")).select(sql`device = crsql_site_id()`.as("local")).select(fields).$castTo(),{async push(e,t,n="next"){if(!t.length)return;await pushTracks(e,t);const{direction:o,playback:a}=await e.selectFrom("devices").where("id","=",localDevice).select(["direction","playback"]).executeTakeFirstOrThrow(),l=t.map(uuid),d=o!=1?Number.isInteger(n)?n:n==="first"?position.first:n==="next"?position.next:position.last:Number.isInteger(n)?position.shift(+n):n==="first"?position.last:n==="next"?position.before:position.first;await e.insertInto("playback_fractindex").values(t.map((h,p)=>({id:l[p],track:h.id,device:localDevice,after_id:n==="random"?position.random(l.slice(0,p)):p>0&&o!=1?l[p-1]:d}))).execute(),!~a&&n==="random"&&await e.updateTable("devices").set({playback:h=>h.selectFrom("queue").select("id").$castTo().limit(1)}).execute()},async purge(e,t){t.length&&await e.deleteFrom("playback").where("id","in",t).execute()},async clear(e,t=localDevice){await e.deleteFrom("playback").where("device","=",t).execute(),await e.updateTable("devices").set({playback:-1,progress:0}).where("id","=",t).execute()},async sync(e,t){await e.updateTable("devices").where("id","=",localDevice).set({progress:t}).execute()},async rearrange(e,t,n=null){const{direction:o}=await e.selectFrom("devices").where("id","=",localDevice).select(["direction"]).executeTakeFirstOrThrow(),a=o!=1?n:n!=null?position.shift(n):position.last;await e.updateTable("playback_fractindex").set({after_id:a}).where("id","=",t).execute()},async redirect(e,t){const n=["forward","backward","shuffled"],{direction:o}=await e.selectFrom("devices").select("direction").where("id","=",localDevice).executeTakeFirstOrThrow(),a=n.indexOf(t);o!==a&&await e.updateTable("devices").set({direction:a}).where("id","=",localDevice).execute()},async repeat(e,t){const n=["none","single","all"];await e.updateTable("devices").set({repeat:n.indexOf(t)}).where("id","=",localDevice).execute()},async infinite(e,t){await e.updateTable("devices").set({infinite:t==null?sql`!infinite`:+t}).where("id","=",localDevice).execute()},async replicate(e,t){const n=uuid();await e.updateTable("devices").where("id","=",localDevice).set({playback:n,progress:o=>o.selectFrom("devices").where("id","=",t).select("progress")}).execute(),await e.deleteFrom("playback").where("device","=",localDevice).execute(),await e.insertInto("playback").expression(o=>o.selectFrom("playback").select(a=>a.case().when(l=>l.selectFrom("devices").whereRef("id","=","playback.device").select("devices.playback"),"=",a.ref("playback.id")).then(n).else(sql`ABS(RANDOM() % 4294967296)`).end().as("id")).select(sql`${localDevice}`.as("device")).select(["track","order","temp"]).where("device","=",t)).execute()}}),fields=["track.id","track.title","track.duration","track.album","track.artists","track.sources"];class StructError extends TypeError{constructor(e,t){let n;const{message:o,explanation:a,...l}=e,{path:d}=e,h=d.length===0?o:`At path: ${d.join(".")} -- ${o}`;super(a??h),a!=null&&(this.cause=h),Object.assign(this,l),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}function isIterable(r){return isObject$2(r)&&typeof r[Symbol.iterator]=="function"}function isObject$2(r){return typeof r=="object"&&r!=null}function print(r){return typeof r=="symbol"?r.toString():typeof r=="string"?JSON.stringify(r):`${r}`}function shiftIterator(r){const{done:e,value:t}=r.next();return e?void 0:t}function toFailure(r,e,t,n){if(r===!0)return;r===!1?r={}:typeof r=="string"&&(r={message:r});const{path:o,branch:a}=e,{type:l}=t,{refinement:d,message:h=`Expected a value of type \`${l}\`${d?` with refinement \`${d}\``:""}, but received: \`${print(n)}\``}=r;return{value:n,type:l,refinement:d,key:o[o.length-1],path:o,branch:a,...r,message:h}}function*toFailures(r,e,t,n){isIterable(r)||(r=[r]);for(const o of r){const a=toFailure(o,e,t,n);a&&(yield a)}}function*run(r,e,t={}){const{path:n=[],branch:o=[r],coerce:a=!1,mask:l=!1}=t,d={path:n,branch:o};if(a&&(r=e.coercer(r,d),l&&e.type!=="type"&&isObject$2(e.schema)&&isObject$2(r)&&!Array.isArray(r)))for(const p in r)e.schema[p]===void 0&&delete r[p];let h="valid";for(const p of e.validator(r,d))p.explanation=t.message,h="not_valid",yield[p,void 0];for(let[p,m,E]of e.entries(r,d)){const A=run(m,E,{path:p===void 0?n:[...n,p],branch:p===void 0?o:[...o,m],coerce:a,mask:l,message:t.message});for(const L of A)L[0]?(h=L[0].refinement!=null?"not_refined":"not_valid",yield[L[0],void 0]):a&&(m=L[1],p===void 0?r=m:r instanceof Map?r.set(p,m):r instanceof Set?r.add(m):isObject$2(r)&&(m!==void 0||p in r)&&(r[p]=m))}if(h!=="not_valid")for(const p of e.refiner(r,d))p.explanation=t.message,h="not_refined",yield[p,void 0];h==="valid"&&(yield[void 0,r])}class Struct{constructor(e){const{type:t,schema:n,validator:o,refiner:a,coercer:l=h=>h,entries:d=function*(){}}=e;this.type=t,this.schema=n,this.entries=d,this.coercer=l,o?this.validator=(h,p)=>{const m=o(h,p);return toFailures(m,p,this,h)}:this.validator=()=>[],a?this.refiner=(h,p)=>{const m=a(h,p);return toFailures(m,p,this,h)}:this.refiner=()=>[]}assert(e,t){return assert(e,this,t)}create(e,t){return create(e,this,t)}is(e){return is(e,this)}mask(e,t){return mask(e,this,t)}validate(e,t={}){return validate(e,this,t)}}function assert(r,e,t){const n=validate(r,e,{message:t});if(n[0])throw n[0]}function create(r,e,t){const n=validate(r,e,{coerce:!0,message:t});if(n[0])throw n[0];return n[1]}function mask(r,e,t){const n=validate(r,e,{coerce:!0,mask:!0,message:t});if(n[0])throw n[0];return n[1]}function is(r,e){return!validate(r,e)[0]}function validate(r,e,t={}){const n=run(r,e,t),o=shiftIterator(n);return o[0]?[new StructError(o[0],function*(){for(const l of n)l[0]&&(yield l[0])}),void 0]:[void 0,o[1]]}function assign(...r){const e=r[0].type==="type",t=r.map(o=>o.schema),n=Object.assign({},...t);return e?type(n):object(n)}function define(r,e){return new Struct({type:r,schema:null,validator:e})}function omit(r,e){const{schema:t}=r,n={...t};for(const o of e)delete n[o];switch(r.type){case"type":return type(n);default:return object(n)}}function any(){return define("any",()=>!0)}function array(r){return new Struct({type:"array",schema:r,*entries(e){if(r&&Array.isArray(e))for(const[t,n]of e.entries())yield[t,n,r]},coercer(e){return Array.isArray(e)?e.slice():e},validator(e){return Array.isArray(e)||`Expected an array value, but received: ${print(e)}`}})}function instance$1(r){return define("instance",e=>e instanceof r||`Expected a \`${r.name}\` instance, but received: ${print(e)}`)}function integer(){return define("integer",r=>typeof r=="number"&&!isNaN(r)&&Number.isInteger(r)||`Expected an integer, but received: ${print(r)}`)}function literal(r){const e=print(r),t=typeof r;return new Struct({type:"literal",schema:t==="string"||t==="number"||t==="boolean"?r:null,validator(n){return n===r||`Expected the literal \`${e}\`, but received: ${print(n)}`}})}function never(){return define("never",()=>!1)}function nullable(r){return new Struct({...r,validator:(e,t)=>e===null||r.validator(e,t),refiner:(e,t)=>e===null||r.refiner(e,t)})}function number(){return define("number",r=>typeof r=="number"&&!isNaN(r)||`Expected a number, but received: ${print(r)}`)}function object(r){const e=r?Object.keys(r):[],t=never();return new Struct({type:"object",schema:r||null,*entries(n){if(r&&isObject$2(n)){const o=new Set(Object.keys(n));for(const a of e)o.delete(a),yield[a,n[a],r[a]];for(const a of o)yield[a,n[a],t]}},validator(n){return isObject$2(n)||`Expected an object, but received: ${print(n)}`},coercer(n){return isObject$2(n)?{...n}:n}})}function optional(r){return new Struct({...r,validator:(e,t)=>e===void 0||r.validator(e,t),refiner:(e,t)=>e===void 0||r.refiner(e,t)})}function string(){return define("string",r=>typeof r=="string"||`Expected a string, but received: ${print(r)}`)}function type(r){const e=Object.keys(r);return new Struct({type:"type",schema:r,*entries(t){if(isObject$2(t))for(const n of e)yield[n,t[n],r[n]]},validator(t){return isObject$2(t)||`Expected an object, but received: ${print(t)}`},coercer(t){return isObject$2(t)?{...t}:t}})}function union(r){const e=r.map(t=>t.type).join(" | ");return new Struct({type:"union",schema:null,coercer(t){for(const n of r){const[o,a]=n.validate(t,{coerce:!0});if(!o)return a}return t},validator(t,n){const o=[];for(const a of r){const[...l]=run(t,a,n),[d]=l;if(d[0])for(const[h]of l)h&&o.push(h);else return[]}return[`Expected the value to satisfy a union of \`${e}\`, but received: ${print(t)}`,...o]}})}const track$1=object({title:string(),duration:number()}),album=object({title:string(),year:integer()}),artist=object({title:string()}),playlist=object({title:string(),relevancy:number(),shared:nullable(string()),remote:nullable(string())});type({title:optional(string()),album:optional(type({title:optional(string())})),artists:optional(array(type({title:optional(string())})))});const media=object({sources:array(string()),arts:optional(array(string())),thumbnails:optional(array(nullable(string())))}),collection=r=>object({size:integer(),duration:number(),tracks:array(r)}),unique=r=>assign(r,object({id:integer()})),artistInfo=assign(artist,media),albumInfo=assign(album,assign(media,object({artists:array(artistInfo)}))),trackInfo=assign(track$1,assign(omit(media,["arts","thumbnails"]),object({album:omit(albumInfo,["artists"]),artists:array(artistInfo)}))),playlistInfo=playlist,track=assign(unique(trackInfo),object({entry:optional(number()),album:unique(trackInfo.schema.album),artists:array(unique(trackInfo.schema.artists.schema))}));assign(unique(albumInfo),object({artists:array(unique(albumInfo.schema.artists.schema)),collection:optional(collection(track))}));assign(unique(artistInfo),object({following:optional(union([literal(0),literal(1)])),collection:optional(collection(track))}));assign(unique(playlistInfo),object({collection:optional(collection(track))}));function has(r,e){return r!==null&&typeof r=="object"&&e in r&&r[e]!==void 0}function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var murmurhash={exports:{}};(function(r){(function(){const e=a=>new TextEncoder().encode(a);function t(a,l){typeof a=="string"&&(a=e(a));let d=a.length,h=l^d,p=0,m;for(;d>=4;)m=a[p]&255|(a[++p]&255)<<8|(a[++p]&255)<<16|(a[++p]&255)<<24,m=(m&65535)*1540483477+(((m>>>16)*1540483477&65535)<<16),m^=m>>>24,m=(m&65535)*1540483477+(((m>>>16)*1540483477&65535)<<16),h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16)^m,d-=4,++p;switch(d){case 3:h^=(a[p+2]&255)<<16;case 2:h^=(a[p+1]&255)<<8;case 1:h^=a[p]&255,h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16)}return h^=h>>>13,h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16),h^=h>>>15,h>>>0}function n(a,l){typeof a=="string"&&(a=e(a));let d,h,p,m,E,A,L,S;for(d=a.length&3,h=a.length-d,p=l,E=3432918353,A=461845907,S=0;S<h;)L=a[S]&255|(a[++S]&255)<<8|(a[++S]&255)<<16|(a[++S]&255)<<24,++S,L=(L&65535)*E+(((L>>>16)*E&65535)<<16)&4294967295,L=L<<15|L>>>17,L=(L&65535)*A+(((L>>>16)*A&65535)<<16)&4294967295,p^=L,p=p<<13|p>>>19,m=(p&65535)*5+(((p>>>16)*5&65535)<<16)&4294967295,p=(m&65535)+27492+(((m>>>16)+58964&65535)<<16);switch(L=0,d){case 3:L^=(a[S+2]&255)<<16;case 2:L^=(a[S+1]&255)<<8;case 1:L^=a[S]&255,L=(L&65535)*E+(((L>>>16)*E&65535)<<16)&4294967295,L=L<<15|L>>>17,L=(L&65535)*A+(((L>>>16)*A&65535)<<16)&4294967295,p^=L}return p^=a.length,p^=p>>>16,p=(p&65535)*2246822507+(((p>>>16)*2246822507&65535)<<16)&4294967295,p^=p>>>13,p=(p&65535)*3266489909+(((p>>>16)*3266489909&65535)<<16)&4294967295,p^=p>>>16,p>>>0}const o=n;o.v2=t,o.v3=n,r.exports=o})()})(murmurhash);var murmurhashExports=murmurhash.exports;const hash=getDefaultExportFromCjs(murmurhashExports);function titled(r){return has(r,"title")?r.title:r}function compare$1(r,e){return typeof r=="string"&&typeof e=="string"?r.localeCompare(e):typeof r=="number"&&typeof e=="number"?r-e:has(r,"title")&&has(e,"title")?compare$1(clean(titled(r)),clean(titled(e))):0}function normalize(r){if(typeof r=="string")return clean(r);if(typeof r!="object")return r;const e={...r};for(const t in e)Array.isArray(e[t])?e[t]=e[t].map(normalize).sort(compare$1):e[t]=normalize(e[t]);return e}function stringify(r){return r=normalize(r),typeof r=="string"?r:typeof r!="object"?clean(String(r)):has(r,"artists")&&has(r,"title")&&has(r,"album")?`${r.artists.map(titled)} - ${r.title} - ${titled(r.album)}`:has(r,"artists")&&has(r,"title")?`${r.artists.map(titled)} - ${r.title}`:has(r,"title")?r.title:Array.isArray(r)?r.map(titled).toString():JSON.stringify(r)}function identify(r){return has(r,"id")?+r.id:hash(stringify(r))}const playlists$2=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",t=>track$2(t).innerJoin("library","library.track","tracks.id").select(["library.playlist","library.id as entry"]).orderBy("library.order").orderBy("library.id")).selectFrom("track").fullJoin("playlists","playlists.id","track.playlist").where("playlists.id",">=",0).select(["playlists.id","playlists.title","playlists.relevancy","playlists.shared","playlists.remote",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.entry",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("playlists.id").orderBy("playlists.order").orderBy("playlists.id").$castTo(),{async create(e,t){await e.insertInto("playlists").onConflict(n=>n.doNothing()).values({id:identify(t),order:APPEND,relevancy:1,...t}).execute()},async edit(e,t,n){await e.updateTable("playlists").where("id","=",t).set(n).execute()},async rearrange(e,t,n){await e.updateTable("playlists_fractindex").set({after_id:n||null}).where("id","=",t).execute()},async delete(e,t){await e.deleteFrom("playlists").where("id","=",t).execute()},get(e,t){return e.selectFrom("playlists").selectAll().where("id","=",t).executeTakeFirstOrThrow()}}),resources$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).selectFrom("source").leftJoin("asset","asset.owner","source.owner").select([t=>t.fn.coalesce("asset.arts",t.val("[]")).as("arts"),t=>t.fn.coalesce("asset.thumbnails",t.val("[]")).as("thumbnails"),t=>t.fn.coalesce("source.sources",t.val("[]")).as("sources")]).$castTo(),{async prioritize(e,t,n){const o=t==="art"?"assets":"sources";await e.updateTable(o).set({primary:sql`${sql.ref(t)} = ${n}`}).where("owner","=",a=>a.selectFrom(o).where(t,"=",n).select("owner")).execute()},get(e,t){return e.with("source",source).with("asset",asset).selectFrom("source").leftJoin("asset","asset.owner","source.owner").select([n=>n.fn.coalesce("asset.arts",n.val("[]")).as("arts"),n=>n.fn.coalesce("asset.thumbnails",n.val("[]")).as("thumbnails"),n=>n.fn.coalesce("source.sources",n.val("[]")).as("sources")]).where("source.owner","=",t).$castTo().executeTakeFirstOrThrow()}}),settings$2=({replicated:r})=>r(e=>e.selectFrom("settings").select(["key",sql`json_extract(value, '$')`.as("value")]),{async store(e,t,n,o="settings"){o!=="settings"&&(await e.schema.createTable(o).ifNotExists().addColumn("key","text",a=>a.primaryKey().notNull()).addColumn("value","text").execute(),await e.schema.createIndex(o+"_value").ifNotExists().on(o).column("value").execute()),await e.insertInto(o).onConflict(a=>a.doUpdateSet({value:JSON.stringify(n)})).values({key:t,value:JSON.stringify(n)}).execute()},async extract(e,t,n="settings"){return e.selectFrom(n).select("value").where("key","=",t).executeTakeFirstOrThrow().then(o=>JSON.parse(o.value))},async lookup(e,t,n="settings"){return e.selectFrom(n).select("key").where("value","=",JSON.stringify(t)).executeTakeFirstOrThrow().then(o=>o.key)}}),history$2=({replicated:r})=>r(e=>e.selectFrom("history").orderBy("date","desc").selectAll(),{async log(e,t){t.trim()&&await e.insertInto("history").onConflict(n=>n.doUpdateSet({date:Date.now()})).values({query:t,date:Date.now()}).execute()},async clear(e){await e.deleteFrom("history").execute()},get(e){return e.selectFrom("history").selectAll().orderBy("date","desc").execute()}}),artists$2=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("artist").leftJoin("attribution","attribution.artist","artist.id").leftJoin("albums","albums.id","attribution.album").leftJoin("tracks","tracks.album","albums.id").leftJoin("track","track.id","tracks.id").select(["artist.id","artist.title","artist.following","artist.arts","artist.thumbnails","artist.sources",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.id",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("artist.id").orderBy(t=>t.fn.count("track.duration"),"desc").orderBy("artist.title").$castTo(),{async push(e,t){await pushArtists(e,t)},async edit(e,t,n){await e.updateTable("artists").where("id","=",t).set(n)},async follow(e,t){await e.updateTable("artists").set({following:1}).where("id","=",t).execute()},async unfollow(e,t){await e.updateTable("artists").set({following:0}).where("id","=",t).execute()},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).selectFrom("artists_fts").where("artists_fts","match",sanitize(t)).orderBy("rank").innerJoin("artist","artist.id","artists_fts.rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).selectFrom("artist").where("artist.id","=",t).selectAll().$castTo().executeTakeFirstOrThrow()}}),library$2=({replicated:r})=>r(e=>e.selectFrom("library").selectAll(),{async push(e,t,n){t.length&&(await pushTracks(e,t),n!=null&&await e.insertInto("library").onConflict(o=>o.doNothing()).values(t.map(({id:o})=>({id:uuid(),order:APPEND,date:~~(Date.now()/1e3),track:o,playlist:n}))).execute())},async rearrange(e,t,n){await e.updateTable("library_fractindex").set({after_id:n||null}).where("id","=",t).execute()},async purge(e,t){const n=t.map(o=>e.deleteFrom("library").where("id","=",o).execute());await Promise.all(n)},async get(e,t){return t.length?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources","library.id as entry"]).where("library.id","in",t).$castTo().execute():[]},async sample(e,t,n=t){const o=n*Math.sqrt(2*Math.PI)/2,a=sql`POW(ABS(RANDOM()) / 9223372036854775808,
        ${o} /
        EXP(-0.5 * POW(row_number() OVER (ORDER BY date DESC) / ${n},2)) *
        playlists.relevancy
      )`;return await e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").innerJoin("playlists","playlists.id","library.playlist").innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources"]).where("relevancy",">",0).orderBy(a,"desc").limit(t).execute()},async banned(e){return await e.selectFrom("library").leftJoin("playlists","playlists.id","library.playlist").select("library.track").where("relevancy","<",0).execute().then(t=>t.map(n=>n.track))},async has(e,t){return await e.selectFrom("tracks").select("id").where("id","in",t).execute()}});function database(r,e={}){const{replica:t,...n}=database$1(r,e);function o(...a){return function(l,d){const h=a.length?derived(a,A=>A):void 0,p=h&&get_store_value(h),{bind:m,...E}=t(l,d,p);return m(A=>h==null?void 0:h.subscribe(A)),E}}return{replicated:Object.assign(o(),{with:o}),...n}}const id=integer,boolean=integer,tracks$2=assign(unique(track$1),object({album:id()}));crr(tracks$2);index(tracks$2,"album");primary(tracks$2,"id");const albums$2=unique(album);crr(albums$2);primary(albums$2,"id");const artists$1=assign(unique(artist),object({following:boolean()}));crr(artists$1);primary(artists$1,"id");const attribution=object({album:id(),artist:id()});crr(attribution);index(attribution,"artist");primary(attribution,"album","artist");const sources=object({source:string(),owner:id(),primary:boolean()});crr(sources);primary(sources,"owner","source");const assets=object({art:string(),thumbnail:nullable(string()),owner:id(),primary:boolean()});crr(assets);primary(assets,"owner","art");const playlists$1=assign(unique(playlist),object({order:string()}));crr(playlists$1);primary(playlists$1,"id");ordered(playlists$1,"order");index(playlists$1,"order","id");const library$1=object({id:id(),playlist:id(),track:id(),date:integer(),order:string()});crr(library$1);primary(library$1,"id");index(library$1,"date");index(library$1,"track");index(library$1,"playlist");index(library$1,"order","id");ordered(library$1,"order","playlist");const playback$1=object({id:id(),device:instance$1(Uint8Array),track:id(),order:string(),temp:any()});crr(playback$1);primary(playback$1,"id");index(playback$1,"device");index(playback$1,"order","id");ordered(playback$1,"order","device");const devices=object({id:instance$1(Uint8Array),playback:id(),direction:integer(),infinite:integer(),progress:number(),repeat:integer()});crr(devices);primary(devices,"id");const settings$1=object({key:string(),value:string()});crr(settings$1);index(settings$1,"value");primary(settings$1,"key");const history$1=object({query:string(),date:integer()});crr(history$1);index(history$1,"date");primary(history$1,"query");const schema=object({tracks:tracks$2,albums:albums$2,attribution,artists:artists$1,sources,assets,library:library$1,playlists:playlists$1,playback:playback$1,devices,settings:settings$1,history:history$1}),tracks$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").where("playlist",">=",0).innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources","library.id as entry","library.date"]).orderBy("library.date","desc").orderBy("library.id").$castTo(),{async edit(e,t,n){const o=await e.updateTable("tracks").where("id","=",t).set({...n,album:void 0}).returning("album").executeTakeFirst();o!=null&&o.album&&n.album&&await e.updateTable("albums").where("id","=",o.album).set(n.album).execute()},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("tracks_fts").where("tracks_fts","match",sanitize(t)).orderBy("rank").innerJoin("track","track.id","rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("track").selectAll().where("id","=",t).$castTo().executeTakeFirstOrThrow()}}),albums$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("album").selectAll().orderBy("album.title"),{async push(e,t){await pushAlbums(e,t)},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("albums_fts").where("albums_fts","match",sanitize(t)).orderBy("rank").innerJoin("album","album.id","albums_fts.rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("album").selectAll().where("album.id","=",t).$castTo().executeTakeFirstOrThrow()}}),feed$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",t=>track$2(t).innerJoin("library","library.track","tracks.id").select(["library.playlist","library.id as entry"]).orderBy("library.order").orderBy("library.id")).selectFrom("track").fullJoin("playlists","playlists.id","track.playlist").where("playlists.id","<",0).select(["playlists.id","playlists.title","playlists.relevancy","playlists.shared","playlists.remote",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.entry",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("playlists.id").orderBy("playlists.order").orderBy("playlists.id").$castTo(),{async get(e,t,n=-1){return e.selectFrom("library").where("playlist","=",t).select("id").limit(n).execute().then(o=>o.map(a=>a.id))},async clear(e,t,n=Number.MAX_SAFE_INTEGER){await e.deleteFrom("library").where("playlist","=",t).where("date","<=",n).execute()}}),connections=new Map,stores=r=>({playlists:playlists$2(r),resources:resources$1(r),preceding:preceding$1(r),playback:playback$2(r),upcoming:upcoming$1(r),settings:settings$2(r),history:history$2(r),artists:artists$2(r),library:library$2(r),albums:albums$1(r),tracks:tracks$1(r),feed:feed$1(r)});function connect(r){if(!connections.has(r.name)){const e=database(r.local?nocrr(schema):schema,r);connections.set(r.name,{...e,...stores(e)});const t=Object.assign({"../sql/cascade.sql":__vite_glob_0_0,"../sql/fts.sql":__vite_glob_0_1,"../sql/playback.sql":__vite_glob_0_2,"../sql/playlists.sql":__vite_glob_0_3});r.local&&delete t["../sql/fts.sql"];const n=Object.values(t).flatMap(o=>o.split(/\r?\n\r?\n/)).map(o=>sql.raw(o));e.update(o=>Promise.all(n.map(a=>a.execute(o))))}return connections.get(r.name)}function nocrr(r){return{...r,schema:Object.fromEntries(Object.entries(r.schema).map(([e,t])=>[e,{...t,crr:!1}]))}}function identity(r){return r}function pipeFromArray(r){return r.length===0?identity:r.length===1?r[0]:function(t){return r.reduce((n,o)=>o(n),t)}}function observable(r){const e={subscribe(t){let n=null,o=!1,a=!1,l=!1;function d(){if(n===null){l=!0;return}a||(a=!0,typeof n=="function"?n():n&&n.unsubscribe())}return n=r({next(h){var p;o||(p=t.next)==null||p.call(t,h)},error(h){var p;o||(o=!0,(p=t.error)==null||p.call(t,h),d())},complete(){var h;o||(o=!0,(h=t.complete)==null||h.call(t),d())}}),l&&d(),{unsubscribe:d}},pipe(...t){return pipeFromArray(t)(e)}};return e}function share(r){return e=>{let t=0,n=null;const o=[];function a(){n||(n=e.subscribe({next(d){var h;for(const p of o)(h=p.next)==null||h.call(p,d)},error(d){var h;for(const p of o)(h=p.error)==null||h.call(p,d)},complete(){var d;for(const h of o)(d=h.complete)==null||d.call(h)}}))}function l(){if(t===0&&n){const d=n;n=null,d.unsubscribe()}}return{subscribe(d){return t++,o.push(d),a(),{unsubscribe(){t--,l();const h=o.findIndex(p=>p===d);h>-1&&o.splice(h,1)}}}}}}class ObservableAbortError extends Error{constructor(e){super(e),this.name="ObservableAbortError",Object.setPrototypeOf(this,ObservableAbortError.prototype)}}function observableToPromise(r){let e;return{promise:new Promise((n,o)=>{let a=!1;function l(){a||(a=!0,o(new ObservableAbortError("This operation was aborted.")),d.unsubscribe())}const d=r.subscribe({next(h){a=!0,n(h),l()},error(h){a=!0,o(h),l()},complete(){a=!0,l()}});e=l}),abort:e}}function createChain(r){return observable(e=>{function t(o=0,a=r.op){const l=r.links[o];if(!l)throw new Error("No more links to execute - did you forget to add an ending link?");return l({op:a,next(h){return t(o+1,h)}})}return t().subscribe(e)})}function invert(r){const e=Object.create(null);for(const t in r){const n=r[t];e[n]=t}return e}const TRPC_ERROR_CODES_BY_KEY={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};invert(TRPC_ERROR_CODES_BY_KEY);invert(TRPC_ERROR_CODES_BY_KEY);const noop=()=>{};function createInnerProxy(r,e){return new Proxy(noop,{get(n,o){if(!(typeof o!="string"||o==="then"))return createInnerProxy(r,[...e,o])},apply(n,o,a){const l=e[e.length-1]==="apply";return r({args:l?a.length>=2?a[1]:[]:a,path:l?e.slice(0,-1):e})}})}const createRecursiveProxy=r=>createInnerProxy(r,[]),createFlatProxy=r=>new Proxy(noop,{get(e,t){if(!(typeof t!="string"||t==="then"))return r(t)}});function isObject$1(r){return!!r&&!Array.isArray(r)&&typeof r=="object"}class UnknownCauseError extends Error{}function getCauseFromUnknown(r){if(r instanceof Error)return r;const e=typeof r;if(!(e==="undefined"||e==="function"||r===null)){if(e!=="object")return new Error(String(r));if(isObject$1(r)){const t=new UnknownCauseError;for(const n in r)t[n]=r[n];return t}}}function isObject(r){return!!r&&!Array.isArray(r)&&typeof r=="object"}function transformResultInner(r,e){if("error"in r){const n=e.transformer.deserialize(r.error);return{ok:!1,error:{...r,error:n}}}return{ok:!0,result:{...r.result,...(!r.result.type||r.result.type==="data")&&{type:"data",data:e.transformer.deserialize(r.result.data)}}}}class TransformResultError extends Error{constructor(){super("Unable to transform response from server")}}function transformResult(r,e){let t;try{t=transformResultInner(r,e)}catch{throw new TransformResultError}if(!t.ok&&(!isObject(t.error.error)||typeof t.error.error.code!="number"))throw new TransformResultError;if(t.ok&&!isObject(t.result))throw new TransformResultError;return t}function isTRPCClientError(r){return r instanceof TRPCClientError||r instanceof Error&&r.name==="TRPCClientError"}function isTRPCErrorResponse(r){return isObject(r)&&isObject(r.error)&&typeof r.error.code=="number"&&typeof r.error.message=="string"}class TRPCClientError extends Error{static from(e,t={}){const n=e;return isTRPCClientError(n)?(t.meta&&(n.meta={...n.meta,...t.meta}),n):isTRPCErrorResponse(n)?new TRPCClientError(n.error.message,{...t,result:n}):n instanceof Error?new TRPCClientError(n.message,{...t,cause:getCauseFromUnknown(n)}):new TRPCClientError("Unknown error",{...t,cause:n})}constructor(e,t){var o,a;const n=t==null?void 0:t.cause;super(e,{cause:n}),this.meta=t==null?void 0:t.meta,this.cause=n,this.shape=(o=t==null?void 0:t.result)==null?void 0:o.error,this.data=(a=t==null?void 0:t.result)==null?void 0:a.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,TRPCClientError.prototype)}}/* istanbul ignore next -- @preserve */const retryDelay=r=>r===0?0:Math.min(1e3*2**r,3e4);function createWSClient(r){const{url:e,WebSocket:t=WebSocket,retryDelayMs:n=retryDelay,onOpen:o,onClose:a}=r;/* istanbul ignore next -- @preserve */if(!t)throw new Error("No WebSocket implementation found - you probably don't want to use this on the server, but if you do you need to pass a `WebSocket`-ponyfill");let l=[];const d=Object.create(null);let h=0,p=null,m=null,E=k(),A="connecting";function L(){A!=="open"||p||(p=setTimeout(()=>{p=null,l.length===1?E.send(JSON.stringify(l.pop())):E.send(JSON.stringify(l)),l=[]}))}function S(){if(m!==null||A==="closed")return;const T=n(h++);w(T)}function N(){A="connecting";const T=E;E=k(),b(T)}function w(T){m||(A="connecting",m=setTimeout(N,T))}function b(T){Object.values(d).some(fe=>fe.ws===T)||T.close()}function g(){Object.values(d).forEach(T=>{T.type==="subscription"&&T.callbacks.complete()})}function C(T){l.some(F=>F.id===T.op.id)||X(T.op,T.callbacks)}function k(){const T=typeof e=="function"?e():e,F=new t(T);clearTimeout(m),m=null,F.addEventListener("open",()=>{/* istanbul ignore next -- @preserve */F===E&&(h=0,A="open",o==null||o(),L())}),F.addEventListener("error",()=>{F===E&&S()});const fe=K=>{if(K.method==="reconnect"&&F===E){A==="open"&&(a==null||a()),N();for(const Q of Object.values(d))Q.type==="subscription"&&C(Q)}},$=K=>{var te,ue;const Q=K.id!==null&&d[K.id];if(Q){if((ue=(te=Q.callbacks).next)==null||ue.call(te,K),Q.ws!==E&&F===E){const Y=Q.ws;Q.ws=E,b(Y)}"result"in K&&K.result.type==="stopped"&&F===E&&Q.callbacks.complete()}};return F.addEventListener("message",({data:K})=>{const Q=JSON.parse(K);"method"in Q?fe(Q):$(Q),(F!==E||A==="closed")&&b(F)}),F.addEventListener("close",({code:K})=>{var Q,te,ue,Y;A==="open"&&(a==null||a({code:K})),E===F&&S();for(const[be,Ae]of Object.entries(d))if(Ae.ws===F){if(A==="closed"){delete d[be],(te=(Q=Ae.callbacks).complete)==null||te.call(Q);continue}Ae.type==="subscription"?C(Ae):(delete d[be],(Y=(ue=Ae.callbacks).error)==null||Y.call(ue,TRPCClientError.from(new TRPCWebSocketClosedError("WebSocket closed prematurely"))))}}),F}function X(T,F){const{type:fe,input:$,path:K,id:Q}=T,te={id:Q,method:fe,params:{input:$,path:K}};return d[Q]={ws:E,type:fe,callbacks:F,op:T},l.push(te),L(),()=>{var Y,be;const ue=(Y=d[Q])==null?void 0:Y.callbacks;delete d[Q],l=l.filter(Ae=>Ae.id!==Q),(be=ue==null?void 0:ue.complete)==null||be.call(ue),E.readyState===t.OPEN&&T.type==="subscription"&&(l.push({id:Q,method:"subscription.stop"}),L())}}return{close:()=>{A="closed",a==null||a(),g(),b(E),clearTimeout(m),m=null},request:X,getConnection(){return E}}}class TRPCWebSocketClosedError extends Error{constructor(e){super(e),this.name="TRPCWebSocketClosedError",Object.setPrototypeOf(this,TRPCWebSocketClosedError.prototype)}}function wsLink(r){return e=>{const{client:t}=r;return({op:n})=>observable(o=>{const{type:a,path:l,id:d,context:h}=n,p=e.transformer.serialize(n.input),m=t.request({type:a,path:l,input:p,id:d,context:h},{error(E){o.error(E),m()},complete(){o.complete()},next(E){const A=transformResult(E,e);if(!A.ok){o.error(TRPCClientError.from(A.error));return}o.next({result:A.result}),n.type!=="subscription"&&(m(),o.complete())}});return()=>{m()}})}}class TRPCUntypedClient{$request({type:e,input:t,path:n,context:o={}}){return createChain({links:this.links,op:{id:++this.requestId,type:e,path:n,input:t,context:o}}).pipe(share())}requestAsPromise(e){const t=this.$request(e),{promise:n,abort:o}=observableToPromise(t);return new Promise((l,d)=>{var h;(h=e.signal)==null||h.addEventListener("abort",o),n.then(p=>{l(p.result.data)}).catch(p=>{d(TRPCClientError.from(p))})})}query(e,t,n){return this.requestAsPromise({type:"query",path:e,input:t,context:n==null?void 0:n.context,signal:n==null?void 0:n.signal})}mutation(e,t,n){return this.requestAsPromise({type:"mutation",path:e,input:t,context:n==null?void 0:n.context,signal:n==null?void 0:n.signal})}subscription(e,t,n){return this.$request({type:"subscription",path:e,input:t,context:n==null?void 0:n.context}).subscribe({next(a){var l,d,h;a.result.type==="started"?(l=n.onStarted)==null||l.call(n):a.result.type==="stopped"?(d=n.onStopped)==null||d.call(n):(h=n.onData)==null||h.call(n,a.result.data)},error(a){var l;(l=n.onError)==null||l.call(n,a)},complete(){var a;(a=n.onComplete)==null||a.call(n)}})}constructor(e){this.requestId=0;const t=(()=>{const n=e.transformer;return n?"input"in n?e.transformer:{input:n,output:n}:{input:{serialize:o=>o,deserialize:o=>o},output:{serialize:o=>o,deserialize:o=>o}}})();this.runtime={transformer:{serialize:n=>t.input.serialize(n),deserialize:n=>t.output.deserialize(n)},combinedTransformer:t},this.links=e.links.map(n=>n(this.runtime))}}const clientCallTypeMap={query:"query",mutate:"mutation",subscribe:"subscription"},clientCallTypeToProcedureType=r=>clientCallTypeMap[r];function createTRPCClientProxy(r){return createFlatProxy(e=>r.hasOwnProperty(e)?r[e]:e==="__untypedClient"?r:createRecursiveProxy(({path:t,args:n})=>{const o=[e,...t],a=clientCallTypeToProcedureType(o.pop()),l=o.join(".");return r[a](l,...n)}))}function createTRPCProxyClient(r){const e=new TRPCUntypedClient(r);return createTRPCClientProxy(e)}var qo;const{sync,search:search$1,streams,expand,desource,transcribe}=createTRPCProxyClient({links:[(qo=globalThis.localStorage)!=null&&qo.getItem("remote")?wsLink({client:createWSClient({url:()=>localStorage.getItem("remote")})}):()=>()=>observable(()=>{})]}),{playlists,resources,preceding,playback,upcoming,settings,history,artists,library,albums,tracks,update,feed}=connect({name:"library.db",push:sync.push.mutate,pull:sync.pull.subscribe}),search=writable(""),extra=writable(null);function format(r,e=!1){if(!e){r=Math.round(+r),r<=0&&(r=0);const d=~~(r/3600);r-=d*3600;const h=~~(r/60);r-=h*60;const p=r,m=E=>E.toString().padStart(2,"0");return d?`${d}:${m(h)}:${m(p)}`:`${h}:${m(p)}`}const t=new Intl.RelativeTimeFormat("en"),n=Math.floor((Date.now()-+r)/1e3),o=Math.floor(n/60),a=Math.floor(o/60),l=Math.floor(a/24);return n<=1?"just now":n<60?t.format(-n,"seconds"):o<60?t.format(-o,"minutes"):a<24?t.format(-a,"hours"):t.format(-l,"days")}function compare(r){const e=new Date;return+r>+e?"In The Future":r.getFullYear()===e.getFullYear()?r.getMonth()===e.getMonth()?e.getDate()-r.getDate()===0?"Today":e.getDate()-r.getDate()===1?"Yesterday":e.getDate()-r.getDate()<7&&e.getDay()>r.getDay()?"This Week":e.getDate()-r.getDate()<7||e.getDate()-r.getDate()<14&&e.getDay()>=r.getDay()?"Last Week":"This Month":e.getMonth()-r.getMonth()===1?"Last Month":`In ${r.toLocaleString("default",{month:"long"})}`:r.getFullYear().toString()}const get_default_slot_changes=r=>({}),get_default_slot_context=r=>({slot:"after"});function create_default_slot_6(r){let e;return{c(){e=text(r[4])},l(t){e=claim_text(t,r[4])},m(t,n){insert_hydration(t,e,n)},p(t,n){n&16&&set_data(e,t[4])},d(t){t&&detach(e)}}}function create_default_slot_5(r){let e,t,n,o;return n=new Text({props:{secondary:!0,$$slots:{default:[create_default_slot_6]},$$scope:{ctx:r}}}),{c(){e=text(r[5]),t=space(),create_component(n.$$.fragment)},l(a){e=claim_text(a,r[5]),t=claim_space(a),claim_component(n.$$.fragment,a)},m(a,l){insert_hydration(a,e,l),insert_hydration(a,t,l),mount_component(n,a,l),o=!0},p(a,l){(!o||l&32)&&set_data(e,a[5]);const d={};l&1040&&(d.$$scope={dirty:l,ctx:a}),n.$set(d)},i(a){o||(transition_in(n.$$.fragment,a),o=!0)},o(a){transition_out(n.$$.fragment,a),o=!1},d(a){a&&(detach(e),detach(t)),destroy_component(n,a)}}}function create_default_slot_4(r){var n;let e=((n=r[3])==null?void 0:n.artists.map(func).join(", "))+"",t;return{c(){t=text(e)},l(o){t=claim_text(o,e)},m(o,a){insert_hydration(o,t,a)},p(o,a){var l;a&8&&e!==(e=((l=o[3])==null?void 0:l.artists.map(func).join(", "))+"")&&set_data(t,e)},d(o){o&&detach(t)}}}function create_if_block(r){let e,t;return e=new When({props:{lg:!0,$$slots:{default:[create_default_slot_2]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const a={};o&1032&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_default_slot_3(r){var n;let e=((n=r[3])==null?void 0:n.album.title)+"",t;return{c(){t=text(e)},l(o){t=claim_text(o,e)},m(o,a){insert_hydration(o,t,a)},p(o,a){var l;a&8&&e!==(e=((l=o[3])==null?void 0:l.album.title)+"")&&set_data(t,e)},d(o){o&&detach(t)}}}function create_default_slot_2(r){let e,t;return e=new Text({props:{secondary:!0,sm:!0,loading:!r[3],$$slots:{default:[create_default_slot_3]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const a={};o&8&&(a.loading=!n[3]),o&1032&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_default_slot_1(r){let e,t,n,o,a,l,d=`scaleX(${r[1]})`,h;e=new Text({props:{accent:!0,loading:!r[3],$$slots:{default:[create_default_slot_5]},$$scope:{ctx:r}}}),n=new Text({props:{secondary:!0,sm:!0,loading:!r[3],$$slots:{default:[create_default_slot_4]},$$scope:{ctx:r}}});let p=!r[0]&&create_if_block(r);return{c(){create_component(e.$$.fragment),t=space(),create_component(n.$$.fragment),o=space(),p&&p.c(),a=space(),l=element("div"),this.h()},l(m){claim_component(e.$$.fragment,m),t=claim_space(m),claim_component(n.$$.fragment,m),o=claim_space(m),p&&p.l(m),a=claim_space(m),l=claim_element(m,"DIV",{class:!0}),children(l).forEach(detach),this.h()},h(){attr(l,"class","absolute bottom-0 left-0 h-0.5 w-full origin-left transform-gpu bg-highlight-200 transition-transform duration-1000"),set_style(l,"transform",d)},m(m,E){mount_component(e,m,E),insert_hydration(m,t,E),mount_component(n,m,E),insert_hydration(m,o,E),p&&p.m(m,E),insert_hydration(m,a,E),insert_hydration(m,l,E),h=!0},p(m,E){const A={};E&8&&(A.loading=!m[3]),E&1072&&(A.$$scope={dirty:E,ctx:m}),e.$set(A);const L={};E&8&&(L.loading=!m[3]),E&1032&&(L.$$scope={dirty:E,ctx:m}),n.$set(L),m[0]?p&&(group_outros(),transition_out(p,1,1,()=>{p=null}),check_outros()):p?(p.p(m,E),E&1&&transition_in(p,1)):(p=create_if_block(m),p.c(),transition_in(p,1),p.m(a.parentNode,a)),E&2&&d!==(d=`scaleX(${m[1]})`)&&set_style(l,"transform",d)},i(m){h||(transition_in(e.$$.fragment,m),transition_in(n.$$.fragment,m),transition_in(p),h=!0)},o(m){transition_out(e.$$.fragment,m),transition_out(n.$$.fragment,m),transition_out(p),h=!1},d(m){m&&(detach(t),detach(o),detach(a),detach(l)),destroy_component(e,m),destroy_component(n,m),p&&p.d(m)}}}function create_default_slot(r){var a;let e,t,n=`hue-rotate(${((a=r[3])==null?void 0:a.id)||0}deg)`,o;return t=new Icon({props:{name:"note"}}),{c(){e=element("div"),create_component(t.$$.fragment),this.h()},l(l){e=claim_element(l,"DIV",{class:!0});var d=children(e);claim_component(t.$$.fragment,d),d.forEach(detach),this.h()},h(){attr(e,"class","flex h-full w-full items-center justify-center bg-gradient-to-r from-rose-400 to-red-400 text-white"),set_style(e,"filter",n)},m(l,d){insert_hydration(l,e,d),mount_component(t,e,null),o=!0},p(l,d){var h;d&8&&n!==(n=`hue-rotate(${((h=l[3])==null?void 0:h.id)||0}deg)`)&&set_style(e,"filter",n)},i(l){o||(transition_in(t.$$.fragment,l),o=!0)},o(l){transition_out(t.$$.fragment,l),o=!1},d(l){l&&detach(e),destroy_component(t)}}}function create_before_slot(r){var n,o;let e,t;return e=new Image({props:{src:r[3]?((n=r[3].album.arts)==null?void 0:n[0])||"":void 0,thumbnail:r[3]?((o=r[3].album.thumbnails)==null?void 0:o[0])||"":void 0,slot:"before",$$slots:{default:[create_default_slot]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(a){claim_component(e.$$.fragment,a)},m(a,l){mount_component(e,a,l),t=!0},p(a,l){var h,p;const d={};l&8&&(d.src=a[3]?((h=a[3].album.arts)==null?void 0:h[0])||"":void 0),l&8&&(d.thumbnail=a[3]?((p=a[3].album.thumbnails)==null?void 0:p[0])||"":void 0),l&1032&&(d.$$scope={dirty:l,ctx:a}),e.$set(d)},i(a){t||(transition_in(e.$$.fragment,a),t=!0)},o(a){transition_out(e.$$.fragment,a),t=!1},d(a){destroy_component(e,a)}}}function create_after_slot(r){let e;const t=r[7].default,n=create_slot(t,r,r[10],get_default_slot_context);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,a){n&&n.p&&(!e||a&1024)&&update_slot_base(n,t,o,o[10],e?get_slot_changes(t,o[10],a,get_default_slot_changes):get_all_dirty_from_scope(o[10]),get_default_slot_context)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_fragment(r){let e,t;return e=new Card({props:{sm:!0,flat:!0,flow:!r[0],interactive:!0,selected:r[2],$$slots:{after:[create_after_slot],before:[create_before_slot],default:[create_default_slot_1]},$$scope:{ctx:r}}}),e.$on("contextmenu",r[8]),e.$on("click",r[9]),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,[o]){const a={};o&1&&(a.flow=!n[0]),o&4&&(a.selected=n[2]),o&1083&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}const func=r=>r.title;function instance(r,e,t){let n,o,a,{$$slots:l={},$$scope:d}=e,{sm:h=!1}=e,{progress:p=0}=e,{selected:m=!1}=e,{track:E=void 0}=e;function A(S){bubble.call(this,r,S)}function L(S){bubble.call(this,r,S)}return r.$$set=S=>{"sm"in S&&t(0,h=S.sm),"progress"in S&&t(1,p=S.progress),"selected"in S&&t(2,m=S.selected),"track"in S&&t(3,E=S.track),"$$scope"in S&&t(10,d=S.$$scope)},r.$$.update=()=>{r.$$.dirty&8&&t(5,[n=void 0,...o]=(E==null?void 0:E.title.split("("))||[],n,(t(6,o),t(3,E))),r.$$.dirty&64&&t(4,a=o.length?"("+o.join("("):"")},[h,p,m,E,a,n,o,l,A,L,d]}class Track extends SvelteComponent{constructor(e){super(),init$1(this,e,instance,create_fragment,safe_not_equal,{sm:0,progress:1,selected:2,track:3})}}export{Card as C,Image as I,Portal as P,Realm as R,Track as T,Virtual as V,When as W,extra as a,ensure_array_like as b,search as c,artists as d,expand as e,feed as f,playlists as g,capitalize as h,Text as i,format as j,history as k,library as l,search$1 as m,albums as n,initRealm as o,playback as p,outro_and_destroy_block as q,ready as r,streams as s,tracks as t,update_keyed_each as u,hold as v,compare as w,upcoming as x,desource as y};
