var ya=Object.defineProperty;var Na=(r,e,t)=>e in r?ya(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var ae=(r,e,t)=>(Na(r,typeof e!="symbol"?e+"":e,t),t),Gi=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var i=(r,e,t)=>(Gi(r,e,"read from private field"),t?t.call(r):e.get(r)),g=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},x=(r,e,t,n)=>(Gi(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var X=(r,e,t)=>(Gi(r,e,"access private method"),t);import{T as run_all,s as safe_not_equal,y as create_slot,e as element,c as claim_element,b as children,f as detach,r as attr,D as toggle_class,i as insert_hydration,z as update_slot_base,A as get_all_dirty_from_scope,B as get_slot_changes,W as setContext,C as empty$1,n as noop$2,G as getContext,a as space,g as claim_space,K as set_style,h as append_hydration,F as listen,S as action_destroyer,k as component_subscribe,H as createEventDispatcher,q as onMount,N as tick,m as set_store_value,v as binding_callbacks,ab as compute_slots,I as assign$1,J as set_dynamic_element_data,x as bubble,af as src_url_equal,p as get_store_value,t as text,d as claim_text,j as set_data}from"./scheduler.CPjqGZYx.js";import{b as transition_out,t as transition_in,S as SvelteComponent,i as init$1,g as group_outros,e as check_outros,c as create_component,a as claim_component,m as mount_component,d as destroy_component}from"./index.7wDAvZi8.js";import{w as writable,d as derived}from"./entry.mG-26q5T.js";import{l as lock,b as unlock,a as getScrollParent,p as position$1,I as Icon,g as get_spread_update}from"./Spinner.svelte_svelte_type_style_lang.CBQfOjAn.js";const globals=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ensure_array_like(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function outro_and_destroy_block(r,e){transition_out(r,1,1,()=>{e.delete(r.key)})}function update_keyed_each(r,e,t,n,o,a,u,d,h,p,m,E){let k=r.length,L=a.length,S=k;const N={};for(;S--;)N[r[S].key]=S;const w=[],b=new Map,_=new Map,C=[];for(S=L;S--;){const F=E(o,a,S),fe=t(F);let $=u.get(fe);$?n&&C.push(()=>$.p(F,e)):($=p(fe,F),$.c()),b.set(fe,w[S]=$),fe in N&&_.set(fe,Math.abs(S-N[fe]))}const A=new Set,j=new Set;function I(F){transition_in(F,1),F.m(d,m),u.set(F.key,F),m=F.first,L--}for(;k&&L;){const F=w[L-1],fe=r[k-1],$=F.key,H=fe.key;F===fe?(m=F.first,k--,L--):b.has(H)?!u.has($)||A.has($)?I(F):j.has(H)?k--:_.get($)>_.get(H)?(j.add($),I(F)):(A.add(H),k--):(h(fe,u),k--)}for(;k--;){const F=r[k];b.has(F.key)||h(F,u)}for(;L;)I(w[L-1]);return run_all(C),w}let observing=0,observer=null;const dispatch=r=>r.forEach(e=>{var t;(t=e.target)==null||t.dispatchEvent(new CustomEvent("resize",{detail:e}))});function resize(r){return observer||(observer=new ResizeObserver(dispatch)),observer.observe(r),observing+=1,{destroy(){observer==null||observer.unobserve(r),observing-=1,observing<=0&&(observer==null||observer.disconnect(),observer=null)}}}function drag(r,e="touchstart"){function t(u){do{if(u!=null&&u.draggable)return u;u=(u==null?void 0:u.parentElement)||null}while(u);return null}function n(u){const d=t(u.target);d&&(lock(),u.preventDefault(),d.dispatchEvent(new DragEvent("dragstart",{bubbles:!0})))}function o(u){u.preventDefault(),addEventListener("pointercancel",a),addEventListener("pointerup",a)}function a(){unlock(),removeEventListener("pointercancel",a),removeEventListener("pointerup",a),r.dispatchEvent(new DragEvent("dragend",{bubbles:!0}))}return r.addEventListener(e,n),r.addEventListener("dragstart",o),{destroy(){r.removeEventListener(e,n),r.removeEventListener("dragstart",o)}}}function hold(r,{touch:e=!0,mouse:t=!1,duration:n=300}={}){function o(a){const u=setTimeout(()=>{var p;d();const h=a instanceof TouchEvent?TouchEvent:MouseEvent;(p=a.target)==null||p.dispatchEvent(new h("hold",a))},n),d=()=>{clearTimeout(u),e&&(r.removeEventListener("touchcancel",d),r.removeEventListener("touchmove",d),r.removeEventListener("touchend",d)),t&&(r.removeEventListener("mousemove",d),r.removeEventListener("mouseup",d))};e&&(r.addEventListener("touchcancel",d,{once:!0}),r.addEventListener("touchend",d,{once:!0}),r.addEventListener("touchmove",d,{once:!0,passive:!0})),t&&(r.addEventListener("mousemove",d,{once:!0}),r.addEventListener("mouseup",d,{once:!0}))}return e&&r.addEventListener("touchstart",o,{passive:!0}),t&&r.addEventListener("mousedown",o),{destroy(){r.removeEventListener("touchstart",o),r.removeEventListener("mousedown",o)}}}function create_fragment$7(r){let e,t,n;const o=r[6].default,a=create_slot(o,r,r[5],null);return{c(){e=element("div"),a&&a.c(),this.h()},l(u){e=claim_element(u,"DIV",{class:!0});var d=children(e);a&&a.l(d),d.forEach(detach),this.h()},h(){attr(e,"class",t=r[0]?"contents":"hidden"),toggle_class(e,"sm:contents",!r[0]&&r[1]),toggle_class(e,"md:contents",!r[0]&&r[2]),toggle_class(e,"lg:contents",!r[0]&&r[3]),toggle_class(e,"xl:contents",!r[0]&&r[4]),toggle_class(e,"sm:hidden",r[0]&&r[1]),toggle_class(e,"md:hidden",r[0]&&r[2]),toggle_class(e,"lg:hidden",r[0]&&r[3]),toggle_class(e,"xl:hidden",r[0]&&r[4])},m(u,d){insert_hydration(u,e,d),a&&a.m(e,null),n=!0},p(u,[d]){a&&a.p&&(!n||d&32)&&update_slot_base(a,o,u,u[5],n?get_slot_changes(o,u[5],d,null):get_all_dirty_from_scope(u[5]),null),(!n||d&1&&t!==(t=u[0]?"contents":"hidden"))&&attr(e,"class",t),(!n||d&3)&&toggle_class(e,"sm:contents",!u[0]&&u[1]),(!n||d&5)&&toggle_class(e,"md:contents",!u[0]&&u[2]),(!n||d&9)&&toggle_class(e,"lg:contents",!u[0]&&u[3]),(!n||d&17)&&toggle_class(e,"xl:contents",!u[0]&&u[4]),(!n||d&3)&&toggle_class(e,"sm:hidden",u[0]&&u[1]),(!n||d&5)&&toggle_class(e,"md:hidden",u[0]&&u[2]),(!n||d&9)&&toggle_class(e,"lg:hidden",u[0]&&u[3]),(!n||d&17)&&toggle_class(e,"xl:hidden",u[0]&&u[4])},i(u){n||(transition_in(a,u),n=!0)},o(u){transition_out(a,u),n=!1},d(u){u&&detach(e),a&&a.d(u)}}}function instance$8(r,e,t){let{$$slots:n={},$$scope:o}=e,{not:a=!1}=e,{sm:u=!1}=e,{md:d=!1}=e,{lg:h=!1}=e,{xl:p=!1}=e;return r.$$set=m=>{"not"in m&&t(0,a=m.not),"sm"in m&&t(1,u=m.sm),"md"in m&&t(2,d=m.md),"lg"in m&&t(3,h=m.lg),"xl"in m&&t(4,p=m.xl),"$$scope"in m&&t(5,o=m.$$scope)},[a,u,d,h,p,o,n]}class When extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$8,create_fragment$7,safe_not_equal,{not:0,sm:1,md:2,lg:3,xl:4})}}function create_fragment$6(r){let e;const t=r[1].default,n=create_slot(t,r,r[0],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,[a]){n&&n.p&&(!e||a&1)&&update_slot_base(n,t,o,o[0],e?get_slot_changes(t,o[0],a,null):get_all_dirty_from_scope(o[0]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}const initRealm=()=>({ssr:"",claimed:new Set,mounted:new Set,claim:new Set,destroy:new Set,mount:new Set,target:void 0});function instance$7(r,e,t){let{$$slots:n={},$$scope:o}=e;return setContext("realm",{}),r.$$set=u=>{"$$scope"in u&&t(0,o=u.$$scope)},[o,n]}class Realm extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$7,create_fragment$6,safe_not_equal,{})}}function create_key_block(r){let e;const t=r[4].default,n=create_slot(t,r,r[3],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,a){n&&n.p&&(!e||a&8)&&update_slot_base(n,t,o,o[3],e?get_slot_changes(t,o[3],a,null):get_all_dirty_from_scope(o[3]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_fragment$5(r){let e=r[0],t,n,o=create_key_block(r);return{c(){o.c(),t=empty$1()},l(a){o.l(a),t=empty$1()},m(a,u){o.m(a,u),insert_hydration(a,t,u),n=!0},p(a,[u]){u&1&&safe_not_equal(e,e=a[0])?(group_outros(),transition_out(o,1,1,noop$2),check_outros(),o=create_key_block(a),o.c(),transition_in(o,1),o.m(t.parentNode,t)):o.p(a,u)},i(a){n||(transition_in(o),n=!0)},o(a){transition_out(o),n=!1},d(a){a&&detach(t),o.d(a)}}}function instance$6($$self,$$props,$$invalidate){let{$$slots:slots={},$$scope}=$$props,{to=""}=$$props,{unique=""}=$$props;const realm=getContext("realm");if(!realm)throw new Error("A portal should exists within a realm!");realm[to]||(realm[to]=initRealm());const target=eval("slots");if(target.default){const[r]=target.default;target.default[0]=(...e)=>{const t=r(...e),n=realm[to];let o=!0,a=!0;function u(p){if(!p||n.claimed.has(unique))return a=!1;t.l(p),unique&&n.claimed.add(unique)}function d(p,m){if(n.mounted.has(unique))return o=!1;a&&t.m(p,m),unique&&n.mounted.add(unique)}function h(p){o&&n.mounted.delete(unique),a&&n.claimed.delete(unique),o&&t.d(p),n.claim.delete(u),n.mount.delete(d),n.destroy.delete(h)}return n.claim.add(u),n.mount.add(d),n.destroy.add(h),{...t,d:h,l:()=>{},m:()=>n.target&&d.apply(null,n.target)}}}return $$self.$$set=r=>{"to"in r&&$$invalidate(0,to=r.to),"unique"in r&&$$invalidate(1,unique=r.unique),"$$scope"in r&&$$invalidate(3,$$scope=r.$$scope)},$$self.$$.update=()=>{$$self.$$.dirty&5&&(realm[to]||$$invalidate(2,realm[to]=initRealm(),realm))},[to,unique,realm,$$scope,slots]}class Portal extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$6,create_fragment$5,safe_not_equal,{to:0,unique:1})}}function minmax(r,e,t,n){return r<e?n??e:r>t?n??t:r}const{Map:Map_1,window:window_1}=globals,get_default_slot_changes_1=r=>({item:r[0]&2048}),get_default_slot_context_1=r=>({item:r[11].data,index:NaN});function get_each_context(r,e,t){const n=r.slice();return n[52]=e[t],n[54]=t,n}const get_default_slot_changes$1=r=>({item:r[0]&16384,index:r[0]&16640}),get_default_slot_context$1=r=>({item:r[52],index:r[8]+r[54]});function create_each_block(r,e){let t,n,o,a;const u=e[40].default,d=create_slot(u,e,e[42],get_default_slot_context$1);return{key:r,first:null,c(){t=element("div"),d&&d.c(),n=space(),this.h()},l(h){t=claim_element(h,"DIV",{draggable:!0,style:!0});var p=children(t);d&&d.l(p),n=claim_space(p),p.forEach(detach),this.h()},h(){var h,p;attr(t,"draggable",o=e[2]&&e[1](e[52])!=null?"true":void 0),set_style(t,"overflow-anchor","none"),toggle_class(t,"invisible",((h=e[11])==null?void 0:h.owner)===e[3]&&((p=e[11])==null?void 0:p.key)===e[1](e[52])),this.first=t},m(h,p){insert_hydration(h,t,p),d&&d.m(t,null),append_hydration(t,n),a=!0},p(h,p){var m,E;e=h,d&&d.p&&(!a||p[0]&16640|p[1]&2048)&&update_slot_base(d,u,e,e[42],a?get_slot_changes(u,e[42],p,get_default_slot_changes$1):get_all_dirty_from_scope(e[42]),get_default_slot_context$1),(!a||p[0]&16390&&o!==(o=e[2]&&e[1](e[52])!=null?"true":void 0))&&attr(t,"draggable",o),(!a||p[0]&18442)&&toggle_class(t,"invisible",((m=e[11])==null?void 0:m.owner)===e[3]&&((E=e[11])==null?void 0:E.key)===e[1](e[52]))},i(h){a||(transition_in(d,h),a=!0)},o(h){transition_out(d,h),a=!1},d(h){h&&detach(t),d&&d.d(h)}}}function create_if_block$3(r){let e,t;return e=new Portal({props:{to:"overlay",$$slots:{default:[create_default_slot$1]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const a={};o[0]&2297|o[1]&2048&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_1$2(r){let e,t=`translate3d(
          ${r[11].back?r[11].back.x:r[7].x+Math.max(r[11].offset.x,-r[4].width/r[6]+r[0])}px,
          ${r[11].back?r[11].back.y:r[7].y+Math.max(r[11].offset.y,-r[5]+r[0])}px, 0)`,n=`${r[4].width/r[6]-r[0]}px`,o=`${r[5]-r[0]}px`,a;const u=r[40].default,d=create_slot(u,r,r[42],get_default_slot_context_1);return{c(){e=element("div"),d&&d.c(),this.h()},l(h){e=claim_element(h,"DIV",{class:!0});var p=children(e);d&&d.l(p),p.forEach(detach),this.h()},h(){attr(e,"class","absolute will-change-transform contain-[size_layout]"),toggle_class(e,"transition-transform",r[11].back),set_style(e,"transform",t),set_style(e,"width",n),set_style(e,"height",o)},m(h,p){insert_hydration(h,e,p),d&&d.m(e,null),a=!0},p(h,p){d&&d.p&&(!a||p[0]&2048|p[1]&2048)&&update_slot_base(d,u,h,h[42],a?get_slot_changes(u,h[42],p,get_default_slot_changes_1):get_all_dirty_from_scope(h[42]),get_default_slot_context_1),(!a||p[0]&2048)&&toggle_class(e,"transition-transform",h[11].back),p[0]&2289&&t!==(t=`translate3d(
          ${h[11].back?h[11].back.x:h[7].x+Math.max(h[11].offset.x,-h[4].width/h[6]+h[0])}px,
          ${h[11].back?h[11].back.y:h[7].y+Math.max(h[11].offset.y,-h[5]+h[0])}px, 0)`)&&set_style(e,"transform",t),p[0]&81&&n!==(n=`${h[4].width/h[6]-h[0]}px`)&&set_style(e,"width",n),p[0]&33&&o!==(o=`${h[5]-h[0]}px`)&&set_style(e,"height",o)},i(h){a||(transition_in(d,h),a=!0)},o(h){transition_out(d,h),a=!1},d(h){h&&detach(e),d&&d.d(h)}}}function create_default_slot$1(r){var o;let e,t,n=((o=r[11])==null?void 0:o.owner)===r[3]&&create_if_block_1$2(r);return{c(){n&&n.c(),e=empty$1()},l(a){n&&n.l(a),e=empty$1()},m(a,u){n&&n.m(a,u),insert_hydration(a,e,u),t=!0},p(a,u){var d;((d=a[11])==null?void 0:d.owner)===a[3]?n?(n.p(a,u),u[0]&2056&&transition_in(n,1)):(n=create_if_block_1$2(a),n.c(),transition_in(n,1),n.m(e.parentNode,e)):n&&(group_outros(),transition_out(n,1,1,()=>{n=null}),check_outros())},i(a){t||(transition_in(n),t=!0)},o(a){transition_out(n),t=!1},d(a){a&&detach(e),n&&n.d(a)}}}function create_fragment$4(r){let e,t,n=[],o=new Map_1,a=`translate3d(0,${Math.ceil(r[8]/r[6])*r[5]}px,0)`,u=`${r[0]}px`,d,h=`${r[10]}px`,p,m,E,k=ensure_array_like(r[14]);const L=N=>N[12][(N[8]+N[54])%N[9]]??N[54];for(let N=0;N<k.length;N+=1){let w=get_each_context(r,k,N),b=L(w);o.set(b,n[N]=create_each_block(b,w))}let S=r[2]&&create_if_block$3(r);return{c(){e=element("div"),t=element("div");for(let N=0;N<n.length;N+=1)n[N].c();d=space(),S&&S.c(),this.h()},l(N){e=claim_element(N,"DIV",{class:!0});var w=children(e);t=claim_element(w,"DIV",{class:!0});var b=children(t);for(let _=0;_<n.length;_+=1)n[_].l(b);b.forEach(detach),d=claim_space(w),S&&S.l(w),w.forEach(detach),this.h()},h(){attr(t,"class","grid auto-rows-max will-change-transform contain-layout"),toggle_class(t,"pointer-events-none",!!r[11]),set_style(t,"transform",a),set_style(t,"grid-template-columns",r[13]),set_style(t,"gap",u),attr(e,"class","shrink-0 contain-[size_layout]"),set_style(e,"height",h)},m(N,w){insert_hydration(N,e,w),append_hydration(e,t);for(let b=0;b<n.length;b+=1)n[b]&&n[b].m(t,null);r[41](t),append_hydration(e,d),S&&S.m(e,null),p=!0,m||(E=[listen(window_1,"dragstart",r[15]),listen(window_1,"dragend",r[16]),action_destroyer(drag.call(null,t,"hold")),action_destroyer(hold.call(null,t))],m=!0)},p(N,w){w[0]&23310|w[1]&2048&&(k=ensure_array_like(N[14]),group_outros(),n=update_keyed_each(n,w,L,1,N,k,o,t,outro_and_destroy_block,create_each_block,null,get_each_context),check_outros()),(!p||w[0]&2048)&&toggle_class(t,"pointer-events-none",!!N[11]),w[0]&352&&a!==(a=`translate3d(0,${Math.ceil(N[8]/N[6])*N[5]}px,0)`)&&set_style(t,"transform",a),w[0]&8192&&set_style(t,"grid-template-columns",N[13]),w[0]&1&&u!==(u=`${N[0]}px`)&&set_style(t,"gap",u),N[2]?S?(S.p(N,w),w[0]&4&&transition_in(S,1)):(S=create_if_block$3(N),S.c(),transition_in(S,1),S.m(e,null)):S&&(group_outros(),transition_out(S,1,1,()=>{S=null}),check_outros()),w[0]&1024&&h!==(h=`${N[10]}px`)&&set_style(e,"height",h)},i(N){if(!p){for(let w=0;w<k.length;w+=1)transition_in(n[w]);transition_in(S),p=!0}},o(N){for(let w=0;w<n.length;w+=1)transition_out(n[w]);transition_out(S),p=!1},d(N){N&&detach(e);for(let w=0;w<n.length;w+=1)n[w].d();r[41](null),S&&S.d(),m=!1,run_all(E)}}}let transfer=writable(null);function instance$5(r,e,t){let n,o,a,u,d,h,p,m,E,k,L,S,N,w,b,_,C,A,j,I;component_subscribe(r,transfer,V=>t(11,I=V));let{$$slots:F={},$$scope:fe}=e;const $=createEventDispatcher();let{gap:H=0}=e,{items:P}=e,{move:ee=!1}=e,{fixed:le=!1}=e,{overthrow:K=1}=e,{prerender:ye=1}=e,{columns:Ce=1}=e,{key:U=V=>V}=e,{animate:te=!1}=e,{sortable:Ne=!1}=e,{container:Oe=void 0}=e,ue=null,Ye={x:0,y:0},at=new DOMRect,Ze=new DOMRect,Qt=!0,Ut=1,J=0,be=0;function Vn(V){!k&&V.length&&tick().then(Ie);const he=new Map,Se=Array.from({length:m}),xe=new Set(E);for(let Ae=0;Ae<V.length;Ae++){const rr=U(V[Ae]);if(rr==null||(he.set(rr,Ae),Ae<d||Ae>=h))continue;const ft=k==null?void 0:k.get(rr);if(ft==null||ft<d||ft>=h||(Se[Ae%m]=E[ft%m],xe.delete(E[ft%m]),ft===Ae||!te)||(I==null?void 0:I.owner)===ue&&rr===(I==null?void 0:I.key))continue;const Di=~~(ft/J)-~~(Ae/J),Wi=~~(ft%J)-~~(Ae%J);Rr(ft,Wi,Di)}const Me=[...xe];return t(12,E=Se.map(Ae=>Ae??Me.shift())),he}function Rr(V,he,Se){const xe=ue==null?void 0:ue.children.item(V-d),Me=[`translate3d(${he*100}%,${Se*100}%,0)`,"translate3d(0,0,0)"];xe==null||xe.animate({transform:Me,zIndex:["100","100"]},{easing:"ease",composite:"accumulate",duration:L})}function Ie(){var xe;if(!Oe||!ue)return;t(4,Ze=(xe=ue.parentElement)==null?void 0:xe.getBoundingClientRect()),t(26,at=Oe.getBoundingClientRect()),t(4,Ze.y+=Ye.y,Ze),t(28,be=Ze.y-at.y-at.height/2),t(4,Ze.width+=H,Ze);const V=ue.firstElementChild;if(!V)return;const{width:he,height:Se}=V.getBoundingClientRect();!he||!Se||(t(6,J=~~(Ze.width/(he+H))),t(5,Ut=Se+H))}let Pe,Tt,se={x:0,y:0};async function Jn({target:V}){if(Ie(),await tick(),!Ne||!ue||!V||I||V.parentElement!==ue||P[j]==null||U(P[j])==null)return;Tt=j,Pe=ee?-1:Tt;const he=V.getBoundingClientRect();he.x-=se.x,he.y-=se.y,set_store_value(transfer,I={group:Ne===!0?ue:Ne,key:U(P[j]),data:P[j],owner:ue,offset:he},I)}function pt(V,he=!1){if(!Ne||!I||le||U(P[V])==null)return;if(!Number.isInteger(V)){Pe!=null&&I.owner!==ue&&(pt(Pe,!0),Pe=void 0);return}if(U(P[V])===I.key)return;V<0&&!P.length&&(V=0);const Se=P.findIndex(xe=>U(xe)===(I==null?void 0:I.key));Se!==V&&(!he&&Pe==null&&(Pe=Se,Tt=Se),~Se&&P.splice(Se,1),~V&&P.splice(V,0,I.data),requestAnimationFrame(()=>t(17,P))),!he&&ue&&set_store_value(transfer,I.owner=ue,I)}async function qi(){if(!Ne||!I||Tt==null)return;const V=P.findIndex(he=>U(he)===(I==null?void 0:I.key));if(I.owner===ue&&~V){const he=ue.children.item(V-d);he&&(set_store_value(transfer,I.back=he.getBoundingClientRect(),I),set_store_value(transfer,I.group=Math.random().toString(),I),await new Promise(Se=>setTimeout(Se,150)))}if(Tt!==V){const he=I.data,Se=P[V-1],xe=(+!!~Tt<<1)+ +!!~V,Me=[void 0,"push","purge","rearrange"][xe];Me&&$("edit",{action:Me,index:V,after:Se,item:he})}Tt=void 0,Pe=void 0,I.owner===ue&&set_store_value(transfer,I=null,I)}onMount(()=>{function V(xe){const Me=xe.currentTarget;t(25,Ye.x=Me.scrollLeft,Ye),t(25,Ye.y=Me.scrollTop,Ye)}Oe||t(18,Oe=getScrollParent(ue));const he=Ne&&position$1.subscribe(xe=>t(7,se=xe));Oe.addEventListener("scroll",V,{passive:!0}),Oe.addEventListener("resize",Ie);const{destroy:Se}=resize(Oe);return t(27,Qt=!1),()=>{Oe==null||Oe.removeEventListener("scroll",V),Oe==null||Oe.removeEventListener("resize",Ie),he&&he(),Se()}});function xr(V){binding_callbacks[V?"unshift":"push"](()=>{ue=V,t(3,ue)})}return r.$$set=V=>{"gap"in V&&t(0,H=V.gap),"items"in V&&t(17,P=V.items),"move"in V&&t(19,ee=V.move),"fixed"in V&&t(20,le=V.fixed),"overthrow"in V&&t(21,K=V.overthrow),"prerender"in V&&t(22,ye=V.prerender),"columns"in V&&t(23,Ce=V.columns),"key"in V&&t(1,U=V.key),"animate"in V&&t(24,te=V.animate),"sortable"in V&&t(2,Ne=V.sortable),"container"in V&&t(18,Oe=V.container),"$$scope"in V&&t(42,fe=V.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&67108960&&t(38,n=Math.ceil(at.height/Ut)*J),r.$$.dirty[0]&96|r.$$.dirty[1]&128&&t(39,o=n/J*Ut),r.$$.dirty[0]&131072|r.$$.dirty[1]&128&&t(36,a=Math.max(Math.ceil(P.length/n)-2,1)),r.$$.dirty[0]&301989888|r.$$.dirty[1]&288&&t(37,u=minmax(~~((Ye.y-be)/o),1,a)),r.$$.dirty[0]&2097152|r.$$.dirty[1]&192&&t(8,d=Math.max(u-K,0)*n),r.$$.dirty[0]&6291456|r.$$.dirty[1]&192&&t(35,h=Math.max((u+K+1)*n,ye)),r.$$.dirty[0]&131328|r.$$.dirty[1]&16&&t(14,p=P.slice(d,h)),r.$$.dirty[0]&2097152|r.$$.dirty[1]&128&&t(9,m=(K*2+1)*n),r.$$.dirty[0]&512&&t(12,E=Array.from({length:m}).map((V,he)=>he)),r.$$.dirty[0]&131072&&(k=Vn(P)),r.$$.dirty[0]&16777216&&(L=te===!0?300:te||0),r.$$.dirty[0]&131169&&t(10,S=Math.ceil(P.length/J)*Ut-H),r.$$.dirty[0]&8388608&&t(13,N=Number.isInteger(Ce)?`repeat(${Ce},1fr)`:`repeat(auto-fill,minmax(min(100%,${Ce}),1fr))`),r.$$.dirty[0]&1024&&Number.isFinite(S)&&(requestAnimationFrame(Ie),t(27,Qt=!1)),r.$$.dirty[0]&134217728|r.$$.dirty[1]&96&&!Qt&&u===a&&($("end"),t(27,Qt=!0)),r.$$.dirty[0]&12&&t(30,w=Ne===!0?ue:Ne),r.$$.dirty[0]&100663441&&t(34,b=minmax(se.y+H/2,at.top,at.bottom,NaN)+Ye.y-Ze.y),r.$$.dirty[0]&33554577&&t(33,_=minmax(se.x+H/2,Ze.left,Ze.right-H-1,NaN)+Ye.x-Ze.x),r.$$.dirty[0]&32|r.$$.dirty[1]&8&&t(32,C=Math.floor(b/Ut)),r.$$.dirty[0]&80|r.$$.dirty[1]&4&&t(31,A=Math.floor(_/(Ze.width/J))),r.$$.dirty[0]&131136|r.$$.dirty[1]&3&&t(29,j=minmax(C*J+A,0,P.length-1)),r.$$.dirty[0]&1610614784&&(I==null?void 0:I.group)===w&&pt(j)},[H,U,Ne,ue,Ze,Ut,J,se,d,m,S,I,E,N,p,Jn,qi,P,Oe,ee,le,K,ye,Ce,te,Ye,at,Qt,be,j,w,A,C,_,b,h,a,u,n,o,F,xr,fe]}class Virtual extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$5,create_fragment$4,safe_not_equal,{gap:0,items:17,move:19,fixed:20,overthrow:21,prerender:22,columns:23,key:1,animate:24,sortable:2,container:18},null,[-1,-1])}}const get_after_slot_changes=r=>({}),get_after_slot_context=r=>({}),get_before_slot_changes=r=>({}),get_before_slot_context=r=>({});function create_if_block_1$1(r){let e,t;const n=r[9].before,o=create_slot(n,r,r[8],get_before_slot_context);return{c(){e=element("div"),o&&o.c(),this.h()},l(a){e=claim_element(a,"DIV",{class:!0});var u=children(e);o&&o.l(u),u.forEach(detach),this.h()},h(){attr(e,"class","z-20 flex items-center")},m(a,u){insert_hydration(a,e,u),o&&o.m(e,null),t=!0},p(a,u){o&&o.p&&(!t||u&256)&&update_slot_base(o,n,a,a[8],t?get_slot_changes(n,a[8],u,get_before_slot_changes):get_all_dirty_from_scope(a[8]),get_before_slot_context)},i(a){t||(transition_in(o,a),t=!0)},o(a){transition_out(o,a),t=!1},d(a){a&&detach(e),o&&o.d(a)}}}function create_if_block$2(r){let e;return{c(){e=element("hr"),this.h()},l(t){e=claim_element(t,"HR",{"aria-hidden":!0,class:!0}),this.h()},h(){attr(e,"aria-hidden",""),attr(e,"class","absolute bottom-0 h-[1px] w-full border-none bg-content/10 group-last-of-type:opacity-0")},m(t,n){insert_hydration(t,e,n)},d(t){t&&detach(e)}}}function create_dynamic_element(r){let e,t,n,o,a,u,d,h,p,m,E,k,L,S,N,w,b,_,C,A,j,I,F,fe,$=r[7].before&&create_if_block_1$1(r);const H=r[9].default,P=create_slot(H,r,r[8],null);let ee=r[2]&&(r[1]||r[0])&&create_if_block$2();S=new Icon({props:{name:"circle"}}),b=new Icon({props:{name:"target"}});const le=r[9].after,K=create_slot(le,r,r[8],get_after_slot_context);let ye=[{role:A=r[5]?"link":"button"},{tabindex:"0"},{href:r[5]},{draggable:"false"},{class:j="group relative z-10 flex w-full items-center gap-4 overflow-hidden px-4 outline-2 -outline-offset-2 outline-primary-600 contain-inline-size focus-visible:outline "+(r[4]?"cursor-pointer touch-manipulation select-none "+(r[2]?"":"transition-transform active:scale-95"):"")+" "+(r[0]?"focus-visible:z-50":r[1]?"rounded-lg py-1 focus-visible:z-50":"rounded-2xl py-4")+" "+(r[2]?"bg-surface":"bg-surface-100 shadow-[0_0_20px_-4px] shadow-black/20 dark:shadow-none")}],Ce={};for(let U=0;U<ye.length;U+=1)Ce=assign$1(Ce,ye[U]);return{c(){e=element(r[4]?r[5]?"a":"button":"article"),t=element("div"),n=space(),o=element("div"),u=space(),$&&$.c(),d=space(),h=element("div"),P&&P.c(),p=space(),ee&&ee.c(),E=space(),k=element("div"),L=element("div"),create_component(S.$$.fragment),N=space(),w=element("div"),create_component(b.$$.fragment),_=space(),C=element("div"),K&&K.c(),this.h()},l(U){e=claim_element(U,((r[4]?r[5]?"a":"button":"article")||"null").toUpperCase(),{role:!0,tabindex:!0,href:!0,draggable:!0,class:!0});var te=children(e);t=claim_element(te,"DIV",{"aria-hidden":!0,class:!0}),children(t).forEach(detach),n=claim_space(te),o=claim_element(te,"DIV",{"aria-hidden":!0,class:!0}),children(o).forEach(detach),u=claim_space(te),$&&$.l(te),d=claim_space(te),h=claim_element(te,"DIV",{class:!0});var Ne=children(h);P&&P.l(Ne),p=claim_space(Ne),ee&&ee.l(Ne),Ne.forEach(detach),E=claim_space(te),k=claim_element(te,"DIV",{class:!0});var Oe=children(k);L=claim_element(Oe,"DIV",{class:!0});var ue=children(L);claim_component(S.$$.fragment,ue),ue.forEach(detach),N=claim_space(Oe),w=claim_element(Oe,"DIV",{class:!0});var Ye=children(w);claim_component(b.$$.fragment,Ye),Ye.forEach(detach),_=claim_space(Oe),C=claim_element(Oe,"DIV",{class:!0});var at=children(C);K&&K.l(at),at.forEach(detach),Oe.forEach(detach),te.forEach(detach),this.h()},h(){attr(t,"aria-hidden",""),attr(t,"class","pointer-events-none absolute inset-0 -z-10 bg-primary-200/30 opacity-0 transition-opacity"),toggle_class(t,"opacity-100",r[6]===!0),attr(o,"aria-hidden",""),attr(o,"class",a="pointer-events-none absolute inset-0 z-0 bg-highlight opacity-0 "+(r[4]?"group-hover:opacity-30 "+(r[2]?"dark:group-hover:opacity-50":"dark:group-hover:opacity-10"):"")),attr(h,"class",m="z-10 grid w-full grid-cols-1 items-baseline overflow-hidden contain-inline-size "+(r[1]||r[0]?"justify-start gap-0.5":"place-items-center justify-center gap-2")+" "+((r[1]||r[0])&&r[3]?"lg:auto-cols-fr lg:grid-flow-col lg:gap-4":"")),attr(L,"class","flex justify-center text-primary-600 opacity-0 transition-opacity"),toggle_class(L,"opacity-100",r[6]),attr(w,"class","flex scale-0 justify-center text-primary-600 transition-transform"),toggle_class(w,"scale-100",r[6]===!0),attr(C,"class","opacity-0 transition-opacity"),toggle_class(C,"opacity-100",!r[6]),attr(k,"class","z-20 grid items-center [&>*]:col-start-1 [&>*]:row-start-1"),set_dynamic_element_data(r[4]?r[5]?"a":"button":"article")(e,Ce)},m(U,te){insert_hydration(U,e,te),append_hydration(e,t),append_hydration(e,n),append_hydration(e,o),append_hydration(e,u),$&&$.m(e,null),append_hydration(e,d),append_hydration(e,h),P&&P.m(h,null),append_hydration(h,p),ee&&ee.m(h,null),append_hydration(e,E),append_hydration(e,k),append_hydration(k,L),mount_component(S,L,null),append_hydration(k,N),append_hydration(k,w),mount_component(b,w,null),append_hydration(k,_),append_hydration(k,C),K&&K.m(C,null),I=!0,F||(fe=[listen(e,"click",r[10]),listen(e,"contextmenu",r[11])],F=!0)},p(U,te){(!I||te&64)&&toggle_class(t,"opacity-100",U[6]===!0),(!I||te&20&&a!==(a="pointer-events-none absolute inset-0 z-0 bg-highlight opacity-0 "+(U[4]?"group-hover:opacity-30 "+(U[2]?"dark:group-hover:opacity-50":"dark:group-hover:opacity-10"):"")))&&attr(o,"class",a),U[7].before?$?($.p(U,te),te&128&&transition_in($,1)):($=create_if_block_1$1(U),$.c(),transition_in($,1),$.m(e,d)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros()),P&&P.p&&(!I||te&256)&&update_slot_base(P,H,U,U[8],I?get_slot_changes(H,U[8],te,null):get_all_dirty_from_scope(U[8]),null),U[2]&&(U[1]||U[0])?ee||(ee=create_if_block$2(),ee.c(),ee.m(h,null)):ee&&(ee.d(1),ee=null),(!I||te&11&&m!==(m="z-10 grid w-full grid-cols-1 items-baseline overflow-hidden contain-inline-size "+(U[1]||U[0]?"justify-start gap-0.5":"place-items-center justify-center gap-2")+" "+((U[1]||U[0])&&U[3]?"lg:auto-cols-fr lg:grid-flow-col lg:gap-4":"")))&&attr(h,"class",m),(!I||te&64)&&toggle_class(L,"opacity-100",U[6]),(!I||te&64)&&toggle_class(w,"scale-100",U[6]===!0),K&&K.p&&(!I||te&256)&&update_slot_base(K,le,U,U[8],I?get_slot_changes(le,U[8],te,get_after_slot_changes):get_all_dirty_from_scope(U[8]),get_after_slot_context),(!I||te&64)&&toggle_class(C,"opacity-100",!U[6]),set_dynamic_element_data(U[4]?U[5]?"a":"button":"article")(e,Ce=get_spread_update(ye,[(!I||te&32&&A!==(A=U[5]?"link":"button"))&&{role:A},{tabindex:"0"},(!I||te&32)&&{href:U[5]},{draggable:"false"},(!I||te&23&&j!==(j="group relative z-10 flex w-full items-center gap-4 overflow-hidden px-4 outline-2 -outline-offset-2 outline-primary-600 contain-inline-size focus-visible:outline "+(U[4]?"cursor-pointer touch-manipulation select-none "+(U[2]?"":"transition-transform active:scale-95"):"")+" "+(U[0]?"focus-visible:z-50":U[1]?"rounded-lg py-1 focus-visible:z-50":"rounded-2xl py-4")+" "+(U[2]?"bg-surface":"bg-surface-100 shadow-[0_0_20px_-4px] shadow-black/20 dark:shadow-none")))&&{class:j}]))},i(U){I||(transition_in($),transition_in(P,U),transition_in(S.$$.fragment,U),transition_in(b.$$.fragment,U),transition_in(K,U),I=!0)},o(U){transition_out($),transition_out(P,U),transition_out(S.$$.fragment,U),transition_out(b.$$.fragment,U),transition_out(K,U),I=!1},d(U){U&&detach(e),$&&$.d(),P&&P.d(U),ee&&ee.d(),destroy_component(S),destroy_component(b),K&&K.d(U),F=!1,run_all(fe)}}}function create_fragment$3(r){let e=r[4]?r[5]?"a":"button":"article",t,n,o=(r[4]?r[5]?"a":"button":"article")&&create_dynamic_element(r);return{c(){o&&o.c(),t=empty$1()},l(a){o&&o.l(a),t=empty$1()},m(a,u){o&&o.m(a,u),insert_hydration(a,t,u),n=!0},p(a,[u]){!a[4]||a[5],e?safe_not_equal(e,a[4]?a[5]?"a":"button":"article")?(o.d(1),o=create_dynamic_element(a),e=a[4]?a[5]?"a":"button":"article",o.c(),o.m(t.parentNode,t)):o.p(a,u):(o=create_dynamic_element(a),e=a[4]?a[5]?"a":"button":"article",o.c(),o.m(t.parentNode,t))},i(a){n||(transition_in(o,a),n=!0)},o(a){transition_out(o,a),n=!1},d(a){a&&detach(t),o&&o.d(a)}}}function instance$4(r,e,t){let{$$slots:n={},$$scope:o}=e;const a=compute_slots(n);let{xs:u=!1}=e,{sm:d=!1}=e,{flat:h=!1}=e,{flow:p=!1}=e,{interactive:m=!1}=e,{href:E=void 0}=e,{selected:k=!1}=e;function L(N){bubble.call(this,r,N)}function S(N){bubble.call(this,r,N)}return r.$$set=N=>{"xs"in N&&t(0,u=N.xs),"sm"in N&&t(1,d=N.sm),"flat"in N&&t(2,h=N.flat),"flow"in N&&t(3,p=N.flow),"interactive"in N&&t(4,m=N.interactive),"href"in N&&t(5,E=N.href),"selected"in N&&t(6,k=N.selected),"$$scope"in N&&t(8,o=N.$$scope)},[u,d,h,p,m,E,k,a,o,n,L,S]}class Card extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$4,create_fragment$3,safe_not_equal,{xs:0,sm:1,flat:2,flow:3,interactive:4,href:5,selected:6})}}function create_fragment$2(r){let e,t,n;const o=r[6].default,a=create_slot(o,r,r[5],null);return{c(){e=element("span"),a&&a.c(),this.h()},l(u){e=claim_element(u,"SPAN",{class:!0});var d=children(e);a&&a.l(d),d.forEach(detach),this.h()},h(){attr(e,"class",t="w-max max-w-full overflow-hidden text-ellipsis whitespace-nowrap rounded-md text-left [&>*]:align-bottom "+(r[1]?"animate-pulse bg-highlight text-transparent":"")+" "+(r[2]?"font-medium":"font-normal")),toggle_class(e,"text-content-200",r[0]),toggle_class(e,"ml-4",r[3]),toggle_class(e,"text-sm",r[4])},m(u,d){insert_hydration(u,e,d),a&&a.m(e,null),n=!0},p(u,[d]){a&&a.p&&(!n||d&32)&&update_slot_base(a,o,u,u[5],n?get_slot_changes(o,u[5],d,null):get_all_dirty_from_scope(u[5]),null),(!n||d&6&&t!==(t="w-max max-w-full overflow-hidden text-ellipsis whitespace-nowrap rounded-md text-left [&>*]:align-bottom "+(u[1]?"animate-pulse bg-highlight text-transparent":"")+" "+(u[2]?"font-medium":"font-normal")))&&attr(e,"class",t),(!n||d&7)&&toggle_class(e,"text-content-200",u[0]),(!n||d&14)&&toggle_class(e,"ml-4",u[3]),(!n||d&22)&&toggle_class(e,"text-sm",u[4])},i(u){n||(transition_in(a,u),n=!0)},o(u){transition_out(a,u),n=!1},d(u){u&&detach(e),a&&a.d(u)}}}function instance$3(r,e,t){let{$$slots:n={},$$scope:o}=e,{secondary:a=!1}=e,{loading:u=!1}=e,{accent:d=!1}=e,{indent:h=!1}=e,{sm:p=!1}=e;return r.$$set=m=>{"secondary"in m&&t(0,a=m.secondary),"loading"in m&&t(1,u=m.loading),"accent"in m&&t(2,d=m.accent),"indent"in m&&t(3,h=m.indent),"sm"in m&&t(4,p=m.sm),"$$scope"in m&&t(5,o=m.$$scope)},[a,u,d,h,p,o,n]}class Text extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$3,create_fragment$2,safe_not_equal,{secondary:0,loading:1,accent:2,indent:3,sm:4})}}function create_if_block_1(r){let e;const t=r[7].default,n=create_slot(t,r,r[6],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,a){n&&n.p&&(!e||a&64)&&update_slot_base(n,t,o,o[6],e?get_slot_changes(t,o[6],a,null):get_all_dirty_from_scope(o[6]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_if_block$1(r){let e,t,n,o,a,u;return{c(){e=element("img"),this.h()},l(d){e=claim_element(d,"IMG",{alt:!0,src:!0,class:!0,loading:!0,width:!0,height:!0,draggable:!0}),this.h()},h(){attr(e,"alt",r[3]),src_url_equal(e.src,t=r[2]<100/devicePixelRatio?r[0]:r[1])||attr(e,"src",t),attr(e,"class","opacity-0 transition-opacity duration-500"),attr(e,"loading","lazy"),attr(e,"width",n=r[2]+"px"),attr(e,"height",o=r[2]+"px"),attr(e,"draggable","false"),toggle_class(e,"opacity-100",r[5]==="ok")},m(d,h){insert_hydration(d,e,h),r[8](e),a||(u=[listen(e,"load",r[9]),listen(e,"error",r[10])],a=!0)},p(d,h){h&8&&attr(e,"alt",d[3]),h&7&&!src_url_equal(e.src,t=d[2]<100/devicePixelRatio?d[0]:d[1])&&attr(e,"src",t),h&4&&n!==(n=d[2]+"px")&&attr(e,"width",n),h&4&&o!==(o=d[2]+"px")&&attr(e,"height",o),h&32&&toggle_class(e,"opacity-100",d[5]==="ok")},i:noop$2,o:noop$2,d(d){d&&detach(e),r[8](null),a=!1,run_all(u)}}}function create_fragment$1(r){let e,t,n,o,a=`${r[2]}px`,u=`${r[2]}px`,d;const h=[create_if_block$1,create_if_block_1],p=[];function m(E,k){return E[1]&&E[5]!=="error"?0:E[5]==="error"?1:-1}return~(t=m(r))&&(n=p[t]=h[t](r)),{c(){e=element("div"),n&&n.c(),this.h()},l(E){e=claim_element(E,"DIV",{class:!0});var k=children(e);n&&n.l(k),k.forEach(detach),this.h()},h(){attr(e,"class",o="overflow-hidden "+(r[2]>200?"rounded-2xl":"rounded")+" bg-highlight-100"),toggle_class(e,"animate-pulse",r[5]==="loading"),set_style(e,"height",a),set_style(e,"width",u)},m(E,k){insert_hydration(E,e,k),~t&&p[t].m(e,null),d=!0},p(E,[k]){let L=t;t=m(E),t===L?~t&&p[t].p(E,k):(n&&(group_outros(),transition_out(p[L],1,1,()=>{p[L]=null}),check_outros()),~t?(n=p[t],n?n.p(E,k):(n=p[t]=h[t](E),n.c()),transition_in(n,1),n.m(e,null)):n=null),(!d||k&4&&o!==(o="overflow-hidden "+(E[2]>200?"rounded-2xl":"rounded")+" bg-highlight-100"))&&attr(e,"class",o),(!d||k&36)&&toggle_class(e,"animate-pulse",E[5]==="loading"),k&4&&a!==(a=`${E[2]}px`)&&set_style(e,"height",a),k&4&&u!==(u=`${E[2]}px`)&&set_style(e,"width",u)},i(E){d||(transition_in(n),d=!0)},o(E){transition_out(n),d=!1},d(E){E&&detach(e),~t&&p[t].d()}}}function instance$2(r,e,t){let n,{$$slots:o={},$$scope:a}=e,{thumbnail:u=void 0}=e,{src:d=void 0}=e,{size:h=48}=e,{alt:p=""}=e,m;onMount(()=>(m!=null&&m.complete&&t(4,m.style.opacity="1",m),!1));function E(S){binding_callbacks[S?"unshift":"push"](()=>{m=S,t(4,m)})}const k=()=>t(5,n="ok"),L=()=>t(5,n="error");return r.$$set=S=>{"thumbnail"in S&&t(0,u=S.thumbnail),"src"in S&&t(1,d=S.src),"size"in S&&t(2,h=S.size),"alt"in S&&t(3,p=S.alt),"$$scope"in S&&t(6,a=S.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(5,n=d===""||d===null?"error":"loading")},[u,d,h,p,m,n,a,o,E,k,L]}class Image extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$2,create_fragment$1,safe_not_equal,{thumbnail:0,src:1,size:2,alt:3})}}function capitalize(r,e=!0){return r&&(e?r.replace(/\b\w/g,t=>t.toUpperCase()):r.replace(/\b\w/,t=>t.toUpperCase()))}function clean(r){return r.normalize().trim().toLowerCase().replace(/\s+/g," ")}const __vite_glob_0_0=`CREATE TRIGGER IF NOT EXISTS cascade_playlists_library
AFTER DELETE ON playlists
FOR EACH ROW
BEGIN
  DELETE FROM library WHERE playlist = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_library_tracks
AFTER DELETE ON library
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM library 
    WHERE track = OLD.track 
  UNION ALL SELECT 1 FROM playback
    WHERE track = OLD.track
  LIMIT 1
)
BEGIN
  DELETE FROM tracks WHERE id = OLD.track;
END;

CREATE TRIGGER IF NOT EXISTS cascade_playback_tracks
AFTER DELETE ON playback
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM library
    WHERE track = OLD.track
  UNION ALL SELECT 1 FROM playback
    WHERE track = OLD.track
  LIMIT 1
)
BEGIN
  DELETE FROM tracks WHERE id = OLD.track;
END;

CREATE TRIGGER IF NOT EXISTS cascade_tracks_albums
AFTER DELETE ON tracks
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM tracks WHERE album = OLD.album LIMIT 1
)
BEGIN
  DELETE FROM albums WHERE id = OLD.album;
END;

CREATE TRIGGER IF NOT EXISTS cascade_albums_attribution
AFTER DELETE ON albums
FOR EACH ROW
BEGIN
  DELETE FROM attribution WHERE album = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_attribution_artists
AFTER DELETE ON attribution
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM attribution
    WHERE artist = OLD.artist
)
BEGIN
  DELETE FROM artists WHERE id = OLD.artist;
END;

CREATE TRIGGER IF NOT EXISTS cascade_tracks_resources
AFTER DELETE ON tracks
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_albums_resources
AFTER DELETE ON albums
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
  DELETE FROM assets WHERE owner = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_artists_resources
AFTER DELETE ON artists
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
  DELETE FROM assets WHERE owner = OLD.id;
END;
`,__vite_glob_0_1=`CREATE VIRTUAL TABLE IF NOT EXISTS tracks_fts USING fts5 (
  title,
  album,
  artists,
  content='',
  tokenize='trigram'
);

CREATE VIRTUAL TABLE IF NOT EXISTS albums_fts USING fts5 (
  title,
  artists,
  content='',
  tokenize='trigram'
);

CREATE VIRTUAL TABLE IF NOT EXISTS artists_fts USING fts5 (
  title,
  content='',
  tokenize='trigram'
);

---------------------------- Artists Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_artists_insert AFTER INSERT ON artists BEGIN
  -- Update artists index
  INSERT INTO artists_fts(rowid,title) VALUES (NEW.id, NEW.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title,
      CASE WHEN EXISTS (SELECT 1 FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id) THEN albums.title ELSE NULL END,
      (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS fts_artists_update AFTER UPDATE OF title ON artists WHEN (OLD.title IS NOT NEW.title) BEGIN
  -- Update artists index
  INSERT INTO artists_fts(artists_fts,rowid,title) VALUES ('delete', OLD.id, OLD.title);
  INSERT INTO artists_fts(rowid,title) VALUES (NEW.id, NEW.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(CASE WHEN artists.id = OLD.id THEN OLD.title ELSE title END) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = OLD.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(CASE WHEN artists.id = OLD.id THEN OLD.title ELSE title END) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = OLD.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS fts_artists_delete BEFORE DELETE ON artists BEGIN
  -- Update artists index
  INSERT INTO artists_fts(artists_fts,rowid,title) VALUES ('delete', OLD.id, OLD.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = OLD.id;
END;

---------------------------- Albums Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_albums_insert AFTER INSERT ON albums BEGIN
  -- Update albums index
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT NEW.id, NEW.title, group_concat(artists.title)
    FROM attribution
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE attribution.album = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, NULL, NULL
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS albums_fts_update AFTER UPDATE OF title ON albums WHEN (OLD.title IS NOT NEW.title) BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', OLD.id, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
    WHERE attribution.album = OLD.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT NEW.id, NEW.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
    WHERE attribution.album = OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = OLD.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, NEW.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS albums_fts_delete BEFORE DELETE ON albums BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', OLD.id, OLD.title, group_concat(artists.title)
    FROM attribution
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE attribution.album = OLD.id
    GROUP BY OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = OLD.id;
END;

---------------------------- Attribution Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_attribution_insert AFTER INSERT ON attribution
  WHEN EXISTS (SELECT 1 FROM artists WHERE id = NEW.artist) AND EXISTS (SELECT 1 FROM albums WHERE id = NEW.album)
BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, NULL, NULL
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT  tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
END;

CREATE TRIGGER IF NOT EXISTS fts_attribution_delete BEFORE DELETE ON attribution BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = OLD.album AND attribution.artist = OLD.artist;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = OLD.album AND attribution.artist = OLD.artist;
END;

---------------------------- Tracks Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_tracks_insert AFTER INSERT ON tracks BEGIN
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT NEW.id, NEW.title, albums.title, group_concat(artists.title)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE albums.id = NEW.album;
END;

CREATE TRIGGER IF NOT EXISTS fts_tracks_update AFTER UPDATE OF title ON tracks WHEN (OLD.title IS NOT NEW.title) BEGIN
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', OLD.id, OLD.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
    WHERE albums.id = OLD.album;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT NEW.id, NEW.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
    WHERE albums.id = NEW.album;
END;

CREATE TRIGGER IF NOT EXISTS fts_tracks_delete BEFORE DELETE ON tracks BEGIN
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', OLD.id, OLD.title, albums.title, group_concat(artists.title)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE albums.id = OLD.album
    GROUP BY OLD.id;
END;`,__vite_glob_0_2=`INSERT OR IGNORE INTO devices VALUES (crsql_site_id(), -1, 0, 0, 0, 0);

CREATE VIEW IF NOT EXISTS queue AS
  WITH ordered AS
    (SELECT playback.*, row_number() OVER (
      ORDER BY
        CASE WHEN "direction" != 1 THEN "order" ELSE NULL END ASC,
        CASE WHEN "direction" = 1 THEN "order" ELSE NULL END DESC,
        CASE WHEN "direction" != 1 THEN "playback"."id" ELSE NULL END ASC,
        CASE WHEN "direction" = 1 THEN "playback"."id" ELSE NULL END DESC
    ) as position FROM devices INNER JOIN playback ON playback.device = devices.id
    WHERE devices.id = crsql_site_id())
  SELECT id, device, track, 
    (position - 
      (SELECT position FROM ordered WHERE id = (SELECT playback FROM devices WHERE id = device))
    ) as position
  FROM ordered;

CREATE TRIGGER IF NOT EXISTS playback_started
BEFORE INSERT ON playback
FOR EACH ROW
WHEN NEW.device = crsql_site_id()
BEGIN
  UPDATE devices SET playback = NEW.id WHERE id = NEW.device AND playback IS -1;
END;

CREATE TRIGGER IF NOT EXISTS playback_finised
BEFORE UPDATE OF progress ON devices
FOR EACH ROW
WHEN NEW.progress >= 1 AND NEW.id = crsql_site_id()
BEGIN
  INSERT INTO library SELECT ABS(RANDOM() % 4294967296), -1, track, UNIXEPOCH(), -1 FROM playback WHERE id = NEW.playback;
  UPDATE devices SET 
    playback = CASE WHEN NEW.repeat = 2 AND NOT EXISTS (SELECT 1 FROM queue WHERE position > 0)
      THEN IFNULL((SELECT id FROM queue LIMIT 1), playback)
      WHEN NEW.repeat = 1 THEN playback
      ELSE IFNULL((SELECT id FROM queue WHERE position = 1), playback)
    END,
    progress = 0
  WHERE id = NEW.id;
  SELECT RAISE(IGNORE);
END;

CREATE TRIGGER IF NOT EXISTS playback_backtracked
BEFORE UPDATE OF progress ON devices
FOR EACH ROW
WHEN NEW.progress < 0 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE devices SET 
    playback = IFNULL((SELECT id FROM queue WHERE position = -1), playback),
    progress = 0
  WHERE id = NEW.id;
  SELECT RAISE(IGNORE);
END;

CREATE TRIGGER IF NOT EXISTS playback_shuffled
AFTER UPDATE OF direction ON devices
FOR EACH ROW
WHEN NEW.direction = 2 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE playback SET "temp"="order" WHERE
    (SELECT id FROM queue WHERE position = 0) != id AND device = NEW.id;
  UPDATE playback SET
    "order"=(SELECT "order" FROM playback WHERE "temp" IS NULL)||trim(hex(randomblob(2)),'0')
  WHERE "temp" IS NOT NULL;
END;

CREATE TRIGGER IF NOT EXISTS playback_unshuffled
AFTER UPDATE OF direction ON devices
FOR EACH ROW
WHEN OLD.direction = 2 AND NEW.direction != 2 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE playback SET
    "order"="temp",
    "temp"=NULL
  WHERE "temp" IS NOT NULL AND device = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS playback_purged
BEFORE DELETE ON playback
FOR EACH ROW
WHEN (OLD.id = (SELECT playback FROM devices WHERE id = crsql_site_id()))
BEGIN
  UPDATE devices SET 
    playback = (SELECT id FROM queue WHERE position = 1),
    progress = 0
  WHERE id = OLD.device;
END;`,__vite_glob_0_3=`INSERT OR IGNORE INTO playlists (id, title, "order", relevancy, shared, remote) VALUES
  (-1, 'Listened', 1, 0, NULL, NULL),
  (-2, 'Recommended', 1, -1, NULL, NULL),
  (-3, 'Blocked', 1, -1, NULL, NULL),
  (-4, 'Followed', 1, 0, NULL, NULL);`,types={boolean:"?",number:"+",string:"'",object:"&",bigint:"^",null:"!","?":"boolean","+":"number","'":"string","^":"bigint","&":"object","!":"null"},encoders={any:r=>{var e;return typeof r in types&&r!=null?types[typeof r]+((e=encoders[typeof r])==null?void 0:e.call(encoders,r))||r.toString():"!"},object:r=>btoa(String.fromCharCode.apply(null,r)),number:r=>r.toString(),string:r=>r.replaceAll(",",",,").replaceAll("*","**"),bigint:r=>r.toString(),boolean:r=>(+r).toString()},decoders={any:r=>{var e;return(e=decoders[types[r[0]]])==null?void 0:e.call(decoders,r.slice(1))},object:r=>Uint8Array.from([...atob(r)].map(e=>e.charCodeAt(0))),number:r=>parseFloat(r),string:r=>r.replaceAll(",,",",").replaceAll("**","*"),bigint:r=>BigInt(r),boolean:r=>!!+r,null:()=>null};function encode$1(r,e){var o;const t=[],n={};for(const a of r)for(const[u,d]of e){const h=encoders[d](a[u]);if(((o=n[u])==null?void 0:o[0])!==h){const p=[h,1];t.push(p),n[u]=p}else n[u][1]+=1}return t.map(([a,u])=>(u>1?"*"+String.fromCharCode(u+43):",")+a).join("")}function decode$1(r,e){const t=[];for(let u=0;u<r.length;){let d=u-1;do d=[",","*"].map(m=>r.indexOf(m,d+2)).filter(m=>~m).reduce((m,E)=>Math.min(m,E),1/0);while(r[d+1]===r[d]&&d!==1/0);let h=r.slice(u,d);const p=h[0]===",";t.push([h.slice(p?1:2),p?1:h.charCodeAt(1)-43]),u=d}const n=t.slice(0,e.length),o=[];let a=e.length;e:for(;;){const u={};for(let d=0;d<e.length;d++){if(!n[d])break e;const[h,p]=e[d];u[h]=decoders[p](n[d][0]),n[d][1]-=1,n[d][1]||(n[d]=t[a++])}o.push(u)}return o}function chunk(r,{size:e=1e3,strict:t=!0}={}){var o;if(r.length<=e)return[r];const n=[];for(let a=0;a<r.length;){const u=r[a].db_version,d=(o=r[a+e])==null?void 0:o.db_version,h=m=>m.db_version===d;let p=1/0;u===d?t?p=a+e:p=r.findLastIndex(h,a+e)+1:d!=null&&(p=r.findIndex(h,a)),n.push(r.slice(a,p)),a=p}return n}function isUndefined(r){return typeof r>"u"||r===void 0}function isString(r){return typeof r=="string"}function isNumber(r){return typeof r=="number"}function isBoolean(r){return typeof r=="boolean"}function isNull(r){return r===null}function isDate(r){return r instanceof Date}function isBigInt(r){return typeof r=="bigint"}function isFunction(r){return typeof r=="function"}function isObject$3(r){return typeof r=="object"&&r!==null}function freeze(r){return Object.freeze(r)}function asArray(r){return isReadonlyArray(r)?r:[r]}function isReadonlyArray(r){return Array.isArray(r)}function noop$1(r){return r}const AlterTableNode=freeze({is(r){return r.kind==="AlterTableNode"},create(r){return freeze({kind:"AlterTableNode",table:r})},cloneWithTableProps(r,e){return freeze({...r,...e})},cloneWithColumnAlteration(r,e){return freeze({...r,columnAlterations:r.columnAlterations?[...r.columnAlterations,e]:[e]})}}),IdentifierNode=freeze({is(r){return r.kind==="IdentifierNode"},create(r){return freeze({kind:"IdentifierNode",name:r})}}),CreateIndexNode=freeze({is(r){return r.kind==="CreateIndexNode"},create(r){return freeze({kind:"CreateIndexNode",name:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})},cloneWithColumns(r,e){return freeze({...r,columns:[...r.columns||[],...e]})}}),CreateSchemaNode=freeze({is(r){return r.kind==="CreateSchemaNode"},create(r,e){return freeze({kind:"CreateSchemaNode",schema:IdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),ON_COMMIT_ACTIONS=["preserve rows","delete rows","drop"],CreateTableNode=freeze({is(r){return r.kind==="CreateTableNode"},create(r){return freeze({kind:"CreateTableNode",table:r,columns:freeze([])})},cloneWithColumn(r,e){return freeze({...r,columns:freeze([...r.columns,e])})},cloneWithConstraint(r,e){return freeze({...r,constraints:r.constraints?freeze([...r.constraints,e]):freeze([e])})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):freeze([e])})},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):freeze([e])})},cloneWith(r,e){return freeze({...r,...e})}}),SchemableIdentifierNode=freeze({is(r){return r.kind==="SchemableIdentifierNode"},create(r){return freeze({kind:"SchemableIdentifierNode",identifier:IdentifierNode.create(r)})},createWithSchema(r,e){return freeze({kind:"SchemableIdentifierNode",schema:IdentifierNode.create(r),identifier:IdentifierNode.create(e)})}}),DropIndexNode=freeze({is(r){return r.kind==="DropIndexNode"},create(r,e){return freeze({kind:"DropIndexNode",name:SchemableIdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),DropSchemaNode=freeze({is(r){return r.kind==="DropSchemaNode"},create(r,e){return freeze({kind:"DropSchemaNode",schema:IdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),DropTableNode=freeze({is(r){return r.kind==="DropTableNode"},create(r,e){return freeze({kind:"DropTableNode",table:r,...e})},cloneWith(r,e){return freeze({...r,...e})}}),AliasNode=freeze({is(r){return r.kind==="AliasNode"},create(r,e){return freeze({kind:"AliasNode",node:r,alias:e})}}),TableNode=freeze({is(r){return r.kind==="TableNode"},create(r){return freeze({kind:"TableNode",table:SchemableIdentifierNode.create(r)})},createWithSchema(r,e){return freeze({kind:"TableNode",table:SchemableIdentifierNode.createWithSchema(r,e)})}});function isOperationNodeSource(r){return isObject$3(r)&&isFunction(r.toOperationNode)}function isExpression(r){return isObject$3(r)&&"expressionType"in r&&isOperationNodeSource(r)}function isAliasedExpression(r){return isObject$3(r)&&"expression"in r&&isString(r.alias)&&isOperationNodeSource(r)}const SelectModifierNode=freeze({is(r){return r.kind==="SelectModifierNode"},create(r,e){return freeze({kind:"SelectModifierNode",modifier:r,of:e})},createWithExpression(r){return freeze({kind:"SelectModifierNode",rawModifier:r})}}),AndNode=freeze({is(r){return r.kind==="AndNode"},create(r,e){return freeze({kind:"AndNode",left:r,right:e})}}),OrNode=freeze({is(r){return r.kind==="OrNode"},create(r,e){return freeze({kind:"OrNode",left:r,right:e})}}),OnNode=freeze({is(r){return r.kind==="OnNode"},create(r){return freeze({kind:"OnNode",on:r})},cloneWithOperation(r,e,t){return freeze({...r,on:e==="And"?AndNode.create(r.on,t):OrNode.create(r.on,t)})}}),JoinNode=freeze({is(r){return r.kind==="JoinNode"},create(r,e){return freeze({kind:"JoinNode",joinType:r,table:e,on:void 0})},createWithOn(r,e,t){return freeze({kind:"JoinNode",joinType:r,table:e,on:OnNode.create(t)})},cloneWithOn(r,e){return freeze({...r,on:r.on?OnNode.cloneWithOperation(r.on,"And",e):OnNode.create(e)})}}),BinaryOperationNode=freeze({is(r){return r.kind==="BinaryOperationNode"},create(r,e,t){return freeze({kind:"BinaryOperationNode",leftOperand:r,operator:e,rightOperand:t})}}),COMPARISON_OPERATORS=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],ARITHMETIC_OPERATORS=["+","-","*","/","%","^","&","|","#","<<",">>"],JSON_OPERATORS=["->","->>"],BINARY_OPERATORS=[...COMPARISON_OPERATORS,...ARITHMETIC_OPERATORS,"&&","||"],UNARY_FILTER_OPERATORS=["exists","not exists"],UNARY_OPERATORS=["not","-",...UNARY_FILTER_OPERATORS],OPERATORS=[...BINARY_OPERATORS,...JSON_OPERATORS,...UNARY_OPERATORS,"between","between symmetric"],OperatorNode=freeze({is(r){return r.kind==="OperatorNode"},create(r){return freeze({kind:"OperatorNode",operator:r})}});function isJSONOperator(r){return isString(r)&&JSON_OPERATORS.includes(r)}const ColumnNode=freeze({is(r){return r.kind==="ColumnNode"},create(r){return freeze({kind:"ColumnNode",column:IdentifierNode.create(r)})}}),SelectAllNode=freeze({is(r){return r.kind==="SelectAllNode"},create(){return freeze({kind:"SelectAllNode"})}}),ReferenceNode=freeze({is(r){return r.kind==="ReferenceNode"},create(r,e){return freeze({kind:"ReferenceNode",table:e,column:r})},createSelectAll(r){return freeze({kind:"ReferenceNode",table:r,column:SelectAllNode.create()})}});var Wr;class DynamicReferenceBuilder{constructor(e){g(this,Wr,void 0);x(this,Wr,e)}get dynamicReference(){return i(this,Wr)}get refType(){}toOperationNode(){return parseSimpleReferenceExpression(i(this,Wr))}}Wr=new WeakMap;function isDynamicReferenceBuilder(r){return isObject$3(r)&&isOperationNodeSource(r)&&isString(r.dynamicReference)}const OrderByItemNode=freeze({is(r){return r.kind==="OrderByItemNode"},create(r,e){return freeze({kind:"OrderByItemNode",orderBy:r,direction:e})}}),RawNode=freeze({is(r){return r.kind==="RawNode"},create(r,e){return freeze({kind:"RawNode",sqlFragments:freeze(r),parameters:freeze(e)})},createWithSql(r){return RawNode.create([r],[])},createWithChild(r){return RawNode.create(["",""],[r])},createWithChildren(r){return RawNode.create(new Array(r.length+1).fill(""),r)}});function isOrderByDirection(r){return r==="asc"||r==="desc"}function parseOrderBy(r){if(r.length===2)return[parseOrderByItem(r[0],r[1])];if(r.length===1){const[e]=r;return Array.isArray(e)?e.map(t=>parseOrderByItem(t)):[parseOrderByItem(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${r.length}`)}function parseOrderByItem(r,e){const t=parseOrderByExpression(r);if(OrderByItemNode.is(t)){if(e)throw new Error("Cannot specify direction twice!");return t}return OrderByItemNode.create(t,parseOrderByDirectionExpression(e))}function parseOrderByExpression(r){if(isExpressionOrFactory(r))return parseExpression(r);if(isDynamicReferenceBuilder(r))return r.toOperationNode();const[e,t]=r.split(" ");if(t){if(!isOrderByDirection(t))throw new Error(`Invalid order by direction: ${t}`);return OrderByItemNode.create(parseStringReference(e),parseOrderByDirectionExpression(t))}return parseStringReference(r)}function parseOrderByDirectionExpression(r){if(r)return r==="asc"||r==="desc"?RawNode.createWithSql(r):r.toOperationNode()}const JSONReferenceNode=freeze({is(r){return r.kind==="JSONReferenceNode"},create(r,e){return freeze({kind:"JSONReferenceNode",reference:r,traversal:e})},cloneWithTraversal(r,e){return freeze({...r,traversal:e})}}),JSONOperatorChainNode=freeze({is(r){return r.kind==="JSONOperatorChainNode"},create(r){return freeze({kind:"JSONOperatorChainNode",operator:r,values:freeze([])})},cloneWithValue(r,e){return freeze({...r,values:freeze([...r.values,e])})}}),JSONPathNode=freeze({is(r){return r.kind==="JSONPathNode"},create(r){return freeze({kind:"JSONPathNode",inOperator:r,pathLegs:freeze([])})},cloneWithLeg(r,e){return freeze({...r,pathLegs:freeze([...r.pathLegs,e])})}});function parseSimpleReferenceExpression(r){return isString(r)?parseStringReference(r):r.toOperationNode()}function parseReferenceExpressionOrList(r){return isReadonlyArray(r)?r.map(e=>parseReferenceExpression(e)):[parseReferenceExpression(r)]}function parseReferenceExpression(r){return isExpressionOrFactory(r)?parseExpression(r):parseSimpleReferenceExpression(r)}function parseJSONReference(r,e){const t=parseStringReference(r);if(isJSONOperator(e))return JSONReferenceNode.create(t,JSONOperatorChainNode.create(OperatorNode.create(e)));const n=e.slice(0,-1);if(isJSONOperator(n))return JSONReferenceNode.create(t,JSONPathNode.create(OperatorNode.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function parseStringReference(r){const e=".";if(!r.includes(e))return ReferenceNode.create(ColumnNode.create(r));const t=r.split(e).map(trim$2);if(t.length===3)return parseStringReferenceWithTableAndSchema(t);if(t.length===2)return parseStringReferenceWithTable(t);throw new Error(`invalid column reference ${r}`)}function parseAliasedStringReference(r){const e=" as ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$2);return AliasNode.create(parseStringReference(t),IdentifierNode.create(n))}else return parseStringReference(r)}function parseColumnName(r){return ColumnNode.create(r)}function parseOrderedColumnName(r){const e=" ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$2);if(!isOrderByDirection(n))throw new Error(`invalid order direction "${n}" next to "${t}"`);return parseOrderBy([t,n])[0]}else return parseColumnName(r)}function parseStringReferenceWithTableAndSchema(r){const[e,t,n]=r;return ReferenceNode.create(ColumnNode.create(n),TableNode.createWithSchema(e,t))}function parseStringReferenceWithTable(r){const[e,t]=r;return ReferenceNode.create(ColumnNode.create(t),TableNode.create(e))}function trim$2(r){return r.trim()}const PrimitiveValueListNode=freeze({is(r){return r.kind==="PrimitiveValueListNode"},create(r){return freeze({kind:"PrimitiveValueListNode",values:freeze([...r])})}}),ValueListNode=freeze({is(r){return r.kind==="ValueListNode"},create(r){return freeze({kind:"ValueListNode",values:freeze(r)})}}),ValueNode=freeze({is(r){return r.kind==="ValueNode"},create(r){return freeze({kind:"ValueNode",value:r})},createImmediate(r){return freeze({kind:"ValueNode",value:r,immediate:!0})}});function parseValueExpressionOrList(r){return isReadonlyArray(r)?parseValueExpressionList(r):parseValueExpression(r)}function parseValueExpression(r){return isExpressionOrFactory(r)?parseExpression(r):ValueNode.create(r)}function isSafeImmediateValue(r){return isNumber(r)||isBoolean(r)||isNull(r)}function parseSafeImmediateValue(r){if(!isSafeImmediateValue(r))throw new Error(`unsafe immediate value ${JSON.stringify(r)}`);return ValueNode.createImmediate(r)}function parseValueExpressionList(r){return r.some(isExpressionOrFactory)?ValueListNode.create(r.map(e=>parseValueExpression(e))):PrimitiveValueListNode.create(r)}const ParensNode=freeze({is(r){return r.kind==="ParensNode"},create(r){return freeze({kind:"ParensNode",node:r})}});function parseValueBinaryOperationOrExpression(r){if(r.length===3)return parseValueBinaryOperation(r[0],r[1],r[2]);if(r.length===1)return parseValueExpression(r[0]);throw new Error(`invalid arguments: ${JSON.stringify(r)}`)}function parseValueBinaryOperation(r,e,t){return isIsOperator(e)&&needsIsOperator(t)?BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),ValueNode.createImmediate(t)):BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),parseValueExpressionOrList(t))}function parseReferentialBinaryOperation(r,e,t){return BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),parseReferenceExpression(t))}function parseFilterObject(r,e){return parseFilterList(Object.entries(r).filter(([,t])=>!isUndefined(t)).map(([t,n])=>parseValueBinaryOperation(t,needsIsOperator(n)?"is":"=",n)),e)}function parseFilterList(r,e){const t=e==="and"?AndNode.create:OrNode.create;if(r.length===0)return BinaryOperationNode.create(ValueNode.createImmediate(1),OperatorNode.create("="),ValueNode.createImmediate(e==="and"?1:0));let n=toOperationNode(r[0]);for(let o=1;o<r.length;++o)n=t(n,toOperationNode(r[o]));return r.length>1?ParensNode.create(n):n}function isIsOperator(r){return r==="is"||r==="is not"}function needsIsOperator(r){return isNull(r)||isBoolean(r)}function parseOperator(r){if(isString(r)&&OPERATORS.includes(r))return OperatorNode.create(r);if(isOperationNodeSource(r))return r.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(r)}`)}function toOperationNode(r){return isOperationNodeSource(r)?r.toOperationNode():r}const OrderByNode=freeze({is(r){return r.kind==="OrderByNode"},create(r){return freeze({kind:"OrderByNode",items:freeze([...r])})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),PartitionByNode=freeze({is(r){return r.kind==="PartitionByNode"},create(r){return freeze({kind:"PartitionByNode",items:freeze(r)})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),OverNode=freeze({is(r){return r.kind==="OverNode"},create(){return freeze({kind:"OverNode"})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithPartitionByItems(r,e){return freeze({...r,partitionBy:r.partitionBy?PartitionByNode.cloneWithItems(r.partitionBy,e):PartitionByNode.create(e)})}}),FromNode=freeze({is(r){return r.kind==="FromNode"},create(r){return freeze({kind:"FromNode",froms:freeze(r)})},cloneWithFroms(r,e){return freeze({...r,froms:freeze([...r.froms,...e])})}}),GroupByNode=freeze({is(r){return r.kind==="GroupByNode"},create(r){return freeze({kind:"GroupByNode",items:freeze(r)})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),HavingNode=freeze({is(r){return r.kind==="HavingNode"},create(r){return freeze({kind:"HavingNode",having:r})},cloneWithOperation(r,e,t){return freeze({...r,having:e==="And"?AndNode.create(r.having,t):OrNode.create(r.having,t)})}}),SelectQueryNode=freeze({is(r){return r.kind==="SelectQueryNode"},create(r){return freeze({kind:"SelectQueryNode",...r&&{with:r}})},createFrom(r,e){return freeze({kind:"SelectQueryNode",from:FromNode.create(r),...e&&{with:e}})},cloneWithSelections(r,e){return freeze({...r,selections:r.selections?freeze([...r.selections,...e]):freeze(e)})},cloneWithDistinctOn(r,e){return freeze({...r,distinctOn:r.distinctOn?freeze([...r.distinctOn,...e]):freeze(e)})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):freeze([e])})},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):freeze([e])})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithGroupByItems(r,e){return freeze({...r,groupBy:r.groupBy?GroupByNode.cloneWithItems(r.groupBy,e):GroupByNode.create(e)})},cloneWithLimit(r,e){return freeze({...r,limit:e})},cloneWithOffset(r,e){return freeze({...r,offset:e})},cloneWithHaving(r,e){return freeze({...r,having:r.having?HavingNode.cloneWithOperation(r.having,"And",e):HavingNode.create(e)})},cloneWithSetOperations(r,e){return freeze({...r,setOperations:r.setOperations?freeze([...r.setOperations,...e]):freeze([...e])})},cloneWithoutSelections(r){return freeze({...r,selections:[]})},cloneWithoutLimit(r){return freeze({...r,limit:void 0})},cloneWithoutOffset(r){return freeze({...r,offset:void 0})},cloneWithoutOrderBy(r){return freeze({...r,orderBy:void 0})}});function preventAwait(r,e){Object.defineProperties(r.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var Nt;const yn=class yn{constructor(e){g(this,Nt,void 0);x(this,Nt,freeze(e))}on(...e){return new yn({...i(this,Nt),joinNode:JoinNode.cloneWithOn(i(this,Nt).joinNode,parseValueBinaryOperationOrExpression(e))})}onRef(e,t,n){return new yn({...i(this,Nt),joinNode:JoinNode.cloneWithOn(i(this,Nt).joinNode,parseReferentialBinaryOperation(e,t,n))})}onTrue(){return new yn({...i(this,Nt),joinNode:JoinNode.cloneWithOn(i(this,Nt).joinNode,RawNode.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return i(this,Nt).joinNode}};Nt=new WeakMap;let JoinBuilder=yn;preventAwait(JoinBuilder,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const PartitionByItemNode=freeze({is(r){return r.kind==="PartitionByItemNode"},create(r){return freeze({kind:"PartitionByItemNode",partitionBy:r})}});function parsePartitionBy(r){return parseReferenceExpressionOrList(r).map(PartitionByItemNode.create)}var ur;const si=class si{constructor(e){g(this,ur,void 0);x(this,ur,freeze(e))}orderBy(e,t){return new si({overNode:OverNode.cloneWithOrderByItems(i(this,ur).overNode,parseOrderBy([e,t]))})}partitionBy(e){return new si({overNode:OverNode.cloneWithPartitionByItems(i(this,ur).overNode,parsePartitionBy(e))})}$call(e){return e(this)}toOperationNode(){return i(this,ur).overNode}};ur=new WeakMap;let OverBuilder=si;preventAwait(OverBuilder,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const SelectionNode=freeze({is(r){return r.kind==="SelectionNode"},create(r){return freeze({kind:"SelectionNode",selection:r})},createSelectAll(){return freeze({kind:"SelectionNode",selection:SelectAllNode.create()})},createSelectAllFromTable(r){return freeze({kind:"SelectionNode",selection:ReferenceNode.createSelectAll(r)})}});function parseSelectArg(r){return isFunction(r)?parseSelectArg(r(expressionBuilder())):isReadonlyArray(r)?r.map(e=>parseSelectExpression(e)):[parseSelectExpression(r)]}function parseSelectExpression(r){return isString(r)?SelectionNode.create(parseAliasedStringReference(r)):isDynamicReferenceBuilder(r)?SelectionNode.create(r.toOperationNode()):SelectionNode.create(parseAliasedExpression(r))}function parseSelectAll(r){return r?Array.isArray(r)?r.map(parseSelectAllArg):[parseSelectAllArg(r)]:[SelectionNode.createSelectAll()]}function parseSelectAllArg(r){if(isString(r))return SelectionNode.createSelectAllFromTable(parseTable(r));throw new Error(`invalid value selectAll expression: ${JSON.stringify(r)}`)}const ValuesNode=freeze({is(r){return r.kind==="ValuesNode"},create(r){return freeze({kind:"ValuesNode",values:freeze(r)})}}),DefaultInsertValueNode=freeze({is(r){return r.kind==="DefaultInsertValueNode"},create(){return freeze({kind:"DefaultInsertValueNode"})}});function parseInsertExpression(r){const e=isFunction(r)?r(expressionBuilder()):r,t=isReadonlyArray(e)?e:freeze([e]);return parseInsertColumnsAndValues(t)}function parseInsertColumnsAndValues(r){const e=parseColumnNamesAndIndexes(r);return[freeze([...e.keys()].map(ColumnNode.create)),ValuesNode.create(r.map(t=>parseRowValues(t,e)))]}function parseColumnNamesAndIndexes(r){const e=new Map;for(const t of r){const n=Object.keys(t);for(const o of n)!e.has(o)&&t[o]!==void 0&&e.set(o,e.size)}return e}function parseRowValues(r,e){const t=Object.keys(r),n=Array.from({length:e.size});let o=!1;for(const u of t){const d=e.get(u);if(isUndefined(d))continue;const h=r[u];(isUndefined(h)||isExpressionOrFactory(h))&&(o=!0),n[d]=h}if(t.length<e.size||o){const u=DefaultInsertValueNode.create();return ValueListNode.create(n.map(d=>isUndefined(d)?u:parseValueExpression(d)))}return PrimitiveValueListNode.create(n)}const InsertQueryNode=freeze({is(r){return r.kind==="InsertQueryNode"},create(r,e,t){return freeze({kind:"InsertQueryNode",into:r,...e&&{with:e},replace:t})},cloneWith(r,e){return freeze({...r,...e})}}),UpdateQueryNode=freeze({is(r){return r.kind==="UpdateQueryNode"},create(r,e){return freeze({kind:"UpdateQueryNode",table:r,...e&&{with:e}})},cloneWithFromItems(r,e){return freeze({...r,from:r.from?FromNode.cloneWithFroms(r.from,e):FromNode.create(e)})},cloneWithUpdates(r,e){return freeze({...r,updates:r.updates?freeze([...r.updates,...e]):e})}}),UsingNode=freeze({is(r){return r.kind==="UsingNode"},create(r){return freeze({kind:"UsingNode",tables:freeze(r)})},cloneWithTables(r,e){return freeze({...r,tables:freeze([...r.tables,...e])})}}),DeleteQueryNode=freeze({is(r){return r.kind==="DeleteQueryNode"},create(r,e){return freeze({kind:"DeleteQueryNode",from:FromNode.create(r),...e&&{with:e}})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithLimit(r,e){return freeze({...r,limit:e})},cloneWithUsing(r,e){return freeze({...r,using:r.using!==void 0?UsingNode.cloneWithTables(r.using,e):UsingNode.create(e)})}}),WhereNode=freeze({is(r){return r.kind==="WhereNode"},create(r){return freeze({kind:"WhereNode",where:r})},cloneWithOperation(r,e,t){return freeze({...r,where:e==="And"?AndNode.create(r.where,t):OrNode.create(r.where,t)})}}),ReturningNode=freeze({is(r){return r.kind==="ReturningNode"},create(r){return freeze({kind:"ReturningNode",selections:freeze(r)})},cloneWithSelections(r,e){return freeze({...r,selections:r.selections?freeze([...r.selections,...e]):freeze(e)})}}),ExplainNode=freeze({is(r){return r.kind==="ExplainNode"},create(r,e){return freeze({kind:"ExplainNode",format:r,options:e})}}),QueryNode=freeze({is(r){return SelectQueryNode.is(r)||InsertQueryNode.is(r)||UpdateQueryNode.is(r)||DeleteQueryNode.is(r)},cloneWithWhere(r,e){return freeze({...r,where:r.where?WhereNode.cloneWithOperation(r.where,"And",e):WhereNode.create(e)})},cloneWithJoin(r,e){return freeze({...r,joins:r.joins?freeze([...r.joins,e]):freeze([e])})},cloneWithReturning(r,e){return freeze({...r,returning:r.returning?ReturningNode.cloneWithSelections(r.returning,e):ReturningNode.create(e)})},cloneWithoutWhere(r){return freeze({...r,where:void 0})},cloneWithExplain(r,e,t){return freeze({...r,explain:ExplainNode.create(e,t==null?void 0:t.toOperationNode())})}}),ColumnUpdateNode=freeze({is(r){return r.kind==="ColumnUpdateNode"},create(r,e){return freeze({kind:"ColumnUpdateNode",column:r,value:e})}});function parseUpdate(...r){return r.length===2?[ColumnUpdateNode.create(parseReferenceExpression(r[0]),parseValueExpression(r[1]))]:parseUpdateObjectExpression(r[0])}function parseUpdateObjectExpression(r){const e=isFunction(r)?r(expressionBuilder()):r;return Object.entries(e).filter(([t,n])=>n!==void 0).map(([t,n])=>ColumnUpdateNode.create(ColumnNode.create(t),parseValueExpression(n)))}const OnDuplicateKeyNode=freeze({is(r){return r.kind==="OnDuplicateKeyNode"},create(r){return freeze({kind:"OnDuplicateKeyNode",updates:r})}});class InsertResult{constructor(e,t){ae(this,"insertId");ae(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=t}}class NoResultError extends Error{constructor(t){super("no result");ae(this,"node");this.node=t}}function isNoResultErrorConstructor(r){return Object.prototype.hasOwnProperty.call(r,"prototype")}const OnConflictNode=freeze({is(r){return r.kind==="OnConflictNode"},create(){return freeze({kind:"OnConflictNode"})},cloneWith(r,e){return freeze({...r,...e})},cloneWithIndexWhere(r,e){return freeze({...r,indexWhere:r.indexWhere?WhereNode.cloneWithOperation(r.indexWhere,"And",e):WhereNode.create(e)})},cloneWithIndexOrWhere(r,e){return freeze({...r,indexWhere:r.indexWhere?WhereNode.cloneWithOperation(r.indexWhere,"Or",e):WhereNode.create(e)})},cloneWithUpdateWhere(r,e){return freeze({...r,updateWhere:r.updateWhere?WhereNode.cloneWithOperation(r.updateWhere,"And",e):WhereNode.create(e)})},cloneWithUpdateOrWhere(r,e){return freeze({...r,updateWhere:r.updateWhere?WhereNode.cloneWithOperation(r.updateWhere,"Or",e):WhereNode.create(e)})},cloneWithoutIndexWhere(r){return freeze({...r,indexWhere:void 0})},cloneWithoutUpdateWhere(r){return freeze({...r,updateWhere:void 0})}});var _e;const kt=class kt{constructor(e){g(this,_e,void 0);x(this,_e,freeze(e))}column(e){const t=ColumnNode.create(e);return new kt({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{columns:i(this,_e).onConflictNode.columns?freeze([...i(this,_e).onConflictNode.columns,t]):freeze([t])})})}columns(e){const t=e.map(ColumnNode.create);return new kt({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{columns:i(this,_e).onConflictNode.columns?freeze([...i(this,_e).onConflictNode.columns,...t]):freeze(t)})})}constraint(e){return new kt({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{constraint:IdentifierNode.create(e)})})}expression(e){return new kt({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new kt({...i(this,_e),onConflictNode:OnConflictNode.cloneWithIndexWhere(i(this,_e).onConflictNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new kt({...i(this,_e),onConflictNode:OnConflictNode.cloneWithIndexWhere(i(this,_e).onConflictNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new kt({...i(this,_e),onConflictNode:OnConflictNode.cloneWithoutIndexWhere(i(this,_e).onConflictNode)})}doNothing(){return new OnConflictDoNothingBuilder({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new OnConflictUpdateBuilder({...i(this,_e),onConflictNode:OnConflictNode.cloneWith(i(this,_e).onConflictNode,{updates:parseUpdateObjectExpression(e)})})}$call(e){return e(this)}};_e=new WeakMap;let OnConflictBuilder=kt;preventAwait(OnConflictBuilder,"don't await OnConflictBuilder instances.");var On;class OnConflictDoNothingBuilder{constructor(e){g(this,On,void 0);x(this,On,freeze(e))}toOperationNode(){return i(this,On).onConflictNode}}On=new WeakMap;preventAwait(OnConflictDoNothingBuilder,"don't await OnConflictDoNothingBuilder instances.");var bt;const Nn=class Nn{constructor(e){g(this,bt,void 0);x(this,bt,freeze(e))}where(...e){return new Nn({...i(this,bt),onConflictNode:OnConflictNode.cloneWithUpdateWhere(i(this,bt).onConflictNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new Nn({...i(this,bt),onConflictNode:OnConflictNode.cloneWithUpdateWhere(i(this,bt).onConflictNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new Nn({...i(this,bt),onConflictNode:OnConflictNode.cloneWithoutUpdateWhere(i(this,bt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return i(this,bt).onConflictNode}};bt=new WeakMap;let OnConflictUpdateBuilder=Nn;preventAwait(OnConflictUpdateBuilder,"don't await OnConflictUpdateBuilder instances.");var ie;const Ve=class Ve{constructor(e){g(this,ie,void 0);x(this,ie,freeze(e))}values(e){const[t,n]=parseInsertExpression(e);return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{columns:t,values:n})})}columns(e){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{columns:freeze(e.map(ColumnNode.create))})})}expression(e){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{values:parseExpression(e)})})}defaultValues(){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{defaultValues:!0})})}ignore(){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{ignore:!0})})}onConflict(e){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{onConflict:e(new OnConflictBuilder({onConflictNode:OnConflictNode.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{onDuplicateKey:OnDuplicateKeyNode.create(parseUpdateObjectExpression(e))})})}returning(e){return new Ve({...i(this,ie),queryNode:QueryNode.cloneWithReturning(i(this,ie).queryNode,parseSelectArg(e))})}returningAll(){return new Ve({...i(this,ie),queryNode:QueryNode.cloneWithReturning(i(this,ie).queryNode,parseSelectAll())})}$call(e){return e(this)}$if(e,t){return e?t(this):new Ve({...i(this,ie)})}$castTo(){return new Ve(i(this,ie))}$narrowType(){return new Ve(i(this,ie))}$assertType(){return new Ve(i(this,ie))}withPlugin(e){return new Ve({...i(this,ie),executor:i(this,ie).executor.withPlugin(e)})}toOperationNode(){return i(this,ie).executor.transformQuery(i(this,ie).queryNode,i(this,ie).queryId)}compile(){return i(this,ie).executor.compileQuery(this.toOperationNode(),i(this,ie).queryId)}async execute(){const e=this.compile(),t=e.query,n=await i(this,ie).executor.executeQuery(e,i(this,ie).queryId);return i(this,ie).executor.adapter.supportsReturning&&t.returning?n.rows:[new InsertResult(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,ie).executor.stream(t,e,i(this,ie).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new Ve({...i(this,ie),queryNode:QueryNode.cloneWithExplain(i(this,ie).queryNode,e,t)}).execute()}};ie=new WeakMap;let InsertQueryBuilder=Ve;preventAwait(InsertQueryBuilder,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class DeleteResult{constructor(e){ae(this,"numDeletedRows");this.numDeletedRows=e}}const LimitNode=freeze({is(r){return r.kind==="LimitNode"},create(r){return freeze({kind:"LimitNode",limit:r})}});var G;const qe=class qe{constructor(e){g(this,G,void 0);x(this,G,freeze(e))}where(...e){return new qe({...i(this,G),queryNode:QueryNode.cloneWithWhere(i(this,G).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new qe({...i(this,G),queryNode:QueryNode.cloneWithWhere(i(this,G).queryNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new qe({...i(this,G),queryNode:QueryNode.cloneWithoutWhere(i(this,G).queryNode)})}using(e){return new qe({...i(this,G),queryNode:DeleteQueryNode.cloneWithUsing(i(this,G).queryNode,parseTableExpressionOrList(e))})}innerJoin(...e){return new qe({...i(this,G),queryNode:QueryNode.cloneWithJoin(i(this,G).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new qe({...i(this,G),queryNode:QueryNode.cloneWithJoin(i(this,G).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new qe({...i(this,G),queryNode:QueryNode.cloneWithJoin(i(this,G).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new qe({...i(this,G),queryNode:QueryNode.cloneWithJoin(i(this,G).queryNode,parseJoin("FullJoin",e))})}returning(e){return new qe({...i(this,G),queryNode:QueryNode.cloneWithReturning(i(this,G).queryNode,parseSelectArg(e))})}returningAll(e){return new qe({...i(this,G),queryNode:QueryNode.cloneWithReturning(i(this,G).queryNode,parseSelectAll(e))})}orderBy(e,t){return new qe({...i(this,G),queryNode:DeleteQueryNode.cloneWithOrderByItems(i(this,G).queryNode,parseOrderBy([e,t]))})}limit(e){return new qe({...i(this,G),queryNode:DeleteQueryNode.cloneWithLimit(i(this,G).queryNode,LimitNode.create(parseValueExpression(e)))})}$call(e){return e(this)}$if(e,t){return e?t(this):new qe({...i(this,G)})}$castTo(){return new qe(i(this,G))}$narrowType(){return new qe(i(this,G))}$assertType(){return new qe(i(this,G))}withPlugin(e){return new qe({...i(this,G),executor:i(this,G).executor.withPlugin(e)})}toOperationNode(){return i(this,G).executor.transformQuery(i(this,G).queryNode,i(this,G).queryId)}compile(){return i(this,G).executor.compileQuery(this.toOperationNode(),i(this,G).queryId)}async execute(){const e=this.compile(),t=e.query,n=await i(this,G).executor.executeQuery(e,i(this,G).queryId);return i(this,G).executor.adapter.supportsReturning&&t.returning?n.rows:[new DeleteResult(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,G).executor.stream(t,e,i(this,G).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new qe({...i(this,G),queryNode:QueryNode.cloneWithExplain(i(this,G).queryNode,e,t)}).execute()}};G=new WeakMap;let DeleteQueryBuilder=qe;preventAwait(DeleteQueryBuilder,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class UpdateResult{constructor(e,t){ae(this,"numUpdatedRows");ae(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=t}}var Z;const We=class We{constructor(e){g(this,Z,void 0);x(this,Z,freeze(e))}where(...e){return new We({...i(this,Z),queryNode:QueryNode.cloneWithWhere(i(this,Z).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new We({...i(this,Z),queryNode:QueryNode.cloneWithWhere(i(this,Z).queryNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new We({...i(this,Z),queryNode:QueryNode.cloneWithoutWhere(i(this,Z).queryNode)})}from(e){return new We({...i(this,Z),queryNode:UpdateQueryNode.cloneWithFromItems(i(this,Z).queryNode,parseTableExpressionOrList(e))})}innerJoin(...e){return new We({...i(this,Z),queryNode:QueryNode.cloneWithJoin(i(this,Z).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new We({...i(this,Z),queryNode:QueryNode.cloneWithJoin(i(this,Z).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new We({...i(this,Z),queryNode:QueryNode.cloneWithJoin(i(this,Z).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new We({...i(this,Z),queryNode:QueryNode.cloneWithJoin(i(this,Z).queryNode,parseJoin("FullJoin",e))})}set(...e){return new We({...i(this,Z),queryNode:UpdateQueryNode.cloneWithUpdates(i(this,Z).queryNode,parseUpdate(...e))})}returning(e){return new We({...i(this,Z),queryNode:QueryNode.cloneWithReturning(i(this,Z).queryNode,parseSelectArg(e))})}returningAll(){return new We({...i(this,Z),queryNode:QueryNode.cloneWithReturning(i(this,Z).queryNode,parseSelectAll())})}$call(e){return e(this)}$if(e,t){return e?t(this):new We({...i(this,Z)})}$castTo(){return new We(i(this,Z))}$narrowType(){return new We(i(this,Z))}$assertType(){return new We(i(this,Z))}withPlugin(e){return new We({...i(this,Z),executor:i(this,Z).executor.withPlugin(e)})}toOperationNode(){return i(this,Z).executor.transformQuery(i(this,Z).queryNode,i(this,Z).queryId)}compile(){return i(this,Z).executor.compileQuery(this.toOperationNode(),i(this,Z).queryId)}async execute(){const e=this.compile(),t=e.query,n=await i(this,Z).executor.executeQuery(e,i(this,Z).queryId);return i(this,Z).executor.adapter.supportsReturning&&t.returning?n.rows:[new UpdateResult(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,Z).executor.stream(t,e,i(this,Z).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new We({...i(this,Z),queryNode:QueryNode.cloneWithExplain(i(this,Z).queryNode,e,t)}).execute()}};Z=new WeakMap;let UpdateQueryBuilder=We;preventAwait(UpdateQueryBuilder,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const CommonTableExpressionNameNode=freeze({is(r){return r.kind==="CommonTableExpressionNameNode"},create(r,e){return freeze({kind:"CommonTableExpressionNameNode",table:TableNode.create(r),columns:e?freeze(e.map(ColumnNode.create)):void 0})}}),CommonTableExpressionNode=freeze({is(r){return r.kind==="CommonTableExpressionNode"},create(r,e){return freeze({kind:"CommonTableExpressionNode",name:r,expression:e})},cloneWith(r,e){return freeze({...r,...e})}});var At;const oi=class oi{constructor(e){g(this,At,void 0);x(this,At,freeze(e))}materialized(){return new oi({...i(this,At),node:CommonTableExpressionNode.cloneWith(i(this,At).node,{materialized:!0})})}notMaterialized(){return new oi({...i(this,At),node:CommonTableExpressionNode.cloneWith(i(this,At).node,{materialized:!1})})}toOperationNode(){return i(this,At).node}};At=new WeakMap;let CTEBuilder=oi;preventAwait(CTEBuilder,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function parseCommonTableExpression(r,e){const t=e(createQueryCreator()).toOperationNode();return isFunction(r)?r(cteBuilderFactory(t)).toOperationNode():CommonTableExpressionNode.create(parseCommonTableExpressionName(r),t)}function cteBuilderFactory(r){return e=>new CTEBuilder({node:CommonTableExpressionNode.create(parseCommonTableExpressionName(e),r)})}function parseCommonTableExpressionName(r){if(r.includes("(")){const e=r.split(/[\(\)]/),t=e[0],n=e[1].split(",").map(o=>o.trim());return CommonTableExpressionNameNode.create(t,n)}else return CommonTableExpressionNameNode.create(r)}const WithNode=freeze({is(r){return r.kind==="WithNode"},create(r,e){return freeze({kind:"WithNode",expressions:freeze([r]),...e})},cloneWithExpression(r,e){return freeze({...r,expressions:freeze([...r.expressions,e])})}}),CHARS=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function randomString(r){let e="";for(let t=0;t<r;++t)e+=randomChar();return e}function randomChar(){return CHARS[~~(Math.random()*CHARS.length)]}function createQueryId(){return new LazyQueryId}var Br;class LazyQueryId{constructor(){g(this,Br,void 0)}get queryId(){return i(this,Br)===void 0&&x(this,Br,randomString(8)),i(this,Br)}}Br=new WeakMap;function requireAllProps(r){return r}var ai;class OperationNodeTransformer{constructor(){ae(this,"nodeStack",[]);g(this,ai,freeze({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),AddIndexNode:this.transformAddIndex.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const t=this.transformNodeImpl(e);return this.nodeStack.pop(),freeze(t)}transformNodeImpl(e){return i(this,ai)[e.kind](e)}transformNodeList(e){return e&&freeze(e.map(t=>this.transformNode(t)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:freeze([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}ai=new WeakMap;const ROOT_OPERATION_NODES=freeze({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});var Fr,cr,dr,li,Qo,ui,Uo,ci,Mo,fr,mn,Tn,Xi,di,$o;class WithSchemaTransformer extends OperationNodeTransformer{constructor(t){super();g(this,li);g(this,ui);g(this,ci);g(this,fr);g(this,Tn);g(this,di);g(this,Fr,void 0);g(this,cr,new Set);g(this,dr,new Set);x(this,Fr,t)}transformNodeImpl(t){if(!X(this,li,Qo).call(this,t))return super.transformNodeImpl(t);const n=X(this,ci,Mo).call(this,t);for(const u of n)i(this,dr).add(u);const o=X(this,ui,Uo).call(this,t);for(const u of o)i(this,cr).add(u);const a=super.transformNodeImpl(t);for(const u of o)i(this,cr).delete(u);for(const u of n)i(this,dr).delete(u);return a}transformSchemableIdentifier(t){const n=super.transformSchemableIdentifier(t);return n.schema||!i(this,cr).has(t.identifier.name)?n:{...n,schema:IdentifierNode.create(i(this,Fr))}}transformReferences(t){const n=super.transformReferences(t);return n.table.table.schema?n:{...n,table:TableNode.createWithSchema(i(this,Fr),n.table.table.identifier.name)}}}Fr=new WeakMap,cr=new WeakMap,dr=new WeakMap,li=new WeakSet,Qo=function(t){return t.kind in ROOT_OPERATION_NODES},ui=new WeakSet,Uo=function(t){const n=new Set;if("name"in t&&t.name&&SchemableIdentifierNode.is(t.name)&&X(this,Tn,Xi).call(this,t.name,n),"from"in t&&t.from)for(const o of t.from.froms)X(this,fr,mn).call(this,o,n);if("into"in t&&t.into&&X(this,fr,mn).call(this,t.into,n),"table"in t&&t.table&&X(this,fr,mn).call(this,t.table,n),"joins"in t&&t.joins)for(const o of t.joins)X(this,fr,mn).call(this,o.table,n);return n},ci=new WeakSet,Mo=function(t){const n=new Set;return"with"in t&&t.with&&X(this,di,$o).call(this,t.with,n),n},fr=new WeakSet,mn=function(t,n){const o=TableNode.is(t)?t:AliasNode.is(t)&&TableNode.is(t.node)?t.node:null;o&&X(this,Tn,Xi).call(this,o.table,n)},Tn=new WeakSet,Xi=function(t,n){const o=t.identifier.name;!i(this,cr).has(o)&&!i(this,dr).has(o)&&n.add(o)},di=new WeakSet,$o=function(t,n){for(const o of t.expressions){const a=o.name.table.table.identifier.name;i(this,dr).has(a)||n.add(a)}};var In;class WithSchemaPlugin{constructor(e){g(this,In,void 0);x(this,In,new WithSchemaTransformer(e))}transformQuery(e){return i(this,In).transformNode(e.node)}async transformResult(e){return e.result}}In=new WeakMap;var we;const sr=class sr{constructor(e){g(this,we,void 0);x(this,we,freeze(e))}selectFrom(e){return createSelectQueryBuilder({queryId:createQueryId(),executor:i(this,we).executor,queryNode:SelectQueryNode.createFrom(parseTableExpressionOrList(e),i(this,we).withNode)})}selectNoFrom(e){return createSelectQueryBuilder({queryId:createQueryId(),executor:i(this,we).executor,queryNode:SelectQueryNode.cloneWithSelections(SelectQueryNode.create(i(this,we).withNode),parseSelectArg(e))})}insertInto(e){return new InsertQueryBuilder({queryId:createQueryId(),executor:i(this,we).executor,queryNode:InsertQueryNode.create(parseTable(e),i(this,we).withNode)})}replaceInto(e){return new InsertQueryBuilder({queryId:createQueryId(),executor:i(this,we).executor,queryNode:InsertQueryNode.create(parseTable(e),i(this,we).withNode,!0)})}deleteFrom(e){return new DeleteQueryBuilder({queryId:createQueryId(),executor:i(this,we).executor,queryNode:DeleteQueryNode.create(parseTableExpressionOrList(e),i(this,we).withNode)})}updateTable(e){return new UpdateQueryBuilder({queryId:createQueryId(),executor:i(this,we).executor,queryNode:UpdateQueryNode.create(parseTableExpression(e),i(this,we).withNode)})}with(e,t){const n=parseCommonTableExpression(e,t);return new sr({...i(this,we),withNode:i(this,we).withNode?WithNode.cloneWithExpression(i(this,we).withNode,n):WithNode.create(n)})}withRecursive(e,t){const n=parseCommonTableExpression(e,t);return new sr({...i(this,we),withNode:i(this,we).withNode?WithNode.cloneWithExpression(i(this,we).withNode,n):WithNode.create(n,{recursive:!0})})}withPlugin(e){return new sr({...i(this,we),executor:i(this,we).executor.withPlugin(e)})}withoutPlugins(){return new sr({...i(this,we),executor:i(this,we).executor.withoutPlugins()})}withSchema(e){return new sr({...i(this,we),executor:i(this,we).executor.withPluginAtFront(new WithSchemaPlugin(e))})}};we=new WeakMap;let QueryCreator=sr;var Sn,Pr,zr;class Deferred{constructor(){g(this,Sn,void 0);g(this,Pr,void 0);g(this,zr,void 0);ae(this,"resolve",e=>{i(this,Pr)&&i(this,Pr).call(this,e)});ae(this,"reject",e=>{i(this,zr)&&i(this,zr).call(this,e)});x(this,Sn,new Promise((e,t)=>{x(this,zr,t),x(this,Pr,e)}))}get promise(){return i(this,Sn)}}Sn=new WeakMap,Pr=new WeakMap,zr=new WeakMap;const LOGGED_MESSAGES=new Set;function logOnce(r){LOGGED_MESSAGES.has(r)||(LOGGED_MESSAGES.add(r),console.log(r))}const NO_PLUGINS=freeze([]);var hr,vn,Yi;class QueryExecutorBase{constructor(e=NO_PLUGINS){g(this,vn);g(this,hr,void 0);x(this,hr,e)}get plugins(){return i(this,hr)}transformQuery(e,t){for(const n of i(this,hr)){const o=n.transformQuery({node:e,queryId:t});if(o.kind===e.kind)e=o;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${o.kind}`].join(" "))}return e}async executeQuery(e,t){return await this.provideConnection(async n=>{const o=await n.executeQuery(e),a=await X(this,vn,Yi).call(this,o,t);return warnOfOutdatedDriverOrPlugins(o,a),a})}async*stream(e,t,n){const o=new Deferred,a=new Deferred;this.provideConnection(async d=>(o.resolve(d),await a.promise)).catch(d=>o.reject(d));const u=await o.promise;try{for await(const d of u.streamQuery(e,t))yield await X(this,vn,Yi).call(this,d,n)}finally{a.resolve()}}}hr=new WeakMap,vn=new WeakSet,Yi=async function(e,t){for(const n of i(this,hr))e=await n.transformResult({result:e,queryId:t});return e};function warnOfOutdatedDriverOrPlugins(r,e){const{numAffectedRows:t}=r;t===void 0&&r.numUpdatedOrDeletedRows===void 0||t!==void 0&&e.numAffectedRows!==void 0||logOnce("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class NoopQueryExecutor extends QueryExecutorBase{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new NoopQueryExecutor([...this.plugins,e])}withPlugins(e){return new NoopQueryExecutor([...this.plugins,...e])}withPluginAtFront(e){return new NoopQueryExecutor([e,...this.plugins])}withoutPlugins(){return new NoopQueryExecutor([])}}const NOOP_QUERY_EXECUTOR=new NoopQueryExecutor;function createQueryCreator(){return new QueryCreator({executor:NOOP_QUERY_EXECUTOR})}function createJoinBuilder(r,e){return new JoinBuilder({joinNode:JoinNode.create(r,parseTableExpression(e))})}function createOverBuilder(){return new OverBuilder({overNode:OverNode.create()})}function parseJoin(r,e){if(e.length===3)return parseSingleOnJoin(r,e[0],e[1],e[2]);if(e.length===2)return parseCallbackJoin(r,e[0],e[1]);throw new Error("not implemented")}function parseCallbackJoin(r,e,t){return t(createJoinBuilder(r,e)).toOperationNode()}function parseSingleOnJoin(r,e,t,n){return JoinNode.createWithOn(r,parseTableExpression(e),parseReferentialBinaryOperation(t,"=",n))}const OffsetNode=freeze({is(r){return r.kind==="OffsetNode"},create(r){return freeze({kind:"OffsetNode",offset:r})}}),GroupByItemNode=freeze({is(r){return r.kind==="GroupByItemNode"},create(r){return freeze({kind:"GroupByItemNode",groupBy:r})}});function parseGroupBy(r){return r=isFunction(r)?r(expressionBuilder()):r,parseReferenceExpressionOrList(r).map(GroupByItemNode.create)}const SetOperationNode=freeze({is(r){return r.kind==="SetOperationNode"},create(r,e,t){return freeze({kind:"SetOperationNode",operator:r,expression:e,all:t})}});function parseSetOperations(r,e,t){return isFunction(e)&&(e=e(createExpressionBuilder())),isReadonlyArray(e)||(e=[e]),e.map(n=>SetOperationNode.create(r,parseExpression(n),t))}var Lt;const fi=class fi{constructor(e){g(this,Lt,void 0);x(this,Lt,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}or(...e){return new OrWrapper(OrNode.create(i(this,Lt),parseValueBinaryOperationOrExpression(e)))}and(...e){return new AndWrapper(AndNode.create(i(this,Lt),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new fi(i(this,Lt))}$notNull(){return new fi(i(this,Lt))}toOperationNode(){return i(this,Lt)}};Lt=new WeakMap;let ExpressionWrapper=fi;var Qr,jt;class AliasedExpressionWrapper{constructor(e,t){g(this,Qr,void 0);g(this,jt,void 0);x(this,Qr,e),x(this,jt,t)}get expression(){return i(this,Qr)}get alias(){return i(this,jt)}toOperationNode(){return AliasNode.create(i(this,Qr).toOperationNode(),isOperationNodeSource(i(this,jt))?i(this,jt).toOperationNode():IdentifierNode.create(i(this,jt)))}}Qr=new WeakMap,jt=new WeakMap;var pr;const hi=class hi{constructor(e){g(this,pr,void 0);x(this,pr,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}or(...e){return new hi(OrNode.create(i(this,pr),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new hi(i(this,pr))}toOperationNode(){return ParensNode.create(i(this,pr))}};pr=new WeakMap;let OrWrapper=hi;var mr;const pi=class pi{constructor(e){g(this,mr,void 0);x(this,mr,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}and(...e){return new pi(AndNode.create(i(this,mr),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new pi(i(this,mr))}toOperationNode(){return ParensNode.create(i(this,mr))}};mr=new WeakMap;let AndWrapper=pi;var W;const Y=class Y{constructor(e){g(this,W,void 0);x(this,W,freeze(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new Y({...i(this,W),queryNode:QueryNode.cloneWithWhere(i(this,W).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new Y({...i(this,W),queryNode:QueryNode.cloneWithWhere(i(this,W).queryNode,parseReferentialBinaryOperation(e,t,n))})}having(...e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithHaving(i(this,W).queryNode,parseValueBinaryOperationOrExpression(e))})}havingRef(e,t,n){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithHaving(i(this,W).queryNode,parseReferentialBinaryOperation(e,t,n))})}select(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithSelections(i(this,W).queryNode,parseSelectArg(e))})}distinctOn(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithDistinctOn(i(this,W).queryNode,parseReferenceExpressionOrList(e))})}modifyFront(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithFrontModifier(i(this,W).queryNode,SelectModifierNode.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.createWithExpression(e.toOperationNode()))})}distinct(){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithFrontModifier(i(this,W).queryNode,SelectModifierNode.create("Distinct"))})}forUpdate(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("ForUpdate",e?asArray(e).map(parseTable):void 0))})}forShare(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("ForShare",e?asArray(e).map(parseTable):void 0))})}forKeyShare(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("ForKeyShare",e?asArray(e).map(parseTable):void 0))})}forNoKeyUpdate(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("ForNoKeyUpdate",e?asArray(e).map(parseTable):void 0))})}skipLocked(){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("SkipLocked"))})}noWait(){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("NoWait"))})}selectAll(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithSelections(i(this,W).queryNode,parseSelectAll(e))})}innerJoin(...e){return new Y({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new Y({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new Y({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new Y({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("FullJoin",e))})}innerJoinLateral(...e){return new Y({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("LateralInnerJoin",e))})}leftJoinLateral(...e){return new Y({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("LateralLeftJoin",e))})}orderBy(...e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithOrderByItems(i(this,W).queryNode,parseOrderBy(e))})}groupBy(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithGroupByItems(i(this,W).queryNode,parseGroupBy(e))})}limit(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithLimit(i(this,W).queryNode,LimitNode.create(parseValueExpression(e)))})}offset(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithOffset(i(this,W).queryNode,OffsetNode.create(parseValueExpression(e)))})}union(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("union",e,!1))})}unionAll(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("union",e,!0))})}intersect(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("intersect",e,!1))})}intersectAll(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("intersect",e,!0))})}except(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("except",e,!1))})}exceptAll(e){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("except",e,!0))})}as(e){return new AliasedSelectQueryBuilderImpl(this,e)}clearSelect(){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithoutSelections(i(this,W).queryNode)})}clearWhere(){return new Y({...i(this,W),queryNode:QueryNode.cloneWithoutWhere(i(this,W).queryNode)})}clearLimit(){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithoutLimit(i(this,W).queryNode)})}clearOffset(){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithoutOffset(i(this,W).queryNode)})}clearOrderBy(){return new Y({...i(this,W),queryNode:SelectQueryNode.cloneWithoutOrderBy(i(this,W).queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new Y({...i(this,W)})}$castTo(){return new Y(i(this,W))}$narrowType(){return new Y(i(this,W))}$assertType(){return new Y(i(this,W))}$asTuple(){return new ExpressionWrapper(this.toOperationNode())}withPlugin(e){return new Y({...i(this,W),executor:i(this,W).executor.withPlugin(e)})}toOperationNode(){return i(this,W).executor.transformQuery(i(this,W).queryNode,i(this,W).queryId)}compile(){return i(this,W).executor.compileQuery(this.toOperationNode(),i(this,W).queryId)}async execute(){const e=this.compile();return(await i(this,W).executor.executeQuery(e,i(this,W).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,W).executor.stream(t,e,i(this,W).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new Y({...i(this,W),queryNode:QueryNode.cloneWithExplain(i(this,W).queryNode,e,t)}).execute()}};W=new WeakMap;let SelectQueryBuilderImpl=Y;preventAwait(SelectQueryBuilderImpl,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function createSelectQueryBuilder(r){return new SelectQueryBuilderImpl(r)}var Ur,Mr;class AliasedSelectQueryBuilderImpl{constructor(e,t){g(this,Ur,void 0);g(this,Mr,void 0);x(this,Ur,e),x(this,Mr,t)}get expression(){return i(this,Ur)}get alias(){return i(this,Mr)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return AliasNode.create(i(this,Ur).toOperationNode(),IdentifierNode.create(i(this,Mr)))}}Ur=new WeakMap,Mr=new WeakMap;preventAwait(AliasedSelectQueryBuilderImpl,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const AggregateFunctionNode=freeze({is(r){return r.kind==="AggregateFunctionNode"},create(r,e=[]){return freeze({kind:"AggregateFunctionNode",func:r,aggregated:e})},cloneWithDistinct(r){return freeze({...r,distinct:!0})},cloneWithFilter(r,e){return freeze({...r,filter:r.filter?WhereNode.cloneWithOperation(r.filter,"And",e):WhereNode.create(e)})},cloneWithOrFilter(r,e){return freeze({...r,filter:r.filter?WhereNode.cloneWithOperation(r.filter,"Or",e):WhereNode.create(e)})},cloneWithOver(r,e){return freeze({...r,over:e})}}),FunctionNode=freeze({is(r){return r.kind==="FunctionNode"},create(r,e){return freeze({kind:"FunctionNode",func:r,arguments:e})}});var tt;const Jt=class Jt{constructor(e){g(this,tt,void 0);x(this,tt,freeze(e))}get expressionType(){}as(e){return new AliasedAggregateFunctionBuilder(this,e)}distinct(){return new Jt({...i(this,tt),aggregateFunctionNode:AggregateFunctionNode.cloneWithDistinct(i(this,tt).aggregateFunctionNode)})}filterWhere(...e){return new Jt({...i(this,tt),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(i(this,tt).aggregateFunctionNode,parseValueBinaryOperationOrExpression(e))})}filterWhereRef(e,t,n){return new Jt({...i(this,tt),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(i(this,tt).aggregateFunctionNode,parseReferentialBinaryOperation(e,t,n))})}over(e){const t=createOverBuilder();return new Jt({...i(this,tt),aggregateFunctionNode:AggregateFunctionNode.cloneWithOver(i(this,tt).aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new Jt(i(this,tt))}$notNull(){return new Jt(i(this,tt))}toOperationNode(){return i(this,tt).aggregateFunctionNode}};tt=new WeakMap;let AggregateFunctionBuilder=Jt;preventAwait(AggregateFunctionBuilder,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var $r,Vr;class AliasedAggregateFunctionBuilder{constructor(e,t){g(this,$r,void 0);g(this,Vr,void 0);x(this,$r,e),x(this,Vr,t)}get expression(){return i(this,$r)}get alias(){return i(this,Vr)}toOperationNode(){return AliasNode.create(i(this,$r).toOperationNode(),IdentifierNode.create(i(this,Vr)))}}$r=new WeakMap,Vr=new WeakMap;function createFunctionModule(){const r=(t,n)=>new ExpressionWrapper(FunctionNode.create(t,parseReferenceExpressionOrList(n??[]))),e=(t,n)=>new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create(t,n?parseReferenceExpressionOrList(n):void 0)});return Object.assign(r,{agg:e,avg(t){return e("avg",[t])},coalesce(...t){return r("coalesce",t)},count(t){return e("count",[t])},countAll(t){return new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create("count",parseSelectAll(t))})},max(t){return e("max",[t])},min(t){return e("min",[t])},sum(t){return e("sum",[t])},any(t){return r("any",[t])},jsonAgg(t){return new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create("json_agg",[isString(t)?parseTable(t):t.toOperationNode()])})},toJson(t){return new ExpressionWrapper(FunctionNode.create("to_json",[isString(t)?parseTable(t):t.toOperationNode()]))}})}const UnaryOperationNode=freeze({is(r){return r.kind==="UnaryOperationNode"},create(r,e){return freeze({kind:"UnaryOperationNode",operator:r,operand:e})}});function parseUnaryOperation(r,e){return UnaryOperationNode.create(OperatorNode.create(r),parseReferenceExpression(e))}const WhenNode=freeze({is(r){return r.kind==="WhenNode"},create(r){return freeze({kind:"WhenNode",condition:r})},cloneWithResult(r,e){return freeze({...r,result:e})}}),CaseNode=freeze({is(r){return r.kind==="CaseNode"},create(r){return freeze({kind:"CaseNode",value:r})},cloneWithWhen(r,e){return freeze({...r,when:freeze(r.when?[...r.when,e]:[e])})},cloneWithThen(r,e){return freeze({...r,when:r.when?freeze([...r.when.slice(0,-1),WhenNode.cloneWithResult(r.when[r.when.length-1],e)]):void 0})},cloneWith(r,e){return freeze({...r,...e})}});var Jr;class CaseBuilder{constructor(e){g(this,Jr,void 0);x(this,Jr,freeze(e))}when(...e){return new CaseThenBuilder({...i(this,Jr),node:CaseNode.cloneWithWhen(i(this,Jr).node,WhenNode.create(parseValueBinaryOperationOrExpression(e)))})}}Jr=new WeakMap;var Hr;class CaseThenBuilder{constructor(e){g(this,Hr,void 0);x(this,Hr,freeze(e))}then(e){return new CaseWhenBuilder({...i(this,Hr),node:CaseNode.cloneWithThen(i(this,Hr).node,isSafeImmediateValue(e)?parseSafeImmediateValue(e):parseValueExpression(e))})}}Hr=new WeakMap;var vt;class CaseWhenBuilder{constructor(e){g(this,vt,void 0);x(this,vt,freeze(e))}when(...e){return new CaseThenBuilder({...i(this,vt),node:CaseNode.cloneWithWhen(i(this,vt).node,WhenNode.create(parseValueBinaryOperationOrExpression(e)))})}else(e){return new CaseEndBuilder({...i(this,vt),node:CaseNode.cloneWith(i(this,vt).node,{else:isSafeImmediateValue(e)?parseSafeImmediateValue(e):parseValueExpression(e)})})}end(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,vt).node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,vt).node,{isStatement:!0}))}}vt=new WeakMap;var jr;class CaseEndBuilder{constructor(e){g(this,jr,void 0);x(this,jr,freeze(e))}end(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,jr).node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,jr).node,{isStatement:!0}))}}jr=new WeakMap;const JSONPathLegNode=freeze({is(r){return r.kind==="JSONPathLegNode"},create(r,e){return freeze({kind:"JSONPathLegNode",type:r,value:e})}});var Ct,Cn,Zi;class JSONPathBuilder{constructor(e){g(this,Cn);g(this,Ct,void 0);x(this,Ct,e)}at(e){return X(this,Cn,Zi).call(this,"ArrayLocation",e)}key(e){return X(this,Cn,Zi).call(this,"Member",e)}}Ct=new WeakMap,Cn=new WeakSet,Zi=function(e,t){return JSONReferenceNode.is(i(this,Ct))?new TraversedJSONPathBuilder(JSONReferenceNode.cloneWithTraversal(i(this,Ct),JSONPathNode.is(i(this,Ct).traversal)?JSONPathNode.cloneWithLeg(i(this,Ct).traversal,JSONPathLegNode.create(e,t)):JSONOperatorChainNode.cloneWithValue(i(this,Ct).traversal,ValueNode.createImmediate(t)))):new TraversedJSONPathBuilder(JSONPathNode.cloneWithLeg(i(this,Ct),JSONPathLegNode.create(e,t)))};var yr;class TraversedJSONPathBuilder extends JSONPathBuilder{constructor(t){super(t);g(this,yr,void 0);x(this,yr,t)}get expressionType(){}as(t){return new AliasedJSONPathBuilder(this,t)}$castTo(){return new JSONPathBuilder(i(this,yr))}$notNull(){return new JSONPathBuilder(i(this,yr))}toOperationNode(){return i(this,yr)}}yr=new WeakMap;var Kr,Kt;class AliasedJSONPathBuilder{constructor(e,t){g(this,Kr,void 0);g(this,Kt,void 0);x(this,Kr,e),x(this,Kt,t)}get expression(){return i(this,Kr)}get alias(){return i(this,Kt)}toOperationNode(){return AliasNode.create(i(this,Kr).toOperationNode(),isOperationNodeSource(i(this,Kt))?i(this,Kt).toOperationNode():IdentifierNode.create(i(this,Kt)))}}Kr=new WeakMap,Kt=new WeakMap;const TupleNode=freeze({is(r){return r.kind==="TupleNode"},create(r){return freeze({kind:"TupleNode",values:freeze(r)})}});function createExpressionBuilder(r=NOOP_QUERY_EXECUTOR){function e(o,a,u){return new ExpressionWrapper(parseValueBinaryOperation(o,a,u))}function t(o,a){return new ExpressionWrapper(parseUnaryOperation(o,a))}const n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(o){return createSelectQueryBuilder({queryId:createQueryId(),executor:r,queryNode:SelectQueryNode.createFrom(parseTableExpressionOrList(o))})},case(o){return new CaseBuilder({node:CaseNode.create(isUndefined(o)?void 0:parseReferenceExpression(o))})},ref(o,a){return isUndefined(a)?new ExpressionWrapper(parseStringReference(o)):new JSONPathBuilder(parseJSONReference(o,a))},jsonPath(){return new JSONPathBuilder(JSONPathNode.create())},table(o){return new ExpressionWrapper(parseTable(o))},val(o){return new ExpressionWrapper(parseValueExpression(o))},refTuple(...o){return new ExpressionWrapper(TupleNode.create(o.map(parseReferenceExpression)))},tuple(...o){return new ExpressionWrapper(TupleNode.create(o.map(parseValueExpression)))},lit(o){return new ExpressionWrapper(parseSafeImmediateValue(o))},unary:t,not(o){return t("not",o)},exists(o){return t("exists",o)},neg(o){return t("-",o)},between(o,a,u){return new ExpressionWrapper(BinaryOperationNode.create(parseReferenceExpression(o),OperatorNode.create("between"),AndNode.create(parseValueExpression(a),parseValueExpression(u))))},betweenSymmetric(o,a,u){return new ExpressionWrapper(BinaryOperationNode.create(parseReferenceExpression(o),OperatorNode.create("between symmetric"),AndNode.create(parseValueExpression(a),parseValueExpression(u))))},and(o){return isReadonlyArray(o)?new ExpressionWrapper(parseFilterList(o,"and")):new ExpressionWrapper(parseFilterObject(o,"and"))},or(o){return isReadonlyArray(o)?new ExpressionWrapper(parseFilterList(o,"or")):new ExpressionWrapper(parseFilterObject(o,"or"))},parens(...o){const a=parseValueBinaryOperationOrExpression(o);return ParensNode.is(a)?new ExpressionWrapper(a):new ExpressionWrapper(ParensNode.create(a))},withSchema(o){return createExpressionBuilder(r.withPluginAtFront(new WithSchemaPlugin(o)))}});return n.fn=createFunctionModule(),n.eb=n,n}function expressionBuilder(r){return createExpressionBuilder()}function parseExpression(r){if(isOperationNodeSource(r))return r.toOperationNode();if(isFunction(r))return r(expressionBuilder()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(r)}`)}function parseAliasedExpression(r){if(isOperationNodeSource(r))return r.toOperationNode();if(isFunction(r))return r(expressionBuilder()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(r)}`)}function isExpressionOrFactory(r){return isExpression(r)||isAliasedExpression(r)||isFunction(r)}function parseTableExpressionOrList(r){return isReadonlyArray(r)?r.map(e=>parseTableExpression(e)):[parseTableExpression(r)]}function parseTableExpression(r){return isString(r)?parseAliasedTable(r):parseAliasedExpression(r)}function parseAliasedTable(r){const e=" as ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$1);return AliasNode.create(parseTable(t),IdentifierNode.create(n))}else return parseTable(r)}function parseTable(r){const e=".";if(r.includes(e)){const[t,n]=r.split(e).map(trim$1);return TableNode.createWithSchema(t,n)}else return TableNode.create(r)}function trim$1(r){return r.trim()}const AddColumnNode=freeze({is(r){return r.kind==="AddColumnNode"},create(r){return freeze({kind:"AddColumnNode",column:r})}}),ColumnDefinitionNode=freeze({is(r){return r.kind==="ColumnDefinitionNode"},create(r,e){return freeze({kind:"ColumnDefinitionNode",column:ColumnNode.create(r),dataType:e})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):[e]})},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):[e]})},cloneWith(r,e){return freeze({...r,...e})}}),DropColumnNode=freeze({is(r){return r.kind==="DropColumnNode"},create(r){return freeze({kind:"DropColumnNode",column:ColumnNode.create(r)})}}),RenameColumnNode=freeze({is(r){return r.kind==="RenameColumnNode"},create(r,e){return freeze({kind:"RenameColumnNode",column:ColumnNode.create(r),renameTo:ColumnNode.create(e)})}}),CheckConstraintNode=freeze({is(r){return r.kind==="CheckConstraintNode"},create(r,e){return freeze({kind:"CheckConstraintNode",expression:r,name:e?IdentifierNode.create(e):void 0})}}),ON_MODIFY_FOREIGN_ACTIONS=["no action","restrict","cascade","set null","set default"],ReferencesNode=freeze({is(r){return r.kind==="ReferencesNode"},create(r,e){return freeze({kind:"ReferencesNode",table:r,columns:freeze([...e])})},cloneWithOnDelete(r,e){return freeze({...r,onDelete:e})},cloneWithOnUpdate(r,e){return freeze({...r,onUpdate:e})}});function parseDefaultValueExpression(r){return isOperationNodeSource(r)?r.toOperationNode():ValueNode.createImmediate(r)}const GeneratedNode=freeze({is(r){return r.kind==="GeneratedNode"},create(r){return freeze({kind:"GeneratedNode",...r})},createWithExpression(r){return freeze({kind:"GeneratedNode",always:!0,expression:r})},cloneWith(r,e){return freeze({...r,...e})}}),DefaultValueNode=freeze({is(r){return r.kind==="DefaultValueNode"},create(r){return freeze({kind:"DefaultValueNode",defaultValue:r})}});function parseOnModifyForeignAction(r){if(ON_MODIFY_FOREIGN_ACTIONS.includes(r))return r;throw new Error(`invalid OnModifyForeignAction ${r}`)}var Ee;const Be=class Be{constructor(e){g(this,Ee,void 0);x(this,Ee,e)}autoIncrement(){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{autoIncrement:!0}))}primaryKey(){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{primaryKey:!0}))}references(e){const t=parseStringReference(e);if(!t.table||SelectAllNode.is(t.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{references:ReferencesNode.create(t.table,[t.column])}))}onDelete(e){if(!i(this,Ee).references)throw new Error("on delete constraint can only be added for foreign keys");return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{references:ReferencesNode.cloneWithOnDelete(i(this,Ee).references,parseOnModifyForeignAction(e))}))}onUpdate(e){if(!i(this,Ee).references)throw new Error("on update constraint can only be added for foreign keys");return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{references:ReferencesNode.cloneWithOnUpdate(i(this,Ee).references,parseOnModifyForeignAction(e))}))}unique(){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{unique:!0}))}notNull(){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{notNull:!0}))}unsigned(){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{unsigned:!0}))}defaultTo(e){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{defaultTo:DefaultValueNode.create(parseDefaultValueExpression(e))}))}check(e){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{check:CheckConstraintNode.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{generated:GeneratedNode.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{generated:GeneratedNode.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{generated:GeneratedNode.create({identity:!0,byDefault:!0})}))}stored(){if(!i(this,Ee).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{generated:GeneratedNode.cloneWith(i(this,Ee).generated,{stored:!0})}))}modifyFront(e){return new Be(ColumnDefinitionNode.cloneWithFrontModifier(i(this,Ee),e.toOperationNode()))}nullsNotDistinct(){return new Be(ColumnDefinitionNode.cloneWith(i(this,Ee),{nullsNotDistinct:!0}))}modifyEnd(e){return new Be(ColumnDefinitionNode.cloneWithEndModifier(i(this,Ee),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return i(this,Ee)}};Ee=new WeakMap;let ColumnDefinitionBuilder=Be;preventAwait(ColumnDefinitionBuilder,"don't await ColumnDefinitionBuilder instances directly.");const ModifyColumnNode=freeze({is(r){return r.kind==="ModifyColumnNode"},create(r){return freeze({kind:"ModifyColumnNode",column:r})}}),DataTypeNode=freeze({is(r){return r.kind==="DataTypeNode"},create(r){return freeze({kind:"DataTypeNode",dataType:r})}});function parseDataTypeExpression(r){return isOperationNodeSource(r)?r.toOperationNode():DataTypeNode.create(r)}const ForeignKeyConstraintNode=freeze({is(r){return r.kind==="ForeignKeyConstraintNode"},create(r,e,t,n){return freeze({kind:"ForeignKeyConstraintNode",columns:r,references:ReferencesNode.create(e,t),name:n?IdentifierNode.create(n):void 0})},cloneWith(r,e){return freeze({...r,...e})}});var Nr;const mi=class mi{constructor(e){g(this,Nr,void 0);x(this,Nr,e)}onDelete(e){return new mi(ForeignKeyConstraintNode.cloneWith(i(this,Nr),{onDelete:parseOnModifyForeignAction(e)}))}onUpdate(e){return new mi(ForeignKeyConstraintNode.cloneWith(i(this,Nr),{onUpdate:parseOnModifyForeignAction(e)}))}$call(e){return e(this)}toOperationNode(){return i(this,Nr)}};Nr=new WeakMap;let ForeignKeyConstraintBuilder=mi;preventAwait(ForeignKeyConstraintBuilder,"don't await ForeignKeyConstraintBuilder instances directly.");const AddConstraintNode=freeze({is(r){return r.kind==="AddConstraintNode"},create(r){return freeze({kind:"AddConstraintNode",constraint:r})}}),UniqueConstraintNode=freeze({is(r){return r.kind==="UniqueConstraintNode"},create(r,e,t){return freeze({kind:"UniqueConstraintNode",columns:freeze(r.map(ColumnNode.create)),name:e?IdentifierNode.create(e):void 0,nullsNotDistinct:t})},cloneWith(r,e){return freeze({...r,...e})}}),DropConstraintNode=freeze({is(r){return r.kind==="DropConstraintNode"},create(r){return freeze({kind:"DropConstraintNode",constraintName:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}}),AlterColumnNode=freeze({is(r){return r.kind==="AlterColumnNode"},create(r,e,t){return freeze({kind:"AlterColumnNode",column:ColumnNode.create(r),[e]:t})}});var qt;class AlterColumnBuilder{constructor(e){g(this,qt,void 0);x(this,qt,e)}setDataType(e){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"dataType",parseDataTypeExpression(e)))}setDefault(e){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"setDefault",parseDefaultValueExpression(e)))}dropDefault(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"dropDefault",!0))}setNotNull(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"setNotNull",!0))}dropNotNull(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"dropNotNull",!0))}$call(e){return e(this)}}qt=new WeakMap;var Rn;class AlteredColumnBuilder{constructor(e){g(this,Rn,void 0);x(this,Rn,e)}toOperationNode(){return i(this,Rn)}}Rn=new WeakMap;var wt;class AlterTableExecutor{constructor(e){g(this,wt,void 0);x(this,wt,freeze(e))}toOperationNode(){return i(this,wt).executor.transformQuery(i(this,wt).node,i(this,wt).queryId)}compile(){return i(this,wt).executor.compileQuery(this.toOperationNode(),i(this,wt).queryId)}async execute(){await i(this,wt).executor.executeQuery(this.compile(),i(this,wt).queryId)}}wt=new WeakMap;preventAwait(AlterTableExecutor,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var Xe;const yi=class yi{constructor(e){g(this,Xe,void 0);x(this,Xe,freeze(e))}onDelete(e){return new yi({...i(this,Xe),constraintBuilder:i(this,Xe).constraintBuilder.onDelete(e)})}onUpdate(e){return new yi({...i(this,Xe),constraintBuilder:i(this,Xe).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return i(this,Xe).executor.transformQuery(AlterTableNode.cloneWithTableProps(i(this,Xe).node,{addConstraint:AddConstraintNode.create(i(this,Xe).constraintBuilder.toOperationNode())}),i(this,Xe).queryId)}compile(){return i(this,Xe).executor.compileQuery(this.toOperationNode(),i(this,Xe).queryId)}async execute(){await i(this,Xe).executor.executeQuery(this.compile(),i(this,Xe).queryId)}};Xe=new WeakMap;let AlterTableAddForeignKeyConstraintBuilder=yi;preventAwait(AlterTableAddForeignKeyConstraintBuilder,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var De;const bn=class bn{constructor(e){g(this,De,void 0);x(this,De,freeze(e))}ifExists(){return new bn({...i(this,De),node:AlterTableNode.cloneWithTableProps(i(this,De).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,De).node.dropConstraint,{ifExists:!0})})})}cascade(){return new bn({...i(this,De),node:AlterTableNode.cloneWithTableProps(i(this,De).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,De).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new bn({...i(this,De),node:AlterTableNode.cloneWithTableProps(i(this,De).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,De).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return i(this,De).executor.transformQuery(i(this,De).node,i(this,De).queryId)}compile(){return i(this,De).executor.compileQuery(this.toOperationNode(),i(this,De).queryId)}async execute(){await i(this,De).executor.executeQuery(this.compile(),i(this,De).queryId)}};De=new WeakMap;let AlterTableDropConstraintBuilder=bn;preventAwait(AlterTableDropConstraintBuilder,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const PrimaryConstraintNode=freeze({is(r){return r.kind==="PrimaryKeyConstraintNode"},create(r,e){return freeze({kind:"PrimaryKeyConstraintNode",columns:freeze(r.map(ColumnNode.create)),name:e?IdentifierNode.create(e):void 0})}}),AddIndexNode=freeze({is(r){return r.kind==="AddIndexNode"},create(r){return freeze({kind:"AddIndexNode",name:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})},cloneWithColumns(r,e){return freeze({...r,columns:[...r.columns||[],...e]})}});var ge;const or=class or{constructor(e){g(this,ge,void 0);x(this,ge,freeze(e))}unique(){return new or({...i(this,ge),node:AlterTableNode.cloneWithTableProps(i(this,ge).node,{addIndex:AddIndexNode.cloneWith(i(this,ge).node.addIndex,{unique:!0})})})}column(e){return new or({...i(this,ge),node:AlterTableNode.cloneWithTableProps(i(this,ge).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,ge).node.addIndex,[parseOrderedColumnName(e)])})})}columns(e){return new or({...i(this,ge),node:AlterTableNode.cloneWithTableProps(i(this,ge).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,ge).node.addIndex,e.map(parseOrderedColumnName))})})}expression(e){return new or({...i(this,ge),node:AlterTableNode.cloneWithTableProps(i(this,ge).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,ge).node.addIndex,[e.toOperationNode()])})})}using(e){return new or({...i(this,ge),node:AlterTableNode.cloneWithTableProps(i(this,ge).node,{addIndex:AddIndexNode.cloneWith(i(this,ge).node.addIndex,{using:RawNode.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return i(this,ge).executor.transformQuery(i(this,ge).node,i(this,ge).queryId)}compile(){return i(this,ge).executor.compileQuery(this.toOperationNode(),i(this,ge).queryId)}async execute(){await i(this,ge).executor.executeQuery(this.compile(),i(this,ge).queryId)}};ge=new WeakMap;let AlterTableAddIndexBuilder=or;preventAwait(AlterTableAddIndexBuilder,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var Gr;const os=class os{constructor(e){g(this,Gr,void 0);x(this,Gr,e)}toOperationNode(){return i(this,Gr)}nullsNotDistinct(){return new os(UniqueConstraintNode.cloneWith(i(this,Gr),{nullsNotDistinct:!0}))}};Gr=new WeakMap;let UniqueConstraintNodeBuilder=os;preventAwait(UniqueConstraintNodeBuilder,"don't await UniqueConstraintNodeBuilder instances directly.");var de;class AlterTableBuilder{constructor(e){g(this,de,void 0);x(this,de,freeze(e))}renameTo(e){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{renameTo:parseTable(e)})})}setSchema(e){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{setSchema:IdentifierNode.create(e)})})}alterColumn(e,t){const n=t(new AlterColumnBuilder(e));return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,n.toOperationNode())})}dropColumn(e){return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,DropColumnNode.create(e))})}renameColumn(e,t){return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,RenameColumnNode.create(e,t))})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,AddColumnNode.create(o.toOperationNode()))})}modifyColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...i(this,de),node:AlterTableNode.cloneWithColumnAlteration(i(this,de).node,ModifyColumnNode.create(o.toOperationNode()))})}addUniqueConstraint(e,t,n=noop$1){const o=n(new UniqueConstraintNodeBuilder(UniqueConstraintNode.create(t,e)));return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{addConstraint:AddConstraintNode.create(o.toOperationNode())})})}addCheckConstraint(e,t){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{addConstraint:AddConstraintNode.create(CheckConstraintNode.create(t.toOperationNode(),e))})})}addForeignKeyConstraint(e,t,n,o){return new AlterTableAddForeignKeyConstraintBuilder({...i(this,de),constraintBuilder:new ForeignKeyConstraintBuilder(ForeignKeyConstraintNode.create(t.map(ColumnNode.create),parseTable(n),o.map(ColumnNode.create),e))})}addPrimaryKeyConstraint(e,t){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{addConstraint:AddConstraintNode.create(PrimaryConstraintNode.create(t,e))})})}dropConstraint(e){return new AlterTableDropConstraintBuilder({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{dropConstraint:DropConstraintNode.create(e)})})}addIndex(e){return new AlterTableAddIndexBuilder({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{addIndex:AddIndexNode.create(e)})})}dropIndex(e){return new AlterTableExecutor({...i(this,de),node:AlterTableNode.cloneWithTableProps(i(this,de).node,{dropIndex:DropIndexNode.create(e)})})}$call(e){return e(this)}}de=new WeakMap;var ke;const ar=class ar{constructor(e){g(this,ke,void 0);x(this,ke,freeze(e))}alterColumn(e,t){const n=t(new AlterColumnBuilder(e));return new ar({...i(this,ke),node:AlterTableNode.cloneWithColumnAlteration(i(this,ke).node,n.toOperationNode())})}dropColumn(e){return new ar({...i(this,ke),node:AlterTableNode.cloneWithColumnAlteration(i(this,ke).node,DropColumnNode.create(e))})}renameColumn(e,t){return new ar({...i(this,ke),node:AlterTableNode.cloneWithColumnAlteration(i(this,ke).node,RenameColumnNode.create(e,t))})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new ar({...i(this,ke),node:AlterTableNode.cloneWithColumnAlteration(i(this,ke).node,AddColumnNode.create(o.toOperationNode()))})}modifyColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new ar({...i(this,ke),node:AlterTableNode.cloneWithColumnAlteration(i(this,ke).node,ModifyColumnNode.create(o.toOperationNode()))})}toOperationNode(){return i(this,ke).executor.transformQuery(i(this,ke).node,i(this,ke).queryId)}compile(){return i(this,ke).executor.compileQuery(this.toOperationNode(),i(this,ke).queryId)}async execute(){await i(this,ke).executor.executeQuery(this.compile(),i(this,ke).queryId)}};ke=new WeakMap;let AlterTableColumnAlteringBuilder=ar;preventAwait(AlterTableBuilder,"don't await AlterTableBuilder instances");preventAwait(AlterColumnBuilder,"don't await AlterColumnBuilder instances");preventAwait(AlterTableColumnAlteringBuilder,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class ImmediateValueTransformer extends OperationNodeTransformer{transformValue(e){return{...super.transformValue(e),immediate:!0}}}var me;const yt=class yt{constructor(e){g(this,me,void 0);x(this,me,freeze(e))}ifNotExists(){return new yt({...i(this,me),node:CreateIndexNode.cloneWith(i(this,me).node,{ifNotExists:!0})})}unique(){return new yt({...i(this,me),node:CreateIndexNode.cloneWith(i(this,me).node,{unique:!0})})}nullsNotDistinct(){return new yt({...i(this,me),node:CreateIndexNode.cloneWith(i(this,me).node,{nullsNotDistinct:!0})})}on(e){return new yt({...i(this,me),node:CreateIndexNode.cloneWith(i(this,me).node,{table:parseTable(e)})})}column(e){return new yt({...i(this,me),node:CreateIndexNode.cloneWithColumns(i(this,me).node,[parseOrderedColumnName(e)])})}columns(e){return new yt({...i(this,me),node:CreateIndexNode.cloneWithColumns(i(this,me).node,e.map(parseOrderedColumnName))})}expression(e){return new yt({...i(this,me),node:CreateIndexNode.cloneWithColumns(i(this,me).node,[e.toOperationNode()])})}using(e){return new yt({...i(this,me),node:CreateIndexNode.cloneWith(i(this,me).node,{using:RawNode.createWithSql(e)})})}where(...e){const t=new ImmediateValueTransformer;return new yt({...i(this,me),node:QueryNode.cloneWithWhere(i(this,me).node,t.transformNode(parseValueBinaryOperationOrExpression(e)))})}$call(e){return e(this)}toOperationNode(){return i(this,me).executor.transformQuery(i(this,me).node,i(this,me).queryId)}compile(){return i(this,me).executor.compileQuery(this.toOperationNode(),i(this,me).queryId)}async execute(){await i(this,me).executor.executeQuery(this.compile(),i(this,me).queryId)}};me=new WeakMap;let CreateIndexBuilder=yt;preventAwait(CreateIndexBuilder,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var ut;const as=class as{constructor(e){g(this,ut,void 0);x(this,ut,freeze(e))}ifNotExists(){return new as({...i(this,ut),node:CreateSchemaNode.cloneWith(i(this,ut).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,ut).executor.transformQuery(i(this,ut).node,i(this,ut).queryId)}compile(){return i(this,ut).executor.compileQuery(this.toOperationNode(),i(this,ut).queryId)}async execute(){await i(this,ut).executor.executeQuery(this.compile(),i(this,ut).queryId)}};ut=new WeakMap;let CreateSchemaBuilder=as;preventAwait(CreateSchemaBuilder,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function parseOnCommitAction(r){if(ON_COMMIT_ACTIONS.includes(r))return r;throw new Error(`invalid OnCommitAction ${r}`)}var ce;const lt=class lt{constructor(e){g(this,ce,void 0);x(this,ce,freeze(e))}temporary(){return new lt({...i(this,ce),node:CreateTableNode.cloneWith(i(this,ce).node,{temporary:!0})})}onCommit(e){return new lt({...i(this,ce),node:CreateTableNode.cloneWith(i(this,ce).node,{onCommit:parseOnCommitAction(e)})})}ifNotExists(){return new lt({...i(this,ce),node:CreateTableNode.cloneWith(i(this,ce).node,{ifNotExists:!0})})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new lt({...i(this,ce),node:CreateTableNode.cloneWithColumn(i(this,ce).node,o.toOperationNode())})}addPrimaryKeyConstraint(e,t){return new lt({...i(this,ce),node:CreateTableNode.cloneWithConstraint(i(this,ce).node,PrimaryConstraintNode.create(t,e))})}addUniqueConstraint(e,t,n=noop$1){const o=n(new UniqueConstraintNodeBuilder(UniqueConstraintNode.create(t,e)));return new lt({...i(this,ce),node:CreateTableNode.cloneWithConstraint(i(this,ce).node,o.toOperationNode())})}addCheckConstraint(e,t){return new lt({...i(this,ce),node:CreateTableNode.cloneWithConstraint(i(this,ce).node,CheckConstraintNode.create(t.toOperationNode(),e))})}addForeignKeyConstraint(e,t,n,o,a=noop$1){const u=a(new ForeignKeyConstraintBuilder(ForeignKeyConstraintNode.create(t.map(ColumnNode.create),parseTable(n),o.map(ColumnNode.create),e)));return new lt({...i(this,ce),node:CreateTableNode.cloneWithConstraint(i(this,ce).node,u.toOperationNode())})}modifyFront(e){return new lt({...i(this,ce),node:CreateTableNode.cloneWithFrontModifier(i(this,ce).node,e.toOperationNode())})}modifyEnd(e){return new lt({...i(this,ce),node:CreateTableNode.cloneWithEndModifier(i(this,ce).node,e.toOperationNode())})}as(e){return new lt({...i(this,ce),node:CreateTableNode.cloneWith(i(this,ce).node,{selectQuery:parseExpression(e)})})}$call(e){return e(this)}toOperationNode(){return i(this,ce).executor.transformQuery(i(this,ce).node,i(this,ce).queryId)}compile(){return i(this,ce).executor.compileQuery(this.toOperationNode(),i(this,ce).queryId)}async execute(){await i(this,ce).executor.executeQuery(this.compile(),i(this,ce).queryId)}};ce=new WeakMap;let CreateTableBuilder=lt;preventAwait(CreateTableBuilder,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var Je;const wn=class wn{constructor(e){g(this,Je,void 0);x(this,Je,freeze(e))}on(e){return new wn({...i(this,Je),node:DropIndexNode.cloneWith(i(this,Je).node,{table:parseTable(e)})})}ifExists(){return new wn({...i(this,Je),node:DropIndexNode.cloneWith(i(this,Je).node,{ifExists:!0})})}cascade(){return new wn({...i(this,Je),node:DropIndexNode.cloneWith(i(this,Je).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Je).executor.transformQuery(i(this,Je).node,i(this,Je).queryId)}compile(){return i(this,Je).executor.compileQuery(this.toOperationNode(),i(this,Je).queryId)}async execute(){await i(this,Je).executor.executeQuery(this.compile(),i(this,Je).queryId)}};Je=new WeakMap;let DropIndexBuilder=wn;preventAwait(DropIndexBuilder,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var rt;const Ni=class Ni{constructor(e){g(this,rt,void 0);x(this,rt,freeze(e))}ifExists(){return new Ni({...i(this,rt),node:DropSchemaNode.cloneWith(i(this,rt).node,{ifExists:!0})})}cascade(){return new Ni({...i(this,rt),node:DropSchemaNode.cloneWith(i(this,rt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,rt).executor.transformQuery(i(this,rt).node,i(this,rt).queryId)}compile(){return i(this,rt).executor.compileQuery(this.toOperationNode(),i(this,rt).queryId)}async execute(){await i(this,rt).executor.executeQuery(this.compile(),i(this,rt).queryId)}};rt=new WeakMap;let DropSchemaBuilder=Ni;preventAwait(DropSchemaBuilder,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var nt;const bi=class bi{constructor(e){g(this,nt,void 0);x(this,nt,freeze(e))}ifExists(){return new bi({...i(this,nt),node:DropTableNode.cloneWith(i(this,nt).node,{ifExists:!0})})}cascade(){return new bi({...i(this,nt),node:DropTableNode.cloneWith(i(this,nt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,nt).executor.transformQuery(i(this,nt).node,i(this,nt).queryId)}compile(){return i(this,nt).executor.compileQuery(this.toOperationNode(),i(this,nt).queryId)}async execute(){await i(this,nt).executor.executeQuery(this.compile(),i(this,nt).queryId)}};nt=new WeakMap;let DropTableBuilder=bi;preventAwait(DropTableBuilder,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const CreateViewNode=freeze({is(r){return r.kind==="CreateViewNode"},create(r){return freeze({kind:"CreateViewNode",name:SchemableIdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}});var wi;class ImmediateValuePlugin{constructor(){g(this,wi,new ImmediateValueTransformer)}transformQuery(e){return i(this,wi).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}wi=new WeakMap;var Re;const Ht=class Ht{constructor(e){g(this,Re,void 0);x(this,Re,freeze(e))}temporary(){return new Ht({...i(this,Re),node:CreateViewNode.cloneWith(i(this,Re).node,{temporary:!0})})}materialized(){return new Ht({...i(this,Re),node:CreateViewNode.cloneWith(i(this,Re).node,{materialized:!0})})}ifNotExists(){return new Ht({...i(this,Re),node:CreateViewNode.cloneWith(i(this,Re).node,{ifNotExists:!0})})}orReplace(){return new Ht({...i(this,Re),node:CreateViewNode.cloneWith(i(this,Re).node,{orReplace:!0})})}columns(e){return new Ht({...i(this,Re),node:CreateViewNode.cloneWith(i(this,Re).node,{columns:e.map(parseColumnName)})})}as(e){const t=e.withPlugin(new ImmediateValuePlugin).toOperationNode();return new Ht({...i(this,Re),node:CreateViewNode.cloneWith(i(this,Re).node,{as:t})})}$call(e){return e(this)}toOperationNode(){return i(this,Re).executor.transformQuery(i(this,Re).node,i(this,Re).queryId)}compile(){return i(this,Re).executor.compileQuery(this.toOperationNode(),i(this,Re).queryId)}async execute(){await i(this,Re).executor.executeQuery(this.compile(),i(this,Re).queryId)}};Re=new WeakMap;let CreateViewBuilder=Ht;preventAwait(CreateViewBuilder,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const DropViewNode=freeze({is(r){return r.kind==="DropViewNode"},create(r){return freeze({kind:"DropViewNode",name:SchemableIdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}});var He;const En=class En{constructor(e){g(this,He,void 0);x(this,He,freeze(e))}materialized(){return new En({...i(this,He),node:DropViewNode.cloneWith(i(this,He).node,{materialized:!0})})}ifExists(){return new En({...i(this,He),node:DropViewNode.cloneWith(i(this,He).node,{ifExists:!0})})}cascade(){return new En({...i(this,He),node:DropViewNode.cloneWith(i(this,He).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,He).executor.transformQuery(i(this,He).node,i(this,He).queryId)}compile(){return i(this,He).executor.compileQuery(this.toOperationNode(),i(this,He).queryId)}async execute(){await i(this,He).executor.executeQuery(this.compile(),i(this,He).queryId)}};He=new WeakMap;let DropViewBuilder=En;preventAwait(DropViewBuilder,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const CreateTypeNode=freeze({is(r){return r.kind==="CreateTypeNode"},create(r){return freeze({kind:"CreateTypeNode",name:r})},cloneWithEnum(r,e){return freeze({...r,enum:ValueListNode.create(e.map(t=>ValueNode.createImmediate(t)))})}});var ct;const ls=class ls{constructor(e){g(this,ct,void 0);x(this,ct,freeze(e))}toOperationNode(){return i(this,ct).executor.transformQuery(i(this,ct).node,i(this,ct).queryId)}asEnum(e){return new ls({...i(this,ct),node:CreateTypeNode.cloneWithEnum(i(this,ct).node,e)})}$call(e){return e(this)}compile(){return i(this,ct).executor.compileQuery(this.toOperationNode(),i(this,ct).queryId)}async execute(){await i(this,ct).executor.executeQuery(this.compile(),i(this,ct).queryId)}};ct=new WeakMap;let CreateTypeBuilder=ls;preventAwait(CreateTypeBuilder,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const DropTypeNode=freeze({is(r){return r.kind==="DropTypeNode"},create(r){return freeze({kind:"DropTypeNode",name:r})},cloneWith(r,e){return freeze({...r,...e})}});var dt;const us=class us{constructor(e){g(this,dt,void 0);x(this,dt,freeze(e))}ifExists(){return new us({...i(this,dt),node:DropTypeNode.cloneWith(i(this,dt).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,dt).executor.transformQuery(i(this,dt).node,i(this,dt).queryId)}compile(){return i(this,dt).executor.compileQuery(this.toOperationNode(),i(this,dt).queryId)}async execute(){await i(this,dt).executor.executeQuery(this.compile(),i(this,dt).queryId)}};dt=new WeakMap;let DropTypeBuilder=us;preventAwait(DropTypeBuilder,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function parseSchemableIdentifier(r){const e=".";if(r.includes(e)){const t=r.split(e).map(trim);if(t.length===2)return SchemableIdentifierNode.createWithSchema(t[0],t[1]);throw new Error(`invalid schemable identifier ${r}`)}else return SchemableIdentifierNode.create(r)}function trim(r){return r.trim()}var Qe;const _n=class _n{constructor(e){g(this,Qe,void 0);x(this,Qe,e)}createTable(e){return new CreateTableBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateTableNode.create(parseTable(e))})}dropTable(e){return new DropTableBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropTableNode.create(parseTable(e))})}createIndex(e){return new CreateIndexBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateIndexNode.create(e)})}dropIndex(e){return new DropIndexBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropIndexNode.create(e)})}createSchema(e){return new CreateSchemaBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateSchemaNode.create(e)})}dropSchema(e){return new DropSchemaBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropSchemaNode.create(e)})}alterTable(e){return new AlterTableBuilder({queryId:createQueryId(),executor:i(this,Qe),node:AlterTableNode.create(parseTable(e))})}createView(e){return new CreateViewBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateViewNode.create(e)})}dropView(e){return new DropViewBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropViewNode.create(e)})}createType(e){return new CreateTypeBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateTypeNode.create(parseSchemableIdentifier(e))})}dropType(e){return new DropTypeBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropTypeNode.create(parseSchemableIdentifier(e))})}withPlugin(e){return new _n(i(this,Qe).withPlugin(e))}withoutPlugins(){return new _n(i(this,Qe).withoutPlugins())}withSchema(e){return new _n(i(this,Qe).withPluginAtFront(new WithSchemaPlugin(e)))}};Qe=new WeakMap;let SchemaModule=_n;class DynamicModule{ref(e){return new DynamicReferenceBuilder(e)}}var Xr;class DefaultConnectionProvider{constructor(e){g(this,Xr,void 0);x(this,Xr,e)}async provideConnection(e){const t=await i(this,Xr).acquireConnection();try{return await e(t)}finally{await i(this,Xr).releaseConnection(t)}}}Xr=new WeakMap;var Rt,xt,Dt;const lr=class lr extends QueryExecutorBase{constructor(t,n,o,a=[]){super(a);g(this,Rt,void 0);g(this,xt,void 0);g(this,Dt,void 0);x(this,Rt,t),x(this,xt,n),x(this,Dt,o)}get adapter(){return i(this,xt)}compileQuery(t){return i(this,Rt).compileQuery(t)}provideConnection(t){return i(this,Dt).provideConnection(t)}withPlugins(t){return new lr(i(this,Rt),i(this,xt),i(this,Dt),[...this.plugins,...t])}withPlugin(t){return new lr(i(this,Rt),i(this,xt),i(this,Dt),[...this.plugins,t])}withPluginAtFront(t){return new lr(i(this,Rt),i(this,xt),i(this,Dt),[t,...this.plugins])}withConnectionProvider(t){return new lr(i(this,Rt),i(this,xt),t,[...this.plugins])}withoutPlugins(){return new lr(i(this,Rt),i(this,xt),i(this,Dt),[])}};Rt=new WeakMap,xt=new WeakMap,Dt=new WeakMap;let DefaultQueryExecutor=lr;function performanceNow(){return typeof performance<"u"&&isFunction(performance.now)?performance.now():Date.now()}var Et,Gt,Wt,Yr,Bt,xn,Ei,Vo,_i,Jo,gi,Ho,Oi,jo,kn,es;class RuntimeDriver{constructor(e,t){g(this,Ei);g(this,_i);g(this,gi);g(this,Oi);g(this,kn);g(this,Et,void 0);g(this,Gt,void 0);g(this,Wt,void 0);g(this,Yr,void 0);g(this,Bt,void 0);g(this,xn,new WeakSet);x(this,Yr,!1),x(this,Et,e),x(this,Gt,t)}async init(){if(i(this,Bt))throw new Error("driver has already been destroyed");i(this,Wt)||x(this,Wt,i(this,Et).init().then(()=>{x(this,Yr,!0)}).catch(e=>(x(this,Wt,void 0),Promise.reject(e)))),await i(this,Wt)}async acquireConnection(){if(i(this,Bt))throw new Error("driver has already been destroyed");i(this,Yr)||await this.init();const e=await i(this,Et).acquireConnection();return i(this,xn).has(e)||(X(this,Ei,Vo).call(this)&&X(this,_i,Jo).call(this,e),i(this,xn).add(e)),e}async releaseConnection(e){await i(this,Et).releaseConnection(e)}beginTransaction(e,t){return i(this,Et).beginTransaction(e,t)}commitTransaction(e){return i(this,Et).commitTransaction(e)}rollbackTransaction(e){return i(this,Et).rollbackTransaction(e)}async destroy(){i(this,Wt)&&(await i(this,Wt),i(this,Bt)||x(this,Bt,i(this,Et).destroy().catch(e=>(x(this,Bt,void 0),Promise.reject(e)))),await i(this,Bt))}}Et=new WeakMap,Gt=new WeakMap,Wt=new WeakMap,Yr=new WeakMap,Bt=new WeakMap,xn=new WeakMap,Ei=new WeakSet,Vo=function(){return i(this,Gt).isLevelEnabled("query")||i(this,Gt).isLevelEnabled("error")},_i=new WeakSet,Jo=function(e){const t=e.executeQuery;e.executeQuery=async n=>{let o;const a=performanceNow();try{return await t.call(e,n)}catch(u){throw o=u,await X(this,gi,Ho).call(this,u,n,a),u}finally{o||await X(this,Oi,jo).call(this,n,a)}}},gi=new WeakSet,Ho=async function(e,t,n){await i(this,Gt).error(()=>({level:"error",error:e,query:t,queryDurationMillis:X(this,kn,es).call(this,n)}))},Oi=new WeakSet,jo=async function(e,t){await i(this,Gt).query(()=>({level:"query",query:e,queryDurationMillis:X(this,kn,es).call(this,t)}))},kn=new WeakSet,es=function(e){return performanceNow()-e};const ignoreError=()=>{};var An,Xt,Ti,Ko;class SingleConnectionProvider{constructor(e){g(this,Ti);g(this,An,void 0);g(this,Xt,void 0);x(this,An,e)}async provideConnection(e){for(;i(this,Xt);)await i(this,Xt).catch(ignoreError);return x(this,Xt,X(this,Ti,Ko).call(this,e).finally(()=>{x(this,Xt,void 0)})),i(this,Xt)}}An=new WeakMap,Xt=new WeakMap,Ti=new WeakSet,Ko=async function(e){return await e(i(this,An))};const TRANSACTION_ISOLATION_LEVELS=["read uncommitted","read committed","repeatable read","serializable","snapshot"];freeze(["query","error"]);var Yt,br;class Log{constructor(e){g(this,Yt,void 0);g(this,br,void 0);isFunction(e)?(x(this,br,e),x(this,Yt,freeze({query:!0,error:!0}))):(x(this,br,defaultLogger),x(this,Yt,freeze({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return i(this,Yt)[e]}async query(e){i(this,Yt).query&&await i(this,br).call(this,e())}async error(e){i(this,Yt).error&&await i(this,br).call(this,e())}}Yt=new WeakMap,br=new WeakMap;function defaultLogger(r){r.level==="query"?(console.log(`kysely:query: ${r.query.sql}`),console.log(`kysely:query: duration: ${r.queryDurationMillis.toFixed(1)}ms`)):r.level==="error"&&(r.error instanceof Error?console.error(`kysely:error: ${r.error.stack??r.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:r.error,query:r.query.sql,queryDurationMillis:r.queryDurationMillis})}`))}function isCompilable(r){return isObject$3(r)&&isFunction(r.compile)}var je;const qr=class qr extends QueryCreator{constructor(t){let n,o;if(isKyselyProps(t))n={executor:t.executor},o={...t};else{const a=t.dialect,u=a.createDriver(),d=a.createQueryCompiler(),h=a.createAdapter(),p=new Log(t.log??[]),m=new RuntimeDriver(u,p),E=new DefaultConnectionProvider(m),k=new DefaultQueryExecutor(d,h,E,t.plugins??[]);n={executor:k},o={config:t,executor:k,dialect:a,driver:m}}super(n);g(this,je,void 0);x(this,je,freeze(o))}get schema(){return new SchemaModule(i(this,je).executor)}get dynamic(){return new DynamicModule}get introspection(){return i(this,je).dialect.createIntrospector(this.withoutPlugins())}case(t){return new CaseBuilder({node:CaseNode.create(isUndefined(t)?void 0:parseExpression(t))})}get fn(){return createFunctionModule()}transaction(){return new TransactionBuilder({...i(this,je)})}connection(){return new ConnectionBuilder({...i(this,je)})}withPlugin(t){return new qr({...i(this,je),executor:i(this,je).executor.withPlugin(t)})}withoutPlugins(){return new qr({...i(this,je),executor:i(this,je).executor.withoutPlugins()})}withSchema(t){return new qr({...i(this,je),executor:i(this,je).executor.withPluginAtFront(new WithSchemaPlugin(t))})}withTables(){return new qr({...i(this,je)})}async destroy(){await i(this,je).driver.destroy()}get isTransaction(){return!1}getExecutor(){return i(this,je).executor}executeQuery(t,n=createQueryId()){const o=isCompilable(t)?t.compile():t;return this.getExecutor().executeQuery(o,n)}};je=new WeakMap;let Kysely=qr;var _t;const Dr=class Dr extends Kysely{constructor(t){super(t);g(this,_t,void 0);x(this,_t,t)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(t){return new Dr({...i(this,_t),executor:i(this,_t).executor.withPlugin(t)})}withoutPlugins(){return new Dr({...i(this,_t),executor:i(this,_t).executor.withoutPlugins()})}withSchema(t){return new Dr({...i(this,_t),executor:i(this,_t).executor.withPluginAtFront(new WithSchemaPlugin(t))})}withTables(){return new Dr({...i(this,_t)})}};_t=new WeakMap;let Transaction=Dr;function isKyselyProps(r){return isObject$3(r)&&isObject$3(r.config)&&isObject$3(r.driver)&&isObject$3(r.executor)&&isObject$3(r.dialect)}var wr;class ConnectionBuilder{constructor(e){g(this,wr,void 0);x(this,wr,freeze(e))}async execute(e){return i(this,wr).executor.provideConnection(async t=>{const n=i(this,wr).executor.withConnectionProvider(new SingleConnectionProvider(t)),o=new Kysely({...i(this,wr),executor:n});return await e(o)})}}wr=new WeakMap;preventAwait(ConnectionBuilder,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var gt;const cs=class cs{constructor(e){g(this,gt,void 0);x(this,gt,freeze(e))}setIsolationLevel(e){return new cs({...i(this,gt),isolationLevel:e})}async execute(e){const{isolationLevel:t,...n}=i(this,gt),o={isolationLevel:t};return validateTransactionSettings(o),i(this,gt).executor.provideConnection(async a=>{const u=i(this,gt).executor.withConnectionProvider(new SingleConnectionProvider(a)),d=new Transaction({...n,executor:u});try{await i(this,gt).driver.beginTransaction(a,o);const h=await e(d);return await i(this,gt).driver.commitTransaction(a),h}catch(h){throw await i(this,gt).driver.rollbackTransaction(a),h}})}};gt=new WeakMap;let TransactionBuilder=cs;preventAwait(TransactionBuilder,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function validateTransactionSettings(r){if(r.isolationLevel&&!TRANSACTION_ISOLATION_LEVELS.includes(r.isolationLevel))throw new Error(`invalid transaction isolation level ${r.isolationLevel}`)}var it,Zr,ii,Ln,ts,qn,rs;const gn=class gn{constructor(e){g(this,Zr);g(this,Ln);g(this,qn);g(this,it,void 0);x(this,it,freeze(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new AliasedRawBuilderImpl(this,e)}$castTo(){return new gn({...i(this,it)})}$notNull(){return new gn(i(this,it))}withPlugin(e){return new gn({...i(this,it),plugins:i(this,it).plugins!==void 0?freeze([...i(this,it).plugins,e]):freeze([e])})}toOperationNode(){return X(this,Ln,ts).call(this,X(this,Zr,ii).call(this))}compile(e){return X(this,qn,rs).call(this,X(this,Zr,ii).call(this,e))}async execute(e){const t=X(this,Zr,ii).call(this,e);return t.executeQuery(X(this,qn,rs).call(this,t),i(this,it).queryId)}};it=new WeakMap,Zr=new WeakSet,ii=function(e){const t=e!==void 0?e.getExecutor():NOOP_QUERY_EXECUTOR;return i(this,it).plugins!==void 0?t.withPlugins(i(this,it).plugins):t},Ln=new WeakSet,ts=function(e){return e.transformQuery(i(this,it).rawNode,i(this,it).queryId)},qn=new WeakSet,rs=function(e){return e.compileQuery(X(this,Ln,ts).call(this,e),i(this,it).queryId)};let RawBuilderImpl=gn;function createRawBuilder(r){return new RawBuilderImpl(r)}preventAwait(RawBuilderImpl,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Er,Zt;class AliasedRawBuilderImpl{constructor(e,t){g(this,Er,void 0);g(this,Zt,void 0);x(this,Er,e),x(this,Zt,t)}get expression(){return i(this,Er)}get alias(){return i(this,Zt)}get rawBuilder(){return i(this,Er)}toOperationNode(){return AliasNode.create(i(this,Er).toOperationNode(),isOperationNodeSource(i(this,Zt))?i(this,Zt).toOperationNode():IdentifierNode.create(i(this,Zt)))}}Er=new WeakMap,Zt=new WeakMap;preventAwait(AliasedRawBuilderImpl,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const sql=Object.assign((r,...e)=>createRawBuilder({queryId:createQueryId(),rawNode:RawNode.create(r,(e==null?void 0:e.map(parseParameter))??[])}),{ref(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseStringReference(r))})},val(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseValueExpression(r))})},value(r){return this.val(r)},table(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseTable(r))})},id(...r){const e=new Array(r.length+1).fill(".");return e[0]="",e[e.length-1]="",createRawBuilder({queryId:createQueryId(),rawNode:RawNode.create(e,r.map(IdentifierNode.create))})},lit(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(ValueNode.createImmediate(r))})},literal(r){return this.lit(r)},raw(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithSql(r)})},join(r,e=sql`, `){const t=new Array(2*r.length-1),n=e.toOperationNode();for(let o=0;o<r.length;++o)t[2*o]=parseParameter(r[o]),o!==r.length-1&&(t[2*o+1]=n);return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChildren(t)})}});function parseParameter(r){return isOperationNodeSource(r)?r.toOperationNode():parseValueExpression(r)}var Ii;class OperationNodeVisitor{constructor(){ae(this,"nodeStack",[]);g(this,Ii,freeze({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),AddIndexNode:this.visitAddIndex.bind(this)}));ae(this,"visitNode",e=>{this.nodeStack.push(e),i(this,Ii)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Ii=new WeakMap;var en,_r;class DefaultQueryCompiler extends OperationNodeVisitor{constructor(){super(...arguments);g(this,en,"");g(this,_r,[])}get numParameters(){return i(this,_r).length}compileQuery(t){return x(this,en,""),x(this,_r,[]),this.visitNode(t),freeze({query:t,sql:this.getSql(),parameters:[...i(this,_r)]})}getSql(){return i(this,en)}visitSelectQuery(t){var o,a;const n=this.parentNode!==void 0&&!ParensNode.is(this.parentNode)&&!InsertQueryNode.is(this.parentNode)&&!CreateTableNode.is(this.parentNode)&&!CreateViewNode.is(this.parentNode)&&!SetOperationNode.is(this.parentNode);this.parentNode===void 0&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("select"),t.distinctOn&&(this.append(" "),this.compileDistinctOn(t.distinctOn)),(o=t.frontModifiers)!=null&&o.length&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.selections&&(this.append(" "),this.compileList(t.selections)),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.groupBy&&(this.append(" "),this.visitNode(t.groupBy)),t.having&&(this.append(" "),this.visitNode(t.having)),t.setOperations&&(this.append(" "),this.compileList(t.setOperations," ")),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.offset&&(this.append(" "),this.visitNode(t.offset)),(a=t.endModifiers)!=null&&a.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...t.endModifiers])," ")),n&&this.append(")")}visitFrom(t){this.append("from "),this.compileList(t.froms)}visitSelection(t){this.visitNode(t.selection)}visitColumn(t){this.visitNode(t.column)}compileDistinctOn(t){this.append("distinct on ("),this.compileList(t),this.append(")")}compileList(t,n=", "){const o=t.length-1;for(let a=0;a<=o;a++)this.visitNode(t[a]),a<o&&this.append(n)}visitWhere(t){this.append("where "),this.visitNode(t.where)}visitHaving(t){this.append("having "),this.visitNode(t.having)}visitInsertQuery(t){const n=this.nodeStack.find(QueryNode.is)!==t;!n&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append(t.replace?"replace":"insert"),t.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(t.into),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.values&&(this.append(" "),this.visitNode(t.values)),t.defaultValues&&(this.append(" "),this.append("default values")),t.onConflict&&(this.append(" "),this.visitNode(t.onConflict)),t.onDuplicateKey&&(this.append(" "),this.visitNode(t.onDuplicateKey)),t.returning&&(this.append(" "),this.visitNode(t.returning)),n&&this.append(")")}visitValues(t){this.append("values "),this.compileList(t.values)}visitDeleteQuery(t){const n=this.nodeStack.find(QueryNode.is)!==t;!n&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("delete "),this.visitNode(t.from),t.using&&(this.append(" "),this.visitNode(t.using)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.returning&&(this.append(" "),this.visitNode(t.returning)),n&&this.append(")")}visitReturning(t){this.append("returning "),this.compileList(t.selections)}visitAlias(t){this.visitNode(t.node),this.append(" as "),this.visitNode(t.alias)}visitReference(t){t.table&&(this.visitNode(t.table),this.append(".")),this.visitNode(t.column)}visitSelectAll(t){this.append("*")}visitIdentifier(t){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(t),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(t){if(!isString(t.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(t.name))}visitAnd(t){this.visitNode(t.left),this.append(" and "),this.visitNode(t.right)}visitOr(t){this.visitNode(t.left),this.append(" or "),this.visitNode(t.right)}visitValue(t){t.immediate?this.appendImmediateValue(t.value):this.appendValue(t.value)}visitValueList(t){this.append("("),this.compileList(t.values),this.append(")")}visitTuple(t){this.append("("),this.compileList(t.values),this.append(")")}visitPrimitiveValueList(t){this.append("(");const{values:n}=t;for(let o=0;o<n.length;++o)this.appendValue(n[o]),o!==n.length-1&&this.append(", ");this.append(")")}visitParens(t){this.append("("),this.visitNode(t.node),this.append(")")}visitJoin(t){this.append(JOIN_TYPE_SQL[t.joinType]),this.append(" "),this.visitNode(t.table),t.on&&(this.append(" "),this.visitNode(t.on))}visitOn(t){this.append("on "),this.visitNode(t.on)}visitRaw(t){const{sqlFragments:n,parameters:o}=t;for(let a=0;a<n.length;++a)this.append(n[a]),o.length>a&&this.visitNode(o[a])}visitOperator(t){this.append(t.operator)}visitTable(t){this.visitNode(t.table)}visitSchemableIdentifier(t){t.schema&&(this.visitNode(t.schema),this.append(".")),this.visitNode(t.identifier)}visitCreateTable(t){this.append("create "),t.frontModifiers&&t.frontModifiers.length>0&&(this.compileList(t.frontModifiers," "),this.append(" ")),t.temporary&&this.append("temporary "),this.append("table "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.table),t.selectQuery?(this.append(" as "),this.visitNode(t.selectQuery)):(this.append(" ("),this.compileList([...t.columns,...t.constraints??[]]),this.append(")"),t.onCommit&&(this.append(" on commit "),this.append(t.onCommit)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," ")))}visitColumnDefinition(t){this.visitNode(t.column),this.append(" "),this.visitNode(t.dataType),t.unsigned&&this.append(" unsigned"),t.frontModifiers&&t.frontModifiers.length>0&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.generated&&(this.append(" "),this.visitNode(t.generated)),t.defaultTo&&(this.append(" "),this.visitNode(t.defaultTo)),t.notNull&&this.append(" not null"),t.unique&&this.append(" unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.primaryKey&&this.append(" primary key"),t.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),t.references&&(this.append(" "),this.visitNode(t.references)),t.check&&(this.append(" "),this.visitNode(t.check)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(t){this.append("references "),this.visitNode(t.table),this.append(" ("),this.compileList(t.columns),this.append(")"),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate))}visitDropTable(t){this.append("drop table "),t.ifExists&&this.append("if exists "),this.visitNode(t.table),t.cascade&&this.append(" cascade")}visitDataType(t){this.append(t.dataType)}visitOrderBy(t){this.append("order by "),this.compileList(t.items)}visitOrderByItem(t){this.visitNode(t.orderBy),t.direction&&(this.append(" "),this.visitNode(t.direction))}visitGroupBy(t){this.append("group by "),this.compileList(t.items)}visitGroupByItem(t){this.visitNode(t.groupBy)}visitUpdateQuery(t){const n=this.nodeStack.find(QueryNode.is)!==t;!n&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("update "),this.visitNode(t.table),this.append(" set "),t.updates&&this.compileList(t.updates),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.returning&&(this.append(" "),this.visitNode(t.returning)),n&&this.append(")")}visitColumnUpdate(t){this.visitNode(t.column),this.append(" = "),this.visitNode(t.value)}visitLimit(t){this.append("limit "),this.visitNode(t.limit)}visitOffset(t){this.append("offset "),this.visitNode(t.offset)}visitOnConflict(t){this.append("on conflict"),t.columns?(this.append(" ("),this.compileList(t.columns),this.append(")")):t.constraint?(this.append(" on constraint "),this.visitNode(t.constraint)):t.indexExpression&&(this.append(" ("),this.visitNode(t.indexExpression),this.append(")")),t.indexWhere&&(this.append(" "),this.visitNode(t.indexWhere)),t.doNothing===!0?this.append(" do nothing"):t.updates&&(this.append(" do update set "),this.compileList(t.updates),t.updateWhere&&(this.append(" "),this.visitNode(t.updateWhere)))}visitOnDuplicateKey(t){this.append("on duplicate key update "),this.compileList(t.updates)}visitCreateIndex(t){this.append("create "),t.unique&&this.append("unique "),this.append("index "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.using&&(this.append(" using "),this.visitNode(t.using)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.where&&(this.append(" "),this.visitNode(t.where))}visitDropIndex(t){this.append("drop index "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.cascade&&this.append(" cascade")}visitCreateSchema(t){this.append("create schema "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.schema)}visitDropSchema(t){this.append("drop schema "),t.ifExists&&this.append("if exists "),this.visitNode(t.schema),t.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("primary key ("),this.compileList(t.columns),this.append(")")}visitUniqueConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(t.columns),this.append(")")}visitCheckConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("check ("),this.visitNode(t.expression),this.append(")")}visitForeignKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("foreign key ("),this.compileList(t.columns),this.append(") "),this.visitNode(t.references),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate))}visitList(t){this.compileList(t.items)}visitWith(t){this.append("with "),t.recursive&&this.append("recursive "),this.compileList(t.expressions)}visitCommonTableExpression(t){this.visitNode(t.name),this.append(" as "),isBoolean(t.materialized)&&(t.materialized||this.append("not "),this.append("materialized ")),this.visitNode(t.expression)}visitCommonTableExpressionName(t){this.visitNode(t.table),t.columns&&(this.append("("),this.compileList(t.columns),this.append(")"))}visitAlterTable(t){this.append("alter table "),this.visitNode(t.table),this.append(" "),t.renameTo&&(this.append("rename to "),this.visitNode(t.renameTo)),t.setSchema&&(this.append("set schema "),this.visitNode(t.setSchema)),t.addConstraint&&this.visitNode(t.addConstraint),t.dropConstraint&&this.visitNode(t.dropConstraint),t.columnAlterations&&this.compileColumnAlterations(t.columnAlterations),t.addIndex&&this.visitNode(t.addIndex),t.dropIndex&&this.visitNode(t.dropIndex)}visitAddColumn(t){this.append("add column "),this.visitNode(t.column)}visitRenameColumn(t){this.append("rename column "),this.visitNode(t.column),this.append(" to "),this.visitNode(t.renameTo)}visitDropColumn(t){this.append("drop column "),this.visitNode(t.column)}visitAlterColumn(t){this.append("alter column "),this.visitNode(t.column),this.append(" "),t.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(t.dataType),t.dataTypeExpression&&(this.append("using "),this.visitNode(t.dataTypeExpression))),t.setDefault&&(this.append("set default "),this.visitNode(t.setDefault)),t.dropDefault&&this.append("drop default"),t.setNotNull&&this.append("set not null"),t.dropNotNull&&this.append("drop not null")}visitModifyColumn(t){this.append("modify column "),this.visitNode(t.column)}visitAddConstraint(t){this.append("add "),this.visitNode(t.constraint)}visitDropConstraint(t){this.append("drop constraint "),t.ifExists&&this.append("if exists "),this.visitNode(t.constraintName),t.modifier==="cascade"?this.append(" cascade"):t.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(t){this.append(t.operator),this.append(" "),t.all&&this.append("all "),this.visitNode(t.expression)}visitCreateView(t){this.append("create "),t.orReplace&&this.append("or replace "),t.materialized&&this.append("materialized "),t.temporary&&this.append("temporary "),this.append("view "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),this.append(" "),t.columns&&(this.append("("),this.compileList(t.columns),this.append(") ")),t.as&&(this.append("as "),this.visitNode(t.as))}visitDropView(t){this.append("drop "),t.materialized&&this.append("materialized "),this.append("view "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.cascade&&this.append(" cascade")}visitGenerated(t){this.append("generated "),t.always&&this.append("always "),t.byDefault&&this.append("by default "),this.append("as "),t.identity&&this.append("identity"),t.expression&&(this.append("("),this.visitNode(t.expression),this.append(")")),t.stored&&this.append(" stored")}visitDefaultValue(t){this.append("default "),this.visitNode(t.defaultValue)}visitSelectModifier(t){t.rawModifier?this.visitNode(t.rawModifier):this.append(SELECT_MODIFIER_SQL[t.modifier]),t.of&&(this.append(" of "),this.compileList(t.of,", "))}visitCreateType(t){this.append("create type "),this.visitNode(t.name),t.enum&&(this.append(" as enum "),this.visitNode(t.enum))}visitDropType(t){this.append("drop type "),t.ifExists&&this.append("if exists "),this.visitNode(t.name)}visitExplain(t){this.append("explain"),(t.options||t.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),t.options&&(this.visitNode(t.options),t.format&&this.append(this.getExplainOptionsDelimiter())),t.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(t.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(t){this.append("default")}visitAggregateFunction(t){this.append(t.func),this.append("("),t.distinct&&this.append("distinct "),this.compileList(t.aggregated),this.append(")"),t.filter&&(this.append(" filter("),this.visitNode(t.filter),this.append(")")),t.over&&(this.append(" "),this.visitNode(t.over))}visitOver(t){this.append("over("),t.partitionBy&&(this.visitNode(t.partitionBy),t.orderBy&&this.append(" ")),t.orderBy&&this.visitNode(t.orderBy),this.append(")")}visitPartitionBy(t){this.append("partition by "),this.compileList(t.items)}visitPartitionByItem(t){this.visitNode(t.partitionBy)}visitBinaryOperation(t){this.visitNode(t.leftOperand),this.append(" "),this.visitNode(t.operator),this.append(" "),this.visitNode(t.rightOperand)}visitUnaryOperation(t){this.visitNode(t.operator),this.isMinusOperator(t.operator)||this.append(" "),this.visitNode(t.operand)}isMinusOperator(t){return OperatorNode.is(t)&&t.operator==="-"}visitUsing(t){this.append("using "),this.compileList(t.tables)}visitFunction(t){this.append(t.func),this.append("("),this.compileList(t.arguments),this.append(")")}visitCase(t){this.append("case"),t.value&&(this.append(" "),this.visitNode(t.value)),t.when&&(this.append(" "),this.compileList(t.when," ")),t.else&&(this.append(" else "),this.visitNode(t.else)),this.append(" end"),t.isStatement&&this.append(" case")}visitWhen(t){this.append("when "),this.visitNode(t.condition),t.result&&(this.append(" then "),this.visitNode(t.result))}visitJSONReference(t){this.visitNode(t.reference),this.visitNode(t.traversal)}visitJSONPath(t){t.inOperator&&this.visitNode(t.inOperator),this.append("'$");for(const n of t.pathLegs)this.visitNode(n);this.append("'")}visitJSONPathLeg(t){const n=t.type==="ArrayLocation";this.append(n?"[":"."),this.append(String(t.value)),n&&this.append("]")}visitJSONOperatorChain(t){for(let n=0,o=t.values.length;n<o;n++)n===o-1?this.visitNode(t.operator):this.append("->"),this.visitNode(t.values[n])}visitAddIndex(t){this.append("add "),t.unique&&this.append("unique "),this.append("index "),this.visitNode(t.name),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.using&&(this.append(" using "),this.visitNode(t.using))}append(t){x(this,en,i(this,en)+t)}appendValue(t){this.addParameter(t),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(t){const n=this.getLeftIdentifierWrapper(),o=this.getRightIdentifierWrapper();let a="";for(const u of t)a+=u,u===n?a+=n:u===o&&(a+=o);return a}addParameter(t){i(this,_r).push(t)}appendImmediateValue(t){if(isString(t))this.append(`'${t}'`);else if(isNumber(t)||isBoolean(t))this.append(t.toString());else if(isNull(t))this.append("null");else if(isDate(t))this.appendImmediateValue(t.toISOString());else if(isBigInt(t))this.appendImmediateValue(t.toString());else throw new Error(`invalid immediate value ${t}`)}sortSelectModifiers(t){return t.sort((n,o)=>n.modifier&&o.modifier?SELECT_MODIFIER_PRIORITY[n.modifier]-SELECT_MODIFIER_PRIORITY[o.modifier]:1),freeze(t)}compileColumnAlterations(t){this.compileList(t)}announcesNewColumnDataType(){return!0}}en=new WeakMap,_r=new WeakMap;const SELECT_MODIFIER_SQL=freeze({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),SELECT_MODIFIER_PRIORITY=freeze({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),JOIN_TYPE_SQL=freeze({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),CompiledQuery=freeze({raw(r,e=[]){return freeze({sql:r,query:RawNode.createWithSql(r),parameters:freeze(e)})}});class DialectAdapterBase{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}}var Ft,Dn,tn,rn;class SqliteDriver{constructor(e){g(this,Ft,void 0);g(this,Dn,new ConnectionMutex);g(this,tn,void 0);g(this,rn,void 0);x(this,Ft,freeze({...e}))}async init(){x(this,tn,isFunction(i(this,Ft).database)?await i(this,Ft).database():i(this,Ft).database),x(this,rn,new SqliteConnection(i(this,tn))),i(this,Ft).onCreateConnection&&await i(this,Ft).onCreateConnection(i(this,rn))}async acquireConnection(){return await i(this,Dn).lock(),i(this,rn)}async beginTransaction(e){await e.executeQuery(CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(CompiledQuery.raw("rollback"))}async releaseConnection(){i(this,Dn).unlock()}async destroy(){var e;(e=i(this,tn))==null||e.close()}}Ft=new WeakMap,Dn=new WeakMap,tn=new WeakMap,rn=new WeakMap;var nn;class SqliteConnection{constructor(e){g(this,nn,void 0);x(this,nn,e)}executeQuery(e){const{sql:t,parameters:n}=e,o=i(this,nn).prepare(t);if(o.reader)return Promise.resolve({rows:o.all(n)});{const{changes:a,lastInsertRowid:u}=o.run(n),d=a!=null?BigInt(a):void 0;return Promise.resolve({numUpdatedOrDeletedRows:d,numAffectedRows:d,insertId:u!=null?BigInt(u):void 0,rows:[]})}}async*streamQuery(e,t){const{sql:n,parameters:o,query:a}=e,u=i(this,nn).prepare(n);if(SelectQueryNode.is(a)){const d=u.iterate(o);for(const h of d)yield{rows:[h]}}else throw new Error("Sqlite driver only supports streaming of select queries")}}nn=new WeakMap;var gr,sn;class ConnectionMutex{constructor(){g(this,gr,void 0);g(this,sn,void 0)}async lock(){for(;i(this,gr);)await i(this,gr);x(this,gr,new Promise(e=>{x(this,sn,e)}))}unlock(){const e=i(this,sn);x(this,gr,void 0),x(this,sn,void 0),e==null||e()}}gr=new WeakMap,sn=new WeakMap;const ID_WRAP_REGEX=/"/g;class SqliteQueryCompiler extends DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(ID_WRAP_REGEX,'""')}visitDefaultInsertValue(e){this.append("null")}}const DEFAULT_MIGRATION_TABLE="kysely_migration",DEFAULT_MIGRATION_LOCK_TABLE="kysely_migration_lock";freeze({__noMigrations__:!0});var on,Si,Go;class SqliteIntrospector{constructor(e){g(this,Si);g(this,on,void 0);x(this,on,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let t=i(this,on).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(t=t.where("name","!=",DEFAULT_MIGRATION_TABLE).where("name","!=",DEFAULT_MIGRATION_LOCK_TABLE));const n=await t.execute();return Promise.all(n.map(({name:o})=>X(this,Si,Go).call(this,o)))}async getMetadata(e){return{tables:await this.getTables(e)}}}on=new WeakMap,Si=new WeakSet,Go=async function(e){var u,d,h,p,m,E;const t=i(this,on),n=await t.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),o=(E=(m=(p=(h=(d=(u=n.sql)==null?void 0:u.split(/[\(\),]/))==null?void 0:d.find(k=>k.toLowerCase().includes("autoincrement")))==null?void 0:h.trimStart())==null?void 0:p.split(/\s+/))==null?void 0:m[0])==null?void 0:E.replace(/["`]/g,""),a=await t.selectFrom(sql`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:n.type==="view",columns:a.map(k=>({name:k.name,dataType:k.type,isNullable:!k.notnull,isAutoIncrementing:k.name===o,hasDefaultValue:k.dflt_value!=null}))}};class SqliteAdapter extends DialectAdapterBase{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}var Wn;class SqliteDialect{constructor(e){g(this,Wn,void 0);x(this,Wn,freeze({...e}))}createDriver(){return new SqliteDriver(i(this,Wn))}createQueryCompiler(){return new SqliteQueryCompiler}createAdapter(){return new SqliteAdapter}createIntrospector(e){return new SqliteIntrospector(e)}}Wn=new WeakMap;const schema$1=[["site_id","object"],["cid","string"],["pk","object"],["table","string"],["val","any"],["db_version","number"],["col_version","number"],["cl","number"],["seq","number"]];function encode(r){return encode$1(r,schema$1)}function decode(r){return decode$1(r,schema$1)}function toBytes(r){return Uint8Array.from([...r].map(e=>e.charCodeAt(0)))}function fromBytes(r){return String.fromCharCode(...r)}function selectVersion(){const r=sql`SELECT 
    crsql_db_version() as current,
    IFNULL(MAX(version), 0) as synced
  FROM "__crstore_sync"`;return{execute:()=>r.execute(this).then(e=>e.rows[0])}}function updateVersion(r){return this.updateTable("__crstore_sync").set({version:r??sql`crsql_db_version()`})}function selectClient(){const r=sql`SELECT crsql_site_id() as client`;return{execute:()=>r.execute(this).then(e=>fromBytes(e.rows[0].client))}}function changesSince(r,{filter:e=void 0,chunk:t=!1}={}){let n=this.selectFrom("crsql_changes").select(sql`crsql_site_id()`.as("site_id")).select(["cid","pk","table","val","db_version","col_version","cl","seq"]).where("db_version",">",r).$if(!r,o=>o.where("cid","!=","__crsql_del")).$if(e===null,o=>o.where("site_id","is",sql`crsql_site_id()`)).$if(typeof e=="string",o=>o.where("site_id","is not",toBytes(e))).$castTo();return{execute:()=>n.execute().then(o=>t?chunk(o,{strict:!1}).map(encode):encode(o))}}function insertChanges(r){const e=async t=>{if(!r.length)return;const n=chunk(decode(r)).map(o=>t.insertInto("crsql_changes").values(o).execute());await Promise.all(n),await updateVersion.bind(t)().execute()};return{execute:()=>this.isTransaction?e(this):this.transaction().execute(e)}}function resolveChanges(r){return{execute:()=>applyOperation.bind(this)(e=>insertChanges.bind(e)(r).execute()).execute().then(e=>e.changes)}}function applyOperation(r,...e){return{execute:()=>this.transaction().execute(async t=>{const{current:n}=await selectVersion.bind(t)().execute(),o=await r(t,...e),a=await changesSince.bind(t)(n).execute();return{result:o,changes:a}})}}function finalize(){const r=sql`select crsql_finalize();`;return{execute:()=>r.execute(this)}}function affectedTables(r){var e,t,n,o;if(typeof r=="string")return[...new Set(decode(r).map(a=>a.table))];if(r.kind==="TableNode")return[r.table.identifier.name];if(r.kind==="ReferenceNode"&&r.table)return[r.table.table.identifier.name];if(r.kind==="AliasNode")return affectedTables(r.node);if(r.kind==="SelectQueryNode"){const a=[...((e=r.from)==null?void 0:e.froms)||[],...((t=r.joins)==null?void 0:t.map(u=>u.table))||[],...((n=r.selections)==null?void 0:n.map(u=>u.selection))||[],...((o=r.with)==null?void 0:o.expressions.map(u=>u.expression))||[]].flatMap(affectedTables);return[...new Set(a)]}return[]}const wasmUrl=""+new URL("../assets/crsqlite.CabMYEmC.wasm",import.meta.url).href;var Module=(()=>{var r=import.meta.url;return function(e={}){var t=e,n,o;t.ready=new Promise((s,l)=>{n=s,o=l});var a=Object.assign({},t),u="./this.program",d=(s,l)=>{throw l},h=typeof window=="object",p=typeof importScripts=="function",m="",E;(h||p)&&(p?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),r&&(m=r),m.indexOf("blob:")!==0?m=m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):m="",p&&(E=s=>{var l=new XMLHttpRequest;return l.open("GET",s,!1),l.responseType="arraybuffer",l.send(null),new Uint8Array(l.response)}));var k=t.print||console.log.bind(console),L=t.printErr||console.error.bind(console);Object.assign(t,a),a=null,t.thisProgram&&(u=t.thisProgram),t.quit&&(d=t.quit);var S;t.wasmBinary&&(S=t.wasmBinary);var N=t.noExitRuntime||!0;typeof WebAssembly!="object"&&Ne("no native wasm support detected");var w,b=!1,_,C,A,j,I,F,fe,$;function H(){var s=w.buffer;t.HEAP8=C=new Int8Array(s),t.HEAP16=j=new Int16Array(s),t.HEAPU8=A=new Uint8Array(s),t.HEAPU16=new Uint16Array(s),t.HEAP32=I=new Int32Array(s),t.HEAPU32=F=new Uint32Array(s),t.HEAPF32=fe=new Float32Array(s),t.HEAPF64=$=new Float64Array(s)}var P=[],ee=[],le=[],K=[],ye=0;function Ce(){var s=t.preRun.shift();P.unshift(s)}var U=0,te=null;function Ne(s){throw t.onAbort&&t.onAbort(s),s="Aborted("+s+")",L(s),b=!0,_=1,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),o(s),s}function Oe(s){return s.startsWith("data:application/octet-stream;base64,")}var ue;if(t.locateFile){if(ue="crsqlite.wasm",!Oe(ue)){var Ye=ue;ue=t.locateFile?t.locateFile(Ye,m):m+Ye}}else ue=new URL(""+new URL("../assets/crsqlite.CabMYEmC.wasm",import.meta.url).href,import.meta.url).href;function at(s){if(s==ue&&S)return new Uint8Array(S);if(E)return E(s);throw"both async and sync fetching of the wasm failed"}function Ze(s){return S||!h&&!p||typeof fetch!="function"?Promise.resolve().then(()=>at(s)):fetch(s,{credentials:"same-origin"}).then(l=>{if(!l.ok)throw"failed to load wasm binary file at '"+s+"'";return l.arrayBuffer()}).catch(()=>at(s))}function Qt(s,l,c){return Ze(s).then(f=>WebAssembly.instantiate(f,l)).then(f=>f).then(c,f=>{L(`failed to asynchronously prepare wasm: ${f}`),Ne(f)})}function Ut(s,l){var c=ue;return S||typeof WebAssembly.instantiateStreaming!="function"||Oe(c)||typeof fetch!="function"?Qt(c,s,l):fetch(c,{credentials:"same-origin"}).then(f=>WebAssembly.instantiateStreaming(f,s).then(l,function(y){return L(`wasm streaming compile failed: ${y}`),L("falling back to ArrayBuffer instantiation"),Qt(c,s,l)}))}var J,be;function Vn(s){this.name="ExitStatus",this.message=`Program terminated with exit(${s})`,this.status=s}var Rr=s=>{for(;0<s.length;)s.shift()(t)};function Ie(s,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":return C[s>>0];case"i8":return C[s>>0];case"i16":return j[s>>1];case"i32":return I[s>>2];case"i64":Ne("to do getValue(i64) use WASM_BIGINT");case"float":return fe[s>>2];case"double":return $[s>>3];case"*":return F[s>>2];default:Ne(`invalid type for getValue: ${l}`)}}function Pe(s,l,c="i8"){switch(c.endsWith("*")&&(c="*"),c){case"i1":C[s>>0]=l;break;case"i8":C[s>>0]=l;break;case"i16":j[s>>1]=l;break;case"i32":I[s>>2]=l;break;case"i64":Ne("to do setValue(i64) use WASM_BIGINT");case"float":fe[s>>2]=l;break;case"double":$[s>>3]=l;break;case"*":F[s>>2]=l;break;default:Ne(`invalid type for setValue: ${c}`)}}var Tt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,se=(s,l,c)=>{var f=l+c;for(c=l;s[c]&&!(c>=f);)++c;if(16<c-l&&s.buffer&&Tt)return Tt.decode(s.subarray(l,c));for(f="";l<c;){var y=s[l++];if(y&128){var T=s[l++]&63;if((y&224)==192)f+=String.fromCharCode((y&31)<<6|T);else{var O=s[l++]&63;y=(y&240)==224?(y&15)<<12|T<<6|O:(y&7)<<18|T<<12|O<<6|s[l++]&63,65536>y?f+=String.fromCharCode(y):(y-=65536,f+=String.fromCharCode(55296|y>>10,56320|y&1023))}}else f+=String.fromCharCode(y)}return f},Jn=(s,l)=>{for(var c=0,f=s.length-1;0<=f;f--){var y=s[f];y==="."?s.splice(f,1):y===".."?(s.splice(f,1),c++):c&&(s.splice(f,1),c--)}if(l)for(;c;c--)s.unshift("..");return s},pt=s=>{var l=s.charAt(0)==="/",c=s.substr(-1)==="/";return(s=Jn(s.split("/").filter(f=>!!f),!l).join("/"))||l||(s="."),s&&c&&(s+="/"),(l?"/":"")+s},qi=s=>{var l=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=l[0],l=l[1],!s&&!l?".":(l&&(l=l.substr(0,l.length-1)),s+l)},xr=s=>{if(s==="/")return"/";s=pt(s),s=s.replace(/\/$/,"");var l=s.lastIndexOf("/");return l===-1?s:s.substr(l+1)},V=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);Ne("initRandomDevice")},he=s=>(he=V())(s);function Se(){for(var s="",l=!1,c=arguments.length-1;-1<=c&&!l;c--){if(l=0<=c?arguments[c]:"/",typeof l!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!l)return"";s=l+"/"+s,l=l.charAt(0)==="/"}return s=Jn(s.split("/").filter(f=>!!f),!l).join("/"),(l?"/":"")+s||"."}var xe=[],Me=s=>{for(var l=0,c=0;c<s.length;++c){var f=s.charCodeAt(c);127>=f?l++:2047>=f?l+=2:55296<=f&&57343>=f?(l+=4,++c):l+=3}return l},Ae=(s,l,c,f)=>{if(!(0<f))return 0;var y=c;f=c+f-1;for(var T=0;T<s.length;++T){var O=s.charCodeAt(T);if(55296<=O&&57343>=O){var D=s.charCodeAt(++T);O=65536+((O&1023)<<10)|D&1023}if(127>=O){if(c>=f)break;l[c++]=O}else{if(2047>=O){if(c+1>=f)break;l[c++]=192|O>>6}else{if(65535>=O){if(c+2>=f)break;l[c++]=224|O>>12}else{if(c+3>=f)break;l[c++]=240|O>>18,l[c++]=128|O>>12&63}l[c++]=128|O>>6&63}l[c++]=128|O&63}}return l[c]=0,c-y},rr=[];function ft(s,l){rr[s]={input:[],Ub:[],ec:l},zi(s,Di)}var Di={open(s){var l=rr[s.node.ic];if(!l)throw new B(43);s.Vb=l,s.seekable=!1},close(s){s.Vb.ec.lc(s.Vb)},lc(s){s.Vb.ec.lc(s.Vb)},read(s,l,c,f){if(!s.Vb||!s.Vb.ec.Ac)throw new B(60);for(var y=0,T=0;T<f;T++){try{var O=s.Vb.ec.Ac(s.Vb)}catch{throw new B(29)}if(O===void 0&&y===0)throw new B(6);if(O==null)break;y++,l[c+T]=O}return y&&(s.node.timestamp=Date.now()),y},write(s,l,c,f){if(!s.Vb||!s.Vb.ec.uc)throw new B(60);try{for(var y=0;y<f;y++)s.Vb.ec.uc(s.Vb,l[c+y])}catch{throw new B(29)}return f&&(s.node.timestamp=Date.now()),y}},Wi={Ac(){e:{if(!xe.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){var l=null;break e}l=Array(Me(s)+1),s=Ae(s,l,0,l.length),l.length=s,xe=l}l=xe.shift()}return l},uc(s,l){l===null||l===10?(k(se(s.Ub,0)),s.Ub=[]):l!=0&&s.Ub.push(l)},lc(s){s.Ub&&0<s.Ub.length&&(k(se(s.Ub,0)),s.Ub=[])},ad(){return{Xc:25856,Zc:5,Wc:191,Yc:35387,Vc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},bd(){return 0},cd(){return[24,80]}},na={uc(s,l){l===null||l===10?(L(se(s.Ub,0)),s.Ub=[]):l!=0&&s.Ub.push(l)},lc(s){s.Ub&&0<s.Ub.length&&(L(se(s.Ub,0)),s.Ub=[])}};function ds(s,l){var c=s.Qb?s.Qb.length:0;c>=l||(l=Math.max(l,c*(1048576>c?2:1.125)>>>0),c!=0&&(l=Math.max(l,256)),c=s.Qb,s.Qb=new Uint8Array(l),0<s.Sb&&s.Qb.set(c.subarray(0,s.Sb),0))}var oe={Yb:null,Xb(){return oe.createNode(null,"/",16895,0)},createNode(s,l,c,f){if((c&61440)===24576||(c&61440)===4096)throw new B(63);return oe.Yb||(oe.Yb={dir:{node:{Wb:oe.Fb.Wb,Tb:oe.Fb.Tb,fc:oe.Fb.fc,mc:oe.Fb.mc,Ec:oe.Fb.Ec,rc:oe.Fb.rc,pc:oe.Fb.pc,Dc:oe.Fb.Dc,qc:oe.Fb.qc},stream:{bc:oe.Pb.bc}},file:{node:{Wb:oe.Fb.Wb,Tb:oe.Fb.Tb},stream:{bc:oe.Pb.bc,read:oe.Pb.read,write:oe.Pb.write,xc:oe.Pb.xc,nc:oe.Pb.nc,oc:oe.Pb.oc}},link:{node:{Wb:oe.Fb.Wb,Tb:oe.Fb.Tb,jc:oe.Fb.jc},stream:{}},yc:{node:{Wb:oe.Fb.Wb,Tb:oe.Fb.Tb},stream:aa}}),c=ms(s,l,c,f),ht(c.mode)?(c.Fb=oe.Yb.dir.node,c.Pb=oe.Yb.dir.stream,c.Qb={}):(c.mode&61440)===32768?(c.Fb=oe.Yb.file.node,c.Pb=oe.Yb.file.stream,c.Sb=0,c.Qb=null):(c.mode&61440)===40960?(c.Fb=oe.Yb.link.node,c.Pb=oe.Yb.link.stream):(c.mode&61440)===8192&&(c.Fb=oe.Yb.yc.node,c.Pb=oe.Yb.yc.stream),c.timestamp=Date.now(),s&&(s.Qb[l]=c,s.timestamp=c.timestamp),c},$c(s){return s.Qb?s.Qb.subarray?s.Qb.subarray(0,s.Sb):new Uint8Array(s.Qb):new Uint8Array(0)},Fb:{Wb(s){var l={};return l.Kc=(s.mode&61440)===8192?s.id:1,l.Bc=s.id,l.mode=s.mode,l.Qc=1,l.uid=0,l.Nc=0,l.ic=s.ic,ht(s.mode)?l.size=4096:(s.mode&61440)===32768?l.size=s.Sb:(s.mode&61440)===40960?l.size=s.link.length:l.size=0,l.Gc=new Date(s.timestamp),l.Pc=new Date(s.timestamp),l.Jc=new Date(s.timestamp),l.Hc=4096,l.Ic=Math.ceil(l.size/l.Hc),l},Tb(s,l){if(l.mode!==void 0&&(s.mode=l.mode),l.timestamp!==void 0&&(s.timestamp=l.timestamp),l.size!==void 0&&(l=l.size,s.Sb!=l))if(l==0)s.Qb=null,s.Sb=0;else{var c=s.Qb;s.Qb=new Uint8Array(l),c&&s.Qb.set(c.subarray(0,Math.min(l,s.Sb))),s.Sb=l}},fc(){throw Fi[44]},mc(s,l,c,f){return oe.createNode(s,l,c,f)},Ec(s,l,c){if(ht(s.mode)){try{var f=nr(l,c)}catch{}if(f)for(var y in f.Qb)throw new B(55)}delete s.parent.Qb[s.name],s.parent.timestamp=Date.now(),s.name=c,l.Qb[c]=s,l.timestamp=s.parent.timestamp,s.parent=l},rc(s,l){delete s.Qb[l],s.timestamp=Date.now()},pc(s,l){var c=nr(s,l),f;for(f in c.Qb)throw new B(55);delete s.Qb[l],s.timestamp=Date.now()},Dc(s){var l=[".",".."],c;for(c in s.Qb)s.Qb.hasOwnProperty(c)&&l.push(c);return l},qc(s,l,c){return s=oe.createNode(s,l,41471,0),s.link=c,s},jc(s){if((s.mode&61440)!==40960)throw new B(28);return s.link}},Pb:{read(s,l,c,f,y){var T=s.node.Qb;if(y>=s.node.Sb)return 0;if(s=Math.min(s.node.Sb-y,f),8<s&&T.subarray)l.set(T.subarray(y,y+s),c);else for(f=0;f<s;f++)l[c+f]=T[y+f];return s},write(s,l,c,f,y,T){if(l.buffer===C.buffer&&(T=!1),!f)return 0;if(s=s.node,s.timestamp=Date.now(),l.subarray&&(!s.Qb||s.Qb.subarray)){if(T)return s.Qb=l.subarray(c,c+f),s.Sb=f;if(s.Sb===0&&y===0)return s.Qb=l.slice(c,c+f),s.Sb=f;if(y+f<=s.Sb)return s.Qb.set(l.subarray(c,c+f),y),f}if(ds(s,y+f),s.Qb.subarray&&l.subarray)s.Qb.set(l.subarray(c,c+f),y);else for(T=0;T<f;T++)s.Qb[y+T]=l[c+T];return s.Sb=Math.max(s.Sb,y+f),f},bc(s,l,c){if(c===1?l+=s.position:c===2&&(s.node.mode&61440)===32768&&(l+=s.node.Sb),0>l)throw new B(28);return l},xc(s,l,c){ds(s.node,l+c),s.node.Sb=Math.max(s.node.Sb,l+c)},nc(s,l,c,f,y){if((s.node.mode&61440)!==32768)throw new B(43);if(s=s.node.Qb,y&2||s.buffer!==C.buffer){if((0<c||c+l<s.length)&&(s.subarray?s=s.subarray(c,c+l):s=Array.prototype.slice.call(s,c,c+l)),c=!0,l=65536*Math.ceil(l/65536),(y=xo(65536,l))?(A.fill(0,y,y+l),l=y):l=0,!l)throw new B(48);C.set(s,l)}else c=!1,l=s.byteOffset;return{Rc:l,Fc:c}},oc(s,l,c,f){return oe.Pb.write(s,l,0,f,c,!1),0}}},ia=(s,l)=>{var c=0;return s&&(c|=365),l&&(c|=146),c},Bi=null,fs={},dn=[],sa=1,Mt=null,hs=!0,B=null,Fi={};function st(s,l={}){if(s=Se(s),!s)return{path:"",node:null};if(l=Object.assign({zc:!0,vc:0},l),8<l.vc)throw new B(32);s=s.split("/").filter(O=>!!O);for(var c=Bi,f="/",y=0;y<s.length;y++){var T=y===s.length-1;if(T&&l.parent)break;if(c=nr(c,s[y]),f=pt(f+"/"+s[y]),c.cc&&(!T||T&&l.zc)&&(c=c.cc.root),!T||l.ac){for(T=0;(c.mode&61440)===40960;)if(c=gs(f),f=Se(qi(f),c),c=st(f,{vc:l.vc+1}).node,40<T++)throw new B(32)}}return{path:f,node:c}}function Hn(s){for(var l;;){if(s===s.parent)return s=s.Xb.Cc,l?s[s.length-1]!=="/"?`${s}/${l}`:s+l:s;l=l?`${s.name}/${l}`:s.name,s=s.parent}}function Pi(s,l){for(var c=0,f=0;f<l.length;f++)c=(c<<5)-c+l.charCodeAt(f)|0;return(s+c>>>0)%Mt.length}function ps(s){var l=Pi(s.parent.id,s.name);if(Mt[l]===s)Mt[l]=s.dc;else for(l=Mt[l];l;){if(l.dc===s){l.dc=s.dc;break}l=l.dc}}function nr(s,l){var c;if(c=(c=kr(s,"x"))?c:s.Fb.fc?0:2)throw new B(c,s);for(c=Mt[Pi(s.id,l)];c;c=c.dc){var f=c.name;if(c.parent.id===s.id&&f===l)return c}return s.Fb.fc(s,l)}function ms(s,l,c,f){return s=new So(s,l,c,f),l=Pi(s.parent.id,s.name),s.dc=Mt[l],Mt[l]=s}function ht(s){return(s&61440)===16384}function ys(s){var l=["r","w","rw"][s&3];return s&512&&(l+="w"),l}function kr(s,l){if(hs)return 0;if(!l.includes("r")||s.mode&292){if(l.includes("w")&&!(s.mode&146)||l.includes("x")&&!(s.mode&73))return 2}else return 2;return 0}function Ns(s,l){try{return nr(s,l),20}catch{}return kr(s,"wx")}function bs(s,l,c){try{var f=nr(s,l)}catch(y){return y.Rb}if(s=kr(s,"wx"))return s;if(c){if(!ht(f.mode))return 54;if(f===f.parent||Hn(f)==="/")return 10}else if(ht(f.mode))return 31;return 0}function oa(){for(var s=0;4096>=s;s++)if(!dn[s])return s;throw new B(33)}function et(s){if(s=dn[s],!s)throw new B(8);return s}function ws(s,l=-1){return hn||(hn=function(){this.kc={}},hn.prototype={},Object.defineProperties(hn.prototype,{object:{get(){return this.node},set(c){this.node=c}},flags:{get(){return this.kc.flags},set(c){this.kc.flags=c}},position:{get(){return this.kc.position},set(c){this.kc.position=c}}})),s=Object.assign(new hn,s),l==-1&&(l=oa()),s.Zb=l,dn[l]=s}var aa={open(s){s.Pb=fs[s.node.ic].Pb,s.Pb.open&&s.Pb.open(s)},bc(){throw new B(70)}};function zi(s,l){fs[s]={Pb:l}}function Es(s,l){var c=l==="/",f=!l;if(c&&Bi)throw new B(10);if(!c&&!f){var y=st(l,{zc:!1});if(l=y.path,y=y.node,y.cc)throw new B(10);if(!ht(y.mode))throw new B(54)}l={type:s,ed:{},Cc:l,Oc:[]},s=s.Xb(l),s.Xb=l,l.root=s,c?Bi=s:y&&(y.cc=l,y.Xb&&y.Xb.Oc.push(l))}function Qi(s,l,c){var f=st(s,{parent:!0}).node;if(s=xr(s),!s||s==="."||s==="..")throw new B(28);var y=Ns(f,s);if(y)throw new B(y);if(!f.Fb.mc)throw new B(63);return f.Fb.mc(f,s,l,c)}function It(s,l){return Qi(s,(l!==void 0?l:511)&1023|16384,0)}function jn(s,l,c){typeof c>"u"&&(c=l,l=438),Qi(s,l|8192,c)}function Ui(s,l){if(!Se(s))throw new B(44);var c=st(l,{parent:!0}).node;if(!c)throw new B(44);l=xr(l);var f=Ns(c,l);if(f)throw new B(f);if(!c.Fb.qc)throw new B(63);c.Fb.qc(c,l,s)}function _s(s){var l=st(s,{parent:!0}).node;s=xr(s);var c=nr(l,s),f=bs(l,s,!0);if(f)throw new B(f);if(!l.Fb.pc)throw new B(63);if(c.cc)throw new B(10);l.Fb.pc(l,s),ps(c)}function gs(s){if(s=st(s).node,!s)throw new B(44);if(!s.Fb.jc)throw new B(28);return Se(Hn(s.parent),s.Fb.jc(s))}function Kn(s,l){if(s=st(s,{ac:!l}).node,!s)throw new B(44);if(!s.Fb.Wb)throw new B(63);return s.Fb.Wb(s)}function Os(s){return Kn(s,!0)}function Ts(s,l){if(s=typeof s=="string"?st(s,{ac:!0}).node:s,!s.Fb.Tb)throw new B(63);s.Fb.Tb(s,{mode:l&4095|s.mode&-4096,timestamp:Date.now()})}function Is(s,l){if(0>l)throw new B(28);if(s=typeof s=="string"?st(s,{ac:!0}).node:s,!s.Fb.Tb)throw new B(63);if(ht(s.mode))throw new B(31);if((s.mode&61440)!==32768)throw new B(28);var c=kr(s,"w");if(c)throw new B(c);s.Fb.Tb(s,{size:l,timestamp:Date.now()})}function Gn(s,l,c){if(s==="")throw new B(44);if(typeof l=="string"){var f={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[l];if(typeof f>"u")throw Error(`Unknown file open mode: ${l}`);l=f}if(c=l&64?(typeof c>"u"?438:c)&4095|32768:0,typeof s=="object")var y=s;else{s=pt(s);try{y=st(s,{ac:!(l&131072)}).node}catch{}}if(f=!1,l&64)if(y){if(l&128)throw new B(20)}else y=Qi(s,c,0),f=!0;if(!y)throw new B(44);if((y.mode&61440)===8192&&(l&=-513),l&65536&&!ht(y.mode))throw new B(54);if(!f&&(c=y?(y.mode&61440)===40960?32:ht(y.mode)&&(ys(l)!=="r"||l&512)?31:kr(y,ys(l)):44))throw new B(c);return l&512&&!f&&Is(y,0),l&=-131713,y=ws({node:y,path:Hn(y),flags:l,seekable:!0,position:0,Pb:y.Pb,Uc:[],error:!1}),y.Pb.open&&y.Pb.open(y),!t.logReadFiles||l&1||(Xn||(Xn={}),s in Xn||(Xn[s]=1)),y}function Ss(s,l,c){if(s.Zb===null)throw new B(8);if(!s.seekable||!s.Pb.bc)throw new B(70);if(c!=0&&c!=1&&c!=2)throw new B(28);s.position=s.Pb.bc(s,l,c),s.Uc=[]}function vs(){B||(B=function(s,l){this.name="ErrnoError",this.node=l,this.Sc=function(c){this.Rb=c},this.Sc(s),this.message="FS error"},B.prototype=Error(),B.prototype.constructor=B,[44].forEach(s=>{Fi[s]=new B(s),Fi[s].stack="<generic error, no stack>"}))}var Cs;function fn(s,l,c){s=pt("/dev/"+s);var f=ia(!!l,!!c);Mi||(Mi=64);var y=Mi++<<8|0;zi(y,{open(T){T.seekable=!1},close(){c&&c.buffer&&c.buffer.length&&c(10)},read(T,O,D,v){for(var R=0,z=0;z<v;z++){try{var q=l()}catch{throw new B(29)}if(q===void 0&&R===0)throw new B(6);if(q==null)break;R++,O[D+z]=q}return R&&(T.node.timestamp=Date.now()),R},write(T,O,D,v){for(var R=0;R<v;R++)try{c(O[D+R])}catch{throw new B(29)}return v&&(T.node.timestamp=Date.now()),R}}),jn(s,f,y)}var Mi,Te={},hn,Xn;function ir(s,l,c){if(l.charAt(0)==="/")return l;if(s=s===-100?"/":et(s).path,l.length==0){if(!c)throw new B(44);return s}return pt(s+"/"+l)}function Yn(s,l,c){try{var f=s(l)}catch(T){if(T&&T.node&&pt(l)!==pt(Hn(T.node)))return-54;throw T}I[c>>2]=f.Kc,I[c+4>>2]=f.mode,F[c+8>>2]=f.Qc,I[c+12>>2]=f.uid,I[c+16>>2]=f.Nc,I[c+20>>2]=f.ic,be=[f.size>>>0,(J=f.size,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],I[c+24>>2]=be[0],I[c+28>>2]=be[1],I[c+32>>2]=4096,I[c+36>>2]=f.Ic,s=f.Gc.getTime(),l=f.Pc.getTime();var y=f.Jc.getTime();return be=[Math.floor(s/1e3)>>>0,(J=Math.floor(s/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],I[c+40>>2]=be[0],I[c+44>>2]=be[1],F[c+48>>2]=s%1e3*1e3,be=[Math.floor(l/1e3)>>>0,(J=Math.floor(l/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],I[c+56>>2]=be[0],I[c+60>>2]=be[1],F[c+64>>2]=l%1e3*1e3,be=[Math.floor(y/1e3)>>>0,(J=Math.floor(y/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],I[c+72>>2]=be[0],I[c+76>>2]=be[1],F[c+80>>2]=y%1e3*1e3,be=[f.Bc>>>0,(J=f.Bc,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],I[c+88>>2]=be[0],I[c+92>>2]=be[1],0}var Zn=void 0;function ei(){var s=I[Zn>>2];return Zn+=4,s}var pn=(s,l)=>l+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*l:NaN,la=[0,31,60,91,121,152,182,213,244,274,305,335],ua=[0,31,59,90,120,151,181,212,243,273,304,334],Rs=s=>{var l=Me(s)+1,c=ji(l);return c&&Ae(s,A,c,l),c},$i={},xs=()=>{if(!Vi){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"},l;for(l in $i)$i[l]===void 0?delete s[l]:s[l]=$i[l];var c=[];for(l in s)c.push(`${l}=${s[l]}`);Vi=c}return Vi},Vi;function ks(){}function As(){}function Ls(){}function qs(){}function Ds(){}function Ws(){}function Bs(){}function Fs(){}function Ps(){}function zs(){}function Qs(){}function Us(){}function Ms(){}function $s(){}function Vs(){}function Js(){}function Hs(){}function js(){}function Ks(){}function Gs(){}function Xs(){}function Ys(){}function Zs(){}function eo(){}function ro(){}function no(){}function io(){}function so(){}function oo(){}function ao(){}function lo(){}function uo(){}function co(){}function fo(){}function ho(){}function po(){}function mo(){}function yo(){}function No(){}function bo(){}var wo=s=>{_=s,N||0<ye||(t.onExit&&t.onExit(s),b=!0),d(s,new Vn(s))},Ji=s=>{s instanceof Vn||s=="unwind"||d(1,s)},ti=s=>{try{s()}catch(l){Ne(l)}};function ca(s){var l={},c;for(c in s)(function(f){var y=s[f];l[f]=typeof y=="function"?function(){ri.push(f);try{return y.apply(null,arguments)}finally{b||(ri.pop()===f||Ne(),St&&$t===1&&ri.length===0&&($t=0,ti(Do),typeof Fibers<"u"&&Fibers.fd()))}}:y})(c);return l}var $t=0,St=null,Eo=0,ri=[],_o={},go={},da=0,Hi=null,fa=[];function ha(){return new Promise((s,l)=>{Hi={resolve:s,reject:l}})}function pa(){var s=ji(16396),l=s+12;F[s>>2]=l,F[s+4>>2]=l+16384,l=ri[0];var c=_o[l];return c===void 0&&(c=da++,_o[l]=c,go[c]=l),I[s+8>>2]=c,s}function Oo(s){if(!b){if($t===0){var l=!1,c=!1;s((f=0)=>{if(!b&&(Eo=f,l=!0,c)){$t=2,ti(()=>Wo(St)),typeof Browser<"u"&&Browser.tc.Mc&&Browser.tc.resume(),f=!1;try{var y=(0,M[go[I[St+8>>2]]])()}catch(D){y=D,f=!0}var T=!1;if(!St){var O=Hi;O&&(Hi=null,(f?O.reject:O.resolve)(y),T=!0)}if(f&&!T)throw y}}),c=!0,l||($t=1,St=pa(),typeof Browser<"u"&&Browser.tc.Mc&&Browser.tc.pause(),ti(()=>qo(St)))}else $t===2?($t=0,ti(Bo),Co(St),St=null,fa.forEach(f=>{if(!b)try{if(f(),!(N||0<ye))try{_=f=_,wo(f)}catch(y){Ji(y)}}catch(y){Ji(y)}})):Ne(`invalid state: ${$t}`);return Eo}}function To(s){return Oo(l=>{s().then(l)})}var Io={},mt=(s,l,c,f,y)=>{function T(q){return--ye,v!==0&&Lo(v),l==="string"?q?se(A,q):"":l==="boolean"?!!q:q}var O={string:q=>{var Q=0;if(q!=null&&q!==0){Q=Me(q)+1;var ne=Ki(Q);Ae(q,A,ne,Q),Q=ne}return Q},array:q=>{var Q=Ki(q.length);return C.set(q,Q),Q}};s=t["_"+s];var D=[],v=0;if(f)for(var R=0;R<f.length;R++){var z=O[c[R]];z?(v===0&&(v=Ao()),D[R]=z(f[R])):D[R]=f[R]}return c=St,f=s.apply(null,D),y=y&&y.async,ye+=1,St!=c?ha().then(T):(f=T(f),y?Promise.resolve(f):f)};function So(s,l,c,f){s||(s=this),this.parent=s,this.Xb=s.Xb,this.cc=null,this.id=sa++,this.name=l,this.mode=c,this.Fb={},this.Pb={},this.ic=f}Object.defineProperties(So.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),vs(),Mt=Array(4096),Es(oe,"/"),It("/tmp"),It("/home"),It("/home/web_user"),function(){It("/dev"),zi(259,{read:()=>0,write:(f,y,T,O)=>O}),jn("/dev/null",259),ft(1280,Wi),ft(1536,na),jn("/dev/tty",1280),jn("/dev/tty1",1536);var s=new Uint8Array(1024),l=0,c=()=>(l===0&&(l=he(s).byteLength),s[--l]);fn("random",c),fn("urandom",c),It("/dev/shm"),It("/dev/shm/tmp")}(),function(){It("/proc");var s=It("/proc/self");It("/proc/self/fd"),Es({Xb(){var l=ms(s,"fd",16895,73);return l.Fb={fc(c,f){var y=et(+f);return c={parent:null,Xb:{Cc:"fake"},Fb:{jc:()=>y.path}},c.parent=c}},l}},"/proc/self/fd")}(),function(){const s=new Map;t.setAuthorizer=function(l,c,f){return c?s.set(l,{f:c,wc:f}):s.delete(l),mt("set_authorizer","number",["number"],[l])},ks=function(l,c,f,y,T,O){if(s.has(l)){const{f:D,wc:v}=s.get(l);return D(v,c,f?f?se(A,f):"":null,y?y?se(A,y):"":null,T?T?se(A,T):"":null,O?O?se(A,O):"":null)}return 0}}(),function(){function s(f,y){const T=[];for(let O=0;f[y+O]!=0;++O){if(1e3<O)throw Error("C-string never terminated after 1k characters");T.push(f[y+O])}return String.fromCharCode(...T)}const l=new Map,c=new Map;t.updateHook=function(f,y){const T=l.size;return l.set(T,y),mt("update_hook","void",["number","number"],[f,T])},t.createFunction=function(f,y,T,O,D,v){const R=l.size;return l.set(R,{f:v,$b:D}),mt("create_function","number","number string number number number number".split(" "),[f,y,T,O,R,0])},t.createAggregate=function(f,y,T,O,D,v,R){const z=l.size;return l.set(z,{step:v,Lc:R,$b:D}),mt("create_function","number","number string number number number number".split(" "),[f,y,T,O,z,1])},t.getFunctionUserData=function(f){return c.get(f)},Ws=function(f,y,T,O,D,v){f=l.get(f);const R=A;D=BigInt(v)<<32n|BigInt(D)&4294967295n,f(y,s(R,T),s(R,O),D)},Ls=function(f,y,T,O){f=l.get(f),c.set(y,f.$b),f.f(y,new Uint32Array(A.buffer,O,T)),c.delete(y)},Ds=function(f,y,T,O){f=l.get(f),c.set(y,f.$b),f.step(y,new Uint32Array(A.buffer,O,T)),c.delete(y)},As=function(f,y){f=l.get(f),c.set(y,f.$b),f.Lc(y),c.delete(y)}}(),function(){const s=new Map;t.progressHandler=function(l,c,f,y){return f?s.set(l,{f,wc:y}):s.delete(l),mt("progress_handler",null,["number","number"],[l,c])},qs=function(l){if(s.has(l)){const{f:c,wc:f}=s.get(l);return c(f)}return 0}}(),function(){function s(v,R){const z=`get${v}`,q=`set${v}`;return new Proxy(new DataView(A.buffer,R,v==="Int32"?4:8),{get(Q,ne){if(ne===z)return function(pe,ze){if(!ze)throw Error("must be little endian");return Q[ne](pe,ze)};if(ne===q)return function(pe,ze,Le){if(!Le)throw Error("must be little endian");return Q[ne](pe,ze,Le)};if(typeof ne=="string"&&ne.match(/^(get)|(set)/))throw Error("invalid type");return Q[ne]}})}const l=typeof Io=="object",c=new Map,f=new Map,y=new Map,T=l?new Set:null,O=l?new Set:null,D=new Map;Zs=function(v,R,z,q){D.set(v?se(A,v):"",{size:R,hc:Array.from(new Uint32Array(A.buffer,q,z))})},t.createModule=function(v,R,z,q){l&&(z.handleAsync=To);const Q=c.size;return c.set(Q,{module:z,$b:q}),q=0,z.xCreate&&(q|=1),z.xConnect&&(q|=2),z.xBestIndex&&(q|=4),z.xDisconnect&&(q|=8),z.xDestroy&&(q|=16),z.xOpen&&(q|=32),z.xClose&&(q|=64),z.xFilter&&(q|=128),z.xNext&&(q|=256),z.xEof&&(q|=512),z.xColumn&&(q|=1024),z.xRowid&&(q|=2048),z.xUpdate&&(q|=4096),z.xBegin&&(q|=8192),z.xSync&&(q|=16384),z.xCommit&&(q|=32768),z.xRollback&&(q|=65536),z.xFindFunction&&(q|=131072),z.xRename&&(q|=262144),mt("create_module","number",["number","string","number","number"],[v,R,Q,q])},Ms=function(v,R,z,q,Q,ne){if(R=c.get(R),f.set(Q,R),l){T.delete(Q);for(const pe of T)f.delete(pe)}return q=Array.from(new Uint32Array(A.buffer,q,z)).map(pe=>pe?se(A,pe):""),R.module.xCreate(v,R.$b,q,Q,s("Int32",ne))},Us=function(v,R,z,q,Q,ne){if(R=c.get(R),f.set(Q,R),l){T.delete(Q);for(const pe of T)f.delete(pe)}return q=Array.from(new Uint32Array(A.buffer,q,z)).map(pe=>pe?se(A,pe):""),R.module.xConnect(v,R.$b,q,Q,s("Int32",ne))},Fs=function(v,R){var z=f.get(v),q=D.get("sqlite3_index_info").hc;const Q={};Q.nConstraint=Ie(R+q[0],"i32"),Q.aConstraint=[];for(var ne=Ie(R+q[1],"*"),pe=D.get("sqlite3_index_constraint").size,ze=0;ze<Q.nConstraint;++ze){var Le=Q.aConstraint,ot=Le.push,$e=ne+ze*pe,Ar=D.get("sqlite3_index_constraint").hc,Vt={};Vt.iColumn=Ie($e+Ar[0],"i32"),Vt.op=Ie($e+Ar[1],"i8"),Vt.usable=!!Ie($e+Ar[2],"i8"),ot.call(Le,Vt)}for(Q.nOrderBy=Ie(R+q[2],"i32"),Q.aOrderBy=[],ne=Ie(R+q[3],"*"),pe=D.get("sqlite3_index_orderby").size,ze=0;ze<Q.nOrderBy;++ze)Le=Q.aOrderBy,ot=Le.push,$e=ne+ze*pe,Ar=D.get("sqlite3_index_orderby").hc,Vt={},Vt.iColumn=Ie($e+Ar[0],"i32"),Vt.desc=!!Ie($e+Ar[1],"i8"),ot.call(Le,Vt);for(Q.aConstraintUsage=[],ne=0;ne<Q.nConstraint;++ne)Q.aConstraintUsage.push({argvIndex:0,omit:!1});for(Q.idxNum=Ie(R+q[5],"i32"),Q.idxStr=null,Q.orderByConsumed=!!Ie(R+q[8],"i8"),Q.estimatedCost=Ie(R+q[9],"double"),Q.estimatedRows=Ie(R+q[10],"i32"),Q.idxFlags=Ie(R+q[11],"i32"),Q.colUsed=Ie(R+q[12],"i32"),v=z.module.xBestIndex(v,Q),z=D.get("sqlite3_index_info").hc,q=Ie(R+z[4],"*"),ne=D.get("sqlite3_index_constraint_usage").size,ot=0;ot<Q.nConstraint;++ot)pe=q+ot*ne,Le=Q.aConstraintUsage[ot],$e=D.get("sqlite3_index_constraint_usage").hc,Pe(pe+$e[0],Le.argvIndex,"i32"),Pe(pe+$e[1],Le.omit?1:0,"i8");return Pe(R+z[5],Q.idxNum,"i32"),typeof Q.idxStr=="string"&&(q=Me(Q.idxStr),ne=mt("sqlite3_malloc","number",["number"],[q+1]),Ae(Q.idxStr,A,ne,q+1),Pe(R+z[6],ne,"*"),Pe(R+z[7],1,"i32")),Pe(R+z[8],Q.orderByConsumed,"i32"),Pe(R+z[9],Q.estimatedCost,"double"),Pe(R+z[10],Q.estimatedRows,"i32"),Pe(R+z[11],Q.idxFlags,"i32"),v},Vs=function(v){const R=f.get(v);return l?T.add(v):f.delete(v),R.module.xDisconnect(v)},$s=function(v){const R=f.get(v);return l?T.add(v):f.delete(v),R.module.xDestroy(v)},Ks=function(v,R){const z=f.get(v);if(y.set(R,z),l){O.delete(R);for(const q of O)y.delete(q)}return z.module.xOpen(v,R)},Ps=function(v){const R=y.get(v);return l?O.add(v):y.delete(v),R.module.xClose(v)},Js=function(v){return y.get(v).module.xEof(v)?1:0},Hs=function(v,R,z,q,Q){const ne=y.get(v);return z=z?z?se(A,z):"":null,Q=new Uint32Array(A.buffer,Q,q),ne.module.xFilter(v,R,z,Q)},js=function(v){return y.get(v).module.xNext(v)},zs=function(v,R,z){return y.get(v).module.xColumn(v,R,z)},Ys=function(v,R){return y.get(v).module.xRowid(v,s("BigInt64",R))},ro=function(v,R,z,q){const Q=f.get(v);return z=new Uint32Array(A.buffer,z,R),Q.module.xUpdate(v,z,s("BigInt64",q))},Bs=function(v){return f.get(v).module.xBegin(v)},eo=function(v){return f.get(v).module.xSync(v)},Qs=function(v){return f.get(v).module.xCommit(v)},Xs=function(v){return f.get(v).module.xRollback(v)},Gs=function(v,R){const z=f.get(v);return R=R?se(A,R):"",z.module.xRename(v,R)}}(),function(){function s(O,D){const v=`get${O}`,R=`set${O}`;return new Proxy(new DataView(A.buffer,D,O==="Int32"?4:8),{get(z,q){if(q===v)return function(Q,ne){if(!ne)throw Error("must be little endian");return z[q](Q,ne)};if(q===R)return function(Q,ne,pe){if(!pe)throw Error("must be little endian");return z[q](Q,ne,pe)};if(typeof q=="string"&&q.match(/^(get)|(set)/))throw Error("invalid type");return z[q]}})}function l(O){return O>>=2,F[O]+F[O+1]*2**32}const c=typeof Io=="object",f=new Map,y=new Map;t.registerVFS=function(O,D){if(mt("sqlite3_vfs_find","number",["string"],[O.name]))throw Error(`VFS '${O.name}' already registered`);c&&(O.handleAsync=To);var v=O.dd??64;const R=t._malloc(4);return D=mt("register_vfs","number",["string","number","number","number"],[O.name,v,D?1:0,R]),D||(v=Ie(R,"*"),f.set(v,O)),t._free(R),D};const T=c?new Set:null;so=function(O){const D=y.get(O);return c?T.add(O):y.delete(O),D.xClose(O)},ho=function(O,D,v,R){return y.get(O).xRead(O,A.subarray(D,D+v),l(R))},bo=function(O,D,v,R){return y.get(O).xWrite(O,A.subarray(D,D+v),l(R))},yo=function(O,D){return y.get(O).xTruncate(O,l(D))},mo=function(O,D){return y.get(O).xSync(O,D)},uo=function(O,D){const v=y.get(O);return D=s("BigInt64",D),v.xFileSize(O,D)},co=function(O,D){return y.get(O).xLock(O,D)},No=function(O,D){return y.get(O).xUnlock(O,D)},io=function(O,D){const v=y.get(O);return D=s("Int32",D),v.xCheckReservedLock(O,D)},lo=function(O,D,v){const R=y.get(O);return v=new DataView(A.buffer,v),R.xFileControl(O,D,v)},po=function(O){return y.get(O).xSectorSize(O)},ao=function(O){return y.get(O).xDeviceCharacteristics(O)},fo=function(O,D,v,R,z){if(O=f.get(O),y.set(v,O),c){T.delete(v);for(var q of T)y.delete(q)}if(q=null,R&64){q=1;const Q=[];for(;q;){const ne=A[D++];if(ne)Q.push(ne);else switch(A[D]||(q=null),q){case 1:Q.push(63),q=2;break;case 2:Q.push(61),q=3;break;case 3:Q.push(38),q=2}}q=new TextDecoder().decode(new Uint8Array(Q))}else D&&(q=D?se(A,D):"");return z=s("Int32",z),O.xOpen(q,v,R,z)},oo=function(O,D,v){return f.get(O).xDelete(D?se(A,D):"",v)},no=function(O,D,v,R){return O=f.get(O),R=s("Int32",R),O.xAccess(D?se(A,D):"",v,R)}}();var ma={a:(s,l,c,f)=>{Ne(`Assertion failed: ${s?se(A,s):""}, at: `+[l?l?se(A,l):"":"unknown filename",c,f?f?se(A,f):"":"unknown function"])},L:function(s,l){try{return s=s?se(A,s):"",Ts(s,l),0}catch(c){if(typeof Te>"u"||c.name!=="ErrnoError")throw c;return-c.Rb}},N:function(s,l,c){try{if(l=l?se(A,l):"",l=ir(s,l),c&-8)return-28;var f=st(l,{ac:!0}).node;return f?(s="",c&4&&(s+="r"),c&2&&(s+="w"),c&1&&(s+="x"),s&&kr(f,s)?-2:0):-44}catch(y){if(typeof Te>"u"||y.name!=="ErrnoError")throw y;return-y.Rb}},M:function(s,l){try{var c=et(s);return Ts(c.node,l),0}catch(f){if(typeof Te>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},K:function(s){try{var l=et(s).node,c=typeof l=="string"?st(l,{ac:!0}).node:l;if(!c.Fb.Tb)throw new B(63);return c.Fb.Tb(c,{timestamp:Date.now()}),0}catch(f){if(typeof Te>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},b:function(s,l,c){Zn=c;try{var f=et(s);switch(l){case 0:var y=ei();if(0>y)return-28;for(;dn[y];)y++;return ws(f,y).Zb;case 1:case 2:return 0;case 3:return f.flags;case 4:return y=ei(),f.flags|=y,0;case 5:return y=ei(),j[y+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return I[vo()>>2]=28,-1;default:return-28}}catch(T){if(typeof Te>"u"||T.name!=="ErrnoError")throw T;return-T.Rb}},J:function(s,l){try{var c=et(s);return Yn(Kn,c.path,l)}catch(f){if(typeof Te>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},n:function(s,l,c){l=pn(l,c);try{if(isNaN(l))return 61;var f=et(s);if(!(f.flags&2097155))throw new B(28);return Is(f.node,l),0}catch(y){if(typeof Te>"u"||y.name!=="ErrnoError")throw y;return-y.Rb}},D:function(s,l){try{if(l===0)return-28;var c=Me("/")+1;return l<c?-68:(Ae("/",A,s,l),c)}catch(f){if(typeof Te>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},G:function(s,l){try{return s=s?se(A,s):"",Yn(Os,s,l)}catch(c){if(typeof Te>"u"||c.name!=="ErrnoError")throw c;return-c.Rb}},A:function(s,l,c){try{return l=l?se(A,l):"",l=ir(s,l),l=pt(l),l[l.length-1]==="/"&&(l=l.substr(0,l.length-1)),It(l,c),0}catch(f){if(typeof Te>"u"||f.name!=="ErrnoError")throw f;return-f.Rb}},F:function(s,l,c,f){try{l=l?se(A,l):"";var y=f&256;return l=ir(s,l,f&4096),Yn(y?Os:Kn,l,c)}catch(T){if(typeof Te>"u"||T.name!=="ErrnoError")throw T;return-T.Rb}},z:function(s,l,c,f){Zn=f;try{l=l?se(A,l):"",l=ir(s,l);var y=f?ei():0;return Gn(l,c,y).Zb}catch(T){if(typeof Te>"u"||T.name!=="ErrnoError")throw T;return-T.Rb}},w:function(s,l,c,f){try{if(l=l?se(A,l):"",l=ir(s,l),0>=f)return-28;var y=gs(l),T=Math.min(f,Me(y)),O=C[c+T];return Ae(y,A,c,f+1),C[c+T]=O,T}catch(D){if(typeof Te>"u"||D.name!=="ErrnoError")throw D;return-D.Rb}},v:function(s){try{return s=s?se(A,s):"",_s(s),0}catch(l){if(typeof Te>"u"||l.name!=="ErrnoError")throw l;return-l.Rb}},H:function(s,l){try{return s=s?se(A,s):"",Yn(Kn,s,l)}catch(c){if(typeof Te>"u"||c.name!=="ErrnoError")throw c;return-c.Rb}},r:function(s,l,c){try{if(l=l?se(A,l):"",l=ir(s,l),c===0){s=l;var f=st(s,{parent:!0}).node;if(!f)throw new B(44);var y=xr(s),T=nr(f,y),O=bs(f,y,!1);if(O)throw new B(O);if(!f.Fb.rc)throw new B(63);if(T.cc)throw new B(10);f.Fb.rc(f,y),ps(T)}else c===512?_s(l):Ne("Invalid flags passed to unlinkat");return 0}catch(D){if(typeof Te>"u"||D.name!=="ErrnoError")throw D;return-D.Rb}},q:function(s,l,c){try{if(l=l?se(A,l):"",l=ir(s,l,!0),c){var f=F[c>>2]+4294967296*I[c+4>>2],y=I[c+8>>2];T=1e3*f+y/1e6,c+=16,f=F[c>>2]+4294967296*I[c+4>>2],y=I[c+8>>2],O=1e3*f+y/1e6}else var T=Date.now(),O=T;s=T;var D=st(l,{ac:!0}).node;return D.Fb.Tb(D,{timestamp:Math.max(s,O)}),0}catch(v){if(typeof Te>"u"||v.name!=="ErrnoError")throw v;return-v.Rb}},k:function(s,l,c){s=new Date(1e3*pn(s,l)),I[c>>2]=s.getSeconds(),I[c+4>>2]=s.getMinutes(),I[c+8>>2]=s.getHours(),I[c+12>>2]=s.getDate(),I[c+16>>2]=s.getMonth(),I[c+20>>2]=s.getFullYear()-1900,I[c+24>>2]=s.getDay(),l=s.getFullYear(),I[c+28>>2]=(l%4!==0||l%100===0&&l%400!==0?ua:la)[s.getMonth()]+s.getDate()-1|0,I[c+36>>2]=-(60*s.getTimezoneOffset()),l=new Date(s.getFullYear(),6,1).getTimezoneOffset();var f=new Date(s.getFullYear(),0,1).getTimezoneOffset();I[c+32>>2]=(l!=f&&s.getTimezoneOffset()==Math.min(f,l))|0},i:function(s,l,c,f,y,T,O,D){y=pn(y,T);try{if(isNaN(y))return 61;var v=et(f);if(l&2&&!(c&2)&&(v.flags&2097155)!==2)throw new B(2);if((v.flags&2097155)===1)throw new B(2);if(!v.Pb.nc)throw new B(43);var R=v.Pb.nc(v,s,y,l,c),z=R.Rc;return I[O>>2]=R.Fc,F[D>>2]=z,0}catch(q){if(typeof Te>"u"||q.name!=="ErrnoError")throw q;return-q.Rb}},j:function(s,l,c,f,y,T,O){T=pn(T,O);try{if(isNaN(T))return 61;var D=et(y);if(c&2){if((D.node.mode&61440)!==32768)throw new B(43);f&2||D.Pb.oc&&D.Pb.oc(D,A.slice(s,s+l),T,l,f)}}catch(v){if(typeof Te>"u"||v.name!=="ErrnoError")throw v;return-v.Rb}},s:(s,l,c)=>{function f(v){return(v=v.toTimeString().match(/\(([A-Za-z ]+)\)$/))?v[1]:"GMT"}var y=new Date().getFullYear(),T=new Date(y,0,1),O=new Date(y,6,1);y=T.getTimezoneOffset();var D=O.getTimezoneOffset();F[s>>2]=60*Math.max(y,D),I[l>>2]=+(y!=D),s=f(T),l=f(O),s=Rs(s),l=Rs(l),D<y?(F[c>>2]=s,F[c+4>>2]=l):(F[c>>2]=l,F[c+4>>2]=s)},e:()=>Date.now(),d:()=>performance.now(),t:(s,l,c)=>A.copyWithin(s,l,l+c),o:s=>{var l=A.length;if(s>>>=0,2147483648<s)return!1;for(var c=1;4>=c;c*=2){var f=l*(1+.2/c);f=Math.min(f,s+100663296);var y=Math;f=Math.max(s,f);e:{y=(y.min.call(y,2147483648,f+(65536-f%65536)%65536)-w.buffer.byteLength+65535)/65536;try{w.grow(y),H();var T=1;break e}catch{}T=void 0}if(T)return!0}return!1},B:(s,l)=>{var c=0;return xs().forEach((f,y)=>{var T=l+c;for(y=F[s+4*y>>2]=T,T=0;T<f.length;++T)C[y++>>0]=f.charCodeAt(T);C[y>>0]=0,c+=f.length+1}),0},C:(s,l)=>{var c=xs();F[s>>2]=c.length;var f=0;return c.forEach(y=>f+=y.length+1),F[l>>2]=f,0},f:function(s){try{var l=et(s);if(l.Zb===null)throw new B(8);l.sc&&(l.sc=null);try{l.Pb.close&&l.Pb.close(l)}catch(c){throw c}finally{dn[l.Zb]=null}return l.Zb=null,0}catch(c){if(typeof Te>"u"||c.name!=="ErrnoError")throw c;return c.Rb}},p:function(s,l){try{var c=et(s);return C[l>>0]=c.Vb?2:ht(c.mode)?3:(c.mode&61440)===40960?7:4,j[l+2>>1]=0,be=[0,(J=0,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],I[l+8>>2]=be[0],I[l+12>>2]=be[1],be=[0,(J=0,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],I[l+16>>2]=be[0],I[l+20>>2]=be[1],0}catch(f){if(typeof Te>"u"||f.name!=="ErrnoError")throw f;return f.Rb}},y:function(s,l,c,f){try{e:{var y=et(s);s=l;for(var T,O=l=0;O<c;O++){var D=F[s>>2],v=F[s+4>>2];s+=8;var R=y,z=D,q=v,Q=T,ne=C;if(0>q||0>Q)throw new B(28);if(R.Zb===null)throw new B(8);if((R.flags&2097155)===1)throw new B(8);if(ht(R.node.mode))throw new B(31);if(!R.Pb.read)throw new B(28);var pe=typeof Q<"u";if(!pe)Q=R.position;else if(!R.seekable)throw new B(70);var ze=R.Pb.read(R,ne,z,q,Q);pe||(R.position+=ze);var Le=ze;if(0>Le){var ot=-1;break e}if(l+=Le,Le<v)break;typeof T<"u"&&(T+=Le)}ot=l}return F[f>>2]=ot,0}catch($e){if(typeof Te>"u"||$e.name!=="ErrnoError")throw $e;return $e.Rb}},l:function(s,l,c,f,y){l=pn(l,c);try{if(isNaN(l))return 61;var T=et(s);return Ss(T,l,f),be=[T.position>>>0,(J=T.position,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],I[y>>2]=be[0],I[y+4>>2]=be[1],T.sc&&l===0&&f===0&&(T.sc=null),0}catch(O){if(typeof Te>"u"||O.name!=="ErrnoError")throw O;return O.Rb}},E:function(s){try{var l=et(s);return Oo(c=>{var f=l.node.Xb;f.type.Tc?f.type.Tc(f,!1,y=>{c(y?29:0)}):c(0)})}catch(c){if(typeof Te>"u"||c.name!=="ErrnoError")throw c;return c.Rb}},u:function(s,l,c,f){try{e:{var y=et(s);s=l;for(var T,O=l=0;O<c;O++){var D=F[s>>2],v=F[s+4>>2];s+=8;var R=y,z=D,q=v,Q=T,ne=C;if(0>q||0>Q)throw new B(28);if(R.Zb===null)throw new B(8);if(!(R.flags&2097155))throw new B(8);if(ht(R.node.mode))throw new B(31);if(!R.Pb.write)throw new B(28);R.seekable&&R.flags&1024&&Ss(R,0,2);var pe=typeof Q<"u";if(!pe)Q=R.position;else if(!R.seekable)throw new B(70);var ze=R.Pb.write(R,ne,z,q,Q,void 0);pe||(R.position+=ze);var Le=ze;if(0>Le){var ot=-1;break e}l+=Le,typeof T<"u"&&(T+=Le)}ot=l}return F[f>>2]=ot,0}catch($e){if(typeof Te>"u"||$e.name!=="ErrnoError")throw $e;return $e.Rb}},ta:ks,P:As,ia:Ls,da:qs,_:Ds,I:Ws,ma:Bs,x:Fs,g:Ps,pa:zs,ka:Qs,fa:Us,ga:Ms,h:$s,m:Vs,qa:Js,sa:Hs,ra:js,ea:Ks,ha:Gs,ja:Xs,oa:Ys,c:Zs,la:eo,na:ro,ba:no,W:io,aa:so,ca:oo,T:ao,V:lo,Z:uo,Y:co,S:fo,R:ho,U:po,$:mo,O:yo,X:No,Q:bo},M=function(){function s(c){if(c=c.exports,M=c=ca(c),w=M.ua,H(),ee.unshift(M.va),U--,t.monitorRunDependencies&&t.monitorRunDependencies(U),U==0&&te){var f=te;te=null,f()}return c}var l={a:ma};if(U++,t.monitorRunDependencies&&t.monitorRunDependencies(U),t.instantiateWasm)try{return t.instantiateWasm(l,s)}catch(c){L(`Module.instantiateWasm callback failed with error: ${c}`),o(c)}return Ut(l,function(c){s(c.instance)}).catch(o),{}}();t._sqlite3_step=s=>(t._sqlite3_step=M.wa)(s),t._sqlite3_malloc=s=>(t._sqlite3_malloc=M.xa)(s),t._sqlite3_free=s=>(t._sqlite3_free=M.ya)(s),t._sqlite3_bind_blob=(s,l,c,f,y)=>(t._sqlite3_bind_blob=M.za)(s,l,c,f,y),t._sqlite3_bind_int=(s,l,c)=>(t._sqlite3_bind_int=M.Aa)(s,l,c),t._sqlite3_bind_int64=(s,l,c,f)=>(t._sqlite3_bind_int64=M.Ba)(s,l,c,f),t._sqlite3_bind_double=(s,l,c)=>(t._sqlite3_bind_double=M.Ca)(s,l,c),t._sqlite3_bind_null=(s,l)=>(t._sqlite3_bind_null=M.Da)(s,l),t._sqlite3_clear_bindings=s=>(t._sqlite3_clear_bindings=M.Ea)(s),t._sqlite3_bind_text=(s,l,c,f,y)=>(t._sqlite3_bind_text=M.Fa)(s,l,c,f,y),t._sqlite3_close=s=>(t._sqlite3_close=M.Ga)(s),t._sqlite3_column_type=(s,l)=>(t._sqlite3_column_type=M.Ha)(s,l),t._sqlite3_column_count=s=>(t._sqlite3_column_count=M.Ia)(s),t._sqlite3_column_text=(s,l)=>(t._sqlite3_column_text=M.Ja)(s,l),t._sqlite3_column_blob=(s,l)=>(t._sqlite3_column_blob=M.Ka)(s,l),t._sqlite3_column_bytes=(s,l)=>(t._sqlite3_column_bytes=M.La)(s,l),t._sqlite3_column_double=(s,l)=>(t._sqlite3_column_double=M.Ma)(s,l),t._sqlite3_column_int=(s,l)=>(t._sqlite3_column_int=M.Na)(s,l),t._sqlite3_column_int64=(s,l)=>(t._sqlite3_column_int64=M.Oa)(s,l),t._sqlite3_column_name=(s,l)=>(t._sqlite3_column_name=M.Pa)(s,l),t._sqlite3_declare_vtab=(s,l)=>(t._sqlite3_declare_vtab=M.Qa)(s,l),t._sqlite3_errmsg=s=>(t._sqlite3_errmsg=M.Ra)(s),t._sqlite3_exec=(s,l,c,f,y)=>(t._sqlite3_exec=M.Sa)(s,l,c,f,y),t._sqlite3_finalize=s=>(t._sqlite3_finalize=M.Ta)(s),t._sqlite3_prepare_v2=(s,l,c,f,y)=>(t._sqlite3_prepare_v2=M.Ua)(s,l,c,f,y),t._sqlite3_result_int=(s,l)=>(t._sqlite3_result_int=M.Va)(s,l),t._sqlite3_result_blob=(s,l,c,f)=>(t._sqlite3_result_blob=M.Wa)(s,l,c,f),t._sqlite3_result_int64=(s,l,c)=>(t._sqlite3_result_int64=M.Xa)(s,l,c),t._sqlite3_result_double=(s,l)=>(t._sqlite3_result_double=M.Ya)(s,l),t._sqlite3_result_null=s=>(t._sqlite3_result_null=M.Za)(s),t._sqlite3_result_error=(s,l,c)=>(t._sqlite3_result_error=M._a)(s,l,c),t._sqlite3_result_text=(s,l,c,f)=>(t._sqlite3_result_text=M.$a)(s,l,c,f),t._sqlite3_sql=s=>(t._sqlite3_sql=M.ab)(s),t._sqlite3_reset=s=>(t._sqlite3_reset=M.bb)(s),t._sqlite3_value_text=s=>(t._sqlite3_value_text=M.cb)(s),t._sqlite3_value_type=s=>(t._sqlite3_value_type=M.db)(s),t._sqlite3_value_bytes=s=>(t._sqlite3_value_bytes=M.eb)(s),t._sqlite3_value_blob=s=>(t._sqlite3_value_blob=M.fb)(s),t._sqlite3_value_int=s=>(t._sqlite3_value_int=M.gb)(s),t._sqlite3_value_int64=s=>(t._sqlite3_value_int64=M.hb)(s),t._sqlite3_value_double=s=>(t._sqlite3_value_double=M.ib)(s),t._sqlite3_get_autocommit=s=>(t._sqlite3_get_autocommit=M.jb)(s),t._sqlite3_vfs_find=s=>(t._sqlite3_vfs_find=M.kb)(s),t._sqlite3_data_count=s=>(t._sqlite3_data_count=M.lb)(s),t._sqlite3_bind_parameter_count=s=>(t._sqlite3_bind_parameter_count=M.mb)(s),t._sqlite3_bind_parameter_name=(s,l)=>(t._sqlite3_bind_parameter_name=M.nb)(s,l),t._sqlite3_libversion=()=>(t._sqlite3_libversion=M.ob)(),t._sqlite3_libversion_number=()=>(t._sqlite3_libversion_number=M.pb)(),t._sqlite3_changes=s=>(t._sqlite3_changes=M.qb)(s),t._sqlite3_limit=(s,l,c)=>(t._sqlite3_limit=M.rb)(s,l,c),t._sqlite3_open_v2=(s,l,c,f)=>(t._sqlite3_open_v2=M.sb)(s,l,c,f);var vo=()=>(vo=M.tb)(),ji=t._malloc=s=>(ji=t._malloc=M.ub)(s),Co=t._free=s=>(Co=t._free=M.vb)(s);t._RegisterExtensionFunctions=s=>(t._RegisterExtensionFunctions=M.wb)(s),t._set_authorizer=s=>(t._set_authorizer=M.xb)(s),t._create_function=(s,l,c,f,y,T)=>(t._create_function=M.yb)(s,l,c,f,y,T),t._update_hook=(s,l)=>(t._update_hook=M.zb)(s,l),t._create_module=(s,l,c,f)=>(t._create_module=M.Ab)(s,l,c,f),t._progress_handler=(s,l)=>(t._progress_handler=M.Bb)(s,l),t._register_vfs=(s,l,c,f)=>(t._register_vfs=M.Cb)(s,l,c,f),t._getSqliteFree=()=>(t._getSqliteFree=M.Db)();var Ro=t._main=(s,l)=>(Ro=t._main=M.Eb)(s,l),xo=(s,l)=>(xo=M.Gb)(s,l),ko=()=>(ko=M.Hb)(),Ao=()=>(Ao=M.Ib)(),Lo=s=>(Lo=M.Jb)(s),Ki=s=>(Ki=M.Kb)(s),qo=s=>(qo=M.Lb)(s),Do=()=>(Do=M.Mb)(),Wo=s=>(Wo=M.Nb)(s),Bo=()=>(Bo=M.Ob)();t.getTempRet0=ko,t.ccall=mt,t.cwrap=(s,l,c,f)=>{var y=!c||c.every(T=>T==="number"||T==="boolean");return l!=="string"&&y&&!f?t["_"+s]:function(){return mt(s,l,c,arguments,f)}},t.setValue=Pe,t.getValue=Ie,t.UTF8ToString=(s,l)=>s?se(A,s,l):"",t.stringToUTF8=(s,l,c)=>Ae(s,A,l,c),t.lengthBytesUTF8=Me;var ni;te=function s(){ni||Fo(),ni||(te=s)};function Fo(){function s(){if(!ni&&(ni=!0,t.calledRun=!0,!b)){if(t.noFSInit||Cs||(Cs=!0,vs(),t.stdin=t.stdin,t.stdout=t.stdout,t.stderr=t.stderr,t.stdin?fn("stdin",t.stdin):Ui("/dev/tty","/dev/stdin"),t.stdout?fn("stdout",null,t.stdout):Ui("/dev/tty","/dev/stdout"),t.stderr?fn("stderr",null,t.stderr):Ui("/dev/tty1","/dev/stderr"),Gn("/dev/stdin",0),Gn("/dev/stdout",1),Gn("/dev/stderr",1)),hs=!1,Rr(ee),Rr(le),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),Po){var l=Ro;try{var c=l(0,0);_=c,wo(c)}catch(f){Ji(f)}}if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)l=t.postRun.shift(),K.unshift(l);Rr(K)}}if(!(0<U)){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Ce();Rr(P),0<U||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),s()},1)):s())}}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();var Po=!0;return t.noInitialRun&&(Po=!1),Fo(),e.ready}})();const SQLITE_OK=0,SQLITE_BUSY=5,SQLITE_IOERR=10,SQLITE_NOTFOUND=12,SQLITE_CANTOPEN=14,SQLITE_MISUSE=21,SQLITE_RANGE=25,SQLITE_NOTICE=27,SQLITE_ROW=100,SQLITE_DONE=101,SQLITE_IOERR_LOCK=3850,SQLITE_IOERR_SHORT_READ=522,SQLITE_OPEN_READONLY=1,SQLITE_OPEN_READWRITE=2,SQLITE_OPEN_CREATE=4,SQLITE_OPEN_DELETEONCLOSE=8,SQLITE_OPEN_URI=64,SQLITE_LOCK_NONE=0,SQLITE_LOCK_SHARED=1,SQLITE_LOCK_RESERVED=2,SQLITE_LOCK_PENDING=3,SQLITE_LOCK_EXCLUSIVE=4,SQLITE_IOCAP_SAFE_APPEND=512,SQLITE_IOCAP_SEQUENTIAL=1024,SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN=2048,SQLITE_IOCAP_BATCH_ATOMIC=16384,SQLITE_INTEGER=1,SQLITE_FLOAT=2,SQLITE_TEXT=3,SQLITE_BLOB=4,SQLITE_NULL=5,SQLITE_UTF8=1,MAX_INT64=0x7fffffffffffffffn,MIN_INT64=-0x8000000000000000n;class SQLiteError extends Error{constructor(e,t){super(e),this.code=t}}const async=!0;function Factory(r){const e={},t=r._getSqliteFree(),n=r._malloc(8),o=[n,n+4];function a(N){if(typeof N!="string")return 0;const w=r.lengthBytesUTF8(N),b=r._sqlite3_malloc(w+1);return r.stringToUTF8(N,b,w+1),b}function u(N,w){return BigInt(w)<<32n|BigInt(N)&0xffffffffn}const d=function(){const N=BigInt(Number.MAX_SAFE_INTEGER)>>32n,w=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(b,_){return _>N||_<w?u(b,_):_*4294967296+(b&2147483647)-(b&2147483648)}}(),h=new Set;function p(N){if(!h.has(N))throw new SQLiteError("not a database",SQLITE_MISUSE)}const m=new Map;function E(N){if(!m.has(N))throw new SQLiteError("not a statement",SQLITE_MISUSE)}e.bind_collection=function(N,w){E(N);const b=Array.isArray(w),_=e.bind_parameter_count(N);for(let C=1;C<=_;++C){const A=b?C-1:e.bind_parameter_name(N,C),j=w[A];j!==void 0&&e.bind(N,C,j)}return SQLITE_OK},e.bind=function(N,w,b){switch(E(N),typeof b){case"number":return b===(b|0)?e.bind_int(N,w,b):e.bind_double(N,w,b);case"string":return e.bind_text(N,w,b);default:if(b instanceof Uint8Array||Array.isArray(b))return e.bind_blob(N,w,b);if(b===null)return e.bind_null(N,w);if(typeof b=="bigint")return e.bind_int64(N,w,b);if(b===void 0)return SQLITE_NOTICE;throw new Error("Unknown binding type "+typeof b)}},e.bind_blob=function(){const N="sqlite3_bind_blob",w=r.cwrap(N,...decl("nnnnn:n"));return function(b,_,C){E(b);const A=C.byteLength??C.length,j=r._sqlite3_malloc(A);r.HEAPU8.subarray(j).set(C);const I=w(b,_,j,A,t);return S(N,I,m.get(b))}}(),e.bind_parameter_count=function(){const w=r.cwrap("sqlite3_bind_parameter_count",...decl("n:n"));return function(b){return E(b),w(b)}}(),e.bind_double=function(){const N="sqlite3_bind_double",w=r.cwrap(N,...decl("nnn:n"));return function(b,_,C){E(b);const A=w(b,_,C);return S(N,A,m.get(b))}}(),e.bind_int=function(){const N="sqlite3_bind_int",w=r.cwrap(N,...decl("nnn:n"));return function(b,_,C){if(E(b),C>2147483647||C<-2147483648)return SQLITE_RANGE;const A=w(b,_,C);return S(N,A,m.get(b))}}(),e.bind_int64=function(){const N="sqlite3_bind_int64",w=r.cwrap(N,...decl("nnnn:n"));return function(b,_,C){if(E(b),C>MAX_INT64||C<MIN_INT64)return SQLITE_RANGE;const A=C&0xffffffffn,j=C>>32n,I=w(b,_,Number(A),Number(j));return S(N,I,m.get(b))}}(),e.bind_null=function(){const N="sqlite3_bind_null",w=r.cwrap(N,...decl("nn:n"));return function(b,_){E(b);const C=w(b,_);return S(N,C,m.get(b))}}(),e.bind_parameter_name=function(){const w=r.cwrap("sqlite3_bind_parameter_name",...decl("n:s"));return function(b,_){return E(b),w(b,_)}}(),e.bind_text=function(){const N="sqlite3_bind_text",w=r.cwrap(N,...decl("nnnnn:n"));return function(b,_,C){E(b);const A=a(C),j=w(b,_,A,-1,t);return S(N,j,m.get(b))}}(),e.changes=function(){const w=r.cwrap("sqlite3_changes",...decl("n:n"));return function(b){return p(b),w(b)}}(),e.close=function(){const N="sqlite3_close",w=r.cwrap(N,...decl("n:n"),{async});return async function(b){p(b);const _=await w(b);return h.delete(b),S(N,_,b)}}(),e.column=function(N,w){E(N);const b=e.column_type(N,w);switch(b){case SQLITE_BLOB:return e.column_blob(N,w);case SQLITE_FLOAT:return e.column_double(N,w);case SQLITE_INTEGER:const _=e.column_int(N,w),C=r.getTempRet0();return d(_,C);case SQLITE_NULL:return null;case SQLITE_TEXT:return e.column_text(N,w);default:throw new SQLiteError("unknown type",b)}},e.column_blob=function(){const w=r.cwrap("sqlite3_column_blob",...decl("nn:n"));return function(b,_){E(b);const C=e.column_bytes(b,_),A=w(b,_),j=r.HEAPU8.subarray(A,A+C),I=new ArrayBuffer(j.byteLength),F=new Uint8Array(I);return F.set(j),F}}(),e.column_bytes=function(){const w=r.cwrap("sqlite3_column_bytes",...decl("nn:n"));return function(b,_){return E(b),w(b,_)}}(),e.column_count=function(){const w=r.cwrap("sqlite3_column_count",...decl("n:n"));return function(b){return E(b),w(b)}}(),e.column_double=function(){const w=r.cwrap("sqlite3_column_double",...decl("nn:n"));return function(b,_){return E(b),w(b,_)}}(),e.column_int=function(){const w=r.cwrap("sqlite3_column_int64",...decl("nn:n"));return function(b,_){return E(b),w(b,_)}}(),e.column_int64=function(){const w=r.cwrap("sqlite3_column_int64",...decl("nn:n"));return function(b,_){E(b);const C=w(b,_),A=r.getTempRet0();return u(C,A)}}(),e.column_name=function(){const w=r.cwrap("sqlite3_column_name",...decl("nn:s"));return function(b,_){return E(b),w(b,_)}}(),e.column_names=function(N){const w=[],b=e.column_count(N);for(let _=0;_<b;++_)w.push(e.column_name(N,_));return w},e.column_text=function(){const w=r.cwrap("sqlite3_column_text",...decl("nn:s"));return function(b,_){return E(b),w(b,_)}}(),e.column_type=function(){const w=r.cwrap("sqlite3_column_type",...decl("nn:n"));return function(b,_){return E(b),w(b,_)}}(),e.update_hook=function(N,w){return p(N),r.updateHook(N,w),SQLITE_OK},e.create_function=function(N,w,b,_,C,A,j,I){if(p(N),A&&!j&&!I){const F=r.createFunction(N,w,b,_,C,A);return S("sqlite3_create_function",F,N)}if(!A&&j&&I){const F=r.createAggregate(N,w,b,_,C,j,I);return S("sqlite3_create_function",F,N)}throw new SQLiteError("invalid function combination",SQLITE_MISUSE)},e.create_module=function(N,w,b,_){p(N);const C=r.createModule(N,w,b,_);return S("sqlite3_create_module",C,N)},e.data_count=function(){const w=r.cwrap("sqlite3_data_count",...decl("n:n"));return function(b){return E(b),w(b)}}(),e.declare_vtab=function(){const w=r.cwrap("sqlite3_declare_vtab",...decl("ns:n"));return function(b,_){const C=w(b,_);return S("sqlite3_declare_vtab",C)}}(),e.exec=async function(N,w,b){for await(const _ of e.statements(N,w)){let C;for(;await e.step(_)===SQLITE_ROW;)if(b){C=C??e.column_names(_);const A=e.row(_);await b(A,C)}}return SQLITE_OK},e.finalize=function(){const w=r.cwrap("sqlite3_finalize",...decl("n:n"),{async});return async function(b){if(!m.has(b))return SQLITE_MISUSE;const _=await w(b);return m.get(b),m.delete(b),_}}(),e.get_autocommit=function(){const w=r.cwrap("sqlite3_get_autocommit",...decl("n:n"));return function(b){return w(b)}}(),e.libversion=function(){const w=r.cwrap("sqlite3_libversion",...decl(":s"));return function(){return w()}}(),e.libversion_number=function(){const w=r.cwrap("sqlite3_libversion_number",...decl(":n"));return function(){return w()}}(),e.limit=function(){const w=r.cwrap("sqlite3_limit",...decl("nnn:n"));return function(b,_,C){return w(b,_,C)}}(),e.open_v2=function(){const N="sqlite3_open_v2",w=r.cwrap(N,...decl("snnn:n"),{async});return async function(b,_,C){_=_||SQLITE_OPEN_CREATE|SQLITE_OPEN_READWRITE,C=a(C);const A=await w(b,o[0],_,C),j=r.getValue(o[0],"*");return h.add(j),r._sqlite3_free(C),r.ccall("RegisterExtensionFunctions","void",["number"],[j]),S(N,A),j}}(),e.prepare_v2=function(){const N="sqlite3_prepare_v2",w=r.cwrap(N,...decl("nnnnn:n"),{async});return async function(b,_){const C=await w(b,_,-1,o[0],o[1]);S(N,C,b);const A=r.getValue(o[0],"*");return A?(m.set(A,b),{stmt:A,sql:r.getValue(o[1],"*")}):null}}(),e.progress_handler=function(N,w,b,_){p(N),r.progressHandler(N,w,b,_)},e.reset=function(){const N="sqlite3_reset",w=r.cwrap(N,...decl("n:n"),{async});return async function(b){E(b);const _=await w(b);return S(N,_,m.get(b))}}(),e.result=function(N,w){switch(typeof w){case"number":w===(w|0)?e.result_int(N,w):e.result_double(N,w);break;case"string":e.result_text(N,w);break;default:if(w instanceof Uint8Array||Array.isArray(w))e.result_blob(N,w);else if(w===null)e.result_null(N);else{if(typeof w=="bigint")return e.result_int64(N,w);console.warn("unknown result converted to null",w),e.result_null(N)}break}},e.result_blob=function(){const w=r.cwrap("sqlite3_result_blob",...decl("nnnn:n"));return function(b,_){const C=_.byteLength??_.length,A=r._sqlite3_malloc(C);r.HEAPU8.subarray(A).set(_),w(b,A,C,t)}}(),e.result_double=function(){const w=r.cwrap("sqlite3_result_double",...decl("nn:n"));return function(b,_){w(b,_)}}(),e.result_int=function(){const w=r.cwrap("sqlite3_result_int",...decl("nn:n"));return function(b,_){w(b,_)}}(),e.result_int64=function(){const w=r.cwrap("sqlite3_result_int64",...decl("nnn:n"));return function(b,_){if(_>MAX_INT64||_<MIN_INT64)return SQLITE_RANGE;const C=_&0xffffffffn,A=_>>32n;w(b,Number(C),Number(A))}}(),e.result_null=function(){const w=r.cwrap("sqlite3_result_null",...decl("n:n"));return function(b){w(b)}}(),e.result_text=function(){const w=r.cwrap("sqlite3_result_text",...decl("nnnn:n"));return function(b,_){const C=a(_);w(b,C,-1,t)}}(),e.row=function(N){const w=[],b=e.data_count(N);for(let _=0;_<b;++_){const C=e.column(N,_);w.push((C==null?void 0:C.buffer)===r.HEAPU8.buffer?C.slice():C)}return w},e.set_authorizer=function(N,w,b){p(N);const _=r.setAuthorizer(N,w,b);return S("sqlite3_set_authorizer",_,N)},e.sql=function(){const w=r.cwrap("sqlite3_sql",...decl("n:s"));return function(b){return E(b),w(b)}}(),e.statements=function(N,w){return async function*(){const b=e.str_new(N,w);let _={stmt:null,sql:e.str_value(b)};try{for(;_=await e.prepare_v2(N,_.sql);)yield _.stmt,e.finalize(_.stmt),_.stmt=null}finally{_!=null&&_.stmt&&e.finalize(_.stmt),e.str_finish(b)}}()},e.step=function(){const N="sqlite3_step",w=r.cwrap(N,...decl("n:n"),{async});return async function(b){E(b);const _=await w(b);return S(N,_,m.get(b),[SQLITE_ROW,SQLITE_DONE])}}();let k=0;const L=new Map;e.str_new=function(N,w=""){const b=r.lengthBytesUTF8(w),_=k++&4294967295,C={offset:r._sqlite3_malloc(b+1),bytes:b};return L.set(_,C),r.stringToUTF8(w,C.offset,C.bytes+1),_},e.str_appendall=function(N,w){if(!L.has(N))throw new SQLiteError("not a string",SQLITE_MISUSE);const b=L.get(N),_=r.lengthBytesUTF8(w),C=b.bytes+_,A=r._sqlite3_malloc(C+1);r.HEAPU8.subarray(A,A+C+1).set(r.HEAPU8.subarray(b.offset,b.offset+b.bytes)),r.stringToUTF8(w,A+b.bytes,_+1),r._sqlite3_free(b.offset),b.offset=A,b.bytes=C,L.set(N,b)},e.str_finish=function(N){if(!L.has(N))throw new SQLiteError("not a string",SQLITE_MISUSE);const w=L.get(N);L.delete(N),r._sqlite3_free(w.offset)},e.str_value=function(N){if(!L.has(N))throw new SQLiteError("not a string",SQLITE_MISUSE);return L.get(N).offset},e.user_data=function(N){return r.getFunctionUserData(N)},e.value=function(N){const w=e.value_type(N);switch(w){case SQLITE_BLOB:return e.value_blob(N);case SQLITE_FLOAT:return e.value_double(N);case SQLITE_INTEGER:const b=e.value_int(N),_=r.getTempRet0();return d(b,_);case SQLITE_NULL:return null;case SQLITE_TEXT:return e.value_text(N);default:throw new SQLiteError("unknown type",w)}},e.value_blob=function(){const w=r.cwrap("sqlite3_value_blob",...decl("n:n"));return function(b){const _=e.value_bytes(b),C=w(b);return r.HEAPU8.subarray(C,C+_)}}(),e.value_bytes=function(){const w=r.cwrap("sqlite3_value_bytes",...decl("n:n"));return function(b){return w(b)}}(),e.value_double=function(){const w=r.cwrap("sqlite3_value_double",...decl("n:n"));return function(b){return w(b)}}(),e.value_int=function(){const w=r.cwrap("sqlite3_value_int64",...decl("n:n"));return function(b){return w(b)}}(),e.value_int64=function(){const w=r.cwrap("sqlite3_value_int64",...decl("n:n"));return function(b){const _=w(b),C=r.getTempRet0();return u(_,C)}}(),e.value_text=function(){const w=r.cwrap("sqlite3_value_text",...decl("n:s"));return function(b){return w(b)}}(),e.value_type=function(){const w=r.cwrap("sqlite3_value_type",...decl("n:n"));return function(b){return w(b)}}(),e.vfs_register=function(N,w){const b=r.registerVFS(N,w);return S("sqlite3_vfs_register",b)};function S(N,w,b=null,_=[SQLITE_OK]){if(_.includes(w))return w;const C=b?r.ccall("sqlite3_errmsg","string",["number"],[b]):N;throw new SQLiteError(C,w)}return e}function decl(r){const e=[],t=r.match(/([ns@]*):([nsv@])/);switch(t[2]){case"n":e.push("number");break;case"s":e.push("string");break;case"v":e.push(null);break}const n=[];for(let o of t[1])switch(o){case"n":n.push("number");break;case"s":n.push("string");break}return e.push(n),e}class Base{constructor(){ae(this,"mxPathName",64)}xClose(e){return SQLITE_IOERR}xRead(e,t,n){return SQLITE_IOERR}xWrite(e,t,n){return SQLITE_IOERR}xTruncate(e,t){return SQLITE_IOERR}xSync(e,t){return SQLITE_OK}xFileSize(e,t){return SQLITE_IOERR}xLock(e,t){return SQLITE_OK}xUnlock(e,t){return SQLITE_OK}xCheckReservedLock(e,t){return t.setInt32(0,0,!0),SQLITE_OK}xFileControl(e,t,n){return SQLITE_NOTFOUND}xSectorSize(e){return 512}xDeviceCharacteristics(e){return 0}xOpen(e,t,n,o){return SQLITE_CANTOPEN}xDelete(e,t){return SQLITE_IOERR}xAccess(e,t,n){return SQLITE_IOERR}handleAsync(e){return e()}}const LOCK_TYPE_MASK=SQLITE_LOCK_NONE|SQLITE_LOCK_SHARED|SQLITE_LOCK_RESERVED|SQLITE_LOCK_PENDING|SQLITE_LOCK_EXCLUSIVE;var Ke,an,Bn,Fn,ns,vi,Xo,Ci,Yo;class WebLocksBase{constructor(){g(this,Fn);g(this,vi);g(this,Ci);g(this,Ke,SQLITE_LOCK_NONE);ae(this,"timeoutMillis",0);g(this,an,new Map);g(this,Bn,Promise.resolve(0))}get state(){return i(this,Ke)}async lock(e){return X(this,Fn,ns).call(this,X(this,vi,Xo),e)}async unlock(e){return X(this,Fn,ns).call(this,X(this,Ci,Yo),e)}async isSomewhereReserved(){throw new Error("unimplemented")}async _NONEtoSHARED(){}async _SHAREDtoEXCLUSIVE(){await this._SHAREDtoRESERVED(),await this._RESERVEDtoEXCLUSIVE()}async _SHAREDtoRESERVED(){}async _RESERVEDtoEXCLUSIVE(){}async _EXCLUSIVEtoRESERVED(){}async _EXCLUSIVEtoSHARED(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED()}async _EXCLUSIVEtoNONE(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _RESERVEDtoSHARED(){}async _RESERVEDtoNONE(){await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _SHAREDtoNONE(){}_acquireWebLock(e,t){return new Promise(async(n,o)=>{try{await navigator.locks.request(e,t,a=>{if(n(a),a)return new Promise(u=>i(this,an).set(e,u))})}catch(a){o(a)}})}_releaseWebLock(e){var t;(t=i(this,an).get(e))==null||t(),i(this,an).delete(e)}async _pollWebLock(e){var n;return(n=(await navigator.locks.query()).held.find(({name:o})=>o===e))==null?void 0:n.mode}_getTimeoutSignal(){if(this.timeoutMillis){const e=new AbortController;return setTimeout(()=>e.abort(),this.timeoutMillis),e.signal}}}Ke=new WeakMap,an=new WeakMap,Bn=new WeakMap,Fn=new WeakSet,ns=async function(e,t){const n=t&LOCK_TYPE_MASK;try{const o=()=>e.call(this,n);return await x(this,Bn,i(this,Bn).then(o,o)),x(this,Ke,n),SQLITE_OK}catch(o){return o.name==="AbortError"?SQLITE_BUSY:(console.error(o),SQLITE_IOERR_LOCK)}},vi=new WeakSet,Xo=async function(e){if(e===i(this,Ke))return SQLITE_OK;switch(i(this,Ke)){case SQLITE_LOCK_NONE:switch(e){case SQLITE_LOCK_SHARED:return this._NONEtoSHARED();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}case SQLITE_LOCK_SHARED:switch(e){case SQLITE_LOCK_RESERVED:return this._SHAREDtoRESERVED();case SQLITE_LOCK_EXCLUSIVE:return this._SHAREDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}case SQLITE_LOCK_RESERVED:switch(e){case SQLITE_LOCK_EXCLUSIVE:return this._RESERVEDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}},Ci=new WeakSet,Yo=async function(e){if(e===i(this,Ke))return SQLITE_OK;switch(i(this,Ke)){case SQLITE_LOCK_EXCLUSIVE:switch(e){case SQLITE_LOCK_SHARED:return this._EXCLUSIVEtoSHARED();case SQLITE_LOCK_NONE:return this._EXCLUSIVEtoNONE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}case SQLITE_LOCK_RESERVED:switch(e){case SQLITE_LOCK_SHARED:return this._RESERVEDtoSHARED();case SQLITE_LOCK_NONE:return this._RESERVEDtoNONE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}case SQLITE_LOCK_SHARED:switch(e){case SQLITE_LOCK_NONE:return this._SHAREDtoNONE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}};class WebLocksExclusive extends WebLocksBase{constructor(e){super(),this._lockName=e+"-outer",this._reservedName=e+"-reserved"}async isSomewhereReserved(){return await this._pollWebLock(this._reservedName)==="exclusive"}async _NONEtoSHARED(){await this._acquireWebLock(this._lockName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _SHAREDtoRESERVED(){await this._acquireWebLock(this._reservedName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _RESERVEDtoSHARED(){this._releaseWebLock(this._reservedName)}async _SHAREDtoNONE(){this._releaseWebLock(this._lockName)}}const MAX_TRANSACTION_LIFETIME_MILLIS=5e3;let nextTxId=0;const mapTxToId=new WeakMap;function log$2(...r){}var ln,un,Pn,Ue,zn,Or,Tr,Ri,Zo;class IDBContext{constructor(e,t={durability:"default"}){g(this,Ri);g(this,ln,void 0);g(this,un,void 0);g(this,Pn,void 0);g(this,Ue,null);g(this,zn,0);g(this,Or,Promise.resolve());g(this,Tr,Promise.resolve());x(this,un,Promise.resolve(e).then(n=>x(this,ln,n))),x(this,Pn,t)}async close(){const e=i(this,ln)??await i(this,un);await i(this,Or),await this.sync(),e.close()}async run(e,t){const n=i(this,Or).then(()=>X(this,Ri,Zo).call(this,e,t));return x(this,Or,n.catch(()=>{})),n}async sync(){await i(this,Or),await i(this,Tr),x(this,Tr,Promise.resolve())}}ln=new WeakMap,un=new WeakMap,Pn=new WeakMap,Ue=new WeakMap,zn=new WeakMap,Or=new WeakMap,Tr=new WeakMap,Ri=new WeakSet,Zo=async function(e,t){var o,a;const n=i(this,ln)??await i(this,un);if(e==="readwrite"&&((o=i(this,Ue))==null?void 0:o.mode)==="readonly")x(this,Ue,null);else if(performance.now()-i(this,zn)>MAX_TRANSACTION_LIFETIME_MILLIS){try{(a=i(this,Ue))==null||a.commit()}catch(u){if(u.name!=="InvalidStateError")throw u}await new Promise(u=>setTimeout(u)),x(this,Ue,null)}for(let u=0;u<2;++u){if(!i(this,Ue)){x(this,Ue,n.transaction(n.objectStoreNames,e,i(this,Pn)));const d=x(this,zn,performance.now());x(this,Tr,i(this,Tr).then(()=>new Promise((h,p)=>{i(this,Ue).addEventListener("complete",m=>{h(),i(this,Ue)===m.target&&x(this,Ue,null),log$2(`transaction ${mapTxToId.get(m.target)} complete`)}),i(this,Ue).addEventListener("abort",m=>{console.warn("tx abort",(performance.now()-d)/1e3);const E=m.target.error;p(E),i(this,Ue)===m.target&&x(this,Ue,null),log$2(`transaction ${mapTxToId.get(m.target)} aborted`,E)})}))),mapTxToId.set(i(this,Ue),nextTxId++)}try{const d=Object.fromEntries(Array.from(n.objectStoreNames,h=>[h,new ObjectStore(i(this,Ue).objectStore(h))]));return await t(d)}catch(d){if(x(this,Ue,null),u)throw d}}};function wrapRequest(r){return new Promise((e,t)=>{r.addEventListener("success",()=>e(r.result)),r.addEventListener("error",()=>t(r.error))})}var Fe;class ObjectStore{constructor(e){g(this,Fe,void 0);x(this,Fe,e)}get(e){log$2(`get ${i(this,Fe).name}`,e);const t=i(this,Fe).get(e);return wrapRequest(t)}getAll(e,t){log$2(`getAll ${i(this,Fe).name}`,e,t);const n=i(this,Fe).getAll(e,t);return wrapRequest(n)}getKey(e){log$2(`getKey ${i(this,Fe).name}`,e);const t=i(this,Fe).getKey(e);return wrapRequest(t)}getAllKeys(e,t){log$2(`getAllKeys ${i(this,Fe).name}`,e,t);const n=i(this,Fe).getAllKeys(e,t);return wrapRequest(n)}put(e,t){log$2(`put ${i(this,Fe).name}`,e,t);const n=i(this,Fe).put(e,t);return wrapRequest(n)}delete(e){log$2(`delete ${i(this,Fe).name}`,e);const t=i(this,Fe).delete(e);return wrapRequest(t)}clear(){log$2(`clear ${i(this,Fe).name}`);const e=i(this,Fe).clear();return wrapRequest(e)}index(e){return new Index(i(this,Fe).index(e))}}Fe=new WeakMap;var Ir;class Index{constructor(e){g(this,Ir,void 0);x(this,Ir,e)}getAllKeys(e,t){log$2(`IDBIndex.getAllKeys ${i(this,Ir).objectStore.name}<${i(this,Ir).name}>`,e,t);const n=i(this,Ir).getAllKeys(e,t);return wrapRequest(n)}}Ir=new WeakMap;const SECTOR_SIZE=512,MAX_TASK_MILLIS=3e3,DEFAULT_OPTIONS={durability:"default",purge:"deferred",purgeAtLeast:16};function log$1(...r){}var er,Ge,ve,Sr,vr,Pt,Qn,ss,xi,ea,ki,ta,tr,Lr,Ai,ra;class IDBBatchAtomicVFS extends Base{constructor(t="wa-sqlite",n=DEFAULT_OPTIONS){super();g(this,Qn);g(this,xi);g(this,ki);g(this,tr);g(this,Ai);g(this,er,void 0);g(this,Ge,new Map);g(this,ve,void 0);g(this,Sr,new Set);g(this,vr,performance.now());g(this,Pt,new Set);this.name=t,x(this,er,Object.assign({},DEFAULT_OPTIONS,n)),x(this,ve,new IDBContext(openDatabase(t),{durability:i(this,er).durability}))}async close(){var t;for(const n of i(this,Ge).keys())await this.xClose(n);await((t=i(this,ve))==null?void 0:t.close()),x(this,ve,null)}xOpen(t,n,o,a){return this.handleAsync(async()=>{t===null&&(t=`null_${n}`),log$1(`xOpen ${t} 0x${n.toString(16)} 0x${o.toString(16)}`);try{const u=new URL(t,"http://localhost/"),d={path:u.pathname,flags:o,block0:null,isMetadataChanged:!0,locks:new WebLocksExclusive(u.pathname)};return i(this,Ge).set(n,d),await i(this,ve).run("readwrite",async({blocks:h})=>{if(d.block0=await h.get(X(this,tr,Lr).call(this,d,0)),!d.block0)if(o&SQLITE_OPEN_CREATE)d.block0={path:d.path,offset:0,version:0,data:new Uint8Array(0),fileSize:0},h.put(d.block0);else throw new Error(`file not found: ${d.path}`)}),a.setInt32(0,o&SQLITE_OPEN_READONLY,!0),SQLITE_OK}catch(u){return console.error(u),SQLITE_CANTOPEN}})}xClose(t){return this.handleAsync(async()=>{try{const n=i(this,Ge).get(t);return n&&(log$1(`xClose ${n.path}`),i(this,Ge).delete(t),n.flags&SQLITE_OPEN_DELETEONCLOSE&&i(this,ve).run("readwrite",({blocks:o})=>{o.delete(IDBKeyRange.bound([n.path],[n.path,[]]))})),SQLITE_OK}catch(n){return console.error(n),SQLITE_IOERR}})}xRead(t,n,o){return this.handleAsync(async()=>{const a=i(this,Ge).get(t);log$1(`xRead ${a.path} ${n.byteLength} ${o}`);try{return await i(this,ve).run("readonly",async({blocks:d})=>{let h=0;for(;h<n.byteLength;){const p=o+h,m=p<a.block0.data.byteLength?a.block0:await d.get(X(this,tr,Lr).call(this,a,-p));if(!m||m.data.byteLength-m.offset<=p)return n.fill(0,h),SQLITE_IOERR_SHORT_READ;const E=n.subarray(h),k=p+m.offset,L=Math.min(Math.max(m.data.byteLength-k,0),E.byteLength);E.set(m.data.subarray(k,k+L)),h+=L}return SQLITE_OK})}catch(u){return console.error(u),SQLITE_IOERR}})}xWrite(t,n,o){const a=i(this,Pt).has(t);if(a||performance.now()-i(this,vr)>MAX_TASK_MILLIS){const u=this.handleAsync(async()=>{this.handleAsync!==super.handleAsync&&i(this,Pt).add(t),await new Promise(h=>setTimeout(h));const d=X(this,Qn,ss).call(this,t,n,o);return x(this,vr,performance.now()),d});return a&&i(this,Pt).delete(t),u}return X(this,Qn,ss).call(this,t,n,o)}xTruncate(t,n){const o=i(this,Ge).get(t);log$1(`xTruncate ${o.path} ${n}`);try{Object.assign(o.block0,{fileSize:n,data:o.block0.data.slice(0,n)});const a=Object.assign({},o.block0);return i(this,ve).run("readwrite",({blocks:u})=>{u.delete(X(this,tr,Lr).call(this,o,-1/0,-n)),u.put(a)}),SQLITE_OK}catch(a){return console.error(a),SQLITE_IOERR}}xSync(t,n){const o=i(this,Pt).has(t);if(o||i(this,er).durability!=="relaxed"||performance.now()-i(this,vr)>MAX_TASK_MILLIS){const u=this.handleAsync(async()=>{this.handleAsync!==super.handleAsync&&i(this,Pt).add(t);const d=await X(this,xi,ea).call(this,t,n);return x(this,vr,performance.now()),d});return o&&i(this,Pt).delete(t),u}const a=i(this,Ge).get(t);return log$1(`xSync ${a.path} ${n}`),SQLITE_OK}xFileSize(t,n){const o=i(this,Ge).get(t);return log$1(`xFileSize ${o.path}`),n.setBigInt64(0,BigInt(o.block0.fileSize),!0),SQLITE_OK}xLock(t,n){return this.handleAsync(async()=>{const o=i(this,Ge).get(t);log$1(`xLock ${o.path} ${n}`);try{const a=await o.locks.lock(n);return a===SQLITE_OK&&o.locks.state===SQLITE_LOCK_SHARED&&(o.block0=await i(this,ve).run("readonly",({blocks:u})=>u.get(X(this,tr,Lr).call(this,o,0)))),a}catch(a){return console.error(a),SQLITE_IOERR}})}xUnlock(t,n){return this.handleAsync(async()=>{const o=i(this,Ge).get(t);log$1(`xUnlock ${o.path} ${n}`);try{return o.locks.unlock(n)}catch(a){return console.error(a),SQLITE_IOERR}})}xCheckReservedLock(t,n){return this.handleAsync(async()=>{const o=i(this,Ge).get(t);log$1(`xCheckReservedLock ${o.path}`);const a=await o.locks.isSomewhereReserved();return n.setInt32(0,a?1:0,!0),SQLITE_OK})}xSectorSize(t){return SECTOR_SIZE}xDeviceCharacteristics(t){return SQLITE_IOCAP_BATCH_ATOMIC|SQLITE_IOCAP_SAFE_APPEND|SQLITE_IOCAP_SEQUENTIAL|SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN}xFileControl(t,n,o){const a=i(this,Ge).get(t);switch(log$1(`xFileControl ${a.path} ${n}`),n){case 11:return a.overwrite=!0,SQLITE_OK;case 21:if(a.overwrite)try{return this.handleAsync(async()=>(await X(this,Ai,ra).call(this,a),SQLITE_OK))}catch(u){return console.error(u),SQLITE_IOERR}if(a.isMetadataChanged)try{i(this,ve).run("readwrite",async({blocks:u})=>{await u.put(a.block0)}),a.isMetadataChanged=!1}catch(u){return console.error(u),SQLITE_IOERR}return SQLITE_OK;case 22:return a.overwrite=!1,SQLITE_OK;case 31:return this.handleAsync(async()=>{try{return a.block0.version--,a.changedPages=new Set,i(this,ve).run("readwrite",async({blocks:u})=>{const d=await u.index("version").getAllKeys(IDBKeyRange.bound([a.path],[a.path,a.block0.version]));for(const h of d)u.delete(h)}),SQLITE_OK}catch(u){return console.error(u),SQLITE_IOERR}});case 32:try{const u=Object.assign({},a.block0);u.data=u.data.slice();const d=a.changedPages;return a.changedPages=null,a.isMetadataChanged=!1,i(this,ve).run("readwrite",async({blocks:h})=>{h.put(u);const p=await h.get([a.path,"purge",0])??{path:a.path,offset:"purge",version:0,data:new Map,count:0};p.count+=d.size;for(const m of d)p.data.set(m,u.version);h.put(p),X(this,ki,ta).call(this,a.path,p.count)}),SQLITE_OK}catch(u){return console.error(u),SQLITE_IOERR}case 33:return this.handleAsync(async()=>{try{return a.changedPages=null,a.isMetadataChanged=!1,a.block0=await i(this,ve).run("readonly",({blocks:u})=>u.get([a.path,0,a.block0.version+1])),SQLITE_OK}catch(u){return console.error(u),SQLITE_IOERR}});default:return SQLITE_NOTFOUND}}xAccess(t,n,o){return this.handleAsync(async()=>{try{const a=new URL(t,"file://localhost/").pathname;log$1(`xAccess ${a} ${n}`);const u=await i(this,ve).run("readonly",({blocks:d})=>d.getKey(X(this,tr,Lr).call(this,{path:a},0)));return o.setInt32(0,u?1:0,!0),SQLITE_OK}catch(a){return console.error(a),SQLITE_IOERR}})}xDelete(t,n){return this.handleAsync(async()=>{const o=new URL(t,"file://localhost/").pathname;try{return i(this,ve).run("readwrite",({blocks:a})=>a.delete(IDBKeyRange.bound([o],[o,[]]))),n&&await i(this,ve).sync(),SQLITE_OK}catch(a){return console.error(a),SQLITE_IOERR}})}async purge(t){const n=Date.now();await i(this,ve).run("readwrite",async({blocks:o})=>{const a=await o.get([t,"purge",0]);if(a){for(const[u,d]of a.data)o.delete(IDBKeyRange.bound([t,u,d],[t,u,1/0],!0,!1));await o.delete([t,"purge",0])}log$1(`purge ${t} ${(a==null?void 0:a.data.size)??0} pages in ${Date.now()-n} ms`)})}}er=new WeakMap,Ge=new WeakMap,ve=new WeakMap,Sr=new WeakMap,vr=new WeakMap,Pt=new WeakMap,Qn=new WeakSet,ss=function(t,n,o){const a=i(this,Ge).get(t);log$1(`xWrite ${a.path} ${n.byteLength} ${o}`);try{const u=a.block0.fileSize;a.block0.fileSize<o+n.byteLength&&(a.block0.fileSize=o+n.byteLength,a.isMetadataChanged=!0);const d=o===0?a.block0:{path:a.path,offset:-o,version:a.block0.version,data:null};return d.data=n.slice(),a.changedPages?(u===a.block0.fileSize&&a.changedPages.add(-o),o!==0&&i(this,ve).run("readwrite",({blocks:h})=>h.put(d))):i(this,ve).run("readwrite",({blocks:h})=>h.put(d)),a.isMetadataChanged=o===0?!1:a.isMetadataChanged,SQLITE_OK}catch(u){return console.error(u),SQLITE_IOERR}},xi=new WeakSet,ea=async function(t,n){const o=i(this,Ge).get(t);log$1(`xSync ${o.path} ${n}`);try{o.isMetadataChanged&&(i(this,ve).run("readwrite",async({blocks:a})=>{await a.put(o.block0)}),o.isMetadataChanged=!1),await i(this,ve).sync()}catch(a){return console.error(a),SQLITE_IOERR}return SQLITE_OK},ki=new WeakSet,ta=function(t,n){i(this,er).purge==="manual"||i(this,Sr).has(t)||n<i(this,er).purgeAtLeast||(globalThis.requestIdleCallback?globalThis.requestIdleCallback(()=>{this.purge(t),i(this,Sr).delete(t)}):setTimeout(()=>{this.purge(t),i(this,Sr).delete(t)}),i(this,Sr).add(t))},tr=new WeakSet,Lr=function(t,n,o=0){const a=!n||-n<t.block0.data.length?-1/0:t.block0.version;return IDBKeyRange.bound([t.path,n,a],[t.path,o,1/0])},Ai=new WeakSet,ra=async function(t){const n=t.block0.data.length;if(n<18)return;const o=new DataView(t.block0.data.buffer,t.block0.data.byteOffset);let a=o.getUint16(16);if(a===1&&(a=65536),a===n)return;const u=Math.max(n,a),d=u/n,h=u/a,m=o.getUint32(28)*a,E=t.block0.version;await i(this,ve).run("readwrite",async({blocks:k})=>{const L=await k.index("version").getAllKeys(IDBKeyRange.bound([t.path,E+1],[t.path,1/0]));for(const S of L)k.delete(S);k.delete([t.path,"purge",0]);for(let S=0;S<m;S+=u){const N=await k.getAll(IDBKeyRange.lowerBound([t.path,-(S+u),1/0]),d);for(const w of N)k.delete([w.path,w.offset,w.version]);if(h===1){const w=new Uint8Array(a);for(const _ of N)w.set(_.data,-(S+_.offset));const b={path:t.path,offset:-S,version:E,data:w};b.offset===0&&(b.fileSize=m,t.block0=b),k.put(b)}else{const w=N[0];for(let b=0;b<h;++b){const _=-(S+b*a);if(-_>=m)break;const C={path:w.path,offset:_,version:E,data:w.data.subarray(b*a,(b+1)*a)};C.offset===0&&(C.fileSize=m,t.block0=C),k.put(C)}}}})};function openDatabase(r){return new Promise((e,t)=>{const n=globalThis.indexedDB.open(r,5);n.addEventListener("upgradeneeded",function(){n.result.createObjectStore("blocks",{keyPath:["path","offset","version"]}).createIndex("version",["path","version"])}),n.addEventListener("success",()=>{e(n.result)}),n.addEventListener("error",()=>{t(n.error)})})}const E_CANCELED=new Error("request for lock canceled");var __awaiter$2=function(r,e,t,n){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(m){try{p(n.next(m))}catch(E){u(E)}}function h(m){try{p(n.throw(m))}catch(E){u(E)}}function p(m){m.done?a(m.value):o(m.value).then(d,h)}p((n=n.apply(r,e||[])).next())})};class Semaphore{constructor(e,t=E_CANCELED){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()})}runExclusive(e,t=1){return __awaiter$2(this,void 0,void 0,function*(){const[n,o]=yield this.acquire(t);try{return yield e(n)}finally{o()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){const n=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!n)continue;const o=this._value,a=t;this._value-=t,t=this._value+1,n.resolve([o,this._newReleaser(a)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}}var __awaiter$1=function(r,e,t,n){function o(a){return a instanceof t?a:new t(function(u){u(a)})}return new(t||(t=Promise))(function(a,u){function d(m){try{p(n.next(m))}catch(E){u(E)}}function h(m){try{p(n.throw(m))}catch(E){u(E)}}function p(m){m.done?a(m.value):o(m.value).then(d,h)}p((n=n.apply(r,e||[])).next())})};class Mutex{constructor(e){this._semaphore=new Semaphore(1,e)}acquire(){return __awaiter$1(this,void 0,void 0,function*(){const[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const isDebug=globalThis.__vlcn_wa_crsqlite_dbg;function log(...r){isDebug&&console.log("crsqlite-wasm: ",...r)}const re=/insert\s|update\s|delete\s/,txRe=/begin\s|commit\s|rollback\s|savepoint\s/;function computeCacheKey(r,e,t){const n=r.toLowerCase();if(txRe.exec(n)==null)return re.exec(n)!=null?(log("received write"),null):t!=null?n+"|"+e+"|"+t.map(a=>a!=null?a.toString():"null").join("|"):n}class Stmt{constructor(e,t,n,o,a,u,d){ae(this,"originDB");ae(this,"stmtFinalizer");ae(this,"cache");ae(this,"api");ae(this,"base");ae(this,"str");ae(this,"sql");ae(this,"mode","o");ae(this,"finalized",!1);ae(this,"bindings",[]);this.originDB=e,this.stmtFinalizer=t,this.cache=n,this.api=o,this.base=a,this.str=u,this.sql=d,t.set(a,this)}run(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),()=>(t.length>0&&this.bind(t),this.api.step(this.base).then(()=>this.api.reset(this.base))),(e==null?void 0:e.__mutex)||this.originDB.__mutex)}get(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),async()=>{t.length>0&&this.bind(t);let n=null,o=this.mode==="o"?this.api.column_names(this.base):null;if(await this.api.step(this.base)==SQLITE_ROW){const a=this.api.row(this.base);if(o!=null){const u={};for(let d=0;d<o.length;++d)u[o[d]]=a[d];n=u}else n=a}return await this.api.reset(this.base),n},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}all(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),async()=>{t.length>0&&this.bind(t);const n=[];let o=this.mode==="o"?this.api.column_names(this.base):null;for(;await this.api.step(this.base)==SQLITE_ROW;)if(o!=null){const a={};for(let u=0;u<o.length;++u)a[o[u]]=this.api.column(this.base,u);n.push(a)}else{n.push(this.api.row(this.base));continue}return await this.api.reset(this.base),n},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}async*iterate(e,...t){for(this.bind(t);await serialize(this.cache,void 0,()=>this.api.step(this.base),(e==null?void 0:e.__mutex)||this.originDB.__mutex)==SQLITE_ROW;)yield this.api.row(this.base);await serialize(this.cache,void 0,()=>this.api.reset(this.base),(e==null?void 0:e.__mutex)||this.originDB.__mutex)}raw(e){return e?this.mode="a":this.mode="o",this}bind(e){this.bindings=e;for(let t=0;t<e.length;++t)this.api.bind(this.base,t+1,e[t]);return this}finalize(e){return serialize(this.cache,void 0,()=>{if(!this.finalized)return this.finalized=!0,this.api.str_finish(this.str),this.stmtFinalizer.delete(this.base),this.api.finalize(this.base)},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}}class TX{constructor(e,t,n,o,a){ae(this,"api");ae(this,"db");ae(this,"__mutex");ae(this,"assertOpen");ae(this,"stmtFinalizer");ae(this,"cache",new Map);this.api=e,this.db=t,this.__mutex=n,this.assertOpen=o,this.stmtFinalizer=a}execMany(e){return this.assertOpen(),serialize(this.cache,null,()=>this.api.exec(this.db,e.join("")),this.__mutex)}exec(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"a",t),()=>this.statements(e,!1,t),this.__mutex)}execO(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"o",t),()=>this.statements(e,!0,t),this.__mutex)}execA(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"a",t),()=>this.statements(e,!1,t),this.__mutex)}prepare(e){return this.assertOpen(),serialize(this.cache,void 0,async()=>{const t=this.api.str_new(this.db,e),n=await this.api.prepare_v2(this.db,this.api.str_value(t));if(n==null)throw this.api.str_finish(t),new Error(`Could not prepare ${e}`);return new Stmt(this,this.stmtFinalizer,this.cache,this.api,n.stmt,t,e)},this.__mutex)}tx(e){this.assertOpen();const t="crsql"+crypto.randomUUID().replaceAll("-","");return serializeTx(async n=>{await n.exec("SAVEPOINT "+t);try{await e(n)}catch(o){throw await n.exec("ROLLBACK TO "+t),await n.exec("RELEASE "+t),o}await n.exec("RELEASE "+t)},this.__mutex,this)}imperativeTx(){return this.__mutex.acquire().then(e=>{const t=new Mutex;return[e,new TX(this.api,this.db,t,this.assertOpen,this.stmtFinalizer)]})}async statements(e,t,n){const o=[],a=this.api.str_new(this.db,e);let u={stmt:null,sql:this.api.str_value(a)};try{for(;u=await this.api.prepare_v2(this.db,u.sql);){const p=u.stmt,m=[],E=this.api.column_names(p);for(n&&this.bind(p,n);await this.api.step(p)===SQLITE_ROW;){const k=this.api.row(p);m.push(k)}E.length&&o.push({columns:E,rows:m}),this.api.finalize(u.stmt),u.stmt=null}}catch(p){throw console.error(`Failed running ${e}`,p),p}finally{u!=null&&u.stmt&&this.api.finalize(u.stmt),this.api.str_finish(a)}const d=o[0];if(d==null)return null;if(!t)return d.rows;const h=[];for(const p of d.rows){const m={};for(let E=0;E<d.columns.length;++E)m[d.columns[E]]=p[E];h.push(m)}return h}bind(e,t){for(let n=0;n<t.length;++n){const o=t[n];this.api.bind(e,n+1,typeof o=="boolean"?o&&1||0:o)}}}const topLevelMutex=new Mutex;topLevelMutex.name="topLevelMutex";function serialize(r,e,t,n){if(e===null)log("Cache clear"),r==null||r.clear();else if(e!==void 0){const a=r==null?void 0:r.get(e);if(a)return log("Cache hit",e),a}log("Enqueueing query ",e);const o=n.runExclusive(t);return e&&(r==null||r.set(e,o),o.finally(()=>r==null?void 0:r.delete(e)).catch(a=>{console.error(a)})),o}function serializeTx(r,e,t){return e.runExclusive(()=>{const n=new Mutex,o=new TX(t.api,t.db,n,t.assertOpen,t.stmtFinalizer);return r(o)})}function cryb64(r,e=0){let t=3735928559^e,n=1103547991^e;for(let o=0,a;o<r.length;o++)a=r.charCodeAt(o),t=Math.imul(t^a,2654435761),n=Math.imul(n^a,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296n*BigInt(n)+BigInt(t)}function firstPick(r){const e=r[0];if(e!=null)return e[Object.keys(e)[0]]}var cn,Cr,zt,Un,Ot,Mn,Li;class DB{constructor(e,t,n){ae(this,"api");ae(this,"db");ae(this,"filename");ae(this,"__mutex",topLevelMutex);ae(this,"stmtFinalizer",new Map);g(this,cn,null);g(this,Cr,null);ae(this,"cache",new Map);g(this,zt,null);g(this,Un,!1);g(this,Ot,void 0);g(this,Mn,()=>{if(i(this,Un))throw new Error("The DB is closed")});g(this,Li,(e,t,n,o)=>{i(this,zt)!=null&&i(this,zt).forEach(a=>{try{a(e,t,n,o)}catch(u){console.error("Failed notifying a DB update listener"),console.error(u)}})});this.api=e,this.db=t,this.filename=n,x(this,Ot,new TX(e,t,topLevelMutex,i(this,Mn),this.stmtFinalizer))}get siteid(){return i(this,cn)}_setSiteid(e){if(i(this,cn))throw new Error("Site id already set");x(this,cn,e)}_setTablesUsedStmt(e){x(this,Cr,e)}get tablesUsedStmt(){if(i(this,Cr)==null)throw new Error("tablesUsedStmt not set");return i(this,Cr)}async automigrateTo(e,t){const n=cryb64(t),o=firstPick(await this.execA("SELECT value FROM crsql_master WHERE key = 'schema_name'")),a=firstPick(await this.execA("SELECT value FROM crsql_master WHERE key = 'schema_version'"));if(o===e&&BigInt(a||0)===n)return"noop";const u=o===void 0||o!==e?"apply":"migrate";return await this.tx(async d=>{if(a==null||o!==e){if(o!==e){const h=await d.execA("SELECT name FROM sqlite_master WHERE type = 'table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'crsql_%'");for(const p of h)await d.exec(`DROP TABLE [${p[0]}]`)}await d.exec(t)}else await d.exec("SELECT crsql_automigrate(?, 'SELECT crsql_finalize();')",[t]);await d.exec("INSERT OR REPLACE INTO crsql_master (key, value) VALUES (?, ?)",["schema_version",n]),await d.exec("INSERT OR REPLACE INTO crsql_master (key, value) VALUES (?, ?)",["schema_name",e])}),await this.exec("VACUUM;"),u}execMany(e){return i(this,Ot).execMany(e)}exec(e,t){return i(this,Ot).exec(e,t)}execO(e,t){return i(this,Ot).execO(e,t)}execA(e,t){return i(this,Ot).execA(e,t)}prepare(e){return i(this,Ot).prepare(e)}tx(e){return i(this,Ot).tx(e)}imperativeTx(){return i(this,Ot).imperativeTx()}async close(){var e;for(const t of this.stmtFinalizer.values())await t.finalize(this);return(e=i(this,Cr))==null||e.finalize(this),this.exec("SELECT crsql_finalize()").then(()=>(x(this,Un,!0),serialize(this.cache,void 0,()=>this.api.close(this.db),this.__mutex)))}createFunction(e,t,n){i(this,Mn).call(this),this.api.create_function(this.db,e,t.length,SQLITE_UTF8,0,(o,a)=>{const u=[];for(let h=0;h<t.length;++h)u.push(this.api.value(a[h]));const d=t(...u);d!==void 0&&this.api.result(o,d)})}onUpdate(e){return i(this,zt)==null&&(this.api.update_hook(this.db,i(this,Li)),x(this,zt,new Set)),i(this,zt).add(e),()=>{var t;return(t=i(this,zt))==null?void 0:t.delete(e)}}}cn=new WeakMap,Cr=new WeakMap,zt=new WeakMap,Un=new WeakMap,Ot=new WeakMap,Mn=new WeakMap,Li=new WeakMap;let api=null;class SQLite3{constructor(e){ae(this,"base");this.base=e}open(e,t="c"){return serialize(null,void 0,()=>this.base.open_v2(e||":memory:",SQLITE_OPEN_CREATE|SQLITE_OPEN_READWRITE|SQLITE_OPEN_URI,e!=null?"idb-batch-atomic":void 0),topLevelMutex).then(n=>{const o=new DB(this.base,n,e||":memory:");return o.prepare(`SELECT tbl_name FROM tables_used(?) AS u
        JOIN sqlite_master ON sqlite_master.name = u.name
        WHERE u.schema = 'main'`).then(a=>{a.raw(!0),o._setTablesUsedStmt(a)}).then(()=>o.execA("select quote(crsql_site_id());")).then(a=>(o._setSiteid(a[0][0].replace(/'|X/g,"")),o))})}}async function initWasm(r){if(api!=null)return api;const e=await Module({locateFile(n){return r?r(n):new URL(""+new URL("../assets/crsqlite.CabMYEmC.wasm",import.meta.url).href,import.meta.url).href}}),t=Factory(e);return t.vfs_register(new IDBBatchAtomicVFS("idb-batch-atomic",{durability:"relaxed"})),api=new SQLite3(t),api}async function load(r,e){return{database:await(await initWasm(()=>e.wasm||wasmUrl)).open(r),browser:!0}}class CRDialect extends SqliteDialect{constructor(t){super(t);ae(this,"database");this.database=async()=>typeof t.database=="function"?t.database():t.database}createDriver(){const t=this.database,n=mutex();let o,a;return{async init(){o=await t(),a={async executeQuery(u){return{rows:await o.execO(u.sql,u.parameters)}},async*streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}}},async acquireConnection(){return await n.lock(),a},async beginTransaction(u){await u.executeQuery(CompiledQuery.raw("begin"))},async commitTransaction(u){await u.executeQuery(CompiledQuery.raw("commit"))},async rollbackTransaction(u){await u.executeQuery(CompiledQuery.raw("rollback"))},async releaseConnection(){n.unlock()},async destroy(){o==null||o.close()}}}}function mutex(){let r,e;return{async lock(){for(;r;)await r;r=new Promise(t=>e=t)},unlock(){const t=e;r=void 0,e=void 0,t==null||t()}}}function json(r,e){const t=Object.entries(e).flatMap(([n,o])=>[sql.lit(n),typeof o=="string"?r.ref(o):o]);return sql`json_object(${sql.join(t)})`.withPlugin({transformQuery({node:n}){return{...n,json:!0}}}).$castTo()}function group(r,e){const t=typeof e=="string"?r.ref(e).toOperationNode():e.toOperationNode();return new AggregateFunctionBuilder({aggregateFunctionNode:{...AggregateFunctionNode.create("json_group_array",[t]),json:!0}})}function groupJSON(r,e){return group(r,json(r,e))}var $n;class JSONPlugin{constructor(){g(this,$n,new WeakMap)}transformQuery({node:e,queryId:t}){return e.kind!=="SelectQueryNode"||i(this,$n).set(t,new Set(this.getColumns(e))),e}async transformResult({result:e,queryId:t}){if(!Array.isArray(e.rows))return e;const n=i(this,$n).get(t);return n&&e.rows.forEach(o=>this.parseObject(o,n)),e}getColumns(e){var n,o;const t=[];for(const a in e)e[a]&&typeof e[a]=="object"&&(e[a].json===!0&&typeof((n=e.alias)==null?void 0:n.name)=="string"&&t.push((o=e.alias)==null?void 0:o.name),t.push(...this.getColumns(e[a])));return t}parseObject(e,t){for(const n in e)t.has(n)&&(e[n]=JSON.parse(String(e[n]))),typeof e[n]=="object"&&this.parseObject(e[n],t)}}$n=new WeakMap;function covert(r){const t={any:"blob",string:"text",number:"real",unknown:"blob",instance:"blob",bigint:"integer",integer:"integer",boolean:"boolean"}[r];if(t)return t;throw new Error(`Type "${r}" is not allowed in the database schema!`)}async function apply(r,{schema:e}){var t;for(const n in e){const o=e[n];let a=r.schema.createTable(n).ifNotExists();for(const u in o.schema){const{type:d}=o.schema[u];a=a.addColumn(u,(t=o.ordered)!=null&&t.find(([h])=>h===u)?"blob":covert(d),h=>{var p;return(p=o.primary)!=null&&p.includes(u)?h.notNull():h})}o.primary&&(a=a.addPrimaryKeyConstraint("primary_key",o.primary)),await a.execute();for(const u of o.indices||[])await r.schema.createIndex(`${n}_${u.join("_")}`).ifNotExists().on(n).columns(u).execute();o.crr&&await sql`SELECT crsql_as_crr(${n})`.execute(r);for(const u of o.ordered||[])await sql`SELECT crsql_fract_as_ordered(${n},${sql.join(u)})`.execute(r);await r.schema.createTable("__crstore_sync").ifNotExists().addColumn("version","integer").execute(),await sql`INSERT INTO __crstore_sync (version) SELECT 0
      WHERE NOT EXISTS (SELECT * FROM __crstore_sync)
    `.execute(r)}}function primary(r,...e){return r.primary=e,r}function crr(r){return r.crr=!0,r}function ordered(r,e,...t){return r.ordered||(r.ordered=[]),r.ordered.push([e,...t]),r}function index(r,...e){return r.indices||(r.indices=[]),r.indices.push(e),r}const connections$1=new Map,defaultPaths={};async function init(r,e,t=defaultPaths){if(connections$1.has(r))return connections$1.get(r);const{database:n,browser:o}=await load(r,t),a=o?CRDialect:SqliteDialect,u=new Kysely({dialect:new a({database:n}),plugins:[new JSONPlugin]}),d=u.destroy.bind(u);await u.transaction().execute(p=>apply(p,e));const h=Object.assign(u,{resolveChanges,applyOperation,insertChanges,updateVersion,selectVersion,selectClient,changesSince,async destroy(){return connections$1.delete(r),await finalize.bind(u)().execute(),d()}});return connections$1.set(r,h),h}const empty=[],ready=r=>r!==empty;function reactive(r,e=[]){const t=new Set,n={stop:void 0,start:void 0};let o,a=empty;function u(m){a=m,o&&t.forEach(E=>E(a))}function d(m){var E;return t.add(m),t.size===1&&(o=r(...e),n.stop=(E=n.start)==null?void 0:E.call(n,p)),m(a),()=>{var k;t.delete(m),t.size===0&&o&&(Promise.resolve(o).then(L=>L()),o=void 0,(k=n.stop)==null||k.call(n),n.stop=void 0)}}function h(m){var E;if(Array.isArray(m))return p(m);(E=n.stop)==null||E.call(n),n.start=m,o&&(n.stop=n.start(p))}function p(m){JSON.stringify(m)!==JSON.stringify(e)&&(e=m.slice(),o&&(Promise.resolve(o).then(E=>E()),o=r(...e)))}return{set:u,subscribe:d,bind:h}}const raf=globalThis.requestAnimationFrame||globalThis.setTimeout,error=Symbol("error");function queue(r,e){const t=new Map;let n;async function o(){return n||(n=new Promise(a=>raf(async()=>{const u=await r,d=new Map;await u.transaction().execute(async h=>{const p=e&&(await selectVersion.bind(h)().execute()).current;for(const[m,E]of t.entries()){const k=await E(h).catch(L=>({[error]:L}));d.set(m,k)}e==null||e(await changesSince.bind(h)(p).execute())}).catch(h=>{if(!String(h).includes("driver has already been destroyed"))throw h}),t.clear(),n=void 0,a(d)})))}return{enqueue(a,u,...d){return t.set(a,h=>u(h,...d)),o().then(h=>h.get(a)).then(h=>{if(h&&typeof h=="object"&&error in h)throw h[error];return h})}}}function database$1(r,{ssr:e=!1,name:t="crstore.db",paths:n=defaultPaths,error:o=void 0,push:a=void 0,pull:u=void 0,online:d=()=>{var h;return!!((h=globalThis.navigator)!=null&&h.onLine)}}={}){var fe;const p=!e&&!1?new Promise(()=>{}):init(t,r,n),m="BroadcastChannel"in globalThis?new globalThis.BroadcastChannel(`${t}-sync`):null,E=$=>I($.data,$.data[0]),k=queue(p,I),L=queue(p);m==null||m.addEventListener("message",E),(fe=globalThis.addEventListener)==null||fe.call(globalThis,"online",C);const S=new Map;let N=()=>{};C();async function w($,H){return L.enqueue(H,P=>P.getExecutor().executeQuery($,H)).then(P=>P.rows)}function b($,H,P){const ee=async(le,K)=>{try{if(P&&P.client===K)return;await H(le,K)}catch(ye){o==null||o(ye)}};return $.forEach(le=>{var K;S.has(le)||S.set(le,new Set),(K=S.get(le))==null||K.add(ee)}),P?p.then(async le=>{const K=await le.changesSince(P.version,{filter:P.client,chunk:!0}).execute();K.length&&K.forEach(ye=>ee(ye))}):ee(""),()=>$.forEach(le=>{var K;return(K=S.get(le))==null?void 0:K.delete(ee)})}async function _(){if(!a||!d())return;const $=await p,{current:H,synced:P}=await $.selectVersion().execute();if(H<=P)return;const ee=await $.changesSince(P,{filter:null,chunk:!0}).execute();await Promise.all(ee.map(a)),await $.updateVersion(H).execute()}async function C(){var ee,le;if((ee=globalThis.removeEventListener)==null||ee.call(globalThis,"offline",N),N(),!u||!d())return;const $=await p,{synced:H}=await $.selectVersion().execute(),P=await $.selectClient().execute();await _(),N=u({version:H,client:P},{async onData(K){K.length&&(await $.insertChanges(K).execute(),await I(K,K[0]))}}).unsubscribe,(le=globalThis.addEventListener)==null||le.call(globalThis,"offline",N)}async function A($,...H){return k.enqueue({},$,...H)}async function j($){if(!$.length)return;const H=await p;await I(await H.resolveChanges($).execute(),$[0])}async function I($,H){var K;if(!$.length)return;const P=new Set,ee=affectedTables($);(K=S.get("*"))==null||K.forEach(ye=>P.add(ye)),ee.forEach(ye=>{var Ce;return(Ce=S.get(ye))==null?void 0:Ce.forEach(U=>P.add(U))});const le=[...P].map(ye=>ye($,H));H||(m==null||m.postMessage($),await _()),await Promise.all(le)}async function F(){var $,H;N(),m==null||m.close(),S.clear(),($=globalThis.removeEventListener)==null||$.call(globalThis,"online",C),(H=globalThis.removeEventListener)==null||H.call(globalThis,"offline",N),m==null||m.removeEventListener("message",E),await p.then(P=>P.destroy())}return{close:F,merge:j,update:A,subscribe:b,connection:p,replica:store.bind({connection:p,subscribe:b,update:A,refresh:w})}}function store(r,e={},t=[]){const{connection:n,update:o,refresh:a}=this;let u=null,d=null;const{subscribe:h,set:p,bind:m}=reactive(async(...L)=>{const S=await n,N=r(S,...L).toOperationNode(),w=affectedTables(N),b=S.getExecutor();return d={queryId:Math.random().toString(36).slice(2)},u=b.compileQuery(b.transformQuery(N,d),d),this.subscribe(w,E)},t);async function E(){await n,!(!u||!d)&&p(await a(u,d))}const k={};for(const L in e)k[L]=(...S)=>o(e[L],...S);return{...k,subscribe:h,bind:m,update(L,...S){return L?o(L,...S):E()},then(L,S){let N=[];const w=h(b=>N=b);return E().then(()=>(w(),L==null?void 0:L(N)),S)}}}const APPEND=1,source=r=>r.selectFrom(e=>e.selectFrom("sources").select(["owner","source"]).orderBy("sources.primary","desc").as("ordered")).select(["owner",e=>group(e,"source").as("sources")]).groupBy("owner").$castTo(),asset=r=>r.selectFrom(e=>e.selectFrom("assets").select(["owner","art","thumbnail"]).orderBy("assets.primary","desc").as("ordered")).select(["owner",e=>group(e,"art").as("arts"),e=>group(e,"thumbnail").as("thumbnails")]).groupBy("owner").$castTo(),artist$1=r=>r.selectFrom("artists").leftJoin("source","source.owner","artists.id").leftJoin("asset","asset.owner","artists.id").select(["artists.id","artists.title","artists.following",e=>e.fn.coalesce("asset.arts",e.val("[]")).as("arts"),e=>e.fn.coalesce("asset.thumbnails",e.val("[]")).as("thumbnails"),e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources")]).$castTo(),album$1=r=>r.selectFrom("albums").leftJoin("source","source.owner","albums.id").leftJoin("asset","asset.owner","albums.id").leftJoin("attribution","attribution.album","albums.id").innerJoin("artist","artist.id","attribution.artist").select(["albums.id","albums.title","albums.year",e=>e.fn.coalesce("asset.arts",e.val("[]")).as("arts"),e=>e.fn.coalesce("asset.thumbnails",e.val("[]")).as("thumbnails"),e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources"),e=>groupJSON(e,{id:"artist.id",title:"artist.title",arts:"artist.arts",thumbnails:"artist.thumbnails",sources:"artist.sources"}).filterWhere("artist.id","is not",null).as("artists")]).groupBy("albums.id").$castTo(),track$2=r=>r.selectFrom("tracks").leftJoin("source","source.owner","tracks.id").innerJoin("album","album.id","tracks.album").select(["tracks.id","tracks.title","tracks.duration","album.artists",e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources"),e=>json(e,{id:"album.id",title:"album.title",year:"album.year",arts:"album.arts",thumbnails:"album.thumbnails",sources:"album.sources"}).as("album")]).$castTo(),localDevice=sql`crsql_site_id()`,uuid=()=>Math.random()*2**32>>>0,sanitize=r=>r.replace(/-/g," ").split(/\s+/g).map(e=>`"${e.replace(/"/g,'""')}"`).join(" "),position={first:null,before:r=>r.selectFrom("queue").select("id").where("position","=",1).limit(1),shift:r=>e=>e.selectFrom("queue").select("id").whereRef(t=>t.selectFrom("queue").select(sql`position + 1`.as("position")).where("id","=",r),"=","position").limit(1),next:r=>r.selectFrom("devices").select("playback").where("id","=",localDevice).limit(1),last:r=>r.selectFrom("playback").select("id").where("device","=",localDevice).orderBy("order","desc").orderBy("id","desc").limit(1),random:r=>e=>e.selectFrom(t=>t.selectFrom("queue").select(["id","position"]).$if(!!r.length,n=>n.unionAll(sql`VALUES ${sql.raw(r.map(o=>`(${o}, 1)`).join(","))}`)).unionAll(sql`SELECT null,1 WHERE NOT EXISTS (SELECT 1 FROM queue WHERE position >= 0)`).as("data")).select("id").where("position",">=",0).orderBy(sql`random()`).limit(1)};async function pushTracks(r,e){e.length&&(await pushAlbums(r,e.map(t=>({...t.album,artists:t.artists}))),await r.insertInto("tracks").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,duration:t.duration,album:t.album.id}))).execute(),await pushResources(r,e))}async function pushAlbums(r,e){e.length&&(await pushArtists(r,e.flatMap(t=>t.artists)),e.find(t=>t.artists.length)&&await r.insertInto("attribution").onConflict(t=>t.doNothing()).values(e.flatMap(t=>t.artists.map(({id:n})=>({album:t.id,artist:n})))).execute(),await r.insertInto("albums").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,year:t.year}))).execute(),await pushResources(r,e))}async function pushArtists(r,e){e.length&&(await r.insertInto("artists").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,following:0}))).execute(),await pushResources(r,e))}async function pushResources(r,e){e.length&&(e.find(t=>t.sources.length)&&await r.insertInto("sources").onConflict(t=>t.doNothing()).values(e.flatMap(({id:t,sources:n})=>n.map((o,a)=>({owner:t,source:o,primary:+!a&&sql`NOT EXISTS (SELECT 1 FROM sources WHERE owner = ${t} AND "primary" = 1)`})))).execute(),e.find(t=>{var n;return(n=t.arts)==null?void 0:n.length})&&await r.insertInto("assets").onConflict(t=>t.doNothing()).values(e.flatMap(({id:t,arts:n,thumbnails:o})=>{if(!n)return[];const a=n.find((u,d)=>!!(o!=null&&o[d]))||n[0];return n.map((u,d)=>({owner:t,art:u,thumbnail:o==null?void 0:o[d],primary:+(u===a)&&sql`NOT EXISTS (SELECT 1 FROM assets WHERE owner = ${t} AND "primary" = 1)`}))})).execute())}const preceding$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).with("update",t=>t.selectFrom("playback").select(n=>n.selectFrom("devices").select("id").as("_"))).selectFrom("queue").innerJoin("track","track.id","queue.track").where("position","<",0).select("queue.id as entry").select(fields).$castTo()),upcoming$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).with("update",t=>t.selectFrom("playback").select(n=>n.selectFrom("devices").select("id").as("_"))).selectFrom("queue").innerJoin("track","track.id","queue.track").where("position",">",0).select("queue.id as entry").select(fields).$castTo()),playback$2=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("devices").innerJoin("playback","playback.id","devices.playback").innerJoin("track","track.id","playback.track").select(["direction","repeat","infinite","device","progress"]).select(t=>json(t,{entry:"playback.id",id:"track.id",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).as("track")).select(sql`device = crsql_site_id()`.as("local")).select(fields).$castTo(),{async push(e,t,n="next"){if(!t.length)return;await pushTracks(e,t);const{direction:o,playback:a}=await e.selectFrom("devices").where("id","=",localDevice).select(["direction","playback"]).executeTakeFirstOrThrow(),u=t.map(uuid),d=o!=1?Number.isInteger(n)?n:n==="first"?position.first:n==="next"?position.next:position.last:Number.isInteger(n)?position.shift(+n):n==="first"?position.last:n==="next"?position.before:position.first;await e.insertInto("playback_fractindex").values(t.map((h,p)=>({id:u[p],track:h.id,device:localDevice,after_id:n==="random"?position.random(u.slice(0,p)):p>0&&o!=1?u[p-1]:d}))).execute(),!~a&&n==="random"&&await e.updateTable("devices").set({playback:h=>h.selectFrom("queue").select("id").$castTo().limit(1)}).execute()},async purge(e,t){t.length&&await e.deleteFrom("playback").where("id","in",t).execute()},async clear(e,t=localDevice){await e.deleteFrom("playback").where("device","=",t).execute(),await e.updateTable("devices").set({playback:-1,progress:0}).where("id","=",t).execute()},async sync(e,t){await e.updateTable("devices").where("id","=",localDevice).set({progress:t}).execute()},async rearrange(e,t,n=null){const{direction:o}=await e.selectFrom("devices").where("id","=",localDevice).select(["direction"]).executeTakeFirstOrThrow(),a=o!=1?n:n!=null?position.shift(n):position.last;await e.updateTable("playback_fractindex").set({after_id:a}).where("id","=",t).execute()},async redirect(e,t){const n=["forward","backward","shuffled"],{direction:o}=await e.selectFrom("devices").select("direction").where("id","=",localDevice).executeTakeFirstOrThrow(),a=n.indexOf(t);o!==a&&await e.updateTable("devices").set({direction:a}).where("id","=",localDevice).execute()},async repeat(e,t){const n=["none","single","all"];await e.updateTable("devices").set({repeat:n.indexOf(t)}).where("id","=",localDevice).execute()},async infinite(e,t){await e.updateTable("devices").set({infinite:t==null?sql`!infinite`:+t}).where("id","=",localDevice).execute()},async replicate(e,t){const n=uuid();await e.updateTable("devices").where("id","=",localDevice).set({playback:n,progress:o=>o.selectFrom("devices").where("id","=",t).select("progress")}).execute(),await e.deleteFrom("playback").where("device","=",localDevice).execute(),await e.insertInto("playback").expression(o=>o.selectFrom("playback").select(a=>a.case().when(u=>u.selectFrom("devices").whereRef("id","=","playback.device").select("devices.playback"),"=",a.ref("playback.id")).then(n).else(sql`ABS(RANDOM() % 4294967296)`).end().as("id")).select(sql`${localDevice}`.as("device")).select(["track","order","temp"]).where("device","=",t)).execute()}}),fields=["track.id","track.title","track.duration","track.album","track.artists","track.sources"];class StructError extends TypeError{constructor(e,t){let n;const{message:o,explanation:a,...u}=e,{path:d}=e,h=d.length===0?o:`At path: ${d.join(".")} -- ${o}`;super(a??h),a!=null&&(this.cause=h),Object.assign(this,u),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}function isIterable(r){return isObject$2(r)&&typeof r[Symbol.iterator]=="function"}function isObject$2(r){return typeof r=="object"&&r!=null}function print(r){return typeof r=="symbol"?r.toString():typeof r=="string"?JSON.stringify(r):`${r}`}function shiftIterator(r){const{done:e,value:t}=r.next();return e?void 0:t}function toFailure(r,e,t,n){if(r===!0)return;r===!1?r={}:typeof r=="string"&&(r={message:r});const{path:o,branch:a}=e,{type:u}=t,{refinement:d,message:h=`Expected a value of type \`${u}\`${d?` with refinement \`${d}\``:""}, but received: \`${print(n)}\``}=r;return{value:n,type:u,refinement:d,key:o[o.length-1],path:o,branch:a,...r,message:h}}function*toFailures(r,e,t,n){isIterable(r)||(r=[r]);for(const o of r){const a=toFailure(o,e,t,n);a&&(yield a)}}function*run(r,e,t={}){const{path:n=[],branch:o=[r],coerce:a=!1,mask:u=!1}=t,d={path:n,branch:o};if(a&&(r=e.coercer(r,d),u&&e.type!=="type"&&isObject$2(e.schema)&&isObject$2(r)&&!Array.isArray(r)))for(const p in r)e.schema[p]===void 0&&delete r[p];let h="valid";for(const p of e.validator(r,d))p.explanation=t.message,h="not_valid",yield[p,void 0];for(let[p,m,E]of e.entries(r,d)){const k=run(m,E,{path:p===void 0?n:[...n,p],branch:p===void 0?o:[...o,m],coerce:a,mask:u,message:t.message});for(const L of k)L[0]?(h=L[0].refinement!=null?"not_refined":"not_valid",yield[L[0],void 0]):a&&(m=L[1],p===void 0?r=m:r instanceof Map?r.set(p,m):r instanceof Set?r.add(m):isObject$2(r)&&(m!==void 0||p in r)&&(r[p]=m))}if(h!=="not_valid")for(const p of e.refiner(r,d))p.explanation=t.message,h="not_refined",yield[p,void 0];h==="valid"&&(yield[void 0,r])}class Struct{constructor(e){const{type:t,schema:n,validator:o,refiner:a,coercer:u=h=>h,entries:d=function*(){}}=e;this.type=t,this.schema=n,this.entries=d,this.coercer=u,o?this.validator=(h,p)=>{const m=o(h,p);return toFailures(m,p,this,h)}:this.validator=()=>[],a?this.refiner=(h,p)=>{const m=a(h,p);return toFailures(m,p,this,h)}:this.refiner=()=>[]}assert(e,t){return assert(e,this,t)}create(e,t){return create(e,this,t)}is(e){return is(e,this)}mask(e,t){return mask(e,this,t)}validate(e,t={}){return validate(e,this,t)}}function assert(r,e,t){const n=validate(r,e,{message:t});if(n[0])throw n[0]}function create(r,e,t){const n=validate(r,e,{coerce:!0,message:t});if(n[0])throw n[0];return n[1]}function mask(r,e,t){const n=validate(r,e,{coerce:!0,mask:!0,message:t});if(n[0])throw n[0];return n[1]}function is(r,e){return!validate(r,e)[0]}function validate(r,e,t={}){const n=run(r,e,t),o=shiftIterator(n);return o[0]?[new StructError(o[0],function*(){for(const u of n)u[0]&&(yield u[0])}),void 0]:[void 0,o[1]]}function assign(...r){const e=r[0].type==="type",t=r.map(o=>o.schema),n=Object.assign({},...t);return e?type(n):object(n)}function define(r,e){return new Struct({type:r,schema:null,validator:e})}function omit(r,e){const{schema:t}=r,n={...t};for(const o of e)delete n[o];switch(r.type){case"type":return type(n);default:return object(n)}}function any(){return define("any",()=>!0)}function array(r){return new Struct({type:"array",schema:r,*entries(e){if(r&&Array.isArray(e))for(const[t,n]of e.entries())yield[t,n,r]},coercer(e){return Array.isArray(e)?e.slice():e},validator(e){return Array.isArray(e)||`Expected an array value, but received: ${print(e)}`}})}function instance$1(r){return define("instance",e=>e instanceof r||`Expected a \`${r.name}\` instance, but received: ${print(e)}`)}function integer(){return define("integer",r=>typeof r=="number"&&!isNaN(r)&&Number.isInteger(r)||`Expected an integer, but received: ${print(r)}`)}function literal(r){const e=print(r),t=typeof r;return new Struct({type:"literal",schema:t==="string"||t==="number"||t==="boolean"?r:null,validator(n){return n===r||`Expected the literal \`${e}\`, but received: ${print(n)}`}})}function never(){return define("never",()=>!1)}function nullable(r){return new Struct({...r,validator:(e,t)=>e===null||r.validator(e,t),refiner:(e,t)=>e===null||r.refiner(e,t)})}function number(){return define("number",r=>typeof r=="number"&&!isNaN(r)||`Expected a number, but received: ${print(r)}`)}function object(r){const e=r?Object.keys(r):[],t=never();return new Struct({type:"object",schema:r||null,*entries(n){if(r&&isObject$2(n)){const o=new Set(Object.keys(n));for(const a of e)o.delete(a),yield[a,n[a],r[a]];for(const a of o)yield[a,n[a],t]}},validator(n){return isObject$2(n)||`Expected an object, but received: ${print(n)}`},coercer(n){return isObject$2(n)?{...n}:n}})}function optional(r){return new Struct({...r,validator:(e,t)=>e===void 0||r.validator(e,t),refiner:(e,t)=>e===void 0||r.refiner(e,t)})}function string(){return define("string",r=>typeof r=="string"||`Expected a string, but received: ${print(r)}`)}function type(r){const e=Object.keys(r);return new Struct({type:"type",schema:r,*entries(t){if(isObject$2(t))for(const n of e)yield[n,t[n],r[n]]},validator(t){return isObject$2(t)||`Expected an object, but received: ${print(t)}`},coercer(t){return isObject$2(t)?{...t}:t}})}function union(r){const e=r.map(t=>t.type).join(" | ");return new Struct({type:"union",schema:null,coercer(t){for(const n of r){const[o,a]=n.validate(t,{coerce:!0});if(!o)return a}return t},validator(t,n){const o=[];for(const a of r){const[...u]=run(t,a,n),[d]=u;if(d[0])for(const[h]of u)h&&o.push(h);else return[]}return[`Expected the value to satisfy a union of \`${e}\`, but received: ${print(t)}`,...o]}})}const track$1=object({title:string(),duration:number()}),album=object({title:string(),year:integer()}),artist=object({title:string()}),playlist=object({title:string(),relevancy:number(),shared:nullable(string()),remote:nullable(string())});type({title:optional(string()),album:optional(type({title:optional(string())})),artists:optional(array(type({title:optional(string())})))});const media=object({sources:array(string()),arts:optional(array(string())),thumbnails:optional(array(nullable(string())))}),collection=r=>object({size:integer(),duration:number(),tracks:array(r)}),unique=r=>assign(r,object({id:integer()})),artistInfo=assign(artist,media),albumInfo=assign(album,assign(media,object({artists:array(artistInfo)}))),trackInfo=assign(track$1,assign(omit(media,["arts","thumbnails"]),object({album:omit(albumInfo,["artists"]),artists:array(artistInfo)}))),playlistInfo=playlist,track=assign(unique(trackInfo),object({entry:optional(number()),album:unique(trackInfo.schema.album),artists:array(unique(trackInfo.schema.artists.schema))}));assign(unique(albumInfo),object({artists:array(unique(albumInfo.schema.artists.schema)),collection:optional(collection(track))}));assign(unique(artistInfo),object({following:optional(union([literal(0),literal(1)])),collection:optional(collection(track))}));assign(unique(playlistInfo),object({collection:optional(collection(track))}));function has(r,e){return r!==null&&typeof r=="object"&&e in r&&r[e]!==void 0}function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var murmurhash={exports:{}};(function(r){(function(){const e=a=>new TextEncoder().encode(a);function t(a,u){typeof a=="string"&&(a=e(a));let d=a.length,h=u^d,p=0,m;for(;d>=4;)m=a[p]&255|(a[++p]&255)<<8|(a[++p]&255)<<16|(a[++p]&255)<<24,m=(m&65535)*1540483477+(((m>>>16)*1540483477&65535)<<16),m^=m>>>24,m=(m&65535)*1540483477+(((m>>>16)*1540483477&65535)<<16),h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16)^m,d-=4,++p;switch(d){case 3:h^=(a[p+2]&255)<<16;case 2:h^=(a[p+1]&255)<<8;case 1:h^=a[p]&255,h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16)}return h^=h>>>13,h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16),h^=h>>>15,h>>>0}function n(a,u){typeof a=="string"&&(a=e(a));let d,h,p,m,E,k,L,S;for(d=a.length&3,h=a.length-d,p=u,E=3432918353,k=461845907,S=0;S<h;)L=a[S]&255|(a[++S]&255)<<8|(a[++S]&255)<<16|(a[++S]&255)<<24,++S,L=(L&65535)*E+(((L>>>16)*E&65535)<<16)&4294967295,L=L<<15|L>>>17,L=(L&65535)*k+(((L>>>16)*k&65535)<<16)&4294967295,p^=L,p=p<<13|p>>>19,m=(p&65535)*5+(((p>>>16)*5&65535)<<16)&4294967295,p=(m&65535)+27492+(((m>>>16)+58964&65535)<<16);switch(L=0,d){case 3:L^=(a[S+2]&255)<<16;case 2:L^=(a[S+1]&255)<<8;case 1:L^=a[S]&255,L=(L&65535)*E+(((L>>>16)*E&65535)<<16)&4294967295,L=L<<15|L>>>17,L=(L&65535)*k+(((L>>>16)*k&65535)<<16)&4294967295,p^=L}return p^=a.length,p^=p>>>16,p=(p&65535)*2246822507+(((p>>>16)*2246822507&65535)<<16)&4294967295,p^=p>>>13,p=(p&65535)*3266489909+(((p>>>16)*3266489909&65535)<<16)&4294967295,p^=p>>>16,p>>>0}const o=n;o.v2=t,o.v3=n,r.exports=o})()})(murmurhash);var murmurhashExports=murmurhash.exports;const hash=getDefaultExportFromCjs(murmurhashExports);function titled(r){return has(r,"title")?r.title:r}function compare$1(r,e){return typeof r=="string"&&typeof e=="string"?r.localeCompare(e):typeof r=="number"&&typeof e=="number"?r-e:has(r,"title")&&has(e,"title")?compare$1(clean(titled(r)),clean(titled(e))):0}function normalize(r){if(typeof r=="string")return clean(r);if(typeof r!="object")return r;const e={...r};for(const t in e)Array.isArray(e[t])?e[t]=e[t].map(normalize).sort(compare$1):e[t]=normalize(e[t]);return e}function stringify(r){return r=normalize(r),typeof r=="string"?r:typeof r!="object"?clean(String(r)):has(r,"artists")&&has(r,"title")&&has(r,"album")?`${r.artists.map(titled)} - ${r.title} - ${titled(r.album)}`:has(r,"artists")&&has(r,"title")?`${r.artists.map(titled)} - ${r.title}`:has(r,"title")?r.title:Array.isArray(r)?r.map(titled).toString():JSON.stringify(r)}function identify(r){return has(r,"id")?+r.id:hash(stringify(r))}const playlists$2=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",t=>track$2(t).innerJoin("library","library.track","tracks.id").select(["library.playlist","library.id as entry"]).orderBy("library.order").orderBy("library.id")).selectFrom("track").fullJoin("playlists","playlists.id","track.playlist").where("playlists.id",">=",0).select(["playlists.id","playlists.title","playlists.relevancy","playlists.shared","playlists.remote",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.entry",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("playlists.id").orderBy("playlists.order").orderBy("playlists.id").$castTo(),{async create(e,t){await e.insertInto("playlists").onConflict(n=>n.doNothing()).values({id:identify(t),order:APPEND,relevancy:1,...t}).execute()},async edit(e,t,n){await e.updateTable("playlists").where("id","=",t).set(n).execute()},async rearrange(e,t,n){await e.updateTable("playlists_fractindex").set({after_id:n||null}).where("id","=",t).execute()},async delete(e,t){await e.deleteFrom("playlists").where("id","=",t).execute()},get(e,t){return e.selectFrom("playlists").selectAll().where("id","=",t).executeTakeFirstOrThrow()}}),resources$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).selectFrom("source").leftJoin("asset","asset.owner","source.owner").select([t=>t.fn.coalesce("asset.arts",t.val("[]")).as("arts"),t=>t.fn.coalesce("asset.thumbnails",t.val("[]")).as("thumbnails"),t=>t.fn.coalesce("source.sources",t.val("[]")).as("sources")]).$castTo(),{async prioritize(e,t,n){const o=t==="art"?"assets":"sources";await e.updateTable(o).set({primary:sql`${sql.ref(t)} = ${n}`}).where("owner","=",a=>a.selectFrom(o).where(t,"=",n).select("owner")).execute()},get(e,t){return e.with("source",source).with("asset",asset).selectFrom("source").leftJoin("asset","asset.owner","source.owner").select([n=>n.fn.coalesce("asset.arts",n.val("[]")).as("arts"),n=>n.fn.coalesce("asset.thumbnails",n.val("[]")).as("thumbnails"),n=>n.fn.coalesce("source.sources",n.val("[]")).as("sources")]).where("source.owner","=",t).$castTo().executeTakeFirstOrThrow()}}),settings$2=({replicated:r})=>r(e=>e.selectFrom("settings").select(["key",sql`json_extract(value, '$')`.as("value")]),{async store(e,t,n,o="settings"){o!=="settings"&&(await e.schema.createTable(o).ifNotExists().addColumn("key","text",a=>a.primaryKey().notNull()).addColumn("value","text").execute(),await e.schema.createIndex(o+"_value").ifNotExists().on(o).column("value").execute()),await e.insertInto(o).onConflict(a=>a.doUpdateSet({value:JSON.stringify(n)})).values({key:t,value:JSON.stringify(n)}).execute()},async extract(e,t,n="settings"){return e.selectFrom(n).select("value").where("key","=",t).executeTakeFirstOrThrow().then(o=>JSON.parse(o.value))},async lookup(e,t,n="settings"){return e.selectFrom(n).select("key").where("value","=",JSON.stringify(t)).executeTakeFirstOrThrow().then(o=>o.key)}}),history$2=({replicated:r})=>r(e=>e.selectFrom("history").orderBy("date","desc").selectAll(),{async log(e,t){t.trim()&&await e.insertInto("history").onConflict(n=>n.doUpdateSet({date:Date.now()})).values({query:t,date:Date.now()}).execute()},async clear(e){await e.deleteFrom("history").execute()},get(e){return e.selectFrom("history").selectAll().orderBy("date","desc").execute()}}),artists$2=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("artist").leftJoin("attribution","attribution.artist","artist.id").leftJoin("albums","albums.id","attribution.album").leftJoin("tracks","tracks.album","albums.id").leftJoin("track","track.id","tracks.id").select(["artist.id","artist.title","artist.following","artist.arts","artist.thumbnails","artist.sources",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.id",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("artist.id").orderBy(t=>t.fn.count("track.duration"),"desc").orderBy("artist.title").$castTo(),{async push(e,t){await pushArtists(e,t)},async edit(e,t,n){await e.updateTable("artists").where("id","=",t).set(n)},async follow(e,t){await e.updateTable("artists").set({following:1}).where("id","=",t).execute()},async unfollow(e,t){await e.updateTable("artists").set({following:0}).where("id","=",t).execute()},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).selectFrom("artists_fts").where("artists_fts","match",sanitize(t)).orderBy("rank").innerJoin("artist","artist.id","artists_fts.rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).selectFrom("artist").where("artist.id","=",t).selectAll().$castTo().executeTakeFirstOrThrow()}}),library$2=({replicated:r})=>r(e=>e.selectFrom("library").selectAll(),{async push(e,t,n){t.length&&(await pushTracks(e,t),n!=null&&await e.insertInto("library").onConflict(o=>o.doNothing()).values(t.map(({id:o})=>({id:uuid(),order:APPEND,date:~~(Date.now()/1e3),track:o,playlist:n}))).execute())},async rearrange(e,t,n){await e.updateTable("library_fractindex").set({after_id:n||null}).where("id","=",t).execute()},async purge(e,t){const n=t.map(o=>e.deleteFrom("library").where("id","=",o).execute());await Promise.all(n)},async get(e,t){return t.length?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources","library.id as entry"]).where("library.id","in",t).$castTo().execute():[]},async sample(e,t){const n=t,o=n*Math.sqrt(2*Math.PI)/2,a=sql`POW(ABS(RANDOM()) / 9223372036854775808,
        ${o} /
        EXP(-0.5 * POW(row_number() OVER (ORDER BY date DESC) / ${n},2)) *
        playlists.relevancy
      )`;return await e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").innerJoin("playlists","playlists.id","library.playlist").innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources"]).where("relevancy",">",0).orderBy(a,"desc").limit(t).execute()},async banned(e){return await e.selectFrom("library").leftJoin("playlists","playlists.id","library.playlist").select("library.track").where("relevancy","<",0).execute().then(t=>t.map(n=>n.track))}});function database(r,e={}){const{replica:t,...n}=database$1(r,e);function o(...a){return function(u,d){const h=a.length?derived(a,k=>k):void 0,p=h&&get_store_value(h),{bind:m,...E}=t(u,d,p);return m(k=>h==null?void 0:h.subscribe(k)),E}}return{replicated:Object.assign(o(),{with:o}),...n}}const id=integer,boolean=integer,tracks$2=assign(unique(track$1),object({album:id()}));crr(tracks$2);index(tracks$2,"album");primary(tracks$2,"id");const albums$2=unique(album);crr(albums$2);primary(albums$2,"id");const artists$1=assign(unique(artist),object({following:boolean()}));crr(artists$1);primary(artists$1,"id");const attribution=object({album:id(),artist:id()});crr(attribution);index(attribution,"artist");primary(attribution,"album","artist");const sources=object({source:string(),owner:id(),primary:boolean()});crr(sources);primary(sources,"owner","source");const assets=object({art:string(),thumbnail:nullable(string()),owner:id(),primary:boolean()});crr(assets);primary(assets,"owner","art");const playlists$1=assign(unique(playlist),object({order:string()}));crr(playlists$1);primary(playlists$1,"id");ordered(playlists$1,"order");index(playlists$1,"order","id");const library$1=object({id:id(),playlist:id(),track:id(),date:integer(),order:string()});crr(library$1);primary(library$1,"id");index(library$1,"date");index(library$1,"track");index(library$1,"playlist");index(library$1,"order","id");ordered(library$1,"order","playlist");const playback$1=object({id:id(),device:instance$1(Uint8Array),track:id(),order:string(),temp:any()});crr(playback$1);primary(playback$1,"id");index(playback$1,"device");index(playback$1,"order","id");ordered(playback$1,"order","device");const devices=object({id:instance$1(Uint8Array),playback:id(),direction:integer(),infinite:integer(),progress:number(),repeat:integer()});crr(devices);primary(devices,"id");const settings$1=object({key:string(),value:string()});crr(settings$1);index(settings$1,"value");primary(settings$1,"key");const history$1=object({query:string(),date:integer()});crr(history$1);index(history$1,"date");primary(history$1,"query");const schema=object({tracks:tracks$2,albums:albums$2,attribution,artists:artists$1,sources,assets,library:library$1,playlists:playlists$1,playback:playback$1,devices,settings:settings$1,history:history$1}),tracks$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").where("playlist",">=",0).innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources","library.id as entry","library.date"]).orderBy("library.date","desc").orderBy("library.id").$castTo(),{async edit(e,t,n){const o=await e.updateTable("tracks").where("id","=",t).set({...n,album:void 0}).returning("album").executeTakeFirst();o!=null&&o.album&&n.album&&await e.updateTable("albums").where("id","=",o.album).set(n.album).execute()},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("tracks_fts").where("tracks_fts","match",sanitize(t)).orderBy("rank").innerJoin("track","track.id","rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("track").selectAll().where("id","=",t).$castTo().executeTakeFirstOrThrow()}}),albums$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("album").selectAll().orderBy("album.title"),{async push(e,t){await pushAlbums(e,t)},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("albums_fts").where("albums_fts","match",sanitize(t)).orderBy("rank").innerJoin("album","album.id","albums_fts.rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("album").selectAll().where("album.id","=",t).$castTo().executeTakeFirstOrThrow()}}),feed$1=({replicated:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",t=>track$2(t).innerJoin("library","library.track","tracks.id").select(["library.playlist","library.id as entry"]).orderBy("library.order").orderBy("library.id")).selectFrom("track").fullJoin("playlists","playlists.id","track.playlist").where("playlists.id","<",0).select(["playlists.id","playlists.title","playlists.relevancy","playlists.shared","playlists.remote",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.entry",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("playlists.id").orderBy("playlists.order").orderBy("playlists.id").$castTo(),{async clear(e,t){await e.deleteFrom("library").where("playlist","=",t).execute()},async get(e,t,n=-1){return e.selectFrom("library").where("playlist","=",t).select("id").limit(n).execute().then(o=>o.map(a=>a.id))}}),connections=new Map,stores=r=>({playlists:playlists$2(r),resources:resources$1(r),preceding:preceding$1(r),playback:playback$2(r),upcoming:upcoming$1(r),settings:settings$2(r),history:history$2(r),artists:artists$2(r),library:library$2(r),albums:albums$1(r),tracks:tracks$1(r),feed:feed$1(r)});function connect(r){if(!connections.has(r.name)){const e=database(r.local?nocrr(schema):schema,r);connections.set(r.name,{...e,...stores(e)});const t=Object.assign({"../sql/cascade.sql":__vite_glob_0_0,"../sql/fts.sql":__vite_glob_0_1,"../sql/playback.sql":__vite_glob_0_2,"../sql/playlists.sql":__vite_glob_0_3});r.local&&delete t["../sql/fts.sql"];const n=Object.values(t).flatMap(o=>o.split(/\r?\n\r?\n/)).map(o=>sql.raw(o));e.update(o=>Promise.all(n.map(a=>a.execute(o))))}return connections.get(r.name)}function nocrr(r){return{...r,schema:Object.fromEntries(Object.entries(r.schema).map(([e,t])=>[e,{...t,crr:!1}]))}}function identity(r){return r}function pipeFromArray(r){return r.length===0?identity:r.length===1?r[0]:function(t){return r.reduce((n,o)=>o(n),t)}}function observable(r){const e={subscribe(t){let n=null,o=!1,a=!1,u=!1;function d(){if(n===null){u=!0;return}a||(a=!0,typeof n=="function"?n():n&&n.unsubscribe())}return n=r({next(h){var p;o||(p=t.next)==null||p.call(t,h)},error(h){var p;o||(o=!0,(p=t.error)==null||p.call(t,h),d())},complete(){var h;o||(o=!0,(h=t.complete)==null||h.call(t),d())}}),u&&d(),{unsubscribe:d}},pipe(...t){return pipeFromArray(t)(e)}};return e}function share(r){return e=>{let t=0,n=null;const o=[];function a(){n||(n=e.subscribe({next(d){var h;for(const p of o)(h=p.next)==null||h.call(p,d)},error(d){var h;for(const p of o)(h=p.error)==null||h.call(p,d)},complete(){var d;for(const h of o)(d=h.complete)==null||d.call(h)}}))}function u(){if(t===0&&n){const d=n;n=null,d.unsubscribe()}}return{subscribe(d){return t++,o.push(d),a(),{unsubscribe(){t--,u();const h=o.findIndex(p=>p===d);h>-1&&o.splice(h,1)}}}}}}class ObservableAbortError extends Error{constructor(e){super(e),this.name="ObservableAbortError",Object.setPrototypeOf(this,ObservableAbortError.prototype)}}function observableToPromise(r){let e;return{promise:new Promise((n,o)=>{let a=!1;function u(){a||(a=!0,o(new ObservableAbortError("This operation was aborted.")),d.unsubscribe())}const d=r.subscribe({next(h){a=!0,n(h),u()},error(h){a=!0,o(h),u()},complete(){a=!0,u()}});e=u}),abort:e}}function createChain(r){return observable(e=>{function t(o=0,a=r.op){const u=r.links[o];if(!u)throw new Error("No more links to execute - did you forget to add an ending link?");return u({op:a,next(h){return t(o+1,h)}})}return t().subscribe(e)})}function invert(r){const e=Object.create(null);for(const t in r){const n=r[t];e[n]=t}return e}const TRPC_ERROR_CODES_BY_KEY={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};invert(TRPC_ERROR_CODES_BY_KEY);invert(TRPC_ERROR_CODES_BY_KEY);const noop=()=>{};function createInnerProxy(r,e){return new Proxy(noop,{get(n,o){if(!(typeof o!="string"||o==="then"))return createInnerProxy(r,[...e,o])},apply(n,o,a){const u=e[e.length-1]==="apply";return r({args:u?a.length>=2?a[1]:[]:a,path:u?e.slice(0,-1):e})}})}const createRecursiveProxy=r=>createInnerProxy(r,[]),createFlatProxy=r=>new Proxy(noop,{get(e,t){if(!(typeof t!="string"||t==="then"))return r(t)}});function isObject$1(r){return!!r&&!Array.isArray(r)&&typeof r=="object"}class UnknownCauseError extends Error{}function getCauseFromUnknown(r){if(r instanceof Error)return r;const e=typeof r;if(!(e==="undefined"||e==="function"||r===null)){if(e!=="object")return new Error(String(r));if(isObject$1(r)){const t=new UnknownCauseError;for(const n in r)t[n]=r[n];return t}}}function isObject(r){return!!r&&!Array.isArray(r)&&typeof r=="object"}function transformResultInner(r,e){if("error"in r){const n=e.transformer.deserialize(r.error);return{ok:!1,error:{...r,error:n}}}return{ok:!0,result:{...r.result,...(!r.result.type||r.result.type==="data")&&{type:"data",data:e.transformer.deserialize(r.result.data)}}}}class TransformResultError extends Error{constructor(){super("Unable to transform response from server")}}function transformResult(r,e){let t;try{t=transformResultInner(r,e)}catch{throw new TransformResultError}if(!t.ok&&(!isObject(t.error.error)||typeof t.error.error.code!="number"))throw new TransformResultError;if(t.ok&&!isObject(t.result))throw new TransformResultError;return t}function isTRPCClientError(r){return r instanceof TRPCClientError||r instanceof Error&&r.name==="TRPCClientError"}function isTRPCErrorResponse(r){return isObject(r)&&isObject(r.error)&&typeof r.error.code=="number"&&typeof r.error.message=="string"}class TRPCClientError extends Error{static from(e,t={}){const n=e;return isTRPCClientError(n)?(t.meta&&(n.meta={...n.meta,...t.meta}),n):isTRPCErrorResponse(n)?new TRPCClientError(n.error.message,{...t,result:n}):n instanceof Error?new TRPCClientError(n.message,{...t,cause:getCauseFromUnknown(n)}):new TRPCClientError("Unknown error",{...t,cause:n})}constructor(e,t){var o,a;const n=t==null?void 0:t.cause;super(e,{cause:n}),this.meta=t==null?void 0:t.meta,this.cause=n,this.shape=(o=t==null?void 0:t.result)==null?void 0:o.error,this.data=(a=t==null?void 0:t.result)==null?void 0:a.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,TRPCClientError.prototype)}}/* istanbul ignore next -- @preserve */const retryDelay=r=>r===0?0:Math.min(1e3*2**r,3e4);function createWSClient(r){const{url:e,WebSocket:t=WebSocket,retryDelayMs:n=retryDelay,onOpen:o,onClose:a}=r;/* istanbul ignore next -- @preserve */if(!t)throw new Error("No WebSocket implementation found - you probably don't want to use this on the server, but if you do you need to pass a `WebSocket`-ponyfill");let u=[];const d=Object.create(null);let h=0,p=null,m=null,E=A(),k="connecting";function L(){k!=="open"||p||(p=setTimeout(()=>{p=null,u.length===1?E.send(JSON.stringify(u.pop())):E.send(JSON.stringify(u)),u=[]}))}function S(){if(m!==null||k==="closed")return;const I=n(h++);w(I)}function N(){k="connecting";const I=E;E=A(),b(I)}function w(I){m||(k="connecting",m=setTimeout(N,I))}function b(I){Object.values(d).some(fe=>fe.ws===I)||I.close()}function _(){Object.values(d).forEach(I=>{I.type==="subscription"&&I.callbacks.complete()})}function C(I){u.some(F=>F.id===I.op.id)||j(I.op,I.callbacks)}function A(){const I=typeof e=="function"?e():e,F=new t(I);clearTimeout(m),m=null,F.addEventListener("open",()=>{/* istanbul ignore next -- @preserve */F===E&&(h=0,k="open",o==null||o(),L())}),F.addEventListener("error",()=>{F===E&&S()});const fe=H=>{if(H.method==="reconnect"&&F===E){k==="open"&&(a==null||a()),N();for(const P of Object.values(d))P.type==="subscription"&&C(P)}},$=H=>{var ee,le;const P=H.id!==null&&d[H.id];if(P){if((le=(ee=P.callbacks).next)==null||le.call(ee,H),P.ws!==E&&F===E){const K=P.ws;P.ws=E,b(K)}"result"in H&&H.result.type==="stopped"&&F===E&&P.callbacks.complete()}};return F.addEventListener("message",({data:H})=>{const P=JSON.parse(H);"method"in P?fe(P):$(P),(F!==E||k==="closed")&&b(F)}),F.addEventListener("close",({code:H})=>{var P,ee,le,K;k==="open"&&(a==null||a({code:H})),E===F&&S();for(const[ye,Ce]of Object.entries(d))if(Ce.ws===F){if(k==="closed"){delete d[ye],(ee=(P=Ce.callbacks).complete)==null||ee.call(P);continue}Ce.type==="subscription"?C(Ce):(delete d[ye],(K=(le=Ce.callbacks).error)==null||K.call(le,TRPCClientError.from(new TRPCWebSocketClosedError("WebSocket closed prematurely"))))}}),F}function j(I,F){const{type:fe,input:$,path:H,id:P}=I,ee={id:P,method:fe,params:{input:$,path:H}};return d[P]={ws:E,type:fe,callbacks:F,op:I},u.push(ee),L(),()=>{var K,ye;const le=(K=d[P])==null?void 0:K.callbacks;delete d[P],u=u.filter(Ce=>Ce.id!==P),(ye=le==null?void 0:le.complete)==null||ye.call(le),E.readyState===t.OPEN&&I.type==="subscription"&&(u.push({id:P,method:"subscription.stop"}),L())}}return{close:()=>{k="closed",a==null||a(),_(),b(E),clearTimeout(m),m=null},request:j,getConnection(){return E}}}class TRPCWebSocketClosedError extends Error{constructor(e){super(e),this.name="TRPCWebSocketClosedError",Object.setPrototypeOf(this,TRPCWebSocketClosedError.prototype)}}function wsLink(r){return e=>{const{client:t}=r;return({op:n})=>observable(o=>{const{type:a,path:u,id:d,context:h}=n,p=e.transformer.serialize(n.input),m=t.request({type:a,path:u,input:p,id:d,context:h},{error(E){o.error(E),m()},complete(){o.complete()},next(E){const k=transformResult(E,e);if(!k.ok){o.error(TRPCClientError.from(k.error));return}o.next({result:k.result}),n.type!=="subscription"&&(m(),o.complete())}});return()=>{m()}})}}class TRPCUntypedClient{$request({type:e,input:t,path:n,context:o={}}){return createChain({links:this.links,op:{id:++this.requestId,type:e,path:n,input:t,context:o}}).pipe(share())}requestAsPromise(e){const t=this.$request(e),{promise:n,abort:o}=observableToPromise(t);return new Promise((u,d)=>{var h;(h=e.signal)==null||h.addEventListener("abort",o),n.then(p=>{u(p.result.data)}).catch(p=>{d(TRPCClientError.from(p))})})}query(e,t,n){return this.requestAsPromise({type:"query",path:e,input:t,context:n==null?void 0:n.context,signal:n==null?void 0:n.signal})}mutation(e,t,n){return this.requestAsPromise({type:"mutation",path:e,input:t,context:n==null?void 0:n.context,signal:n==null?void 0:n.signal})}subscription(e,t,n){return this.$request({type:"subscription",path:e,input:t,context:n==null?void 0:n.context}).subscribe({next(a){var u,d,h;a.result.type==="started"?(u=n.onStarted)==null||u.call(n):a.result.type==="stopped"?(d=n.onStopped)==null||d.call(n):(h=n.onData)==null||h.call(n,a.result.data)},error(a){var u;(u=n.onError)==null||u.call(n,a)},complete(){var a;(a=n.onComplete)==null||a.call(n)}})}constructor(e){this.requestId=0;const t=(()=>{const n=e.transformer;return n?"input"in n?e.transformer:{input:n,output:n}:{input:{serialize:o=>o,deserialize:o=>o},output:{serialize:o=>o,deserialize:o=>o}}})();this.runtime={transformer:{serialize:n=>t.input.serialize(n),deserialize:n=>t.output.deserialize(n)},combinedTransformer:t},this.links=e.links.map(n=>n(this.runtime))}}const clientCallTypeMap={query:"query",mutate:"mutation",subscribe:"subscription"},clientCallTypeToProcedureType=r=>clientCallTypeMap[r];function createTRPCClientProxy(r){return createFlatProxy(e=>r.hasOwnProperty(e)?r[e]:e==="__untypedClient"?r:createRecursiveProxy(({path:t,args:n})=>{const o=[e,...t],a=clientCallTypeToProcedureType(o.pop()),u=o.join(".");return r[a](u,...n)}))}function createTRPCProxyClient(r){const e=new TRPCUntypedClient(r);return createTRPCClientProxy(e)}var zo;const{sync,search:search$1,streams,expand,desource,transcribe}=createTRPCProxyClient({links:[(zo=globalThis.localStorage)!=null&&zo.getItem("remote")?wsLink({client:createWSClient({url:()=>localStorage.getItem("remote")})}):()=>()=>observable(()=>{})]}),{playlists,resources,preceding,playback,upcoming,settings,history,artists,library,albums,tracks,update,feed}=connect({name:"library.db",push:sync.push.mutate,pull:sync.pull.subscribe}),search=writable(""),extra=writable(null);function format(r,e=!1){if(!e){r=Math.round(+r),r<=0&&(r=0);const d=~~(r/3600);r-=d*3600;const h=~~(r/60);r-=h*60;const p=r,m=E=>E.toString().padStart(2,"0");return d?`${d}:${m(h)}:${m(p)}`:`${h}:${m(p)}`}const t=new Intl.RelativeTimeFormat("en"),n=Math.floor((Date.now()-+r)/1e3),o=Math.floor(n/60),a=Math.floor(o/60),u=Math.floor(a/24);return n<=1?"just now":n<60?t.format(-n,"seconds"):o<60?t.format(-o,"minutes"):a<24?t.format(-a,"hours"):t.format(-u,"days")}function compare(r){const e=new Date;return+r>+e?"In The Future":r.getFullYear()===e.getFullYear()?r.getMonth()===e.getMonth()?e.getDate()-r.getDate()===0?"Today":e.getDate()-r.getDate()===1?"Yesterday":e.getDate()-r.getDate()<7&&e.getDay()>r.getDay()?"This Week":e.getDate()-r.getDate()<7||e.getDate()-r.getDate()<14&&e.getDay()>=r.getDay()?"Last Week":"This Month":e.getMonth()-r.getMonth()===1?"Last Month":`In ${r.toLocaleString("default",{month:"long"})}`:r.getFullYear().toString()}const get_default_slot_changes=r=>({}),get_default_slot_context=r=>({slot:"after"});function create_default_slot_6(r){let e;return{c(){e=text(r[4])},l(t){e=claim_text(t,r[4])},m(t,n){insert_hydration(t,e,n)},p(t,n){n&16&&set_data(e,t[4])},d(t){t&&detach(e)}}}function create_default_slot_5(r){let e,t,n,o;return n=new Text({props:{secondary:!0,$$slots:{default:[create_default_slot_6]},$$scope:{ctx:r}}}),{c(){e=text(r[5]),t=space(),create_component(n.$$.fragment)},l(a){e=claim_text(a,r[5]),t=claim_space(a),claim_component(n.$$.fragment,a)},m(a,u){insert_hydration(a,e,u),insert_hydration(a,t,u),mount_component(n,a,u),o=!0},p(a,u){(!o||u&32)&&set_data(e,a[5]);const d={};u&1040&&(d.$$scope={dirty:u,ctx:a}),n.$set(d)},i(a){o||(transition_in(n.$$.fragment,a),o=!0)},o(a){transition_out(n.$$.fragment,a),o=!1},d(a){a&&(detach(e),detach(t)),destroy_component(n,a)}}}function create_default_slot_4(r){var n;let e=((n=r[3])==null?void 0:n.artists.map(func).join(", "))+"",t;return{c(){t=text(e)},l(o){t=claim_text(o,e)},m(o,a){insert_hydration(o,t,a)},p(o,a){var u;a&8&&e!==(e=((u=o[3])==null?void 0:u.artists.map(func).join(", "))+"")&&set_data(t,e)},d(o){o&&detach(t)}}}function create_if_block(r){let e,t;return e=new When({props:{lg:!0,$$slots:{default:[create_default_slot_2]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const a={};o&1032&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_default_slot_3(r){var n;let e=((n=r[3])==null?void 0:n.album.title)+"",t;return{c(){t=text(e)},l(o){t=claim_text(o,e)},m(o,a){insert_hydration(o,t,a)},p(o,a){var u;a&8&&e!==(e=((u=o[3])==null?void 0:u.album.title)+"")&&set_data(t,e)},d(o){o&&detach(t)}}}function create_default_slot_2(r){let e,t;return e=new Text({props:{secondary:!0,sm:!0,loading:!r[3],$$slots:{default:[create_default_slot_3]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const a={};o&8&&(a.loading=!n[3]),o&1032&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_default_slot_1(r){let e,t,n,o,a,u,d=`scaleX(${r[1]})`,h;e=new Text({props:{accent:!0,loading:!r[3],$$slots:{default:[create_default_slot_5]},$$scope:{ctx:r}}}),n=new Text({props:{secondary:!0,sm:!0,loading:!r[3],$$slots:{default:[create_default_slot_4]},$$scope:{ctx:r}}});let p=!r[0]&&create_if_block(r);return{c(){create_component(e.$$.fragment),t=space(),create_component(n.$$.fragment),o=space(),p&&p.c(),a=space(),u=element("div"),this.h()},l(m){claim_component(e.$$.fragment,m),t=claim_space(m),claim_component(n.$$.fragment,m),o=claim_space(m),p&&p.l(m),a=claim_space(m),u=claim_element(m,"DIV",{class:!0}),children(u).forEach(detach),this.h()},h(){attr(u,"class","absolute bottom-0 left-0 h-0.5 w-full origin-left transform-gpu bg-highlight-200 transition-transform duration-1000"),set_style(u,"transform",d)},m(m,E){mount_component(e,m,E),insert_hydration(m,t,E),mount_component(n,m,E),insert_hydration(m,o,E),p&&p.m(m,E),insert_hydration(m,a,E),insert_hydration(m,u,E),h=!0},p(m,E){const k={};E&8&&(k.loading=!m[3]),E&1072&&(k.$$scope={dirty:E,ctx:m}),e.$set(k);const L={};E&8&&(L.loading=!m[3]),E&1032&&(L.$$scope={dirty:E,ctx:m}),n.$set(L),m[0]?p&&(group_outros(),transition_out(p,1,1,()=>{p=null}),check_outros()):p?(p.p(m,E),E&1&&transition_in(p,1)):(p=create_if_block(m),p.c(),transition_in(p,1),p.m(a.parentNode,a)),E&2&&d!==(d=`scaleX(${m[1]})`)&&set_style(u,"transform",d)},i(m){h||(transition_in(e.$$.fragment,m),transition_in(n.$$.fragment,m),transition_in(p),h=!0)},o(m){transition_out(e.$$.fragment,m),transition_out(n.$$.fragment,m),transition_out(p),h=!1},d(m){m&&(detach(t),detach(o),detach(a),detach(u)),destroy_component(e,m),destroy_component(n,m),p&&p.d(m)}}}function create_default_slot(r){var a;let e,t,n=`hue-rotate(${((a=r[3])==null?void 0:a.id)||0}deg)`,o;return t=new Icon({props:{name:"note"}}),{c(){e=element("div"),create_component(t.$$.fragment),this.h()},l(u){e=claim_element(u,"DIV",{class:!0});var d=children(e);claim_component(t.$$.fragment,d),d.forEach(detach),this.h()},h(){attr(e,"class","flex h-full w-full items-center justify-center bg-gradient-to-r from-rose-400 to-red-400 text-white"),set_style(e,"filter",n)},m(u,d){insert_hydration(u,e,d),mount_component(t,e,null),o=!0},p(u,d){var h;d&8&&n!==(n=`hue-rotate(${((h=u[3])==null?void 0:h.id)||0}deg)`)&&set_style(e,"filter",n)},i(u){o||(transition_in(t.$$.fragment,u),o=!0)},o(u){transition_out(t.$$.fragment,u),o=!1},d(u){u&&detach(e),destroy_component(t)}}}function create_before_slot(r){var n,o;let e,t;return e=new Image({props:{src:r[3]?((n=r[3].album.arts)==null?void 0:n[0])||"":void 0,thumbnail:r[3]?((o=r[3].album.thumbnails)==null?void 0:o[0])||"":void 0,slot:"before",$$slots:{default:[create_default_slot]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(a){claim_component(e.$$.fragment,a)},m(a,u){mount_component(e,a,u),t=!0},p(a,u){var h,p;const d={};u&8&&(d.src=a[3]?((h=a[3].album.arts)==null?void 0:h[0])||"":void 0),u&8&&(d.thumbnail=a[3]?((p=a[3].album.thumbnails)==null?void 0:p[0])||"":void 0),u&1032&&(d.$$scope={dirty:u,ctx:a}),e.$set(d)},i(a){t||(transition_in(e.$$.fragment,a),t=!0)},o(a){transition_out(e.$$.fragment,a),t=!1},d(a){destroy_component(e,a)}}}function create_after_slot(r){let e;const t=r[7].default,n=create_slot(t,r,r[10],get_default_slot_context);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,a){n&&n.p&&(!e||a&1024)&&update_slot_base(n,t,o,o[10],e?get_slot_changes(t,o[10],a,get_default_slot_changes):get_all_dirty_from_scope(o[10]),get_default_slot_context)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_fragment(r){let e,t;return e=new Card({props:{sm:!0,flat:!0,flow:!r[0],interactive:!0,selected:r[2],$$slots:{after:[create_after_slot],before:[create_before_slot],default:[create_default_slot_1]},$$scope:{ctx:r}}}),e.$on("contextmenu",r[8]),e.$on("click",r[9]),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,[o]){const a={};o&1&&(a.flow=!n[0]),o&4&&(a.selected=n[2]),o&1083&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}const func=r=>r.title;function instance(r,e,t){let n,o,a,{$$slots:u={},$$scope:d}=e,{sm:h=!1}=e,{progress:p=0}=e,{selected:m=!1}=e,{track:E=void 0}=e;function k(S){bubble.call(this,r,S)}function L(S){bubble.call(this,r,S)}return r.$$set=S=>{"sm"in S&&t(0,h=S.sm),"progress"in S&&t(1,p=S.progress),"selected"in S&&t(2,m=S.selected),"track"in S&&t(3,E=S.track),"$$scope"in S&&t(10,d=S.$$scope)},r.$$.update=()=>{r.$$.dirty&8&&t(5,[n=void 0,...o]=(E==null?void 0:E.title.split("("))||[],n,(t(6,o),t(3,E))),r.$$.dirty&64&&t(4,a=o.length?"("+o.join("("):"")},[h,p,m,E,a,n,o,u,k,L,d]}class Track extends SvelteComponent{constructor(e){super(),init$1(this,e,instance,create_fragment,safe_not_equal,{sm:0,progress:1,selected:2,track:3})}}export{Card as C,Image as I,Portal as P,Realm as R,Track as T,Virtual as V,When as W,extra as a,ensure_array_like as b,search as c,artists as d,expand as e,feed as f,playlists as g,capitalize as h,Text as i,format as j,history as k,library as l,search$1 as m,albums as n,initRealm as o,playback as p,outro_and_destroy_block as q,ready as r,streams as s,tracks as t,update_keyed_each as u,hold as v,compare as w,upcoming as x,desource as y};
