var Na=Object.defineProperty;var ya=(r,e,t)=>e in r?Na(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var le=(r,e,t)=>(ya(r,typeof e!="symbol"?e+"":e,t),t),Gi=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var i=(r,e,t)=>(Gi(r,e,"read from private field"),t?t.call(r):e.get(r)),g=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},x=(r,e,t,n)=>(Gi(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var Y=(r,e,t)=>(Gi(r,e,"access private method"),t);import{T as run_all,s as safe_not_equal,w as create_slot,f as element,g as claim_element,h as children,d as detach,j as attr,E as toggle_class,i as insert_hydration,x as update_slot_base,y as get_all_dirty_from_scope,z as get_slot_changes,L as setContext,e as empty$1,G as noop$2,A as getContext,a as space,c as claim_space,k as set_style,u as append_hydration,C as listen,J as action_destroyer,v as component_subscribe,W as createEventDispatcher,o as onMount,t as tick,F as set_store_value,p as binding_callbacks,H as compute_slots,X as assign$1,a1 as set_dynamic_element_data,M as bubble,a0 as src_url_equal,l as text,m as claim_text,n as set_data}from"./scheduler.8f775f3a.js";import{t as transition_out,a as transition_in,S as SvelteComponent,i as init$1,g as group_outros,c as check_outros,b as create_component,d as claim_component,m as mount_component,e as destroy_component}from"./index.3432bd78.js";import{w as writable,d as derived}from"./paths.efb1cef9.js";import{l as lock,b as unlock,a as getScrollParent,p as position$1,I as Icon,g as get_spread_update}from"./Spinner.svelte_svelte_type_style_lang.24c9e146.js";const globals=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ensure_array_like(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function outro_and_destroy_block(r,e){transition_out(r,1,1,()=>{e.delete(r.key)})}function update_keyed_each(r,e,t,n,o,l,c,f,h,m,b,E){let k=r.length,L=l.length,I=k;const p={};for(;I--;)p[r[I].key]=I;const w=[],y=new Map,_=new Map,R=[];for(I=L;I--;){const F=E(o,l,I),he=t(F);let G=c.get(he);G?n&&R.push(()=>G.p(F,e)):(G=m(he,F),G.c()),y.set(he,w[I]=G),he in p&&_.set(he,Math.abs(I-p[he]))}const A=new Set,j=new Set;function S(F){transition_in(F,1),F.m(f,b),c.set(F.key,F),b=F.first,L--}for(;k&&L;){const F=w[L-1],he=r[k-1],G=F.key,$=he.key;F===he?(b=F.first,k--,L--):y.has($)?!c.has(G)||A.has(G)?S(F):j.has($)?k--:_.get(G)>_.get($)?(j.add(G),S(F)):(A.add($),k--):(h(he,c),k--)}for(;k--;){const F=r[k];y.has(F.key)||h(F,c)}for(;L;)S(w[L-1]);return run_all(R),w}let observing=0,observer=null;const dispatch=r=>r.forEach(e=>{var t;(t=e.target)==null||t.dispatchEvent(new CustomEvent("resize",{detail:e}))});function resize(r){return observer||(observer=new ResizeObserver(dispatch)),observer.observe(r),observing+=1,{destroy(){observer==null||observer.unobserve(r),observing-=1,observing<=0&&(observer==null||observer.disconnect(),observer=null)}}}function drag(r,e="touchstart"){function t(c){do{if(c!=null&&c.draggable)return c;c=(c==null?void 0:c.parentElement)||null}while(c);return null}function n(c){const f=t(c.target);f&&(lock(),c.preventDefault(),f.dispatchEvent(new DragEvent("dragstart",{bubbles:!0})))}function o(c){c.preventDefault(),addEventListener("pointercancel",l),addEventListener("pointerup",l)}function l(){unlock(),removeEventListener("pointercancel",l),removeEventListener("pointerup",l),r.dispatchEvent(new DragEvent("dragend",{bubbles:!0}))}return r.addEventListener(e,n),r.addEventListener("dragstart",o),{destroy(){r.removeEventListener(e,n),r.removeEventListener("dragstart",o)}}}function hold(r,{touch:e=!0,mouse:t=!1,duration:n=300}={}){function o(l){const c=setTimeout(()=>{var m;f();const h=l instanceof TouchEvent?TouchEvent:MouseEvent;(m=l.target)==null||m.dispatchEvent(new h("hold",l))},n),f=()=>{clearTimeout(c),e&&(r.removeEventListener("touchcancel",f),r.removeEventListener("touchmove",f),r.removeEventListener("touchend",f)),t&&(r.removeEventListener("mousemove",f),r.removeEventListener("mouseup",f))};e&&(r.addEventListener("touchcancel",f,{once:!0}),r.addEventListener("touchend",f,{once:!0}),r.addEventListener("touchmove",f,{once:!0,passive:!0})),t&&(r.addEventListener("mousemove",f,{once:!0}),r.addEventListener("mouseup",f,{once:!0}))}return e&&r.addEventListener("touchstart",o,{passive:!0}),t&&r.addEventListener("mousedown",o),{destroy(){r.removeEventListener("touchstart",o),r.removeEventListener("mousedown",o)}}}function create_fragment$7(r){let e,t,n;const o=r[6].default,l=create_slot(o,r,r[5],null);return{c(){e=element("div"),l&&l.c(),this.h()},l(c){e=claim_element(c,"DIV",{class:!0});var f=children(e);l&&l.l(f),f.forEach(detach),this.h()},h(){attr(e,"class",t=r[0]?"contents":"hidden"),toggle_class(e,"sm:contents",!r[0]&&r[1]),toggle_class(e,"md:contents",!r[0]&&r[2]),toggle_class(e,"lg:contents",!r[0]&&r[3]),toggle_class(e,"xl:contents",!r[0]&&r[4]),toggle_class(e,"sm:hidden",r[0]&&r[1]),toggle_class(e,"md:hidden",r[0]&&r[2]),toggle_class(e,"lg:hidden",r[0]&&r[3]),toggle_class(e,"xl:hidden",r[0]&&r[4])},m(c,f){insert_hydration(c,e,f),l&&l.m(e,null),n=!0},p(c,[f]){l&&l.p&&(!n||f&32)&&update_slot_base(l,o,c,c[5],n?get_slot_changes(o,c[5],f,null):get_all_dirty_from_scope(c[5]),null),(!n||f&1&&t!==(t=c[0]?"contents":"hidden"))&&attr(e,"class",t),(!n||f&3)&&toggle_class(e,"sm:contents",!c[0]&&c[1]),(!n||f&5)&&toggle_class(e,"md:contents",!c[0]&&c[2]),(!n||f&9)&&toggle_class(e,"lg:contents",!c[0]&&c[3]),(!n||f&17)&&toggle_class(e,"xl:contents",!c[0]&&c[4]),(!n||f&3)&&toggle_class(e,"sm:hidden",c[0]&&c[1]),(!n||f&5)&&toggle_class(e,"md:hidden",c[0]&&c[2]),(!n||f&9)&&toggle_class(e,"lg:hidden",c[0]&&c[3]),(!n||f&17)&&toggle_class(e,"xl:hidden",c[0]&&c[4])},i(c){n||(transition_in(l,c),n=!0)},o(c){transition_out(l,c),n=!1},d(c){c&&detach(e),l&&l.d(c)}}}function instance$8(r,e,t){let{$$slots:n={},$$scope:o}=e,{not:l=!1}=e,{sm:c=!1}=e,{md:f=!1}=e,{lg:h=!1}=e,{xl:m=!1}=e;return r.$$set=b=>{"not"in b&&t(0,l=b.not),"sm"in b&&t(1,c=b.sm),"md"in b&&t(2,f=b.md),"lg"in b&&t(3,h=b.lg),"xl"in b&&t(4,m=b.xl),"$$scope"in b&&t(5,o=b.$$scope)},[l,c,f,h,m,o,n]}class When extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$8,create_fragment$7,safe_not_equal,{not:0,sm:1,md:2,lg:3,xl:4})}}function create_fragment$6(r){let e;const t=r[1].default,n=create_slot(t,r,r[0],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,[l]){n&&n.p&&(!e||l&1)&&update_slot_base(n,t,o,o[0],e?get_slot_changes(t,o[0],l,null):get_all_dirty_from_scope(o[0]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}const initRealm=()=>({ssr:"",claimed:new Set,mounted:new Set,claim:new Set,destroy:new Set,mount:new Set,target:void 0});function instance$7(r,e,t){let{$$slots:n={},$$scope:o}=e;return setContext("realm",{}),r.$$set=c=>{"$$scope"in c&&t(0,o=c.$$scope)},[o,n]}class Realm extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$7,create_fragment$6,safe_not_equal,{})}}function create_key_block(r){let e;const t=r[4].default,n=create_slot(t,r,r[3],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&update_slot_base(n,t,o,o[3],e?get_slot_changes(t,o[3],l,null):get_all_dirty_from_scope(o[3]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_fragment$5(r){let e=r[0],t,n,o=create_key_block(r);return{c(){o.c(),t=empty$1()},l(l){o.l(l),t=empty$1()},m(l,c){o.m(l,c),insert_hydration(l,t,c),n=!0},p(l,[c]){c&1&&safe_not_equal(e,e=l[0])?(group_outros(),transition_out(o,1,1,noop$2),check_outros(),o=create_key_block(l),o.c(),transition_in(o,1),o.m(t.parentNode,t)):o.p(l,c)},i(l){n||(transition_in(o),n=!0)},o(l){transition_out(o),n=!1},d(l){l&&detach(t),o.d(l)}}}function instance$6($$self,$$props,$$invalidate){let{$$slots:slots={},$$scope}=$$props,{to=""}=$$props,{unique=""}=$$props;const realm=getContext("realm");if(!realm)throw new Error("A portal should exists within a realm!");realm[to]||(realm[to]=initRealm());const target=eval("slots");if(target.default){const[r]=target.default;target.default[0]=(...e)=>{const t=r(...e),n=realm[to];let o=!0,l=!0;function c(m){if(!m||n.claimed.has(unique))return l=!1;t.l(m),unique&&n.claimed.add(unique)}function f(m,b){if(n.mounted.has(unique))return o=!1;l&&t.m(m,b),unique&&n.mounted.add(unique)}function h(m){o&&n.mounted.delete(unique),l&&n.claimed.delete(unique),o&&t.d(m),n.claim.delete(c),n.mount.delete(f),n.destroy.delete(h)}return n.claim.add(c),n.mount.add(f),n.destroy.add(h),{...t,d:h,l:()=>{},m:()=>n.target&&f.apply(null,n.target)}}}return $$self.$$set=r=>{"to"in r&&$$invalidate(0,to=r.to),"unique"in r&&$$invalidate(1,unique=r.unique),"$$scope"in r&&$$invalidate(3,$$scope=r.$$scope)},$$self.$$.update=()=>{$$self.$$.dirty&5&&(realm[to]||$$invalidate(2,realm[to]=initRealm(),realm))},[to,unique,realm,$$scope,slots]}class Portal extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$6,create_fragment$5,safe_not_equal,{to:0,unique:1})}}function minmax(r,e,t,n){return r<e?n??e:r>t?n??t:r}const{Map:Map_1,window:window_1}=globals,get_default_slot_changes_1=r=>({item:r[0]&2048}),get_default_slot_context_1=r=>({item:r[11].data,index:NaN});function get_each_context(r,e,t){const n=r.slice();return n[52]=e[t],n[54]=t,n}const get_default_slot_changes$1=r=>({item:r[0]&16384,index:r[0]&16640}),get_default_slot_context$1=r=>({item:r[52],index:r[8]+r[54]});function create_each_block(r,e){let t,n,o,l;const c=e[40].default,f=create_slot(c,e,e[42],get_default_slot_context$1);return{key:r,first:null,c(){t=element("div"),f&&f.c(),n=space(),this.h()},l(h){t=claim_element(h,"DIV",{draggable:!0,style:!0});var m=children(t);f&&f.l(m),n=claim_space(m),m.forEach(detach),this.h()},h(){var h,m;attr(t,"draggable",o=e[2]&&e[1](e[52])!=null?"true":void 0),set_style(t,"overflow-anchor","none"),toggle_class(t,"invisible",((h=e[11])==null?void 0:h.owner)===e[3]&&((m=e[11])==null?void 0:m.key)===e[1](e[52])),this.first=t},m(h,m){insert_hydration(h,t,m),f&&f.m(t,null),append_hydration(t,n),l=!0},p(h,m){var b,E;e=h,f&&f.p&&(!l||m[0]&16640|m[1]&2048)&&update_slot_base(f,c,e,e[42],l?get_slot_changes(c,e[42],m,get_default_slot_changes$1):get_all_dirty_from_scope(e[42]),get_default_slot_context$1),(!l||m[0]&16390&&o!==(o=e[2]&&e[1](e[52])!=null?"true":void 0))&&attr(t,"draggable",o),(!l||m[0]&18442)&&toggle_class(t,"invisible",((b=e[11])==null?void 0:b.owner)===e[3]&&((E=e[11])==null?void 0:E.key)===e[1](e[52]))},i(h){l||(transition_in(f,h),l=!0)},o(h){transition_out(f,h),l=!1},d(h){h&&detach(t),f&&f.d(h)}}}function create_if_block$3(r){let e,t;return e=new Portal({props:{to:"overlay",$$slots:{default:[create_default_slot$1]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const l={};o[0]&2297|o[1]&2048&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_if_block_1$2(r){let e,t=`translate3d(
          ${r[11].back?r[11].back.x:r[7].x+Math.max(r[11].offset.x,-r[4].width/r[6]+r[0])}px,
          ${r[11].back?r[11].back.y:r[7].y+Math.max(r[11].offset.y,-r[5]+r[0])}px, 0)`,n=`${r[4].width/r[6]-r[0]}px`,o=`${r[5]-r[0]}px`,l;const c=r[40].default,f=create_slot(c,r,r[42],get_default_slot_context_1);return{c(){e=element("div"),f&&f.c(),this.h()},l(h){e=claim_element(h,"DIV",{class:!0});var m=children(e);f&&f.l(m),m.forEach(detach),this.h()},h(){attr(e,"class","absolute will-change-transform contain-[size_layout]"),toggle_class(e,"transition-transform",r[11].back),set_style(e,"transform",t),set_style(e,"width",n),set_style(e,"height",o)},m(h,m){insert_hydration(h,e,m),f&&f.m(e,null),l=!0},p(h,m){f&&f.p&&(!l||m[0]&2048|m[1]&2048)&&update_slot_base(f,c,h,h[42],l?get_slot_changes(c,h[42],m,get_default_slot_changes_1):get_all_dirty_from_scope(h[42]),get_default_slot_context_1),(!l||m[0]&2048)&&toggle_class(e,"transition-transform",h[11].back),m[0]&2289&&t!==(t=`translate3d(
          ${h[11].back?h[11].back.x:h[7].x+Math.max(h[11].offset.x,-h[4].width/h[6]+h[0])}px,
          ${h[11].back?h[11].back.y:h[7].y+Math.max(h[11].offset.y,-h[5]+h[0])}px, 0)`)&&set_style(e,"transform",t),m[0]&81&&n!==(n=`${h[4].width/h[6]-h[0]}px`)&&set_style(e,"width",n),m[0]&33&&o!==(o=`${h[5]-h[0]}px`)&&set_style(e,"height",o)},i(h){l||(transition_in(f,h),l=!0)},o(h){transition_out(f,h),l=!1},d(h){h&&detach(e),f&&f.d(h)}}}function create_default_slot$1(r){var o;let e,t,n=((o=r[11])==null?void 0:o.owner)===r[3]&&create_if_block_1$2(r);return{c(){n&&n.c(),e=empty$1()},l(l){n&&n.l(l),e=empty$1()},m(l,c){n&&n.m(l,c),insert_hydration(l,e,c),t=!0},p(l,c){var f;((f=l[11])==null?void 0:f.owner)===l[3]?n?(n.p(l,c),c[0]&2056&&transition_in(n,1)):(n=create_if_block_1$2(l),n.c(),transition_in(n,1),n.m(e.parentNode,e)):n&&(group_outros(),transition_out(n,1,1,()=>{n=null}),check_outros())},i(l){t||(transition_in(n),t=!0)},o(l){transition_out(n),t=!1},d(l){l&&detach(e),n&&n.d(l)}}}function create_fragment$4(r){let e,t,n=[],o=new Map_1,l=`translate3d(0,${Math.ceil(r[8]/r[6])*r[5]}px,0)`,c=`${r[0]}px`,f,h=`${r[10]}px`,m,b,E,k=ensure_array_like(r[14]);const L=p=>p[12][(p[8]+p[54])%p[9]]??p[54];for(let p=0;p<k.length;p+=1){let w=get_each_context(r,k,p),y=L(w);o.set(y,n[p]=create_each_block(y,w))}let I=r[2]&&create_if_block$3(r);return{c(){e=element("div"),t=element("div");for(let p=0;p<n.length;p+=1)n[p].c();f=space(),I&&I.c(),this.h()},l(p){e=claim_element(p,"DIV",{class:!0});var w=children(e);t=claim_element(w,"DIV",{class:!0});var y=children(t);for(let _=0;_<n.length;_+=1)n[_].l(y);y.forEach(detach),f=claim_space(w),I&&I.l(w),w.forEach(detach),this.h()},h(){attr(t,"class","grid auto-rows-max will-change-transform contain-layout"),toggle_class(t,"pointer-events-none",!!r[11]),set_style(t,"transform",l),set_style(t,"grid-template-columns",r[13]),set_style(t,"gap",c),attr(e,"class","shrink-0 contain-[size_layout]"),set_style(e,"height",h)},m(p,w){insert_hydration(p,e,w),append_hydration(e,t);for(let y=0;y<n.length;y+=1)n[y]&&n[y].m(t,null);r[41](t),append_hydration(e,f),I&&I.m(e,null),m=!0,b||(E=[listen(window_1,"dragstart",r[15]),listen(window_1,"dragend",r[16]),action_destroyer(drag.call(null,t,"hold")),action_destroyer(hold.call(null,t))],b=!0)},p(p,w){w[0]&23310|w[1]&2048&&(k=ensure_array_like(p[14]),group_outros(),n=update_keyed_each(n,w,L,1,p,k,o,t,outro_and_destroy_block,create_each_block,null,get_each_context),check_outros()),(!m||w[0]&2048)&&toggle_class(t,"pointer-events-none",!!p[11]),w[0]&352&&l!==(l=`translate3d(0,${Math.ceil(p[8]/p[6])*p[5]}px,0)`)&&set_style(t,"transform",l),w[0]&8192&&set_style(t,"grid-template-columns",p[13]),w[0]&1&&c!==(c=`${p[0]}px`)&&set_style(t,"gap",c),p[2]?I?(I.p(p,w),w[0]&4&&transition_in(I,1)):(I=create_if_block$3(p),I.c(),transition_in(I,1),I.m(e,null)):I&&(group_outros(),transition_out(I,1,1,()=>{I=null}),check_outros()),w[0]&1024&&h!==(h=`${p[10]}px`)&&set_style(e,"height",h)},i(p){if(!m){for(let w=0;w<k.length;w+=1)transition_in(n[w]);transition_in(I),m=!0}},o(p){for(let w=0;w<n.length;w+=1)transition_out(n[w]);transition_out(I),m=!1},d(p){p&&detach(e);for(let w=0;w<n.length;w+=1)n[w].d();r[41](null),I&&I.d(),b=!1,run_all(E)}}}let transfer=writable(null);function instance$5(r,e,t){let n,o,l,c,f,h,m,b,E,k,L,I,p,w,y,_,R,A,j,S;component_subscribe(r,transfer,V=>t(11,S=V));let{$$slots:F={},$$scope:he}=e;const G=createEventDispatcher();let{gap:$=0}=e,{items:z}=e,{move:H=!1}=e,{fixed:ue=!1}=e,{overthrow:X=1}=e,{prerender:oe=1}=e,{columns:ye=1}=e,{key:M=V=>V}=e,{animate:te=!1}=e,{sortable:be=!1}=e,{container:Te=void 0}=e,ce=null,Ye={x:0,y:0},at=new DOMRect,Ze=new DOMRect,Qt=!0,Mt=1,J=0,we=0;function Vn(V){!k&&V.length&&tick().then(Ie);const pe=new Map,ve=Array.from({length:b}),xe=new Set(E);for(let ke=0;ke<V.length;ke++){const rr=M(V[ke]);if(rr==null||(pe.set(rr,ke),ke<f||ke>=h))continue;const ft=k==null?void 0:k.get(rr);if(ft==null||ft<f||ft>=h||(ve[ke%b]=E[ft%b],xe.delete(E[ft%b]),ft===ke||!te)||(S==null?void 0:S.owner)===ce&&rr===(S==null?void 0:S.key))continue;const Di=~~(ft/J)-~~(ke/J),Wi=~~(ft%J)-~~(ke%J);Cr(ft,Wi,Di)}const Ue=[...xe];return t(12,E=ve.map(ke=>ke??Ue.shift())),pe}function Cr(V,pe,ve){const xe=ce==null?void 0:ce.children.item(V-f),Ue=[`translate3d(${pe*100}%,${ve*100}%,0)`,"translate3d(0,0,0)"];xe==null||xe.animate({transform:Ue,zIndex:["100","100"]},{easing:"ease",composite:"accumulate",duration:L})}function Ie(){var xe;if(!Te||!ce)return;t(4,Ze=(xe=ce.parentElement)==null?void 0:xe.getBoundingClientRect()),t(26,at=Te.getBoundingClientRect()),t(4,Ze.y+=Ye.y,Ze),t(28,we=Ze.y-at.y-at.height/2),t(4,Ze.width+=$,Ze);const V=ce.firstElementChild;if(!V)return;const{width:pe,height:ve}=V.getBoundingClientRect();!pe||!ve||(t(6,J=~~(Ze.width/(pe+$))),t(5,Mt=ve+$))}let Pe,Tt,se={x:0,y:0};async function Jn({target:V}){if(Ie(),await tick(),!be||!ce||!V||S||V.parentElement!==ce||z[j]==null||M(z[j])==null)return;Tt=j,Pe=H?-1:Tt;const pe=V.getBoundingClientRect();pe.x-=se.x,pe.y-=se.y,set_store_value(transfer,S={group:be===!0?ce:be,key:M(z[j]),data:z[j],owner:ce,offset:pe},S)}function pt(V,pe=!1){if(!be||!S||ue||M(z[V])==null)return;if(!Number.isInteger(V)){Pe!=null&&S.owner!==ce&&(pt(Pe,!0),Pe=void 0);return}if(M(z[V])===S.key)return;V<0&&!z.length&&(V=0);const ve=z.findIndex(xe=>M(xe)===(S==null?void 0:S.key));ve!==V&&(!pe&&Pe==null&&(Pe=ve,Tt=ve),~ve&&z.splice(ve,1),~V&&z.splice(V,0,S.data),requestAnimationFrame(()=>t(17,z))),!pe&&ce&&set_store_value(transfer,S.owner=ce,S)}async function qi(){if(!be||!S||Tt==null)return;const V=z.findIndex(pe=>M(pe)===(S==null?void 0:S.key));if(S.owner===ce&&~V){const pe=ce.children.item(V-f);pe&&(set_store_value(transfer,S.back=pe.getBoundingClientRect(),S),set_store_value(transfer,S.group=Math.random().toString(),S),await new Promise(ve=>setTimeout(ve,150)))}if(Tt!==V){const pe=S.data,ve=z[V-1],xe=(+!!~Tt<<1)+ +!!~V,Ue=[void 0,"push","purge","rearrange"][xe];Ue&&G("edit",{action:Ue,index:V,after:ve,item:pe})}Tt=void 0,Pe=void 0,S.owner===ce&&set_store_value(transfer,S=null,S)}onMount(()=>{function V(xe){const Ue=xe.currentTarget;t(25,Ye.x=Ue.scrollLeft,Ye),t(25,Ye.y=Ue.scrollTop,Ye)}Te||t(18,Te=getScrollParent(ce));const pe=be&&position$1.subscribe(xe=>t(7,se=xe));Te.addEventListener("scroll",V,{passive:!0}),Te.addEventListener("resize",Ie);const{destroy:ve}=resize(Te);return t(27,Qt=!1),()=>{Te==null||Te.removeEventListener("scroll",V),Te==null||Te.removeEventListener("resize",Ie),pe&&pe(),ve()}});function xr(V){binding_callbacks[V?"unshift":"push"](()=>{ce=V,t(3,ce)})}return r.$$set=V=>{"gap"in V&&t(0,$=V.gap),"items"in V&&t(17,z=V.items),"move"in V&&t(19,H=V.move),"fixed"in V&&t(20,ue=V.fixed),"overthrow"in V&&t(21,X=V.overthrow),"prerender"in V&&t(22,oe=V.prerender),"columns"in V&&t(23,ye=V.columns),"key"in V&&t(1,M=V.key),"animate"in V&&t(24,te=V.animate),"sortable"in V&&t(2,be=V.sortable),"container"in V&&t(18,Te=V.container),"$$scope"in V&&t(42,he=V.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&67108960&&t(38,n=Math.ceil(at.height/Mt)*J),r.$$.dirty[0]&96|r.$$.dirty[1]&128&&t(39,o=n/J*Mt),r.$$.dirty[0]&131072|r.$$.dirty[1]&128&&t(36,l=Math.max(Math.ceil(z.length/n)-2,1)),r.$$.dirty[0]&301989888|r.$$.dirty[1]&288&&t(37,c=minmax(~~((Ye.y-we)/o),1,l)),r.$$.dirty[0]&2097152|r.$$.dirty[1]&192&&t(8,f=Math.max(c-X,0)*n),r.$$.dirty[0]&6291456|r.$$.dirty[1]&192&&t(35,h=Math.max((c+X+1)*n,oe)),r.$$.dirty[0]&131328|r.$$.dirty[1]&16&&t(14,m=z.slice(f,h)),r.$$.dirty[0]&2097152|r.$$.dirty[1]&128&&t(9,b=(X*2+1)*n),r.$$.dirty[0]&512&&t(12,E=Array.from({length:b}).map((V,pe)=>pe)),r.$$.dirty[0]&131072&&(k=Vn(z)),r.$$.dirty[0]&16777216&&(L=te===!0?300:te||0),r.$$.dirty[0]&131169&&t(10,I=Math.ceil(z.length/J)*Mt-$),r.$$.dirty[0]&8388608&&t(13,p=Number.isInteger(ye)?`repeat(${ye},1fr)`:`repeat(auto-fill,minmax(min(100%,${ye}),1fr))`),r.$$.dirty[0]&1024&&Number.isFinite(I)&&(requestAnimationFrame(Ie),t(27,Qt=!1)),r.$$.dirty[0]&134217728|r.$$.dirty[1]&96&&!Qt&&c===l&&(G("end"),t(27,Qt=!0)),r.$$.dirty[0]&12&&t(30,w=be===!0?ce:be),r.$$.dirty[0]&100663441&&t(34,y=minmax(se.y+$/2,at.top,at.bottom,NaN)+Ye.y-Ze.y),r.$$.dirty[0]&33554577&&t(33,_=minmax(se.x+$/2,Ze.left,Ze.right-$-1,NaN)+Ye.x-Ze.x),r.$$.dirty[0]&32|r.$$.dirty[1]&8&&t(32,R=Math.floor(y/Mt)),r.$$.dirty[0]&80|r.$$.dirty[1]&4&&t(31,A=Math.floor(_/(Ze.width/J))),r.$$.dirty[0]&131136|r.$$.dirty[1]&3&&t(29,j=minmax(R*J+A,0,z.length-1)),r.$$.dirty[0]&1610614784&&(S==null?void 0:S.group)===w&&pt(j)},[$,M,be,ce,Ze,Mt,J,se,f,b,I,S,E,p,m,Jn,qi,z,Te,H,ue,X,oe,ye,te,Ye,at,Qt,we,j,w,A,R,_,y,h,l,c,n,o,F,xr,he]}class Virtual extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$5,create_fragment$4,safe_not_equal,{gap:0,items:17,move:19,fixed:20,overthrow:21,prerender:22,columns:23,key:1,animate:24,sortable:2,container:18},null,[-1,-1])}}const get_after_slot_changes=r=>({}),get_after_slot_context=r=>({}),get_before_slot_changes=r=>({}),get_before_slot_context=r=>({});function create_if_block_1$1(r){let e,t;const n=r[9].before,o=create_slot(n,r,r[8],get_before_slot_context);return{c(){e=element("div"),o&&o.c(),this.h()},l(l){e=claim_element(l,"DIV",{class:!0});var c=children(e);o&&o.l(c),c.forEach(detach),this.h()},h(){attr(e,"class","z-20 flex items-center")},m(l,c){insert_hydration(l,e,c),o&&o.m(e,null),t=!0},p(l,c){o&&o.p&&(!t||c&256)&&update_slot_base(o,n,l,l[8],t?get_slot_changes(n,l[8],c,get_before_slot_changes):get_all_dirty_from_scope(l[8]),get_before_slot_context)},i(l){t||(transition_in(o,l),t=!0)},o(l){transition_out(o,l),t=!1},d(l){l&&detach(e),o&&o.d(l)}}}function create_if_block$2(r){let e;return{c(){e=element("hr"),this.h()},l(t){e=claim_element(t,"HR",{"aria-hidden":!0,class:!0}),this.h()},h(){attr(e,"aria-hidden",""),attr(e,"class","absolute bottom-0 h-[1px] w-full border-none bg-content/10 group-last-of-type:opacity-0")},m(t,n){insert_hydration(t,e,n)},d(t){t&&detach(e)}}}function create_dynamic_element(r){let e,t,n,o,l,c,f,h,m,b,E,k,L,I,p,w,y,_,R,A,j,S,F,he,G=r[7].before&&create_if_block_1$1(r);const $=r[9].default,z=create_slot($,r,r[8],null);let H=r[2]&&(r[1]||r[0])&&create_if_block$2();I=new Icon({props:{name:"circle"}}),y=new Icon({props:{name:"target"}});const ue=r[9].after,X=create_slot(ue,r,r[8],get_after_slot_context);let oe=[{role:A=r[5]?"link":"button"},{tabindex:"0"},{href:r[5]},{draggable:"false"},{class:j="group relative z-10 flex w-full items-center gap-4 overflow-hidden px-4 outline-2 -outline-offset-2 outline-primary-600 contain-inline-size focus-visible:outline "+(r[4]?"cursor-pointer touch-manipulation select-none "+(r[2]?"":"transition-transform active:scale-95"):"")+" "+(r[0]?"focus-visible:z-50":r[1]?"rounded-lg py-1 focus-visible:z-50":"rounded-2xl py-4")+" "+(r[2]?"bg-surface":"bg-surface-100 shadow-[0_0_20px_-4px] shadow-black/20 dark:shadow-none")}],ye={};for(let M=0;M<oe.length;M+=1)ye=assign$1(ye,oe[M]);return{c(){e=element(r[4]?r[5]?"a":"button":"article"),t=element("div"),n=space(),o=element("div"),c=space(),G&&G.c(),f=space(),h=element("div"),z&&z.c(),m=space(),H&&H.c(),E=space(),k=element("div"),L=element("div"),create_component(I.$$.fragment),p=space(),w=element("div"),create_component(y.$$.fragment),_=space(),R=element("div"),X&&X.c(),this.h()},l(M){e=claim_element(M,((r[4]?r[5]?"a":"button":"article")||"null").toUpperCase(),{role:!0,tabindex:!0,href:!0,draggable:!0,class:!0});var te=children(e);t=claim_element(te,"DIV",{"aria-hidden":!0,class:!0}),children(t).forEach(detach),n=claim_space(te),o=claim_element(te,"DIV",{"aria-hidden":!0,class:!0}),children(o).forEach(detach),c=claim_space(te),G&&G.l(te),f=claim_space(te),h=claim_element(te,"DIV",{class:!0});var be=children(h);z&&z.l(be),m=claim_space(be),H&&H.l(be),be.forEach(detach),E=claim_space(te),k=claim_element(te,"DIV",{class:!0});var Te=children(k);L=claim_element(Te,"DIV",{class:!0});var ce=children(L);claim_component(I.$$.fragment,ce),ce.forEach(detach),p=claim_space(Te),w=claim_element(Te,"DIV",{class:!0});var Ye=children(w);claim_component(y.$$.fragment,Ye),Ye.forEach(detach),_=claim_space(Te),R=claim_element(Te,"DIV",{class:!0});var at=children(R);X&&X.l(at),at.forEach(detach),Te.forEach(detach),te.forEach(detach),this.h()},h(){attr(t,"aria-hidden",""),attr(t,"class","pointer-events-none absolute inset-0 -z-10 bg-primary-200/30 opacity-0 transition-opacity"),toggle_class(t,"opacity-100",r[6]===!0),attr(o,"aria-hidden",""),attr(o,"class",l="pointer-events-none absolute inset-0 z-0 bg-highlight opacity-0 "+(r[4]?"group-hover:opacity-30 "+(r[2]?"dark:group-hover:opacity-50":"dark:group-hover:opacity-10"):"")),attr(h,"class",b="z-10 grid w-full grid-cols-1 items-baseline overflow-hidden contain-inline-size "+(r[1]||r[0]?"justify-start gap-0.5":"place-items-center justify-center gap-2")+" "+((r[1]||r[0])&&r[3]?"lg:auto-cols-fr lg:grid-flow-col lg:gap-4":"")),attr(L,"class","flex justify-center text-primary-600 opacity-0 transition-opacity"),toggle_class(L,"opacity-100",r[6]),attr(w,"class","flex scale-0 justify-center text-primary-600 transition-transform"),toggle_class(w,"scale-100",r[6]===!0),attr(R,"class","opacity-0 transition-opacity"),toggle_class(R,"opacity-100",!r[6]),attr(k,"class","z-20 grid items-center [&>*]:col-start-1 [&>*]:row-start-1"),set_dynamic_element_data(r[4]?r[5]?"a":"button":"article")(e,ye)},m(M,te){insert_hydration(M,e,te),append_hydration(e,t),append_hydration(e,n),append_hydration(e,o),append_hydration(e,c),G&&G.m(e,null),append_hydration(e,f),append_hydration(e,h),z&&z.m(h,null),append_hydration(h,m),H&&H.m(h,null),append_hydration(e,E),append_hydration(e,k),append_hydration(k,L),mount_component(I,L,null),append_hydration(k,p),append_hydration(k,w),mount_component(y,w,null),append_hydration(k,_),append_hydration(k,R),X&&X.m(R,null),S=!0,F||(he=[listen(e,"click",r[10]),listen(e,"contextmenu",r[11])],F=!0)},p(M,te){(!S||te&64)&&toggle_class(t,"opacity-100",M[6]===!0),(!S||te&20&&l!==(l="pointer-events-none absolute inset-0 z-0 bg-highlight opacity-0 "+(M[4]?"group-hover:opacity-30 "+(M[2]?"dark:group-hover:opacity-50":"dark:group-hover:opacity-10"):"")))&&attr(o,"class",l),M[7].before?G?(G.p(M,te),te&128&&transition_in(G,1)):(G=create_if_block_1$1(M),G.c(),transition_in(G,1),G.m(e,f)):G&&(group_outros(),transition_out(G,1,1,()=>{G=null}),check_outros()),z&&z.p&&(!S||te&256)&&update_slot_base(z,$,M,M[8],S?get_slot_changes($,M[8],te,null):get_all_dirty_from_scope(M[8]),null),M[2]&&(M[1]||M[0])?H||(H=create_if_block$2(),H.c(),H.m(h,null)):H&&(H.d(1),H=null),(!S||te&11&&b!==(b="z-10 grid w-full grid-cols-1 items-baseline overflow-hidden contain-inline-size "+(M[1]||M[0]?"justify-start gap-0.5":"place-items-center justify-center gap-2")+" "+((M[1]||M[0])&&M[3]?"lg:auto-cols-fr lg:grid-flow-col lg:gap-4":"")))&&attr(h,"class",b),(!S||te&64)&&toggle_class(L,"opacity-100",M[6]),(!S||te&64)&&toggle_class(w,"scale-100",M[6]===!0),X&&X.p&&(!S||te&256)&&update_slot_base(X,ue,M,M[8],S?get_slot_changes(ue,M[8],te,get_after_slot_changes):get_all_dirty_from_scope(M[8]),get_after_slot_context),(!S||te&64)&&toggle_class(R,"opacity-100",!M[6]),set_dynamic_element_data(M[4]?M[5]?"a":"button":"article")(e,ye=get_spread_update(oe,[(!S||te&32&&A!==(A=M[5]?"link":"button"))&&{role:A},{tabindex:"0"},(!S||te&32)&&{href:M[5]},{draggable:"false"},(!S||te&23&&j!==(j="group relative z-10 flex w-full items-center gap-4 overflow-hidden px-4 outline-2 -outline-offset-2 outline-primary-600 contain-inline-size focus-visible:outline "+(M[4]?"cursor-pointer touch-manipulation select-none "+(M[2]?"":"transition-transform active:scale-95"):"")+" "+(M[0]?"focus-visible:z-50":M[1]?"rounded-lg py-1 focus-visible:z-50":"rounded-2xl py-4")+" "+(M[2]?"bg-surface":"bg-surface-100 shadow-[0_0_20px_-4px] shadow-black/20 dark:shadow-none")))&&{class:j}]))},i(M){S||(transition_in(G),transition_in(z,M),transition_in(I.$$.fragment,M),transition_in(y.$$.fragment,M),transition_in(X,M),S=!0)},o(M){transition_out(G),transition_out(z,M),transition_out(I.$$.fragment,M),transition_out(y.$$.fragment,M),transition_out(X,M),S=!1},d(M){M&&detach(e),G&&G.d(),z&&z.d(M),H&&H.d(),destroy_component(I),destroy_component(y),X&&X.d(M),F=!1,run_all(he)}}}function create_fragment$3(r){let e=r[4]?r[5]?"a":"button":"article",t,n,o=(r[4]?r[5]?"a":"button":"article")&&create_dynamic_element(r);return{c(){o&&o.c(),t=empty$1()},l(l){o&&o.l(l),t=empty$1()},m(l,c){o&&o.m(l,c),insert_hydration(l,t,c),n=!0},p(l,[c]){!l[4]||l[5],e?safe_not_equal(e,l[4]?l[5]?"a":"button":"article")?(o.d(1),o=create_dynamic_element(l),e=l[4]?l[5]?"a":"button":"article",o.c(),o.m(t.parentNode,t)):o.p(l,c):(o=create_dynamic_element(l),e=l[4]?l[5]?"a":"button":"article",o.c(),o.m(t.parentNode,t))},i(l){n||(transition_in(o,l),n=!0)},o(l){transition_out(o,l),n=!1},d(l){l&&detach(t),o&&o.d(l)}}}function instance$4(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=compute_slots(n);let{xs:c=!1}=e,{sm:f=!1}=e,{flat:h=!1}=e,{flow:m=!1}=e,{interactive:b=!1}=e,{href:E=void 0}=e,{selected:k=!1}=e;function L(p){bubble.call(this,r,p)}function I(p){bubble.call(this,r,p)}return r.$$set=p=>{"xs"in p&&t(0,c=p.xs),"sm"in p&&t(1,f=p.sm),"flat"in p&&t(2,h=p.flat),"flow"in p&&t(3,m=p.flow),"interactive"in p&&t(4,b=p.interactive),"href"in p&&t(5,E=p.href),"selected"in p&&t(6,k=p.selected),"$$scope"in p&&t(8,o=p.$$scope)},[c,f,h,m,b,E,k,l,o,n,L,I]}class Card extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$4,create_fragment$3,safe_not_equal,{xs:0,sm:1,flat:2,flow:3,interactive:4,href:5,selected:6})}}function create_fragment$2(r){let e,t,n;const o=r[6].default,l=create_slot(o,r,r[5],null);return{c(){e=element("span"),l&&l.c(),this.h()},l(c){e=claim_element(c,"SPAN",{class:!0});var f=children(e);l&&l.l(f),f.forEach(detach),this.h()},h(){attr(e,"class",t="w-max max-w-full overflow-hidden text-ellipsis whitespace-nowrap rounded-md text-left [&>*]:align-bottom "+(r[1]?"animate-pulse bg-highlight text-transparent":"")+" "+(r[2]?"font-medium":"font-normal")),toggle_class(e,"text-content-200",r[0]),toggle_class(e,"ml-4",r[3]),toggle_class(e,"text-sm",r[4])},m(c,f){insert_hydration(c,e,f),l&&l.m(e,null),n=!0},p(c,[f]){l&&l.p&&(!n||f&32)&&update_slot_base(l,o,c,c[5],n?get_slot_changes(o,c[5],f,null):get_all_dirty_from_scope(c[5]),null),(!n||f&6&&t!==(t="w-max max-w-full overflow-hidden text-ellipsis whitespace-nowrap rounded-md text-left [&>*]:align-bottom "+(c[1]?"animate-pulse bg-highlight text-transparent":"")+" "+(c[2]?"font-medium":"font-normal")))&&attr(e,"class",t),(!n||f&7)&&toggle_class(e,"text-content-200",c[0]),(!n||f&14)&&toggle_class(e,"ml-4",c[3]),(!n||f&22)&&toggle_class(e,"text-sm",c[4])},i(c){n||(transition_in(l,c),n=!0)},o(c){transition_out(l,c),n=!1},d(c){c&&detach(e),l&&l.d(c)}}}function instance$3(r,e,t){let{$$slots:n={},$$scope:o}=e,{secondary:l=!1}=e,{loading:c=!1}=e,{accent:f=!1}=e,{indent:h=!1}=e,{sm:m=!1}=e;return r.$$set=b=>{"secondary"in b&&t(0,l=b.secondary),"loading"in b&&t(1,c=b.loading),"accent"in b&&t(2,f=b.accent),"indent"in b&&t(3,h=b.indent),"sm"in b&&t(4,m=b.sm),"$$scope"in b&&t(5,o=b.$$scope)},[l,c,f,h,m,o,n]}class Text extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$3,create_fragment$2,safe_not_equal,{secondary:0,loading:1,accent:2,indent:3,sm:4})}}function create_if_block_1(r){let e;const t=r[7].default,n=create_slot(t,r,r[6],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&64)&&update_slot_base(n,t,o,o[6],e?get_slot_changes(t,o[6],l,null):get_all_dirty_from_scope(o[6]),null)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_if_block$1(r){let e,t,n,o,l,c;return{c(){e=element("img"),this.h()},l(f){e=claim_element(f,"IMG",{alt:!0,src:!0,class:!0,loading:!0,width:!0,height:!0,draggable:!0}),this.h()},h(){attr(e,"alt",r[3]),src_url_equal(e.src,t=r[2]<100/devicePixelRatio?r[0]:r[1])||attr(e,"src",t),attr(e,"class","opacity-0 transition-opacity duration-500"),attr(e,"loading","lazy"),attr(e,"width",n=r[2]+"px"),attr(e,"height",o=r[2]+"px"),attr(e,"draggable","false"),toggle_class(e,"opacity-100",r[5]==="ok")},m(f,h){insert_hydration(f,e,h),r[8](e),l||(c=[listen(e,"load",r[9]),listen(e,"error",r[10])],l=!0)},p(f,h){h&8&&attr(e,"alt",f[3]),h&7&&!src_url_equal(e.src,t=f[2]<100/devicePixelRatio?f[0]:f[1])&&attr(e,"src",t),h&4&&n!==(n=f[2]+"px")&&attr(e,"width",n),h&4&&o!==(o=f[2]+"px")&&attr(e,"height",o),h&32&&toggle_class(e,"opacity-100",f[5]==="ok")},i:noop$2,o:noop$2,d(f){f&&detach(e),r[8](null),l=!1,run_all(c)}}}function create_fragment$1(r){let e,t,n,o,l=`${r[2]}px`,c=`${r[2]}px`,f;const h=[create_if_block$1,create_if_block_1],m=[];function b(E,k){return E[1]&&E[5]!=="error"?0:E[5]==="error"?1:-1}return~(t=b(r))&&(n=m[t]=h[t](r)),{c(){e=element("div"),n&&n.c(),this.h()},l(E){e=claim_element(E,"DIV",{class:!0});var k=children(e);n&&n.l(k),k.forEach(detach),this.h()},h(){attr(e,"class",o="overflow-hidden "+(r[2]>200?"rounded-2xl":"rounded")+" bg-highlight-100"),toggle_class(e,"animate-pulse",r[5]==="loading"),set_style(e,"height",l),set_style(e,"width",c)},m(E,k){insert_hydration(E,e,k),~t&&m[t].m(e,null),f=!0},p(E,[k]){let L=t;t=b(E),t===L?~t&&m[t].p(E,k):(n&&(group_outros(),transition_out(m[L],1,1,()=>{m[L]=null}),check_outros()),~t?(n=m[t],n?n.p(E,k):(n=m[t]=h[t](E),n.c()),transition_in(n,1),n.m(e,null)):n=null),(!f||k&4&&o!==(o="overflow-hidden "+(E[2]>200?"rounded-2xl":"rounded")+" bg-highlight-100"))&&attr(e,"class",o),(!f||k&36)&&toggle_class(e,"animate-pulse",E[5]==="loading"),k&4&&l!==(l=`${E[2]}px`)&&set_style(e,"height",l),k&4&&c!==(c=`${E[2]}px`)&&set_style(e,"width",c)},i(E){f||(transition_in(n),f=!0)},o(E){transition_out(n),f=!1},d(E){E&&detach(e),~t&&m[t].d()}}}function instance$2(r,e,t){let n,{$$slots:o={},$$scope:l}=e,{thumbnail:c=void 0}=e,{src:f=void 0}=e,{size:h=48}=e,{alt:m=""}=e,b;onMount(()=>(b!=null&&b.complete&&t(4,b.style.opacity="1",b),!1));function E(I){binding_callbacks[I?"unshift":"push"](()=>{b=I,t(4,b)})}const k=()=>t(5,n="ok"),L=()=>t(5,n="error");return r.$$set=I=>{"thumbnail"in I&&t(0,c=I.thumbnail),"src"in I&&t(1,f=I.src),"size"in I&&t(2,h=I.size),"alt"in I&&t(3,m=I.alt),"$$scope"in I&&t(6,l=I.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(5,n=f===""||f===null?"error":"loading")},[c,f,h,m,b,n,l,o,E,k,L]}class Image extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$2,create_fragment$1,safe_not_equal,{thumbnail:0,src:1,size:2,alt:3})}}function capitalize(r,e=!0){return r&&(e?r.replace(/\b\w/g,t=>t.toUpperCase()):r.replace(/\b\w/,t=>t.toUpperCase()))}function clean(r){return r.normalize().trim().toLowerCase().replace(/\s+/g," ")}const __vite_glob_0_0=`CREATE TRIGGER IF NOT EXISTS cascade_playlists_library
AFTER DELETE ON playlists
FOR EACH ROW
BEGIN
  DELETE FROM library WHERE playlist = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_library_tracks
AFTER DELETE ON library
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM library 
    WHERE track = OLD.track 
  UNION ALL SELECT 1 FROM playback
    WHERE track = OLD.track
  LIMIT 1
)
BEGIN
  DELETE FROM tracks WHERE id = OLD.track;
END;

CREATE TRIGGER IF NOT EXISTS cascade_playback_tracks
AFTER DELETE ON playback
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM library
    WHERE track = OLD.track
  UNION ALL SELECT 1 FROM playback
    WHERE track = OLD.track
  LIMIT 1
)
BEGIN
  DELETE FROM tracks WHERE id = OLD.track;
END;

CREATE TRIGGER IF NOT EXISTS cascade_tracks_albums
AFTER DELETE ON tracks
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM tracks WHERE album = OLD.album LIMIT 1
)
BEGIN
  DELETE FROM albums WHERE id = OLD.album;
END;

CREATE TRIGGER IF NOT EXISTS cascade_albums_attribution
AFTER DELETE ON albums
FOR EACH ROW
BEGIN
  DELETE FROM attribution WHERE album = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_attribution_artists
AFTER DELETE ON attribution
FOR EACH ROW
WHEN NOT EXISTS (
  SELECT 1 FROM attribution
    WHERE artist = OLD.artist
)
BEGIN
  DELETE FROM artists WHERE id = OLD.artist;
END;

CREATE TRIGGER IF NOT EXISTS cascade_tracks_resources
AFTER DELETE ON tracks
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_albums_resources
AFTER DELETE ON albums
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
  DELETE FROM assets WHERE owner = OLD.id;
END;

CREATE TRIGGER IF NOT EXISTS cascade_artists_resources
AFTER DELETE ON artists
FOR EACH ROW
BEGIN
  DELETE FROM sources WHERE owner = OLD.id;
  DELETE FROM assets WHERE owner = OLD.id;
END;
`,__vite_glob_0_1=`CREATE VIRTUAL TABLE IF NOT EXISTS tracks_fts USING fts5 (
  title,
  album,
  artists,
  content='',
  tokenize='trigram'
);

CREATE VIRTUAL TABLE IF NOT EXISTS albums_fts USING fts5 (
  title,
  artists,
  content='',
  tokenize='trigram'
);

CREATE VIRTUAL TABLE IF NOT EXISTS artists_fts USING fts5 (
  title,
  content='',
  tokenize='trigram'
);

---------------------------- Artists Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_artists_insert AFTER INSERT ON artists BEGIN
  -- Update artists index
  INSERT INTO artists_fts(rowid,title) VALUES (NEW.id, NEW.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title,
      CASE WHEN EXISTS (SELECT 1 FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id) THEN albums.title ELSE NULL END,
      (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.id)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS fts_artists_update AFTER UPDATE OF title ON artists WHEN (OLD.title IS NOT NEW.title) BEGIN
  -- Update artists index
  INSERT INTO artists_fts(artists_fts,rowid,title) VALUES ('delete', OLD.id, OLD.title);
  INSERT INTO artists_fts(rowid,title) VALUES (NEW.id, NEW.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(CASE WHEN artists.id = OLD.id THEN OLD.title ELSE title END) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = OLD.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(CASE WHEN artists.id = OLD.id THEN OLD.title ELSE title END) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = OLD.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS fts_artists_delete BEFORE DELETE ON artists BEGIN
  -- Update artists index
  INSERT INTO artists_fts(artists_fts,rowid,title) VALUES ('delete', OLD.id, OLD.title);
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.artist = OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.artist = OLD.id;
END;

---------------------------- Albums Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_albums_insert AFTER INSERT ON albums BEGIN
  -- Update albums index
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT NEW.id, NEW.title, group_concat(artists.title)
    FROM attribution
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE attribution.album = NEW.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, NULL, NULL
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS albums_fts_update AFTER UPDATE OF title ON albums WHEN (OLD.title IS NOT NEW.title) BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', OLD.id, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
    WHERE attribution.album = OLD.id;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT NEW.id, NEW.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
    WHERE attribution.album = OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = OLD.id;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT tracks.id, tracks.title, NEW.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS albums_fts_delete BEFORE DELETE ON albums BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', OLD.id, OLD.title, group_concat(artists.title)
    FROM attribution
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE attribution.album = OLD.id
    GROUP BY OLD.id;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, OLD.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN tracks ON tracks.album = attribution.album
    WHERE attribution.album = OLD.id;
END;

---------------------------- Attribution Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_attribution_insert AFTER INSERT ON attribution
  WHEN EXISTS (SELECT 1 FROM artists WHERE id = NEW.artist) AND EXISTS (SELECT 1 FROM albums WHERE id = NEW.album)
BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist AND artists.id != NEW.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  INSERT INTO albums_fts(rowid,title,artists)
    SELECT albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, NULL, NULL
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT  tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = NEW.album AND attribution.artist = NEW.artist;
END;

CREATE TRIGGER IF NOT EXISTS fts_attribution_delete BEFORE DELETE ON attribution BEGIN
  -- Update albums index
  INSERT INTO albums_fts(albums_fts,rowid,title,artists)
    SELECT 'delete', albums.id, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
    WHERE attribution.album = OLD.album AND attribution.artist = OLD.artist;
  -- Update tracks index
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', tracks.id, tracks.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM attribution
      INNER JOIN albums ON albums.id = attribution.album
      INNER JOIN tracks ON tracks.album = albums.id
    WHERE attribution.album = OLD.album AND attribution.artist = OLD.artist;
END;

---------------------------- Tracks Triggers ----------------------------
CREATE TRIGGER IF NOT EXISTS fts_tracks_insert AFTER INSERT ON tracks BEGIN
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT NEW.id, NEW.title, albums.title, group_concat(artists.title)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE albums.id = NEW.album;
END;

CREATE TRIGGER IF NOT EXISTS fts_tracks_update AFTER UPDATE OF title ON tracks WHEN (OLD.title IS NOT NEW.title) BEGIN
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', OLD.id, OLD.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
    WHERE albums.id = OLD.album;
  INSERT INTO tracks_fts(rowid,title,album,artists)
    SELECT NEW.id, NEW.title, albums.title, (SELECT group_concat(title) FROM artists WHERE artists.id = attribution.artist)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
    WHERE albums.id = NEW.album;
END;

CREATE TRIGGER IF NOT EXISTS fts_tracks_delete BEFORE DELETE ON tracks BEGIN
  INSERT INTO tracks_fts(tracks_fts,rowid,title,album,artists)
    SELECT 'delete', OLD.id, OLD.title, albums.title, group_concat(artists.title)
    FROM albums
      INNER JOIN attribution ON attribution.album = albums.id
      INNER JOIN artists ON artists.id = attribution.artist
    WHERE albums.id = OLD.album
    GROUP BY OLD.id;
END;`,__vite_glob_0_2=`INSERT OR IGNORE INTO devices VALUES (crsql_site_id(), -1, 0, 0, 0, 0);

CREATE VIEW IF NOT EXISTS queue AS
  WITH ordered AS
    (SELECT playback.*, row_number() OVER (
      ORDER BY
        CASE WHEN "direction" != 1 THEN "order" ELSE NULL END ASC,
        CASE WHEN "direction" = 1 THEN "order" ELSE NULL END DESC,
        CASE WHEN "direction" != 1 THEN "playback"."id" ELSE NULL END ASC,
        CASE WHEN "direction" = 1 THEN "playback"."id" ELSE NULL END DESC
    ) as position FROM devices INNER JOIN playback ON playback.device = devices.id
    WHERE devices.id = crsql_site_id())
  SELECT id, device, track, 
    (position - 
      (SELECT position FROM ordered WHERE id = (SELECT playback FROM devices WHERE id = device))
    ) as position
  FROM ordered;

CREATE TRIGGER IF NOT EXISTS playback_started
BEFORE INSERT ON playback
FOR EACH ROW
WHEN NEW.device = crsql_site_id()
BEGIN
  UPDATE devices SET playback = NEW.id WHERE id = NEW.device AND playback IS -1;
END;

CREATE TRIGGER IF NOT EXISTS playback_finised
BEFORE UPDATE OF progress ON devices
FOR EACH ROW
WHEN NEW.progress >= 1 AND NEW.id = crsql_site_id()
BEGIN
  INSERT INTO library SELECT ABS(RANDOM() % 4294967296), -1, track, UNIXEPOCH(), -1 FROM playback WHERE id = NEW.playback;
  UPDATE devices SET 
    playback = CASE WHEN NEW.repeat = 2 AND NOT EXISTS (SELECT 1 FROM queue WHERE position > 0)
      THEN IFNULL((SELECT id FROM queue LIMIT 1), playback)
      WHEN NEW.repeat = 1 THEN playback
      ELSE IFNULL((SELECT id FROM queue WHERE position = 1), playback)
    END,
    progress = 0
  WHERE id = NEW.id;
  SELECT RAISE(IGNORE);
END;

CREATE TRIGGER IF NOT EXISTS playback_backtracked
BEFORE UPDATE OF progress ON devices
FOR EACH ROW
WHEN NEW.progress < 0 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE devices SET 
    playback = IFNULL((SELECT id FROM queue WHERE position = -1), playback),
    progress = 0
  WHERE id = NEW.id;
  SELECT RAISE(IGNORE);
END;

CREATE TRIGGER IF NOT EXISTS playback_shuffled
AFTER UPDATE OF direction ON devices
FOR EACH ROW
WHEN NEW.direction = 2 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE playback SET "temp"="order" WHERE
    (SELECT id FROM queue WHERE position = 0) != id AND device = NEW.id;
  UPDATE playback SET
    "order"=(SELECT "order" FROM playback WHERE "temp" IS NULL)||trim(hex(randomblob(2)),'0')
  WHERE "temp" IS NOT NULL;
END;

CREATE TRIGGER IF NOT EXISTS playback_unshuffled
AFTER UPDATE OF direction ON devices
FOR EACH ROW
WHEN OLD.direction = 2 AND NEW.direction != 2 AND NEW.id = crsql_site_id()
BEGIN
  UPDATE playback SET
    "order"="temp",
    "temp"=NULL
  WHERE "temp" IS NOT NULL AND device = NEW.id;
END;

CREATE TRIGGER IF NOT EXISTS playback_purged
BEFORE DELETE ON playback
FOR EACH ROW
WHEN (OLD.id = (SELECT playback FROM devices WHERE id = crsql_site_id()))
BEGIN
  UPDATE devices SET 
    playback = (SELECT id FROM queue WHERE position = 1),
    progress = 0
  WHERE id = OLD.device;
END;`,__vite_glob_0_3=`INSERT OR IGNORE INTO playlists (id, title, "order", relevancy, shared, remote) VALUES
  (-1, 'Listened', 1, 0, NULL, NULL),
  (-2, 'Recommended', 1, -1, NULL, NULL),
  (-3, 'Blocked', 1, -1, NULL, NULL),
  (-4, 'Followed', 1, 0, NULL, NULL);`;function isUndefined(r){return typeof r>"u"||r===void 0}function isString(r){return typeof r=="string"}function isNumber(r){return typeof r=="number"}function isBoolean(r){return typeof r=="boolean"}function isNull(r){return r===null}function isDate(r){return r instanceof Date}function isBigInt(r){return typeof r=="bigint"}function isFunction(r){return typeof r=="function"}function isObject$2(r){return typeof r=="object"&&r!==null}function freeze(r){return Object.freeze(r)}function asArray(r){return isReadonlyArray(r)?r:[r]}function isReadonlyArray(r){return Array.isArray(r)}function noop$1(r){return r}const AlterTableNode=freeze({is(r){return r.kind==="AlterTableNode"},create(r){return freeze({kind:"AlterTableNode",table:r})},cloneWithTableProps(r,e){return freeze({...r,...e})},cloneWithColumnAlteration(r,e){return freeze({...r,columnAlterations:r.columnAlterations?[...r.columnAlterations,e]:[e]})}}),IdentifierNode=freeze({is(r){return r.kind==="IdentifierNode"},create(r){return freeze({kind:"IdentifierNode",name:r})}}),CreateIndexNode=freeze({is(r){return r.kind==="CreateIndexNode"},create(r){return freeze({kind:"CreateIndexNode",name:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})},cloneWithColumns(r,e){return freeze({...r,columns:[...r.columns||[],...e]})}}),CreateSchemaNode=freeze({is(r){return r.kind==="CreateSchemaNode"},create(r,e){return freeze({kind:"CreateSchemaNode",schema:IdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),ON_COMMIT_ACTIONS=["preserve rows","delete rows","drop"],CreateTableNode=freeze({is(r){return r.kind==="CreateTableNode"},create(r){return freeze({kind:"CreateTableNode",table:r,columns:freeze([])})},cloneWithColumn(r,e){return freeze({...r,columns:freeze([...r.columns,e])})},cloneWithConstraint(r,e){return freeze({...r,constraints:r.constraints?freeze([...r.constraints,e]):freeze([e])})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):freeze([e])})},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):freeze([e])})},cloneWith(r,e){return freeze({...r,...e})}}),SchemableIdentifierNode=freeze({is(r){return r.kind==="SchemableIdentifierNode"},create(r){return freeze({kind:"SchemableIdentifierNode",identifier:IdentifierNode.create(r)})},createWithSchema(r,e){return freeze({kind:"SchemableIdentifierNode",schema:IdentifierNode.create(r),identifier:IdentifierNode.create(e)})}}),DropIndexNode=freeze({is(r){return r.kind==="DropIndexNode"},create(r,e){return freeze({kind:"DropIndexNode",name:SchemableIdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),DropSchemaNode=freeze({is(r){return r.kind==="DropSchemaNode"},create(r,e){return freeze({kind:"DropSchemaNode",schema:IdentifierNode.create(r),...e})},cloneWith(r,e){return freeze({...r,...e})}}),DropTableNode=freeze({is(r){return r.kind==="DropTableNode"},create(r,e){return freeze({kind:"DropTableNode",table:r,...e})},cloneWith(r,e){return freeze({...r,...e})}}),AliasNode=freeze({is(r){return r.kind==="AliasNode"},create(r,e){return freeze({kind:"AliasNode",node:r,alias:e})}}),TableNode=freeze({is(r){return r.kind==="TableNode"},create(r){return freeze({kind:"TableNode",table:SchemableIdentifierNode.create(r)})},createWithSchema(r,e){return freeze({kind:"TableNode",table:SchemableIdentifierNode.createWithSchema(r,e)})}});function isOperationNodeSource(r){return isObject$2(r)&&isFunction(r.toOperationNode)}function isExpression(r){return isObject$2(r)&&"expressionType"in r&&isOperationNodeSource(r)}function isAliasedExpression(r){return isObject$2(r)&&"expression"in r&&isString(r.alias)&&isOperationNodeSource(r)}const SelectModifierNode=freeze({is(r){return r.kind==="SelectModifierNode"},create(r,e){return freeze({kind:"SelectModifierNode",modifier:r,of:e})},createWithExpression(r){return freeze({kind:"SelectModifierNode",rawModifier:r})}}),AndNode=freeze({is(r){return r.kind==="AndNode"},create(r,e){return freeze({kind:"AndNode",left:r,right:e})}}),OrNode=freeze({is(r){return r.kind==="OrNode"},create(r,e){return freeze({kind:"OrNode",left:r,right:e})}}),OnNode=freeze({is(r){return r.kind==="OnNode"},create(r){return freeze({kind:"OnNode",on:r})},cloneWithOperation(r,e,t){return freeze({...r,on:e==="And"?AndNode.create(r.on,t):OrNode.create(r.on,t)})}}),JoinNode=freeze({is(r){return r.kind==="JoinNode"},create(r,e){return freeze({kind:"JoinNode",joinType:r,table:e,on:void 0})},createWithOn(r,e,t){return freeze({kind:"JoinNode",joinType:r,table:e,on:OnNode.create(t)})},cloneWithOn(r,e){return freeze({...r,on:r.on?OnNode.cloneWithOperation(r.on,"And",e):OnNode.create(e)})}}),BinaryOperationNode=freeze({is(r){return r.kind==="BinaryOperationNode"},create(r,e,t){return freeze({kind:"BinaryOperationNode",leftOperand:r,operator:e,rightOperand:t})}}),COMPARISON_OPERATORS=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],ARITHMETIC_OPERATORS=["+","-","*","/","%","^","&","|","#","<<",">>"],JSON_OPERATORS=["->","->>"],BINARY_OPERATORS=[...COMPARISON_OPERATORS,...ARITHMETIC_OPERATORS,"&&","||"],UNARY_FILTER_OPERATORS=["exists","not exists"],UNARY_OPERATORS=["not","-",...UNARY_FILTER_OPERATORS],OPERATORS=[...BINARY_OPERATORS,...JSON_OPERATORS,...UNARY_OPERATORS,"between","between symmetric"],OperatorNode=freeze({is(r){return r.kind==="OperatorNode"},create(r){return freeze({kind:"OperatorNode",operator:r})}});function isJSONOperator(r){return isString(r)&&JSON_OPERATORS.includes(r)}const ColumnNode=freeze({is(r){return r.kind==="ColumnNode"},create(r){return freeze({kind:"ColumnNode",column:IdentifierNode.create(r)})}}),SelectAllNode=freeze({is(r){return r.kind==="SelectAllNode"},create(){return freeze({kind:"SelectAllNode"})}}),ReferenceNode=freeze({is(r){return r.kind==="ReferenceNode"},create(r,e){return freeze({kind:"ReferenceNode",table:e,column:r})},createSelectAll(r){return freeze({kind:"ReferenceNode",table:r,column:SelectAllNode.create()})}});var Wr;class DynamicReferenceBuilder{constructor(e){g(this,Wr,void 0);x(this,Wr,e)}get dynamicReference(){return i(this,Wr)}get refType(){}toOperationNode(){return parseSimpleReferenceExpression(i(this,Wr))}}Wr=new WeakMap;function isDynamicReferenceBuilder(r){return isObject$2(r)&&isOperationNodeSource(r)&&isString(r.dynamicReference)}const OrderByItemNode=freeze({is(r){return r.kind==="OrderByItemNode"},create(r,e){return freeze({kind:"OrderByItemNode",orderBy:r,direction:e})}}),RawNode=freeze({is(r){return r.kind==="RawNode"},create(r,e){return freeze({kind:"RawNode",sqlFragments:freeze(r),parameters:freeze(e)})},createWithSql(r){return RawNode.create([r],[])},createWithChild(r){return RawNode.create(["",""],[r])},createWithChildren(r){return RawNode.create(new Array(r.length+1).fill(""),r)}});function isOrderByDirection(r){return r==="asc"||r==="desc"}function parseOrderBy(r){if(r.length===2)return[parseOrderByItem(r[0],r[1])];if(r.length===1){const[e]=r;return Array.isArray(e)?e.map(t=>parseOrderByItem(t)):[parseOrderByItem(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${r.length}`)}function parseOrderByItem(r,e){const t=parseOrderByExpression(r);if(OrderByItemNode.is(t)){if(e)throw new Error("Cannot specify direction twice!");return t}return OrderByItemNode.create(t,parseOrderByDirectionExpression(e))}function parseOrderByExpression(r){if(isExpressionOrFactory(r))return parseExpression(r);if(isDynamicReferenceBuilder(r))return r.toOperationNode();const[e,t]=r.split(" ");if(t){if(!isOrderByDirection(t))throw new Error(`Invalid order by direction: ${t}`);return OrderByItemNode.create(parseStringReference(e),parseOrderByDirectionExpression(t))}return parseStringReference(r)}function parseOrderByDirectionExpression(r){if(r)return r==="asc"||r==="desc"?RawNode.createWithSql(r):r.toOperationNode()}const JSONReferenceNode=freeze({is(r){return r.kind==="JSONReferenceNode"},create(r,e){return freeze({kind:"JSONReferenceNode",reference:r,traversal:e})},cloneWithTraversal(r,e){return freeze({...r,traversal:e})}}),JSONOperatorChainNode=freeze({is(r){return r.kind==="JSONOperatorChainNode"},create(r){return freeze({kind:"JSONOperatorChainNode",operator:r,values:freeze([])})},cloneWithValue(r,e){return freeze({...r,values:freeze([...r.values,e])})}}),JSONPathNode=freeze({is(r){return r.kind==="JSONPathNode"},create(r){return freeze({kind:"JSONPathNode",inOperator:r,pathLegs:freeze([])})},cloneWithLeg(r,e){return freeze({...r,pathLegs:freeze([...r.pathLegs,e])})}});function parseSimpleReferenceExpression(r){return isString(r)?parseStringReference(r):r.toOperationNode()}function parseReferenceExpressionOrList(r){return isReadonlyArray(r)?r.map(e=>parseReferenceExpression(e)):[parseReferenceExpression(r)]}function parseReferenceExpression(r){return isExpressionOrFactory(r)?parseExpression(r):parseSimpleReferenceExpression(r)}function parseJSONReference(r,e){const t=parseStringReference(r);if(isJSONOperator(e))return JSONReferenceNode.create(t,JSONOperatorChainNode.create(OperatorNode.create(e)));const n=e.slice(0,-1);if(isJSONOperator(n))return JSONReferenceNode.create(t,JSONPathNode.create(OperatorNode.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function parseStringReference(r){const e=".";if(!r.includes(e))return ReferenceNode.create(ColumnNode.create(r));const t=r.split(e).map(trim$2);if(t.length===3)return parseStringReferenceWithTableAndSchema(t);if(t.length===2)return parseStringReferenceWithTable(t);throw new Error(`invalid column reference ${r}`)}function parseAliasedStringReference(r){const e=" as ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$2);return AliasNode.create(parseStringReference(t),IdentifierNode.create(n))}else return parseStringReference(r)}function parseColumnName(r){return ColumnNode.create(r)}function parseOrderedColumnName(r){const e=" ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$2);if(!isOrderByDirection(n))throw new Error(`invalid order direction "${n}" next to "${t}"`);return parseOrderBy([t,n])[0]}else return parseColumnName(r)}function parseStringReferenceWithTableAndSchema(r){const[e,t,n]=r;return ReferenceNode.create(ColumnNode.create(n),TableNode.createWithSchema(e,t))}function parseStringReferenceWithTable(r){const[e,t]=r;return ReferenceNode.create(ColumnNode.create(t),TableNode.create(e))}function trim$2(r){return r.trim()}const PrimitiveValueListNode=freeze({is(r){return r.kind==="PrimitiveValueListNode"},create(r){return freeze({kind:"PrimitiveValueListNode",values:freeze([...r])})}}),ValueListNode=freeze({is(r){return r.kind==="ValueListNode"},create(r){return freeze({kind:"ValueListNode",values:freeze(r)})}}),ValueNode=freeze({is(r){return r.kind==="ValueNode"},create(r){return freeze({kind:"ValueNode",value:r})},createImmediate(r){return freeze({kind:"ValueNode",value:r,immediate:!0})}});function parseValueExpressionOrList(r){return isReadonlyArray(r)?parseValueExpressionList(r):parseValueExpression(r)}function parseValueExpression(r){return isExpressionOrFactory(r)?parseExpression(r):ValueNode.create(r)}function isSafeImmediateValue(r){return isNumber(r)||isBoolean(r)||isNull(r)}function parseSafeImmediateValue(r){if(!isSafeImmediateValue(r))throw new Error(`unsafe immediate value ${JSON.stringify(r)}`);return ValueNode.createImmediate(r)}function parseValueExpressionList(r){return r.some(isExpressionOrFactory)?ValueListNode.create(r.map(e=>parseValueExpression(e))):PrimitiveValueListNode.create(r)}const ParensNode=freeze({is(r){return r.kind==="ParensNode"},create(r){return freeze({kind:"ParensNode",node:r})}});function parseValueBinaryOperationOrExpression(r){if(r.length===3)return parseValueBinaryOperation(r[0],r[1],r[2]);if(r.length===1)return parseValueExpression(r[0]);throw new Error(`invalid arguments: ${JSON.stringify(r)}`)}function parseValueBinaryOperation(r,e,t){return isIsOperator(e)&&needsIsOperator(t)?BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),ValueNode.createImmediate(t)):BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),parseValueExpressionOrList(t))}function parseReferentialBinaryOperation(r,e,t){return BinaryOperationNode.create(parseReferenceExpression(r),parseOperator(e),parseReferenceExpression(t))}function parseFilterObject(r,e){return parseFilterList(Object.entries(r).filter(([,t])=>!isUndefined(t)).map(([t,n])=>parseValueBinaryOperation(t,needsIsOperator(n)?"is":"=",n)),e)}function parseFilterList(r,e){const t=e==="and"?AndNode.create:OrNode.create;if(r.length===0)return BinaryOperationNode.create(ValueNode.createImmediate(1),OperatorNode.create("="),ValueNode.createImmediate(e==="and"?1:0));let n=toOperationNode(r[0]);for(let o=1;o<r.length;++o)n=t(n,toOperationNode(r[o]));return r.length>1?ParensNode.create(n):n}function isIsOperator(r){return r==="is"||r==="is not"}function needsIsOperator(r){return isNull(r)||isBoolean(r)}function parseOperator(r){if(isString(r)&&OPERATORS.includes(r))return OperatorNode.create(r);if(isOperationNodeSource(r))return r.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(r)}`)}function toOperationNode(r){return isOperationNodeSource(r)?r.toOperationNode():r}const OrderByNode=freeze({is(r){return r.kind==="OrderByNode"},create(r){return freeze({kind:"OrderByNode",items:freeze([...r])})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),PartitionByNode=freeze({is(r){return r.kind==="PartitionByNode"},create(r){return freeze({kind:"PartitionByNode",items:freeze(r)})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),OverNode=freeze({is(r){return r.kind==="OverNode"},create(){return freeze({kind:"OverNode"})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithPartitionByItems(r,e){return freeze({...r,partitionBy:r.partitionBy?PartitionByNode.cloneWithItems(r.partitionBy,e):PartitionByNode.create(e)})}}),FromNode=freeze({is(r){return r.kind==="FromNode"},create(r){return freeze({kind:"FromNode",froms:freeze(r)})},cloneWithFroms(r,e){return freeze({...r,froms:freeze([...r.froms,...e])})}}),GroupByNode=freeze({is(r){return r.kind==="GroupByNode"},create(r){return freeze({kind:"GroupByNode",items:freeze(r)})},cloneWithItems(r,e){return freeze({...r,items:freeze([...r.items,...e])})}}),HavingNode=freeze({is(r){return r.kind==="HavingNode"},create(r){return freeze({kind:"HavingNode",having:r})},cloneWithOperation(r,e,t){return freeze({...r,having:e==="And"?AndNode.create(r.having,t):OrNode.create(r.having,t)})}}),SelectQueryNode=freeze({is(r){return r.kind==="SelectQueryNode"},create(r){return freeze({kind:"SelectQueryNode",...r&&{with:r}})},createFrom(r,e){return freeze({kind:"SelectQueryNode",from:FromNode.create(r),...e&&{with:e}})},cloneWithSelections(r,e){return freeze({...r,selections:r.selections?freeze([...r.selections,...e]):freeze(e)})},cloneWithDistinctOn(r,e){return freeze({...r,distinctOn:r.distinctOn?freeze([...r.distinctOn,...e]):freeze(e)})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):freeze([e])})},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):freeze([e])})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithGroupByItems(r,e){return freeze({...r,groupBy:r.groupBy?GroupByNode.cloneWithItems(r.groupBy,e):GroupByNode.create(e)})},cloneWithLimit(r,e){return freeze({...r,limit:e})},cloneWithOffset(r,e){return freeze({...r,offset:e})},cloneWithHaving(r,e){return freeze({...r,having:r.having?HavingNode.cloneWithOperation(r.having,"And",e):HavingNode.create(e)})},cloneWithSetOperations(r,e){return freeze({...r,setOperations:r.setOperations?freeze([...r.setOperations,...e]):freeze([...e])})},cloneWithoutSelections(r){return freeze({...r,selections:[]})},cloneWithoutLimit(r){return freeze({...r,limit:void 0})},cloneWithoutOffset(r){return freeze({...r,offset:void 0})},cloneWithoutOrderBy(r){return freeze({...r,orderBy:void 0})}});function preventAwait(r,e){Object.defineProperties(r.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var yt;const Nn=class Nn{constructor(e){g(this,yt,void 0);x(this,yt,freeze(e))}on(...e){return new Nn({...i(this,yt),joinNode:JoinNode.cloneWithOn(i(this,yt).joinNode,parseValueBinaryOperationOrExpression(e))})}onRef(e,t,n){return new Nn({...i(this,yt),joinNode:JoinNode.cloneWithOn(i(this,yt).joinNode,parseReferentialBinaryOperation(e,t,n))})}onTrue(){return new Nn({...i(this,yt),joinNode:JoinNode.cloneWithOn(i(this,yt).joinNode,RawNode.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return i(this,yt).joinNode}};yt=new WeakMap;let JoinBuilder=Nn;preventAwait(JoinBuilder,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const PartitionByItemNode=freeze({is(r){return r.kind==="PartitionByItemNode"},create(r){return freeze({kind:"PartitionByItemNode",partitionBy:r})}});function parsePartitionBy(r){return parseReferenceExpressionOrList(r).map(PartitionByItemNode.create)}var ur;const si=class si{constructor(e){g(this,ur,void 0);x(this,ur,freeze(e))}orderBy(e,t){return new si({overNode:OverNode.cloneWithOrderByItems(i(this,ur).overNode,parseOrderBy([e,t]))})}partitionBy(e){return new si({overNode:OverNode.cloneWithPartitionByItems(i(this,ur).overNode,parsePartitionBy(e))})}$call(e){return e(this)}toOperationNode(){return i(this,ur).overNode}};ur=new WeakMap;let OverBuilder=si;preventAwait(OverBuilder,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const SelectionNode=freeze({is(r){return r.kind==="SelectionNode"},create(r){return freeze({kind:"SelectionNode",selection:r})},createSelectAll(){return freeze({kind:"SelectionNode",selection:SelectAllNode.create()})},createSelectAllFromTable(r){return freeze({kind:"SelectionNode",selection:ReferenceNode.createSelectAll(r)})}});function parseSelectArg(r){return isFunction(r)?parseSelectArg(r(expressionBuilder())):isReadonlyArray(r)?r.map(e=>parseSelectExpression(e)):[parseSelectExpression(r)]}function parseSelectExpression(r){return isString(r)?SelectionNode.create(parseAliasedStringReference(r)):isDynamicReferenceBuilder(r)?SelectionNode.create(r.toOperationNode()):SelectionNode.create(parseAliasedExpression(r))}function parseSelectAll(r){return r?Array.isArray(r)?r.map(parseSelectAllArg):[parseSelectAllArg(r)]:[SelectionNode.createSelectAll()]}function parseSelectAllArg(r){if(isString(r))return SelectionNode.createSelectAllFromTable(parseTable(r));throw new Error(`invalid value selectAll expression: ${JSON.stringify(r)}`)}const ValuesNode=freeze({is(r){return r.kind==="ValuesNode"},create(r){return freeze({kind:"ValuesNode",values:freeze(r)})}}),DefaultInsertValueNode=freeze({is(r){return r.kind==="DefaultInsertValueNode"},create(){return freeze({kind:"DefaultInsertValueNode"})}});function parseInsertExpression(r){const e=isFunction(r)?r(expressionBuilder()):r,t=isReadonlyArray(e)?e:freeze([e]);return parseInsertColumnsAndValues(t)}function parseInsertColumnsAndValues(r){const e=parseColumnNamesAndIndexes(r);return[freeze([...e.keys()].map(ColumnNode.create)),ValuesNode.create(r.map(t=>parseRowValues(t,e)))]}function parseColumnNamesAndIndexes(r){const e=new Map;for(const t of r){const n=Object.keys(t);for(const o of n)!e.has(o)&&t[o]!==void 0&&e.set(o,e.size)}return e}function parseRowValues(r,e){const t=Object.keys(r),n=Array.from({length:e.size});let o=!1;for(const c of t){const f=e.get(c);if(isUndefined(f))continue;const h=r[c];(isUndefined(h)||isExpressionOrFactory(h))&&(o=!0),n[f]=h}if(t.length<e.size||o){const c=DefaultInsertValueNode.create();return ValueListNode.create(n.map(f=>isUndefined(f)?c:parseValueExpression(f)))}return PrimitiveValueListNode.create(n)}const InsertQueryNode=freeze({is(r){return r.kind==="InsertQueryNode"},create(r,e,t){return freeze({kind:"InsertQueryNode",into:r,...e&&{with:e},replace:t})},cloneWith(r,e){return freeze({...r,...e})}}),UpdateQueryNode=freeze({is(r){return r.kind==="UpdateQueryNode"},create(r,e){return freeze({kind:"UpdateQueryNode",table:r,...e&&{with:e}})},cloneWithFromItems(r,e){return freeze({...r,from:r.from?FromNode.cloneWithFroms(r.from,e):FromNode.create(e)})},cloneWithUpdates(r,e){return freeze({...r,updates:r.updates?freeze([...r.updates,...e]):e})}}),UsingNode=freeze({is(r){return r.kind==="UsingNode"},create(r){return freeze({kind:"UsingNode",tables:freeze(r)})},cloneWithTables(r,e){return freeze({...r,tables:freeze([...r.tables,...e])})}}),DeleteQueryNode=freeze({is(r){return r.kind==="DeleteQueryNode"},create(r,e){return freeze({kind:"DeleteQueryNode",from:FromNode.create(r),...e&&{with:e}})},cloneWithOrderByItems(r,e){return freeze({...r,orderBy:r.orderBy?OrderByNode.cloneWithItems(r.orderBy,e):OrderByNode.create(e)})},cloneWithLimit(r,e){return freeze({...r,limit:e})},cloneWithUsing(r,e){return freeze({...r,using:r.using!==void 0?UsingNode.cloneWithTables(r.using,e):UsingNode.create(e)})}}),WhereNode=freeze({is(r){return r.kind==="WhereNode"},create(r){return freeze({kind:"WhereNode",where:r})},cloneWithOperation(r,e,t){return freeze({...r,where:e==="And"?AndNode.create(r.where,t):OrNode.create(r.where,t)})}}),ReturningNode=freeze({is(r){return r.kind==="ReturningNode"},create(r){return freeze({kind:"ReturningNode",selections:freeze(r)})},cloneWithSelections(r,e){return freeze({...r,selections:r.selections?freeze([...r.selections,...e]):freeze(e)})}}),ExplainNode=freeze({is(r){return r.kind==="ExplainNode"},create(r,e){return freeze({kind:"ExplainNode",format:r,options:e})}}),QueryNode=freeze({is(r){return SelectQueryNode.is(r)||InsertQueryNode.is(r)||UpdateQueryNode.is(r)||DeleteQueryNode.is(r)},cloneWithWhere(r,e){return freeze({...r,where:r.where?WhereNode.cloneWithOperation(r.where,"And",e):WhereNode.create(e)})},cloneWithJoin(r,e){return freeze({...r,joins:r.joins?freeze([...r.joins,e]):freeze([e])})},cloneWithReturning(r,e){return freeze({...r,returning:r.returning?ReturningNode.cloneWithSelections(r.returning,e):ReturningNode.create(e)})},cloneWithoutWhere(r){return freeze({...r,where:void 0})},cloneWithExplain(r,e,t){return freeze({...r,explain:ExplainNode.create(e,t==null?void 0:t.toOperationNode())})}}),ColumnUpdateNode=freeze({is(r){return r.kind==="ColumnUpdateNode"},create(r,e){return freeze({kind:"ColumnUpdateNode",column:r,value:e})}});function parseUpdate(...r){return r.length===2?[ColumnUpdateNode.create(parseReferenceExpression(r[0]),parseValueExpression(r[1]))]:parseUpdateObjectExpression(r[0])}function parseUpdateObjectExpression(r){const e=isFunction(r)?r(expressionBuilder()):r;return Object.entries(e).filter(([t,n])=>n!==void 0).map(([t,n])=>ColumnUpdateNode.create(ColumnNode.create(t),parseValueExpression(n)))}const OnDuplicateKeyNode=freeze({is(r){return r.kind==="OnDuplicateKeyNode"},create(r){return freeze({kind:"OnDuplicateKeyNode",updates:r})}});class InsertResult{constructor(e,t){le(this,"insertId");le(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=t}}class NoResultError extends Error{constructor(t){super("no result");le(this,"node");this.node=t}}function isNoResultErrorConstructor(r){return Object.prototype.hasOwnProperty.call(r,"prototype")}const OnConflictNode=freeze({is(r){return r.kind==="OnConflictNode"},create(){return freeze({kind:"OnConflictNode"})},cloneWith(r,e){return freeze({...r,...e})},cloneWithIndexWhere(r,e){return freeze({...r,indexWhere:r.indexWhere?WhereNode.cloneWithOperation(r.indexWhere,"And",e):WhereNode.create(e)})},cloneWithIndexOrWhere(r,e){return freeze({...r,indexWhere:r.indexWhere?WhereNode.cloneWithOperation(r.indexWhere,"Or",e):WhereNode.create(e)})},cloneWithUpdateWhere(r,e){return freeze({...r,updateWhere:r.updateWhere?WhereNode.cloneWithOperation(r.updateWhere,"And",e):WhereNode.create(e)})},cloneWithUpdateOrWhere(r,e){return freeze({...r,updateWhere:r.updateWhere?WhereNode.cloneWithOperation(r.updateWhere,"Or",e):WhereNode.create(e)})},cloneWithoutIndexWhere(r){return freeze({...r,indexWhere:void 0})},cloneWithoutUpdateWhere(r){return freeze({...r,updateWhere:void 0})}});var ge;const At=class At{constructor(e){g(this,ge,void 0);x(this,ge,freeze(e))}column(e){const t=ColumnNode.create(e);return new At({...i(this,ge),onConflictNode:OnConflictNode.cloneWith(i(this,ge).onConflictNode,{columns:i(this,ge).onConflictNode.columns?freeze([...i(this,ge).onConflictNode.columns,t]):freeze([t])})})}columns(e){const t=e.map(ColumnNode.create);return new At({...i(this,ge),onConflictNode:OnConflictNode.cloneWith(i(this,ge).onConflictNode,{columns:i(this,ge).onConflictNode.columns?freeze([...i(this,ge).onConflictNode.columns,...t]):freeze(t)})})}constraint(e){return new At({...i(this,ge),onConflictNode:OnConflictNode.cloneWith(i(this,ge).onConflictNode,{constraint:IdentifierNode.create(e)})})}expression(e){return new At({...i(this,ge),onConflictNode:OnConflictNode.cloneWith(i(this,ge).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new At({...i(this,ge),onConflictNode:OnConflictNode.cloneWithIndexWhere(i(this,ge).onConflictNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new At({...i(this,ge),onConflictNode:OnConflictNode.cloneWithIndexWhere(i(this,ge).onConflictNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new At({...i(this,ge),onConflictNode:OnConflictNode.cloneWithoutIndexWhere(i(this,ge).onConflictNode)})}doNothing(){return new OnConflictDoNothingBuilder({...i(this,ge),onConflictNode:OnConflictNode.cloneWith(i(this,ge).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new OnConflictUpdateBuilder({...i(this,ge),onConflictNode:OnConflictNode.cloneWith(i(this,ge).onConflictNode,{updates:parseUpdateObjectExpression(e)})})}$call(e){return e(this)}};ge=new WeakMap;let OnConflictBuilder=At;preventAwait(OnConflictBuilder,"don't await OnConflictBuilder instances.");var On;class OnConflictDoNothingBuilder{constructor(e){g(this,On,void 0);x(this,On,freeze(e))}toOperationNode(){return i(this,On).onConflictNode}}On=new WeakMap;preventAwait(OnConflictDoNothingBuilder,"don't await OnConflictDoNothingBuilder instances.");var bt;const yn=class yn{constructor(e){g(this,bt,void 0);x(this,bt,freeze(e))}where(...e){return new yn({...i(this,bt),onConflictNode:OnConflictNode.cloneWithUpdateWhere(i(this,bt).onConflictNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new yn({...i(this,bt),onConflictNode:OnConflictNode.cloneWithUpdateWhere(i(this,bt).onConflictNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new yn({...i(this,bt),onConflictNode:OnConflictNode.cloneWithoutUpdateWhere(i(this,bt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return i(this,bt).onConflictNode}};bt=new WeakMap;let OnConflictUpdateBuilder=yn;preventAwait(OnConflictUpdateBuilder,"don't await OnConflictUpdateBuilder instances.");var ie;const Ve=class Ve{constructor(e){g(this,ie,void 0);x(this,ie,freeze(e))}values(e){const[t,n]=parseInsertExpression(e);return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{columns:t,values:n})})}columns(e){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{columns:freeze(e.map(ColumnNode.create))})})}expression(e){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{values:parseExpression(e)})})}defaultValues(){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{defaultValues:!0})})}ignore(){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{ignore:!0})})}onConflict(e){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{onConflict:e(new OnConflictBuilder({onConflictNode:OnConflictNode.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Ve({...i(this,ie),queryNode:InsertQueryNode.cloneWith(i(this,ie).queryNode,{onDuplicateKey:OnDuplicateKeyNode.create(parseUpdateObjectExpression(e))})})}returning(e){return new Ve({...i(this,ie),queryNode:QueryNode.cloneWithReturning(i(this,ie).queryNode,parseSelectArg(e))})}returningAll(){return new Ve({...i(this,ie),queryNode:QueryNode.cloneWithReturning(i(this,ie).queryNode,parseSelectAll())})}$call(e){return e(this)}$if(e,t){return e?t(this):new Ve({...i(this,ie)})}$castTo(){return new Ve(i(this,ie))}$narrowType(){return new Ve(i(this,ie))}$assertType(){return new Ve(i(this,ie))}withPlugin(e){return new Ve({...i(this,ie),executor:i(this,ie).executor.withPlugin(e)})}toOperationNode(){return i(this,ie).executor.transformQuery(i(this,ie).queryNode,i(this,ie).queryId)}compile(){return i(this,ie).executor.compileQuery(this.toOperationNode(),i(this,ie).queryId)}async execute(){const e=this.compile(),t=e.query,n=await i(this,ie).executor.executeQuery(e,i(this,ie).queryId);return i(this,ie).executor.adapter.supportsReturning&&t.returning?n.rows:[new InsertResult(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,ie).executor.stream(t,e,i(this,ie).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new Ve({...i(this,ie),queryNode:QueryNode.cloneWithExplain(i(this,ie).queryNode,e,t)}).execute()}};ie=new WeakMap;let InsertQueryBuilder=Ve;preventAwait(InsertQueryBuilder,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class DeleteResult{constructor(e){le(this,"numDeletedRows");this.numDeletedRows=e}}const LimitNode=freeze({is(r){return r.kind==="LimitNode"},create(r){return freeze({kind:"LimitNode",limit:r})}});var K;const qe=class qe{constructor(e){g(this,K,void 0);x(this,K,freeze(e))}where(...e){return new qe({...i(this,K),queryNode:QueryNode.cloneWithWhere(i(this,K).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new qe({...i(this,K),queryNode:QueryNode.cloneWithWhere(i(this,K).queryNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new qe({...i(this,K),queryNode:QueryNode.cloneWithoutWhere(i(this,K).queryNode)})}using(e){return new qe({...i(this,K),queryNode:DeleteQueryNode.cloneWithUsing(i(this,K).queryNode,parseTableExpressionOrList(e))})}innerJoin(...e){return new qe({...i(this,K),queryNode:QueryNode.cloneWithJoin(i(this,K).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new qe({...i(this,K),queryNode:QueryNode.cloneWithJoin(i(this,K).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new qe({...i(this,K),queryNode:QueryNode.cloneWithJoin(i(this,K).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new qe({...i(this,K),queryNode:QueryNode.cloneWithJoin(i(this,K).queryNode,parseJoin("FullJoin",e))})}returning(e){return new qe({...i(this,K),queryNode:QueryNode.cloneWithReturning(i(this,K).queryNode,parseSelectArg(e))})}returningAll(e){return new qe({...i(this,K),queryNode:QueryNode.cloneWithReturning(i(this,K).queryNode,parseSelectAll(e))})}orderBy(e,t){return new qe({...i(this,K),queryNode:DeleteQueryNode.cloneWithOrderByItems(i(this,K).queryNode,parseOrderBy([e,t]))})}limit(e){return new qe({...i(this,K),queryNode:DeleteQueryNode.cloneWithLimit(i(this,K).queryNode,LimitNode.create(parseValueExpression(e)))})}$call(e){return e(this)}$if(e,t){return e?t(this):new qe({...i(this,K)})}$castTo(){return new qe(i(this,K))}$narrowType(){return new qe(i(this,K))}$assertType(){return new qe(i(this,K))}withPlugin(e){return new qe({...i(this,K),executor:i(this,K).executor.withPlugin(e)})}toOperationNode(){return i(this,K).executor.transformQuery(i(this,K).queryNode,i(this,K).queryId)}compile(){return i(this,K).executor.compileQuery(this.toOperationNode(),i(this,K).queryId)}async execute(){const e=this.compile(),t=e.query,n=await i(this,K).executor.executeQuery(e,i(this,K).queryId);return i(this,K).executor.adapter.supportsReturning&&t.returning?n.rows:[new DeleteResult(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,K).executor.stream(t,e,i(this,K).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new qe({...i(this,K),queryNode:QueryNode.cloneWithExplain(i(this,K).queryNode,e,t)}).execute()}};K=new WeakMap;let DeleteQueryBuilder=qe;preventAwait(DeleteQueryBuilder,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class UpdateResult{constructor(e,t){le(this,"numUpdatedRows");le(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=t}}var ee;const We=class We{constructor(e){g(this,ee,void 0);x(this,ee,freeze(e))}where(...e){return new We({...i(this,ee),queryNode:QueryNode.cloneWithWhere(i(this,ee).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new We({...i(this,ee),queryNode:QueryNode.cloneWithWhere(i(this,ee).queryNode,parseReferentialBinaryOperation(e,t,n))})}clearWhere(){return new We({...i(this,ee),queryNode:QueryNode.cloneWithoutWhere(i(this,ee).queryNode)})}from(e){return new We({...i(this,ee),queryNode:UpdateQueryNode.cloneWithFromItems(i(this,ee).queryNode,parseTableExpressionOrList(e))})}innerJoin(...e){return new We({...i(this,ee),queryNode:QueryNode.cloneWithJoin(i(this,ee).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new We({...i(this,ee),queryNode:QueryNode.cloneWithJoin(i(this,ee).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new We({...i(this,ee),queryNode:QueryNode.cloneWithJoin(i(this,ee).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new We({...i(this,ee),queryNode:QueryNode.cloneWithJoin(i(this,ee).queryNode,parseJoin("FullJoin",e))})}set(...e){return new We({...i(this,ee),queryNode:UpdateQueryNode.cloneWithUpdates(i(this,ee).queryNode,parseUpdate(...e))})}returning(e){return new We({...i(this,ee),queryNode:QueryNode.cloneWithReturning(i(this,ee).queryNode,parseSelectArg(e))})}returningAll(){return new We({...i(this,ee),queryNode:QueryNode.cloneWithReturning(i(this,ee).queryNode,parseSelectAll())})}$call(e){return e(this)}$if(e,t){return e?t(this):new We({...i(this,ee)})}$castTo(){return new We(i(this,ee))}$narrowType(){return new We(i(this,ee))}$assertType(){return new We(i(this,ee))}withPlugin(e){return new We({...i(this,ee),executor:i(this,ee).executor.withPlugin(e)})}toOperationNode(){return i(this,ee).executor.transformQuery(i(this,ee).queryNode,i(this,ee).queryId)}compile(){return i(this,ee).executor.compileQuery(this.toOperationNode(),i(this,ee).queryId)}async execute(){const e=this.compile(),t=e.query,n=await i(this,ee).executor.executeQuery(e,i(this,ee).queryId);return i(this,ee).executor.adapter.supportsReturning&&t.returning?n.rows:[new UpdateResult(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,ee).executor.stream(t,e,i(this,ee).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new We({...i(this,ee),queryNode:QueryNode.cloneWithExplain(i(this,ee).queryNode,e,t)}).execute()}};ee=new WeakMap;let UpdateQueryBuilder=We;preventAwait(UpdateQueryBuilder,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const CommonTableExpressionNameNode=freeze({is(r){return r.kind==="CommonTableExpressionNameNode"},create(r,e){return freeze({kind:"CommonTableExpressionNameNode",table:TableNode.create(r),columns:e?freeze(e.map(ColumnNode.create)):void 0})}}),CommonTableExpressionNode=freeze({is(r){return r.kind==="CommonTableExpressionNode"},create(r,e){return freeze({kind:"CommonTableExpressionNode",name:r,expression:e})},cloneWith(r,e){return freeze({...r,...e})}});var kt;const oi=class oi{constructor(e){g(this,kt,void 0);x(this,kt,freeze(e))}materialized(){return new oi({...i(this,kt),node:CommonTableExpressionNode.cloneWith(i(this,kt).node,{materialized:!0})})}notMaterialized(){return new oi({...i(this,kt),node:CommonTableExpressionNode.cloneWith(i(this,kt).node,{materialized:!1})})}toOperationNode(){return i(this,kt).node}};kt=new WeakMap;let CTEBuilder=oi;preventAwait(CTEBuilder,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function parseCommonTableExpression(r,e){const t=e(createQueryCreator()).toOperationNode();return isFunction(r)?r(cteBuilderFactory(t)).toOperationNode():CommonTableExpressionNode.create(parseCommonTableExpressionName(r),t)}function cteBuilderFactory(r){return e=>new CTEBuilder({node:CommonTableExpressionNode.create(parseCommonTableExpressionName(e),r)})}function parseCommonTableExpressionName(r){if(r.includes("(")){const e=r.split(/[\(\)]/),t=e[0],n=e[1].split(",").map(o=>o.trim());return CommonTableExpressionNameNode.create(t,n)}else return CommonTableExpressionNameNode.create(r)}const WithNode=freeze({is(r){return r.kind==="WithNode"},create(r,e){return freeze({kind:"WithNode",expressions:freeze([r]),...e})},cloneWithExpression(r,e){return freeze({...r,expressions:freeze([...r.expressions,e])})}}),CHARS=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function randomString(r){let e="";for(let t=0;t<r;++t)e+=randomChar();return e}function randomChar(){return CHARS[~~(Math.random()*CHARS.length)]}function createQueryId(){return new LazyQueryId}var Br;class LazyQueryId{constructor(){g(this,Br,void 0)}get queryId(){return i(this,Br)===void 0&&x(this,Br,randomString(8)),i(this,Br)}}Br=new WeakMap;function requireAllProps(r){return r}var ai;class OperationNodeTransformer{constructor(){le(this,"nodeStack",[]);g(this,ai,freeze({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),AddIndexNode:this.transformAddIndex.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const t=this.transformNodeImpl(e);return this.nodeStack.pop(),freeze(t)}transformNodeImpl(e){return i(this,ai)[e.kind](e)}transformNodeList(e){return e&&freeze(e.map(t=>this.transformNode(t)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:freeze([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}ai=new WeakMap;const ROOT_OPERATION_NODES=freeze({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});var Fr,cr,dr,li,Qo,ui,Mo,ci,Uo,fr,mn,Tn,Xi,di,$o;class WithSchemaTransformer extends OperationNodeTransformer{constructor(t){super();g(this,li);g(this,ui);g(this,ci);g(this,fr);g(this,Tn);g(this,di);g(this,Fr,void 0);g(this,cr,new Set);g(this,dr,new Set);x(this,Fr,t)}transformNodeImpl(t){if(!Y(this,li,Qo).call(this,t))return super.transformNodeImpl(t);const n=Y(this,ci,Uo).call(this,t);for(const c of n)i(this,dr).add(c);const o=Y(this,ui,Mo).call(this,t);for(const c of o)i(this,cr).add(c);const l=super.transformNodeImpl(t);for(const c of o)i(this,cr).delete(c);for(const c of n)i(this,dr).delete(c);return l}transformSchemableIdentifier(t){const n=super.transformSchemableIdentifier(t);return n.schema||!i(this,cr).has(t.identifier.name)?n:{...n,schema:IdentifierNode.create(i(this,Fr))}}transformReferences(t){const n=super.transformReferences(t);return n.table.table.schema?n:{...n,table:TableNode.createWithSchema(i(this,Fr),n.table.table.identifier.name)}}}Fr=new WeakMap,cr=new WeakMap,dr=new WeakMap,li=new WeakSet,Qo=function(t){return t.kind in ROOT_OPERATION_NODES},ui=new WeakSet,Mo=function(t){const n=new Set;if("name"in t&&t.name&&SchemableIdentifierNode.is(t.name)&&Y(this,Tn,Xi).call(this,t.name,n),"from"in t&&t.from)for(const o of t.from.froms)Y(this,fr,mn).call(this,o,n);if("into"in t&&t.into&&Y(this,fr,mn).call(this,t.into,n),"table"in t&&t.table&&Y(this,fr,mn).call(this,t.table,n),"joins"in t&&t.joins)for(const o of t.joins)Y(this,fr,mn).call(this,o.table,n);return n},ci=new WeakSet,Uo=function(t){const n=new Set;return"with"in t&&t.with&&Y(this,di,$o).call(this,t.with,n),n},fr=new WeakSet,mn=function(t,n){const o=TableNode.is(t)?t:AliasNode.is(t)&&TableNode.is(t.node)?t.node:null;o&&Y(this,Tn,Xi).call(this,o.table,n)},Tn=new WeakSet,Xi=function(t,n){const o=t.identifier.name;!i(this,cr).has(o)&&!i(this,dr).has(o)&&n.add(o)},di=new WeakSet,$o=function(t,n){for(const o of t.expressions){const l=o.name.table.table.identifier.name;i(this,dr).has(l)||n.add(l)}};var Sn;class WithSchemaPlugin{constructor(e){g(this,Sn,void 0);x(this,Sn,new WithSchemaTransformer(e))}transformQuery(e){return i(this,Sn).transformNode(e.node)}async transformResult(e){return e.result}}Sn=new WeakMap;var Ee;const sr=class sr{constructor(e){g(this,Ee,void 0);x(this,Ee,freeze(e))}selectFrom(e){return createSelectQueryBuilder({queryId:createQueryId(),executor:i(this,Ee).executor,queryNode:SelectQueryNode.createFrom(parseTableExpressionOrList(e),i(this,Ee).withNode)})}selectNoFrom(e){return createSelectQueryBuilder({queryId:createQueryId(),executor:i(this,Ee).executor,queryNode:SelectQueryNode.cloneWithSelections(SelectQueryNode.create(i(this,Ee).withNode),parseSelectArg(e))})}insertInto(e){return new InsertQueryBuilder({queryId:createQueryId(),executor:i(this,Ee).executor,queryNode:InsertQueryNode.create(parseTable(e),i(this,Ee).withNode)})}replaceInto(e){return new InsertQueryBuilder({queryId:createQueryId(),executor:i(this,Ee).executor,queryNode:InsertQueryNode.create(parseTable(e),i(this,Ee).withNode,!0)})}deleteFrom(e){return new DeleteQueryBuilder({queryId:createQueryId(),executor:i(this,Ee).executor,queryNode:DeleteQueryNode.create(parseTableExpressionOrList(e),i(this,Ee).withNode)})}updateTable(e){return new UpdateQueryBuilder({queryId:createQueryId(),executor:i(this,Ee).executor,queryNode:UpdateQueryNode.create(parseTableExpression(e),i(this,Ee).withNode)})}with(e,t){const n=parseCommonTableExpression(e,t);return new sr({...i(this,Ee),withNode:i(this,Ee).withNode?WithNode.cloneWithExpression(i(this,Ee).withNode,n):WithNode.create(n)})}withRecursive(e,t){const n=parseCommonTableExpression(e,t);return new sr({...i(this,Ee),withNode:i(this,Ee).withNode?WithNode.cloneWithExpression(i(this,Ee).withNode,n):WithNode.create(n,{recursive:!0})})}withPlugin(e){return new sr({...i(this,Ee),executor:i(this,Ee).executor.withPlugin(e)})}withoutPlugins(){return new sr({...i(this,Ee),executor:i(this,Ee).executor.withoutPlugins()})}withSchema(e){return new sr({...i(this,Ee),executor:i(this,Ee).executor.withPluginAtFront(new WithSchemaPlugin(e))})}};Ee=new WeakMap;let QueryCreator=sr;var In,Pr,zr;class Deferred{constructor(){g(this,In,void 0);g(this,Pr,void 0);g(this,zr,void 0);le(this,"resolve",e=>{i(this,Pr)&&i(this,Pr).call(this,e)});le(this,"reject",e=>{i(this,zr)&&i(this,zr).call(this,e)});x(this,In,new Promise((e,t)=>{x(this,zr,t),x(this,Pr,e)}))}get promise(){return i(this,In)}}In=new WeakMap,Pr=new WeakMap,zr=new WeakMap;const LOGGED_MESSAGES=new Set;function logOnce(r){LOGGED_MESSAGES.has(r)||(LOGGED_MESSAGES.add(r),console.log(r))}const NO_PLUGINS=freeze([]);var hr,vn,Yi;class QueryExecutorBase{constructor(e=NO_PLUGINS){g(this,vn);g(this,hr,void 0);x(this,hr,e)}get plugins(){return i(this,hr)}transformQuery(e,t){for(const n of i(this,hr)){const o=n.transformQuery({node:e,queryId:t});if(o.kind===e.kind)e=o;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${o.kind}`].join(" "))}return e}async executeQuery(e,t){return await this.provideConnection(async n=>{const o=await n.executeQuery(e),l=await Y(this,vn,Yi).call(this,o,t);return warnOfOutdatedDriverOrPlugins(o,l),l})}async*stream(e,t,n){const o=new Deferred,l=new Deferred;this.provideConnection(async f=>(o.resolve(f),await l.promise)).catch(f=>o.reject(f));const c=await o.promise;try{for await(const f of c.streamQuery(e,t))yield await Y(this,vn,Yi).call(this,f,n)}finally{l.resolve()}}}hr=new WeakMap,vn=new WeakSet,Yi=async function(e,t){for(const n of i(this,hr))e=await n.transformResult({result:e,queryId:t});return e};function warnOfOutdatedDriverOrPlugins(r,e){const{numAffectedRows:t}=r;t===void 0&&r.numUpdatedOrDeletedRows===void 0||t!==void 0&&e.numAffectedRows!==void 0||logOnce("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class NoopQueryExecutor extends QueryExecutorBase{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new NoopQueryExecutor([...this.plugins,e])}withPlugins(e){return new NoopQueryExecutor([...this.plugins,...e])}withPluginAtFront(e){return new NoopQueryExecutor([e,...this.plugins])}withoutPlugins(){return new NoopQueryExecutor([])}}const NOOP_QUERY_EXECUTOR=new NoopQueryExecutor;function createQueryCreator(){return new QueryCreator({executor:NOOP_QUERY_EXECUTOR})}function createJoinBuilder(r,e){return new JoinBuilder({joinNode:JoinNode.create(r,parseTableExpression(e))})}function createOverBuilder(){return new OverBuilder({overNode:OverNode.create()})}function parseJoin(r,e){if(e.length===3)return parseSingleOnJoin(r,e[0],e[1],e[2]);if(e.length===2)return parseCallbackJoin(r,e[0],e[1]);throw new Error("not implemented")}function parseCallbackJoin(r,e,t){return t(createJoinBuilder(r,e)).toOperationNode()}function parseSingleOnJoin(r,e,t,n){return JoinNode.createWithOn(r,parseTableExpression(e),parseReferentialBinaryOperation(t,"=",n))}const OffsetNode=freeze({is(r){return r.kind==="OffsetNode"},create(r){return freeze({kind:"OffsetNode",offset:r})}}),GroupByItemNode=freeze({is(r){return r.kind==="GroupByItemNode"},create(r){return freeze({kind:"GroupByItemNode",groupBy:r})}});function parseGroupBy(r){return r=isFunction(r)?r(expressionBuilder()):r,parseReferenceExpressionOrList(r).map(GroupByItemNode.create)}const SetOperationNode=freeze({is(r){return r.kind==="SetOperationNode"},create(r,e,t){return freeze({kind:"SetOperationNode",operator:r,expression:e,all:t})}});function parseSetOperations(r,e,t){return isFunction(e)&&(e=e(createExpressionBuilder())),isReadonlyArray(e)||(e=[e]),e.map(n=>SetOperationNode.create(r,parseExpression(n),t))}var Lt;const fi=class fi{constructor(e){g(this,Lt,void 0);x(this,Lt,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}or(...e){return new OrWrapper(OrNode.create(i(this,Lt),parseValueBinaryOperationOrExpression(e)))}and(...e){return new AndWrapper(AndNode.create(i(this,Lt),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new fi(i(this,Lt))}$notNull(){return new fi(i(this,Lt))}toOperationNode(){return i(this,Lt)}};Lt=new WeakMap;let ExpressionWrapper=fi;var Qr,jt;class AliasedExpressionWrapper{constructor(e,t){g(this,Qr,void 0);g(this,jt,void 0);x(this,Qr,e),x(this,jt,t)}get expression(){return i(this,Qr)}get alias(){return i(this,jt)}toOperationNode(){return AliasNode.create(i(this,Qr).toOperationNode(),isOperationNodeSource(i(this,jt))?i(this,jt).toOperationNode():IdentifierNode.create(i(this,jt)))}}Qr=new WeakMap,jt=new WeakMap;var pr;const hi=class hi{constructor(e){g(this,pr,void 0);x(this,pr,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}or(...e){return new hi(OrNode.create(i(this,pr),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new hi(i(this,pr))}toOperationNode(){return ParensNode.create(i(this,pr))}};pr=new WeakMap;let OrWrapper=hi;var mr;const pi=class pi{constructor(e){g(this,mr,void 0);x(this,mr,e)}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}and(...e){return new pi(AndNode.create(i(this,mr),parseValueBinaryOperationOrExpression(e)))}$castTo(){return new pi(i(this,mr))}toOperationNode(){return ParensNode.create(i(this,mr))}};mr=new WeakMap;let AndWrapper=pi;var W;const Z=class Z{constructor(e){g(this,W,void 0);x(this,W,freeze(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new Z({...i(this,W),queryNode:QueryNode.cloneWithWhere(i(this,W).queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,n){return new Z({...i(this,W),queryNode:QueryNode.cloneWithWhere(i(this,W).queryNode,parseReferentialBinaryOperation(e,t,n))})}having(...e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithHaving(i(this,W).queryNode,parseValueBinaryOperationOrExpression(e))})}havingRef(e,t,n){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithHaving(i(this,W).queryNode,parseReferentialBinaryOperation(e,t,n))})}select(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithSelections(i(this,W).queryNode,parseSelectArg(e))})}distinctOn(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithDistinctOn(i(this,W).queryNode,parseReferenceExpressionOrList(e))})}modifyFront(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithFrontModifier(i(this,W).queryNode,SelectModifierNode.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.createWithExpression(e.toOperationNode()))})}distinct(){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithFrontModifier(i(this,W).queryNode,SelectModifierNode.create("Distinct"))})}forUpdate(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("ForUpdate",e?asArray(e).map(parseTable):void 0))})}forShare(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("ForShare",e?asArray(e).map(parseTable):void 0))})}forKeyShare(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("ForKeyShare",e?asArray(e).map(parseTable):void 0))})}forNoKeyUpdate(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("ForNoKeyUpdate",e?asArray(e).map(parseTable):void 0))})}skipLocked(){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("SkipLocked"))})}noWait(){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithEndModifier(i(this,W).queryNode,SelectModifierNode.create("NoWait"))})}selectAll(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithSelections(i(this,W).queryNode,parseSelectAll(e))})}innerJoin(...e){return new Z({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new Z({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new Z({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new Z({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("FullJoin",e))})}innerJoinLateral(...e){return new Z({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("LateralInnerJoin",e))})}leftJoinLateral(...e){return new Z({...i(this,W),queryNode:QueryNode.cloneWithJoin(i(this,W).queryNode,parseJoin("LateralLeftJoin",e))})}orderBy(...e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithOrderByItems(i(this,W).queryNode,parseOrderBy(e))})}groupBy(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithGroupByItems(i(this,W).queryNode,parseGroupBy(e))})}limit(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithLimit(i(this,W).queryNode,LimitNode.create(parseValueExpression(e)))})}offset(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithOffset(i(this,W).queryNode,OffsetNode.create(parseValueExpression(e)))})}union(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("union",e,!1))})}unionAll(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("union",e,!0))})}intersect(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("intersect",e,!1))})}intersectAll(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("intersect",e,!0))})}except(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("except",e,!1))})}exceptAll(e){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithSetOperations(i(this,W).queryNode,parseSetOperations("except",e,!0))})}as(e){return new AliasedSelectQueryBuilderImpl(this,e)}clearSelect(){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithoutSelections(i(this,W).queryNode)})}clearWhere(){return new Z({...i(this,W),queryNode:QueryNode.cloneWithoutWhere(i(this,W).queryNode)})}clearLimit(){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithoutLimit(i(this,W).queryNode)})}clearOffset(){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithoutOffset(i(this,W).queryNode)})}clearOrderBy(){return new Z({...i(this,W),queryNode:SelectQueryNode.cloneWithoutOrderBy(i(this,W).queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new Z({...i(this,W)})}$castTo(){return new Z(i(this,W))}$narrowType(){return new Z(i(this,W))}$assertType(){return new Z(i(this,W))}$asTuple(){return new ExpressionWrapper(this.toOperationNode())}withPlugin(e){return new Z({...i(this,W),executor:i(this,W).executor.withPlugin(e)})}toOperationNode(){return i(this,W).executor.transformQuery(i(this,W).queryNode,i(this,W).queryId)}compile(){return i(this,W).executor.compileQuery(this.toOperationNode(),i(this,W).queryId)}async execute(){const e=this.compile();return(await i(this,W).executor.executeQuery(e,i(this,W).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(t===void 0)throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async*stream(e=100){const t=this.compile(),n=i(this,W).executor.stream(t,e,i(this,W).queryId);for await(const o of n)yield*o.rows}async explain(e,t){return await new Z({...i(this,W),queryNode:QueryNode.cloneWithExplain(i(this,W).queryNode,e,t)}).execute()}};W=new WeakMap;let SelectQueryBuilderImpl=Z;preventAwait(SelectQueryBuilderImpl,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function createSelectQueryBuilder(r){return new SelectQueryBuilderImpl(r)}var Mr,Ur;class AliasedSelectQueryBuilderImpl{constructor(e,t){g(this,Mr,void 0);g(this,Ur,void 0);x(this,Mr,e),x(this,Ur,t)}get expression(){return i(this,Mr)}get alias(){return i(this,Ur)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return AliasNode.create(i(this,Mr).toOperationNode(),IdentifierNode.create(i(this,Ur)))}}Mr=new WeakMap,Ur=new WeakMap;preventAwait(AliasedSelectQueryBuilderImpl,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const AggregateFunctionNode=freeze({is(r){return r.kind==="AggregateFunctionNode"},create(r,e=[]){return freeze({kind:"AggregateFunctionNode",func:r,aggregated:e})},cloneWithDistinct(r){return freeze({...r,distinct:!0})},cloneWithFilter(r,e){return freeze({...r,filter:r.filter?WhereNode.cloneWithOperation(r.filter,"And",e):WhereNode.create(e)})},cloneWithOrFilter(r,e){return freeze({...r,filter:r.filter?WhereNode.cloneWithOperation(r.filter,"Or",e):WhereNode.create(e)})},cloneWithOver(r,e){return freeze({...r,over:e})}}),FunctionNode=freeze({is(r){return r.kind==="FunctionNode"},create(r,e){return freeze({kind:"FunctionNode",func:r,arguments:e})}});var tt;const Jt=class Jt{constructor(e){g(this,tt,void 0);x(this,tt,freeze(e))}get expressionType(){}as(e){return new AliasedAggregateFunctionBuilder(this,e)}distinct(){return new Jt({...i(this,tt),aggregateFunctionNode:AggregateFunctionNode.cloneWithDistinct(i(this,tt).aggregateFunctionNode)})}filterWhere(...e){return new Jt({...i(this,tt),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(i(this,tt).aggregateFunctionNode,parseValueBinaryOperationOrExpression(e))})}filterWhereRef(e,t,n){return new Jt({...i(this,tt),aggregateFunctionNode:AggregateFunctionNode.cloneWithFilter(i(this,tt).aggregateFunctionNode,parseReferentialBinaryOperation(e,t,n))})}over(e){const t=createOverBuilder();return new Jt({...i(this,tt),aggregateFunctionNode:AggregateFunctionNode.cloneWithOver(i(this,tt).aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new Jt(i(this,tt))}$notNull(){return new Jt(i(this,tt))}toOperationNode(){return i(this,tt).aggregateFunctionNode}};tt=new WeakMap;let AggregateFunctionBuilder=Jt;preventAwait(AggregateFunctionBuilder,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var $r,Vr;class AliasedAggregateFunctionBuilder{constructor(e,t){g(this,$r,void 0);g(this,Vr,void 0);x(this,$r,e),x(this,Vr,t)}get expression(){return i(this,$r)}get alias(){return i(this,Vr)}toOperationNode(){return AliasNode.create(i(this,$r).toOperationNode(),IdentifierNode.create(i(this,Vr)))}}$r=new WeakMap,Vr=new WeakMap;function createFunctionModule(){const r=(t,n)=>new ExpressionWrapper(FunctionNode.create(t,parseReferenceExpressionOrList(n??[]))),e=(t,n)=>new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create(t,n?parseReferenceExpressionOrList(n):void 0)});return Object.assign(r,{agg:e,avg(t){return e("avg",[t])},coalesce(...t){return r("coalesce",t)},count(t){return e("count",[t])},countAll(t){return new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create("count",parseSelectAll(t))})},max(t){return e("max",[t])},min(t){return e("min",[t])},sum(t){return e("sum",[t])},any(t){return r("any",[t])},jsonAgg(t){return new AggregateFunctionBuilder({aggregateFunctionNode:AggregateFunctionNode.create("json_agg",[isString(t)?parseTable(t):t.toOperationNode()])})},toJson(t){return new ExpressionWrapper(FunctionNode.create("to_json",[isString(t)?parseTable(t):t.toOperationNode()]))}})}const UnaryOperationNode=freeze({is(r){return r.kind==="UnaryOperationNode"},create(r,e){return freeze({kind:"UnaryOperationNode",operator:r,operand:e})}});function parseUnaryOperation(r,e){return UnaryOperationNode.create(OperatorNode.create(r),parseReferenceExpression(e))}const WhenNode=freeze({is(r){return r.kind==="WhenNode"},create(r){return freeze({kind:"WhenNode",condition:r})},cloneWithResult(r,e){return freeze({...r,result:e})}}),CaseNode=freeze({is(r){return r.kind==="CaseNode"},create(r){return freeze({kind:"CaseNode",value:r})},cloneWithWhen(r,e){return freeze({...r,when:freeze(r.when?[...r.when,e]:[e])})},cloneWithThen(r,e){return freeze({...r,when:r.when?freeze([...r.when.slice(0,-1),WhenNode.cloneWithResult(r.when[r.when.length-1],e)]):void 0})},cloneWith(r,e){return freeze({...r,...e})}});var Jr;class CaseBuilder{constructor(e){g(this,Jr,void 0);x(this,Jr,freeze(e))}when(...e){return new CaseThenBuilder({...i(this,Jr),node:CaseNode.cloneWithWhen(i(this,Jr).node,WhenNode.create(parseValueBinaryOperationOrExpression(e)))})}}Jr=new WeakMap;var Hr;class CaseThenBuilder{constructor(e){g(this,Hr,void 0);x(this,Hr,freeze(e))}then(e){return new CaseWhenBuilder({...i(this,Hr),node:CaseNode.cloneWithThen(i(this,Hr).node,isSafeImmediateValue(e)?parseSafeImmediateValue(e):parseValueExpression(e))})}}Hr=new WeakMap;var vt;class CaseWhenBuilder{constructor(e){g(this,vt,void 0);x(this,vt,freeze(e))}when(...e){return new CaseThenBuilder({...i(this,vt),node:CaseNode.cloneWithWhen(i(this,vt).node,WhenNode.create(parseValueBinaryOperationOrExpression(e)))})}else(e){return new CaseEndBuilder({...i(this,vt),node:CaseNode.cloneWith(i(this,vt).node,{else:isSafeImmediateValue(e)?parseSafeImmediateValue(e):parseValueExpression(e)})})}end(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,vt).node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,vt).node,{isStatement:!0}))}}vt=new WeakMap;var jr;class CaseEndBuilder{constructor(e){g(this,jr,void 0);x(this,jr,freeze(e))}end(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,jr).node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(CaseNode.cloneWith(i(this,jr).node,{isStatement:!0}))}}jr=new WeakMap;const JSONPathLegNode=freeze({is(r){return r.kind==="JSONPathLegNode"},create(r,e){return freeze({kind:"JSONPathLegNode",type:r,value:e})}});var Rt,Rn,Zi;class JSONPathBuilder{constructor(e){g(this,Rn);g(this,Rt,void 0);x(this,Rt,e)}at(e){return Y(this,Rn,Zi).call(this,"ArrayLocation",e)}key(e){return Y(this,Rn,Zi).call(this,"Member",e)}}Rt=new WeakMap,Rn=new WeakSet,Zi=function(e,t){return JSONReferenceNode.is(i(this,Rt))?new TraversedJSONPathBuilder(JSONReferenceNode.cloneWithTraversal(i(this,Rt),JSONPathNode.is(i(this,Rt).traversal)?JSONPathNode.cloneWithLeg(i(this,Rt).traversal,JSONPathLegNode.create(e,t)):JSONOperatorChainNode.cloneWithValue(i(this,Rt).traversal,ValueNode.createImmediate(t)))):new TraversedJSONPathBuilder(JSONPathNode.cloneWithLeg(i(this,Rt),JSONPathLegNode.create(e,t)))};var Nr;class TraversedJSONPathBuilder extends JSONPathBuilder{constructor(t){super(t);g(this,Nr,void 0);x(this,Nr,t)}get expressionType(){}as(t){return new AliasedJSONPathBuilder(this,t)}$castTo(){return new JSONPathBuilder(i(this,Nr))}$notNull(){return new JSONPathBuilder(i(this,Nr))}toOperationNode(){return i(this,Nr)}}Nr=new WeakMap;var Kr,Kt;class AliasedJSONPathBuilder{constructor(e,t){g(this,Kr,void 0);g(this,Kt,void 0);x(this,Kr,e),x(this,Kt,t)}get expression(){return i(this,Kr)}get alias(){return i(this,Kt)}toOperationNode(){return AliasNode.create(i(this,Kr).toOperationNode(),isOperationNodeSource(i(this,Kt))?i(this,Kt).toOperationNode():IdentifierNode.create(i(this,Kt)))}}Kr=new WeakMap,Kt=new WeakMap;const TupleNode=freeze({is(r){return r.kind==="TupleNode"},create(r){return freeze({kind:"TupleNode",values:freeze(r)})}});function createExpressionBuilder(r=NOOP_QUERY_EXECUTOR){function e(o,l,c){return new ExpressionWrapper(parseValueBinaryOperation(o,l,c))}function t(o,l){return new ExpressionWrapper(parseUnaryOperation(o,l))}const n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(o){return createSelectQueryBuilder({queryId:createQueryId(),executor:r,queryNode:SelectQueryNode.createFrom(parseTableExpressionOrList(o))})},case(o){return new CaseBuilder({node:CaseNode.create(isUndefined(o)?void 0:parseReferenceExpression(o))})},ref(o,l){return isUndefined(l)?new ExpressionWrapper(parseStringReference(o)):new JSONPathBuilder(parseJSONReference(o,l))},jsonPath(){return new JSONPathBuilder(JSONPathNode.create())},table(o){return new ExpressionWrapper(parseTable(o))},val(o){return new ExpressionWrapper(parseValueExpression(o))},refTuple(...o){return new ExpressionWrapper(TupleNode.create(o.map(parseReferenceExpression)))},tuple(...o){return new ExpressionWrapper(TupleNode.create(o.map(parseValueExpression)))},lit(o){return new ExpressionWrapper(parseSafeImmediateValue(o))},unary:t,not(o){return t("not",o)},exists(o){return t("exists",o)},neg(o){return t("-",o)},between(o,l,c){return new ExpressionWrapper(BinaryOperationNode.create(parseReferenceExpression(o),OperatorNode.create("between"),AndNode.create(parseValueExpression(l),parseValueExpression(c))))},betweenSymmetric(o,l,c){return new ExpressionWrapper(BinaryOperationNode.create(parseReferenceExpression(o),OperatorNode.create("between symmetric"),AndNode.create(parseValueExpression(l),parseValueExpression(c))))},and(o){return isReadonlyArray(o)?new ExpressionWrapper(parseFilterList(o,"and")):new ExpressionWrapper(parseFilterObject(o,"and"))},or(o){return isReadonlyArray(o)?new ExpressionWrapper(parseFilterList(o,"or")):new ExpressionWrapper(parseFilterObject(o,"or"))},parens(...o){const l=parseValueBinaryOperationOrExpression(o);return ParensNode.is(l)?new ExpressionWrapper(l):new ExpressionWrapper(ParensNode.create(l))},withSchema(o){return createExpressionBuilder(r.withPluginAtFront(new WithSchemaPlugin(o)))}});return n.fn=createFunctionModule(),n.eb=n,n}function expressionBuilder(r){return createExpressionBuilder()}function parseExpression(r){if(isOperationNodeSource(r))return r.toOperationNode();if(isFunction(r))return r(expressionBuilder()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(r)}`)}function parseAliasedExpression(r){if(isOperationNodeSource(r))return r.toOperationNode();if(isFunction(r))return r(expressionBuilder()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(r)}`)}function isExpressionOrFactory(r){return isExpression(r)||isAliasedExpression(r)||isFunction(r)}function parseTableExpressionOrList(r){return isReadonlyArray(r)?r.map(e=>parseTableExpression(e)):[parseTableExpression(r)]}function parseTableExpression(r){return isString(r)?parseAliasedTable(r):parseAliasedExpression(r)}function parseAliasedTable(r){const e=" as ";if(r.includes(e)){const[t,n]=r.split(e).map(trim$1);return AliasNode.create(parseTable(t),IdentifierNode.create(n))}else return parseTable(r)}function parseTable(r){const e=".";if(r.includes(e)){const[t,n]=r.split(e).map(trim$1);return TableNode.createWithSchema(t,n)}else return TableNode.create(r)}function trim$1(r){return r.trim()}const AddColumnNode=freeze({is(r){return r.kind==="AddColumnNode"},create(r){return freeze({kind:"AddColumnNode",column:r})}}),ColumnDefinitionNode=freeze({is(r){return r.kind==="ColumnDefinitionNode"},create(r,e){return freeze({kind:"ColumnDefinitionNode",column:ColumnNode.create(r),dataType:e})},cloneWithFrontModifier(r,e){return freeze({...r,frontModifiers:r.frontModifiers?freeze([...r.frontModifiers,e]):[e]})},cloneWithEndModifier(r,e){return freeze({...r,endModifiers:r.endModifiers?freeze([...r.endModifiers,e]):[e]})},cloneWith(r,e){return freeze({...r,...e})}}),DropColumnNode=freeze({is(r){return r.kind==="DropColumnNode"},create(r){return freeze({kind:"DropColumnNode",column:ColumnNode.create(r)})}}),RenameColumnNode=freeze({is(r){return r.kind==="RenameColumnNode"},create(r,e){return freeze({kind:"RenameColumnNode",column:ColumnNode.create(r),renameTo:ColumnNode.create(e)})}}),CheckConstraintNode=freeze({is(r){return r.kind==="CheckConstraintNode"},create(r,e){return freeze({kind:"CheckConstraintNode",expression:r,name:e?IdentifierNode.create(e):void 0})}}),ON_MODIFY_FOREIGN_ACTIONS=["no action","restrict","cascade","set null","set default"],ReferencesNode=freeze({is(r){return r.kind==="ReferencesNode"},create(r,e){return freeze({kind:"ReferencesNode",table:r,columns:freeze([...e])})},cloneWithOnDelete(r,e){return freeze({...r,onDelete:e})},cloneWithOnUpdate(r,e){return freeze({...r,onUpdate:e})}});function parseDefaultValueExpression(r){return isOperationNodeSource(r)?r.toOperationNode():ValueNode.createImmediate(r)}const GeneratedNode=freeze({is(r){return r.kind==="GeneratedNode"},create(r){return freeze({kind:"GeneratedNode",...r})},createWithExpression(r){return freeze({kind:"GeneratedNode",always:!0,expression:r})},cloneWith(r,e){return freeze({...r,...e})}}),DefaultValueNode=freeze({is(r){return r.kind==="DefaultValueNode"},create(r){return freeze({kind:"DefaultValueNode",defaultValue:r})}});function parseOnModifyForeignAction(r){if(ON_MODIFY_FOREIGN_ACTIONS.includes(r))return r;throw new Error(`invalid OnModifyForeignAction ${r}`)}var _e;const Be=class Be{constructor(e){g(this,_e,void 0);x(this,_e,e)}autoIncrement(){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{autoIncrement:!0}))}primaryKey(){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{primaryKey:!0}))}references(e){const t=parseStringReference(e);if(!t.table||SelectAllNode.is(t.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{references:ReferencesNode.create(t.table,[t.column])}))}onDelete(e){if(!i(this,_e).references)throw new Error("on delete constraint can only be added for foreign keys");return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{references:ReferencesNode.cloneWithOnDelete(i(this,_e).references,parseOnModifyForeignAction(e))}))}onUpdate(e){if(!i(this,_e).references)throw new Error("on update constraint can only be added for foreign keys");return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{references:ReferencesNode.cloneWithOnUpdate(i(this,_e).references,parseOnModifyForeignAction(e))}))}unique(){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{unique:!0}))}notNull(){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{notNull:!0}))}unsigned(){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{unsigned:!0}))}defaultTo(e){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{defaultTo:DefaultValueNode.create(parseDefaultValueExpression(e))}))}check(e){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{check:CheckConstraintNode.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{generated:GeneratedNode.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{generated:GeneratedNode.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{generated:GeneratedNode.create({identity:!0,byDefault:!0})}))}stored(){if(!i(this,_e).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{generated:GeneratedNode.cloneWith(i(this,_e).generated,{stored:!0})}))}modifyFront(e){return new Be(ColumnDefinitionNode.cloneWithFrontModifier(i(this,_e),e.toOperationNode()))}nullsNotDistinct(){return new Be(ColumnDefinitionNode.cloneWith(i(this,_e),{nullsNotDistinct:!0}))}modifyEnd(e){return new Be(ColumnDefinitionNode.cloneWithEndModifier(i(this,_e),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return i(this,_e)}};_e=new WeakMap;let ColumnDefinitionBuilder=Be;preventAwait(ColumnDefinitionBuilder,"don't await ColumnDefinitionBuilder instances directly.");const ModifyColumnNode=freeze({is(r){return r.kind==="ModifyColumnNode"},create(r){return freeze({kind:"ModifyColumnNode",column:r})}}),DataTypeNode=freeze({is(r){return r.kind==="DataTypeNode"},create(r){return freeze({kind:"DataTypeNode",dataType:r})}});function parseDataTypeExpression(r){return isOperationNodeSource(r)?r.toOperationNode():DataTypeNode.create(r)}const ForeignKeyConstraintNode=freeze({is(r){return r.kind==="ForeignKeyConstraintNode"},create(r,e,t,n){return freeze({kind:"ForeignKeyConstraintNode",columns:r,references:ReferencesNode.create(e,t),name:n?IdentifierNode.create(n):void 0})},cloneWith(r,e){return freeze({...r,...e})}});var yr;const mi=class mi{constructor(e){g(this,yr,void 0);x(this,yr,e)}onDelete(e){return new mi(ForeignKeyConstraintNode.cloneWith(i(this,yr),{onDelete:parseOnModifyForeignAction(e)}))}onUpdate(e){return new mi(ForeignKeyConstraintNode.cloneWith(i(this,yr),{onUpdate:parseOnModifyForeignAction(e)}))}$call(e){return e(this)}toOperationNode(){return i(this,yr)}};yr=new WeakMap;let ForeignKeyConstraintBuilder=mi;preventAwait(ForeignKeyConstraintBuilder,"don't await ForeignKeyConstraintBuilder instances directly.");const AddConstraintNode=freeze({is(r){return r.kind==="AddConstraintNode"},create(r){return freeze({kind:"AddConstraintNode",constraint:r})}}),UniqueConstraintNode=freeze({is(r){return r.kind==="UniqueConstraintNode"},create(r,e,t){return freeze({kind:"UniqueConstraintNode",columns:freeze(r.map(ColumnNode.create)),name:e?IdentifierNode.create(e):void 0,nullsNotDistinct:t})},cloneWith(r,e){return freeze({...r,...e})}}),DropConstraintNode=freeze({is(r){return r.kind==="DropConstraintNode"},create(r){return freeze({kind:"DropConstraintNode",constraintName:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}}),AlterColumnNode=freeze({is(r){return r.kind==="AlterColumnNode"},create(r,e,t){return freeze({kind:"AlterColumnNode",column:ColumnNode.create(r),[e]:t})}});var qt;class AlterColumnBuilder{constructor(e){g(this,qt,void 0);x(this,qt,e)}setDataType(e){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"dataType",parseDataTypeExpression(e)))}setDefault(e){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"setDefault",parseDefaultValueExpression(e)))}dropDefault(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"dropDefault",!0))}setNotNull(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"setNotNull",!0))}dropNotNull(){return new AlteredColumnBuilder(AlterColumnNode.create(i(this,qt),"dropNotNull",!0))}$call(e){return e(this)}}qt=new WeakMap;var Cn;class AlteredColumnBuilder{constructor(e){g(this,Cn,void 0);x(this,Cn,e)}toOperationNode(){return i(this,Cn)}}Cn=new WeakMap;var wt;class AlterTableExecutor{constructor(e){g(this,wt,void 0);x(this,wt,freeze(e))}toOperationNode(){return i(this,wt).executor.transformQuery(i(this,wt).node,i(this,wt).queryId)}compile(){return i(this,wt).executor.compileQuery(this.toOperationNode(),i(this,wt).queryId)}async execute(){await i(this,wt).executor.executeQuery(this.compile(),i(this,wt).queryId)}}wt=new WeakMap;preventAwait(AlterTableExecutor,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var Xe;const Ni=class Ni{constructor(e){g(this,Xe,void 0);x(this,Xe,freeze(e))}onDelete(e){return new Ni({...i(this,Xe),constraintBuilder:i(this,Xe).constraintBuilder.onDelete(e)})}onUpdate(e){return new Ni({...i(this,Xe),constraintBuilder:i(this,Xe).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return i(this,Xe).executor.transformQuery(AlterTableNode.cloneWithTableProps(i(this,Xe).node,{addConstraint:AddConstraintNode.create(i(this,Xe).constraintBuilder.toOperationNode())}),i(this,Xe).queryId)}compile(){return i(this,Xe).executor.compileQuery(this.toOperationNode(),i(this,Xe).queryId)}async execute(){await i(this,Xe).executor.executeQuery(this.compile(),i(this,Xe).queryId)}};Xe=new WeakMap;let AlterTableAddForeignKeyConstraintBuilder=Ni;preventAwait(AlterTableAddForeignKeyConstraintBuilder,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var De;const bn=class bn{constructor(e){g(this,De,void 0);x(this,De,freeze(e))}ifExists(){return new bn({...i(this,De),node:AlterTableNode.cloneWithTableProps(i(this,De).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,De).node.dropConstraint,{ifExists:!0})})})}cascade(){return new bn({...i(this,De),node:AlterTableNode.cloneWithTableProps(i(this,De).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,De).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new bn({...i(this,De),node:AlterTableNode.cloneWithTableProps(i(this,De).node,{dropConstraint:DropConstraintNode.cloneWith(i(this,De).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return i(this,De).executor.transformQuery(i(this,De).node,i(this,De).queryId)}compile(){return i(this,De).executor.compileQuery(this.toOperationNode(),i(this,De).queryId)}async execute(){await i(this,De).executor.executeQuery(this.compile(),i(this,De).queryId)}};De=new WeakMap;let AlterTableDropConstraintBuilder=bn;preventAwait(AlterTableDropConstraintBuilder,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const PrimaryConstraintNode=freeze({is(r){return r.kind==="PrimaryKeyConstraintNode"},create(r,e){return freeze({kind:"PrimaryKeyConstraintNode",columns:freeze(r.map(ColumnNode.create)),name:e?IdentifierNode.create(e):void 0})}}),AddIndexNode=freeze({is(r){return r.kind==="AddIndexNode"},create(r){return freeze({kind:"AddIndexNode",name:IdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})},cloneWithColumns(r,e){return freeze({...r,columns:[...r.columns||[],...e]})}});var Oe;const or=class or{constructor(e){g(this,Oe,void 0);x(this,Oe,freeze(e))}unique(){return new or({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWith(i(this,Oe).node.addIndex,{unique:!0})})})}column(e){return new or({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,Oe).node.addIndex,[parseOrderedColumnName(e)])})})}columns(e){return new or({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,Oe).node.addIndex,e.map(parseOrderedColumnName))})})}expression(e){return new or({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWithColumns(i(this,Oe).node.addIndex,[e.toOperationNode()])})})}using(e){return new or({...i(this,Oe),node:AlterTableNode.cloneWithTableProps(i(this,Oe).node,{addIndex:AddIndexNode.cloneWith(i(this,Oe).node.addIndex,{using:RawNode.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return i(this,Oe).executor.transformQuery(i(this,Oe).node,i(this,Oe).queryId)}compile(){return i(this,Oe).executor.compileQuery(this.toOperationNode(),i(this,Oe).queryId)}async execute(){await i(this,Oe).executor.executeQuery(this.compile(),i(this,Oe).queryId)}};Oe=new WeakMap;let AlterTableAddIndexBuilder=or;preventAwait(AlterTableAddIndexBuilder,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var Gr;const os=class os{constructor(e){g(this,Gr,void 0);x(this,Gr,e)}toOperationNode(){return i(this,Gr)}nullsNotDistinct(){return new os(UniqueConstraintNode.cloneWith(i(this,Gr),{nullsNotDistinct:!0}))}};Gr=new WeakMap;let UniqueConstraintNodeBuilder=os;preventAwait(UniqueConstraintNodeBuilder,"don't await UniqueConstraintNodeBuilder instances directly.");var fe;class AlterTableBuilder{constructor(e){g(this,fe,void 0);x(this,fe,freeze(e))}renameTo(e){return new AlterTableExecutor({...i(this,fe),node:AlterTableNode.cloneWithTableProps(i(this,fe).node,{renameTo:parseTable(e)})})}setSchema(e){return new AlterTableExecutor({...i(this,fe),node:AlterTableNode.cloneWithTableProps(i(this,fe).node,{setSchema:IdentifierNode.create(e)})})}alterColumn(e,t){const n=t(new AlterColumnBuilder(e));return new AlterTableColumnAlteringBuilder({...i(this,fe),node:AlterTableNode.cloneWithColumnAlteration(i(this,fe).node,n.toOperationNode())})}dropColumn(e){return new AlterTableColumnAlteringBuilder({...i(this,fe),node:AlterTableNode.cloneWithColumnAlteration(i(this,fe).node,DropColumnNode.create(e))})}renameColumn(e,t){return new AlterTableColumnAlteringBuilder({...i(this,fe),node:AlterTableNode.cloneWithColumnAlteration(i(this,fe).node,RenameColumnNode.create(e,t))})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...i(this,fe),node:AlterTableNode.cloneWithColumnAlteration(i(this,fe).node,AddColumnNode.create(o.toOperationNode()))})}modifyColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...i(this,fe),node:AlterTableNode.cloneWithColumnAlteration(i(this,fe).node,ModifyColumnNode.create(o.toOperationNode()))})}addUniqueConstraint(e,t,n=noop$1){const o=n(new UniqueConstraintNodeBuilder(UniqueConstraintNode.create(t,e)));return new AlterTableExecutor({...i(this,fe),node:AlterTableNode.cloneWithTableProps(i(this,fe).node,{addConstraint:AddConstraintNode.create(o.toOperationNode())})})}addCheckConstraint(e,t){return new AlterTableExecutor({...i(this,fe),node:AlterTableNode.cloneWithTableProps(i(this,fe).node,{addConstraint:AddConstraintNode.create(CheckConstraintNode.create(t.toOperationNode(),e))})})}addForeignKeyConstraint(e,t,n,o){return new AlterTableAddForeignKeyConstraintBuilder({...i(this,fe),constraintBuilder:new ForeignKeyConstraintBuilder(ForeignKeyConstraintNode.create(t.map(ColumnNode.create),parseTable(n),o.map(ColumnNode.create),e))})}addPrimaryKeyConstraint(e,t){return new AlterTableExecutor({...i(this,fe),node:AlterTableNode.cloneWithTableProps(i(this,fe).node,{addConstraint:AddConstraintNode.create(PrimaryConstraintNode.create(t,e))})})}dropConstraint(e){return new AlterTableDropConstraintBuilder({...i(this,fe),node:AlterTableNode.cloneWithTableProps(i(this,fe).node,{dropConstraint:DropConstraintNode.create(e)})})}addIndex(e){return new AlterTableAddIndexBuilder({...i(this,fe),node:AlterTableNode.cloneWithTableProps(i(this,fe).node,{addIndex:AddIndexNode.create(e)})})}dropIndex(e){return new AlterTableExecutor({...i(this,fe),node:AlterTableNode.cloneWithTableProps(i(this,fe).node,{dropIndex:DropIndexNode.create(e)})})}$call(e){return e(this)}}fe=new WeakMap;var Ae;const ar=class ar{constructor(e){g(this,Ae,void 0);x(this,Ae,freeze(e))}alterColumn(e,t){const n=t(new AlterColumnBuilder(e));return new ar({...i(this,Ae),node:AlterTableNode.cloneWithColumnAlteration(i(this,Ae).node,n.toOperationNode())})}dropColumn(e){return new ar({...i(this,Ae),node:AlterTableNode.cloneWithColumnAlteration(i(this,Ae).node,DropColumnNode.create(e))})}renameColumn(e,t){return new ar({...i(this,Ae),node:AlterTableNode.cloneWithColumnAlteration(i(this,Ae).node,RenameColumnNode.create(e,t))})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new ar({...i(this,Ae),node:AlterTableNode.cloneWithColumnAlteration(i(this,Ae).node,AddColumnNode.create(o.toOperationNode()))})}modifyColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new ar({...i(this,Ae),node:AlterTableNode.cloneWithColumnAlteration(i(this,Ae).node,ModifyColumnNode.create(o.toOperationNode()))})}toOperationNode(){return i(this,Ae).executor.transformQuery(i(this,Ae).node,i(this,Ae).queryId)}compile(){return i(this,Ae).executor.compileQuery(this.toOperationNode(),i(this,Ae).queryId)}async execute(){await i(this,Ae).executor.executeQuery(this.compile(),i(this,Ae).queryId)}};Ae=new WeakMap;let AlterTableColumnAlteringBuilder=ar;preventAwait(AlterTableBuilder,"don't await AlterTableBuilder instances");preventAwait(AlterColumnBuilder,"don't await AlterColumnBuilder instances");preventAwait(AlterTableColumnAlteringBuilder,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class ImmediateValueTransformer extends OperationNodeTransformer{transformValue(e){return{...super.transformValue(e),immediate:!0}}}var Ne;const Nt=class Nt{constructor(e){g(this,Ne,void 0);x(this,Ne,freeze(e))}ifNotExists(){return new Nt({...i(this,Ne),node:CreateIndexNode.cloneWith(i(this,Ne).node,{ifNotExists:!0})})}unique(){return new Nt({...i(this,Ne),node:CreateIndexNode.cloneWith(i(this,Ne).node,{unique:!0})})}nullsNotDistinct(){return new Nt({...i(this,Ne),node:CreateIndexNode.cloneWith(i(this,Ne).node,{nullsNotDistinct:!0})})}on(e){return new Nt({...i(this,Ne),node:CreateIndexNode.cloneWith(i(this,Ne).node,{table:parseTable(e)})})}column(e){return new Nt({...i(this,Ne),node:CreateIndexNode.cloneWithColumns(i(this,Ne).node,[parseOrderedColumnName(e)])})}columns(e){return new Nt({...i(this,Ne),node:CreateIndexNode.cloneWithColumns(i(this,Ne).node,e.map(parseOrderedColumnName))})}expression(e){return new Nt({...i(this,Ne),node:CreateIndexNode.cloneWithColumns(i(this,Ne).node,[e.toOperationNode()])})}using(e){return new Nt({...i(this,Ne),node:CreateIndexNode.cloneWith(i(this,Ne).node,{using:RawNode.createWithSql(e)})})}where(...e){const t=new ImmediateValueTransformer;return new Nt({...i(this,Ne),node:QueryNode.cloneWithWhere(i(this,Ne).node,t.transformNode(parseValueBinaryOperationOrExpression(e)))})}$call(e){return e(this)}toOperationNode(){return i(this,Ne).executor.transformQuery(i(this,Ne).node,i(this,Ne).queryId)}compile(){return i(this,Ne).executor.compileQuery(this.toOperationNode(),i(this,Ne).queryId)}async execute(){await i(this,Ne).executor.executeQuery(this.compile(),i(this,Ne).queryId)}};Ne=new WeakMap;let CreateIndexBuilder=Nt;preventAwait(CreateIndexBuilder,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var ut;const as=class as{constructor(e){g(this,ut,void 0);x(this,ut,freeze(e))}ifNotExists(){return new as({...i(this,ut),node:CreateSchemaNode.cloneWith(i(this,ut).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,ut).executor.transformQuery(i(this,ut).node,i(this,ut).queryId)}compile(){return i(this,ut).executor.compileQuery(this.toOperationNode(),i(this,ut).queryId)}async execute(){await i(this,ut).executor.executeQuery(this.compile(),i(this,ut).queryId)}};ut=new WeakMap;let CreateSchemaBuilder=as;preventAwait(CreateSchemaBuilder,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function parseOnCommitAction(r){if(ON_COMMIT_ACTIONS.includes(r))return r;throw new Error(`invalid OnCommitAction ${r}`)}var de;const lt=class lt{constructor(e){g(this,de,void 0);x(this,de,freeze(e))}temporary(){return new lt({...i(this,de),node:CreateTableNode.cloneWith(i(this,de).node,{temporary:!0})})}onCommit(e){return new lt({...i(this,de),node:CreateTableNode.cloneWith(i(this,de).node,{onCommit:parseOnCommitAction(e)})})}ifNotExists(){return new lt({...i(this,de),node:CreateTableNode.cloneWith(i(this,de).node,{ifNotExists:!0})})}addColumn(e,t,n=noop$1){const o=n(new ColumnDefinitionBuilder(ColumnDefinitionNode.create(e,parseDataTypeExpression(t))));return new lt({...i(this,de),node:CreateTableNode.cloneWithColumn(i(this,de).node,o.toOperationNode())})}addPrimaryKeyConstraint(e,t){return new lt({...i(this,de),node:CreateTableNode.cloneWithConstraint(i(this,de).node,PrimaryConstraintNode.create(t,e))})}addUniqueConstraint(e,t,n=noop$1){const o=n(new UniqueConstraintNodeBuilder(UniqueConstraintNode.create(t,e)));return new lt({...i(this,de),node:CreateTableNode.cloneWithConstraint(i(this,de).node,o.toOperationNode())})}addCheckConstraint(e,t){return new lt({...i(this,de),node:CreateTableNode.cloneWithConstraint(i(this,de).node,CheckConstraintNode.create(t.toOperationNode(),e))})}addForeignKeyConstraint(e,t,n,o,l=noop$1){const c=l(new ForeignKeyConstraintBuilder(ForeignKeyConstraintNode.create(t.map(ColumnNode.create),parseTable(n),o.map(ColumnNode.create),e)));return new lt({...i(this,de),node:CreateTableNode.cloneWithConstraint(i(this,de).node,c.toOperationNode())})}modifyFront(e){return new lt({...i(this,de),node:CreateTableNode.cloneWithFrontModifier(i(this,de).node,e.toOperationNode())})}modifyEnd(e){return new lt({...i(this,de),node:CreateTableNode.cloneWithEndModifier(i(this,de).node,e.toOperationNode())})}as(e){return new lt({...i(this,de),node:CreateTableNode.cloneWith(i(this,de).node,{selectQuery:parseExpression(e)})})}$call(e){return e(this)}toOperationNode(){return i(this,de).executor.transformQuery(i(this,de).node,i(this,de).queryId)}compile(){return i(this,de).executor.compileQuery(this.toOperationNode(),i(this,de).queryId)}async execute(){await i(this,de).executor.executeQuery(this.compile(),i(this,de).queryId)}};de=new WeakMap;let CreateTableBuilder=lt;preventAwait(CreateTableBuilder,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var Je;const wn=class wn{constructor(e){g(this,Je,void 0);x(this,Je,freeze(e))}on(e){return new wn({...i(this,Je),node:DropIndexNode.cloneWith(i(this,Je).node,{table:parseTable(e)})})}ifExists(){return new wn({...i(this,Je),node:DropIndexNode.cloneWith(i(this,Je).node,{ifExists:!0})})}cascade(){return new wn({...i(this,Je),node:DropIndexNode.cloneWith(i(this,Je).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Je).executor.transformQuery(i(this,Je).node,i(this,Je).queryId)}compile(){return i(this,Je).executor.compileQuery(this.toOperationNode(),i(this,Je).queryId)}async execute(){await i(this,Je).executor.executeQuery(this.compile(),i(this,Je).queryId)}};Je=new WeakMap;let DropIndexBuilder=wn;preventAwait(DropIndexBuilder,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var rt;const yi=class yi{constructor(e){g(this,rt,void 0);x(this,rt,freeze(e))}ifExists(){return new yi({...i(this,rt),node:DropSchemaNode.cloneWith(i(this,rt).node,{ifExists:!0})})}cascade(){return new yi({...i(this,rt),node:DropSchemaNode.cloneWith(i(this,rt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,rt).executor.transformQuery(i(this,rt).node,i(this,rt).queryId)}compile(){return i(this,rt).executor.compileQuery(this.toOperationNode(),i(this,rt).queryId)}async execute(){await i(this,rt).executor.executeQuery(this.compile(),i(this,rt).queryId)}};rt=new WeakMap;let DropSchemaBuilder=yi;preventAwait(DropSchemaBuilder,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var nt;const bi=class bi{constructor(e){g(this,nt,void 0);x(this,nt,freeze(e))}ifExists(){return new bi({...i(this,nt),node:DropTableNode.cloneWith(i(this,nt).node,{ifExists:!0})})}cascade(){return new bi({...i(this,nt),node:DropTableNode.cloneWith(i(this,nt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,nt).executor.transformQuery(i(this,nt).node,i(this,nt).queryId)}compile(){return i(this,nt).executor.compileQuery(this.toOperationNode(),i(this,nt).queryId)}async execute(){await i(this,nt).executor.executeQuery(this.compile(),i(this,nt).queryId)}};nt=new WeakMap;let DropTableBuilder=bi;preventAwait(DropTableBuilder,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const CreateViewNode=freeze({is(r){return r.kind==="CreateViewNode"},create(r){return freeze({kind:"CreateViewNode",name:SchemableIdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}});var wi;class ImmediateValuePlugin{constructor(){g(this,wi,new ImmediateValueTransformer)}transformQuery(e){return i(this,wi).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}wi=new WeakMap;var Ce;const Ht=class Ht{constructor(e){g(this,Ce,void 0);x(this,Ce,freeze(e))}temporary(){return new Ht({...i(this,Ce),node:CreateViewNode.cloneWith(i(this,Ce).node,{temporary:!0})})}materialized(){return new Ht({...i(this,Ce),node:CreateViewNode.cloneWith(i(this,Ce).node,{materialized:!0})})}ifNotExists(){return new Ht({...i(this,Ce),node:CreateViewNode.cloneWith(i(this,Ce).node,{ifNotExists:!0})})}orReplace(){return new Ht({...i(this,Ce),node:CreateViewNode.cloneWith(i(this,Ce).node,{orReplace:!0})})}columns(e){return new Ht({...i(this,Ce),node:CreateViewNode.cloneWith(i(this,Ce).node,{columns:e.map(parseColumnName)})})}as(e){const t=e.withPlugin(new ImmediateValuePlugin).toOperationNode();return new Ht({...i(this,Ce),node:CreateViewNode.cloneWith(i(this,Ce).node,{as:t})})}$call(e){return e(this)}toOperationNode(){return i(this,Ce).executor.transformQuery(i(this,Ce).node,i(this,Ce).queryId)}compile(){return i(this,Ce).executor.compileQuery(this.toOperationNode(),i(this,Ce).queryId)}async execute(){await i(this,Ce).executor.executeQuery(this.compile(),i(this,Ce).queryId)}};Ce=new WeakMap;let CreateViewBuilder=Ht;preventAwait(CreateViewBuilder,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const DropViewNode=freeze({is(r){return r.kind==="DropViewNode"},create(r){return freeze({kind:"DropViewNode",name:SchemableIdentifierNode.create(r)})},cloneWith(r,e){return freeze({...r,...e})}});var He;const En=class En{constructor(e){g(this,He,void 0);x(this,He,freeze(e))}materialized(){return new En({...i(this,He),node:DropViewNode.cloneWith(i(this,He).node,{materialized:!0})})}ifExists(){return new En({...i(this,He),node:DropViewNode.cloneWith(i(this,He).node,{ifExists:!0})})}cascade(){return new En({...i(this,He),node:DropViewNode.cloneWith(i(this,He).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,He).executor.transformQuery(i(this,He).node,i(this,He).queryId)}compile(){return i(this,He).executor.compileQuery(this.toOperationNode(),i(this,He).queryId)}async execute(){await i(this,He).executor.executeQuery(this.compile(),i(this,He).queryId)}};He=new WeakMap;let DropViewBuilder=En;preventAwait(DropViewBuilder,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const CreateTypeNode=freeze({is(r){return r.kind==="CreateTypeNode"},create(r){return freeze({kind:"CreateTypeNode",name:r})},cloneWithEnum(r,e){return freeze({...r,enum:ValueListNode.create(e.map(t=>ValueNode.createImmediate(t)))})}});var ct;const ls=class ls{constructor(e){g(this,ct,void 0);x(this,ct,freeze(e))}toOperationNode(){return i(this,ct).executor.transformQuery(i(this,ct).node,i(this,ct).queryId)}asEnum(e){return new ls({...i(this,ct),node:CreateTypeNode.cloneWithEnum(i(this,ct).node,e)})}$call(e){return e(this)}compile(){return i(this,ct).executor.compileQuery(this.toOperationNode(),i(this,ct).queryId)}async execute(){await i(this,ct).executor.executeQuery(this.compile(),i(this,ct).queryId)}};ct=new WeakMap;let CreateTypeBuilder=ls;preventAwait(CreateTypeBuilder,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const DropTypeNode=freeze({is(r){return r.kind==="DropTypeNode"},create(r){return freeze({kind:"DropTypeNode",name:r})},cloneWith(r,e){return freeze({...r,...e})}});var dt;const us=class us{constructor(e){g(this,dt,void 0);x(this,dt,freeze(e))}ifExists(){return new us({...i(this,dt),node:DropTypeNode.cloneWith(i(this,dt).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,dt).executor.transformQuery(i(this,dt).node,i(this,dt).queryId)}compile(){return i(this,dt).executor.compileQuery(this.toOperationNode(),i(this,dt).queryId)}async execute(){await i(this,dt).executor.executeQuery(this.compile(),i(this,dt).queryId)}};dt=new WeakMap;let DropTypeBuilder=us;preventAwait(DropTypeBuilder,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function parseSchemableIdentifier(r){const e=".";if(r.includes(e)){const t=r.split(e).map(trim);if(t.length===2)return SchemableIdentifierNode.createWithSchema(t[0],t[1]);throw new Error(`invalid schemable identifier ${r}`)}else return SchemableIdentifierNode.create(r)}function trim(r){return r.trim()}var Qe;const _n=class _n{constructor(e){g(this,Qe,void 0);x(this,Qe,e)}createTable(e){return new CreateTableBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateTableNode.create(parseTable(e))})}dropTable(e){return new DropTableBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropTableNode.create(parseTable(e))})}createIndex(e){return new CreateIndexBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateIndexNode.create(e)})}dropIndex(e){return new DropIndexBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropIndexNode.create(e)})}createSchema(e){return new CreateSchemaBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateSchemaNode.create(e)})}dropSchema(e){return new DropSchemaBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropSchemaNode.create(e)})}alterTable(e){return new AlterTableBuilder({queryId:createQueryId(),executor:i(this,Qe),node:AlterTableNode.create(parseTable(e))})}createView(e){return new CreateViewBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateViewNode.create(e)})}dropView(e){return new DropViewBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropViewNode.create(e)})}createType(e){return new CreateTypeBuilder({queryId:createQueryId(),executor:i(this,Qe),node:CreateTypeNode.create(parseSchemableIdentifier(e))})}dropType(e){return new DropTypeBuilder({queryId:createQueryId(),executor:i(this,Qe),node:DropTypeNode.create(parseSchemableIdentifier(e))})}withPlugin(e){return new _n(i(this,Qe).withPlugin(e))}withoutPlugins(){return new _n(i(this,Qe).withoutPlugins())}withSchema(e){return new _n(i(this,Qe).withPluginAtFront(new WithSchemaPlugin(e)))}};Qe=new WeakMap;let SchemaModule=_n;class DynamicModule{ref(e){return new DynamicReferenceBuilder(e)}}var Xr;class DefaultConnectionProvider{constructor(e){g(this,Xr,void 0);x(this,Xr,e)}async provideConnection(e){const t=await i(this,Xr).acquireConnection();try{return await e(t)}finally{await i(this,Xr).releaseConnection(t)}}}Xr=new WeakMap;var Ct,xt,Dt;const lr=class lr extends QueryExecutorBase{constructor(t,n,o,l=[]){super(l);g(this,Ct,void 0);g(this,xt,void 0);g(this,Dt,void 0);x(this,Ct,t),x(this,xt,n),x(this,Dt,o)}get adapter(){return i(this,xt)}compileQuery(t){return i(this,Ct).compileQuery(t)}provideConnection(t){return i(this,Dt).provideConnection(t)}withPlugins(t){return new lr(i(this,Ct),i(this,xt),i(this,Dt),[...this.plugins,...t])}withPlugin(t){return new lr(i(this,Ct),i(this,xt),i(this,Dt),[...this.plugins,t])}withPluginAtFront(t){return new lr(i(this,Ct),i(this,xt),i(this,Dt),[t,...this.plugins])}withConnectionProvider(t){return new lr(i(this,Ct),i(this,xt),t,[...this.plugins])}withoutPlugins(){return new lr(i(this,Ct),i(this,xt),i(this,Dt),[])}};Ct=new WeakMap,xt=new WeakMap,Dt=new WeakMap;let DefaultQueryExecutor=lr;function performanceNow(){return typeof performance<"u"&&isFunction(performance.now)?performance.now():Date.now()}var Et,Gt,Wt,Yr,Bt,xn,Ei,Vo,_i,Jo,gi,Ho,Oi,jo,An,es;class RuntimeDriver{constructor(e,t){g(this,Ei);g(this,_i);g(this,gi);g(this,Oi);g(this,An);g(this,Et,void 0);g(this,Gt,void 0);g(this,Wt,void 0);g(this,Yr,void 0);g(this,Bt,void 0);g(this,xn,new WeakSet);x(this,Yr,!1),x(this,Et,e),x(this,Gt,t)}async init(){if(i(this,Bt))throw new Error("driver has already been destroyed");i(this,Wt)||x(this,Wt,i(this,Et).init().then(()=>{x(this,Yr,!0)}).catch(e=>(x(this,Wt,void 0),Promise.reject(e)))),await i(this,Wt)}async acquireConnection(){if(i(this,Bt))throw new Error("driver has already been destroyed");i(this,Yr)||await this.init();const e=await i(this,Et).acquireConnection();return i(this,xn).has(e)||(Y(this,Ei,Vo).call(this)&&Y(this,_i,Jo).call(this,e),i(this,xn).add(e)),e}async releaseConnection(e){await i(this,Et).releaseConnection(e)}beginTransaction(e,t){return i(this,Et).beginTransaction(e,t)}commitTransaction(e){return i(this,Et).commitTransaction(e)}rollbackTransaction(e){return i(this,Et).rollbackTransaction(e)}async destroy(){i(this,Wt)&&(await i(this,Wt),i(this,Bt)||x(this,Bt,i(this,Et).destroy().catch(e=>(x(this,Bt,void 0),Promise.reject(e)))),await i(this,Bt))}}Et=new WeakMap,Gt=new WeakMap,Wt=new WeakMap,Yr=new WeakMap,Bt=new WeakMap,xn=new WeakMap,Ei=new WeakSet,Vo=function(){return i(this,Gt).isLevelEnabled("query")||i(this,Gt).isLevelEnabled("error")},_i=new WeakSet,Jo=function(e){const t=e.executeQuery;e.executeQuery=async n=>{let o;const l=performanceNow();try{return await t.call(e,n)}catch(c){throw o=c,await Y(this,gi,Ho).call(this,c,n,l),c}finally{o||await Y(this,Oi,jo).call(this,n,l)}}},gi=new WeakSet,Ho=async function(e,t,n){await i(this,Gt).error(()=>({level:"error",error:e,query:t,queryDurationMillis:Y(this,An,es).call(this,n)}))},Oi=new WeakSet,jo=async function(e,t){await i(this,Gt).query(()=>({level:"query",query:e,queryDurationMillis:Y(this,An,es).call(this,t)}))},An=new WeakSet,es=function(e){return performanceNow()-e};const ignoreError=()=>{};var kn,Xt,Ti,Ko;class SingleConnectionProvider{constructor(e){g(this,Ti);g(this,kn,void 0);g(this,Xt,void 0);x(this,kn,e)}async provideConnection(e){for(;i(this,Xt);)await i(this,Xt).catch(ignoreError);return x(this,Xt,Y(this,Ti,Ko).call(this,e).finally(()=>{x(this,Xt,void 0)})),i(this,Xt)}}kn=new WeakMap,Xt=new WeakMap,Ti=new WeakSet,Ko=async function(e){return await e(i(this,kn))};const TRANSACTION_ISOLATION_LEVELS=["read uncommitted","read committed","repeatable read","serializable","snapshot"];freeze(["query","error"]);var Yt,br;class Log{constructor(e){g(this,Yt,void 0);g(this,br,void 0);isFunction(e)?(x(this,br,e),x(this,Yt,freeze({query:!0,error:!0}))):(x(this,br,defaultLogger),x(this,Yt,freeze({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return i(this,Yt)[e]}async query(e){i(this,Yt).query&&await i(this,br).call(this,e())}async error(e){i(this,Yt).error&&await i(this,br).call(this,e())}}Yt=new WeakMap,br=new WeakMap;function defaultLogger(r){r.level==="query"?(console.log(`kysely:query: ${r.query.sql}`),console.log(`kysely:query: duration: ${r.queryDurationMillis.toFixed(1)}ms`)):r.level==="error"&&(r.error instanceof Error?console.error(`kysely:error: ${r.error.stack??r.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:r.error,query:r.query.sql,queryDurationMillis:r.queryDurationMillis})}`))}function isCompilable(r){return isObject$2(r)&&isFunction(r.compile)}var je;const qr=class qr extends QueryCreator{constructor(t){let n,o;if(isKyselyProps(t))n={executor:t.executor},o={...t};else{const l=t.dialect,c=l.createDriver(),f=l.createQueryCompiler(),h=l.createAdapter(),m=new Log(t.log??[]),b=new RuntimeDriver(c,m),E=new DefaultConnectionProvider(b),k=new DefaultQueryExecutor(f,h,E,t.plugins??[]);n={executor:k},o={config:t,executor:k,dialect:l,driver:b}}super(n);g(this,je,void 0);x(this,je,freeze(o))}get schema(){return new SchemaModule(i(this,je).executor)}get dynamic(){return new DynamicModule}get introspection(){return i(this,je).dialect.createIntrospector(this.withoutPlugins())}case(t){return new CaseBuilder({node:CaseNode.create(isUndefined(t)?void 0:parseExpression(t))})}get fn(){return createFunctionModule()}transaction(){return new TransactionBuilder({...i(this,je)})}connection(){return new ConnectionBuilder({...i(this,je)})}withPlugin(t){return new qr({...i(this,je),executor:i(this,je).executor.withPlugin(t)})}withoutPlugins(){return new qr({...i(this,je),executor:i(this,je).executor.withoutPlugins()})}withSchema(t){return new qr({...i(this,je),executor:i(this,je).executor.withPluginAtFront(new WithSchemaPlugin(t))})}withTables(){return new qr({...i(this,je)})}async destroy(){await i(this,je).driver.destroy()}get isTransaction(){return!1}getExecutor(){return i(this,je).executor}executeQuery(t,n=createQueryId()){const o=isCompilable(t)?t.compile():t;return this.getExecutor().executeQuery(o,n)}};je=new WeakMap;let Kysely=qr;var _t;const Dr=class Dr extends Kysely{constructor(t){super(t);g(this,_t,void 0);x(this,_t,t)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(t){return new Dr({...i(this,_t),executor:i(this,_t).executor.withPlugin(t)})}withoutPlugins(){return new Dr({...i(this,_t),executor:i(this,_t).executor.withoutPlugins()})}withSchema(t){return new Dr({...i(this,_t),executor:i(this,_t).executor.withPluginAtFront(new WithSchemaPlugin(t))})}withTables(){return new Dr({...i(this,_t)})}};_t=new WeakMap;let Transaction=Dr;function isKyselyProps(r){return isObject$2(r)&&isObject$2(r.config)&&isObject$2(r.driver)&&isObject$2(r.executor)&&isObject$2(r.dialect)}var wr;class ConnectionBuilder{constructor(e){g(this,wr,void 0);x(this,wr,freeze(e))}async execute(e){return i(this,wr).executor.provideConnection(async t=>{const n=i(this,wr).executor.withConnectionProvider(new SingleConnectionProvider(t)),o=new Kysely({...i(this,wr),executor:n});return await e(o)})}}wr=new WeakMap;preventAwait(ConnectionBuilder,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var gt;const cs=class cs{constructor(e){g(this,gt,void 0);x(this,gt,freeze(e))}setIsolationLevel(e){return new cs({...i(this,gt),isolationLevel:e})}async execute(e){const{isolationLevel:t,...n}=i(this,gt),o={isolationLevel:t};return validateTransactionSettings(o),i(this,gt).executor.provideConnection(async l=>{const c=i(this,gt).executor.withConnectionProvider(new SingleConnectionProvider(l)),f=new Transaction({...n,executor:c});try{await i(this,gt).driver.beginTransaction(l,o);const h=await e(f);return await i(this,gt).driver.commitTransaction(l),h}catch(h){throw await i(this,gt).driver.rollbackTransaction(l),h}})}};gt=new WeakMap;let TransactionBuilder=cs;preventAwait(TransactionBuilder,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function validateTransactionSettings(r){if(r.isolationLevel&&!TRANSACTION_ISOLATION_LEVELS.includes(r.isolationLevel))throw new Error(`invalid transaction isolation level ${r.isolationLevel}`)}var it,Zr,ii,Ln,ts,qn,rs;const gn=class gn{constructor(e){g(this,Zr);g(this,Ln);g(this,qn);g(this,it,void 0);x(this,it,freeze(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new AliasedRawBuilderImpl(this,e)}$castTo(){return new gn({...i(this,it)})}$notNull(){return new gn(i(this,it))}withPlugin(e){return new gn({...i(this,it),plugins:i(this,it).plugins!==void 0?freeze([...i(this,it).plugins,e]):freeze([e])})}toOperationNode(){return Y(this,Ln,ts).call(this,Y(this,Zr,ii).call(this))}compile(e){return Y(this,qn,rs).call(this,Y(this,Zr,ii).call(this,e))}async execute(e){const t=Y(this,Zr,ii).call(this,e);return t.executeQuery(Y(this,qn,rs).call(this,t),i(this,it).queryId)}};it=new WeakMap,Zr=new WeakSet,ii=function(e){const t=e!==void 0?e.getExecutor():NOOP_QUERY_EXECUTOR;return i(this,it).plugins!==void 0?t.withPlugins(i(this,it).plugins):t},Ln=new WeakSet,ts=function(e){return e.transformQuery(i(this,it).rawNode,i(this,it).queryId)},qn=new WeakSet,rs=function(e){return e.compileQuery(Y(this,Ln,ts).call(this,e),i(this,it).queryId)};let RawBuilderImpl=gn;function createRawBuilder(r){return new RawBuilderImpl(r)}preventAwait(RawBuilderImpl,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Er,Zt;class AliasedRawBuilderImpl{constructor(e,t){g(this,Er,void 0);g(this,Zt,void 0);x(this,Er,e),x(this,Zt,t)}get expression(){return i(this,Er)}get alias(){return i(this,Zt)}get rawBuilder(){return i(this,Er)}toOperationNode(){return AliasNode.create(i(this,Er).toOperationNode(),isOperationNodeSource(i(this,Zt))?i(this,Zt).toOperationNode():IdentifierNode.create(i(this,Zt)))}}Er=new WeakMap,Zt=new WeakMap;preventAwait(AliasedRawBuilderImpl,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const sql=Object.assign((r,...e)=>createRawBuilder({queryId:createQueryId(),rawNode:RawNode.create(r,(e==null?void 0:e.map(parseParameter))??[])}),{ref(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseStringReference(r))})},val(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseValueExpression(r))})},value(r){return this.val(r)},table(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(parseTable(r))})},id(...r){const e=new Array(r.length+1).fill(".");return e[0]="",e[e.length-1]="",createRawBuilder({queryId:createQueryId(),rawNode:RawNode.create(e,r.map(IdentifierNode.create))})},lit(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChild(ValueNode.createImmediate(r))})},literal(r){return this.lit(r)},raw(r){return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithSql(r)})},join(r,e=sql`, `){const t=new Array(2*r.length-1),n=e.toOperationNode();for(let o=0;o<r.length;++o)t[2*o]=parseParameter(r[o]),o!==r.length-1&&(t[2*o+1]=n);return createRawBuilder({queryId:createQueryId(),rawNode:RawNode.createWithChildren(t)})}});function parseParameter(r){return isOperationNodeSource(r)?r.toOperationNode():parseValueExpression(r)}var Si;class OperationNodeVisitor{constructor(){le(this,"nodeStack",[]);g(this,Si,freeze({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),AddIndexNode:this.visitAddIndex.bind(this)}));le(this,"visitNode",e=>{this.nodeStack.push(e),i(this,Si)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Si=new WeakMap;var en,_r;class DefaultQueryCompiler extends OperationNodeVisitor{constructor(){super(...arguments);g(this,en,"");g(this,_r,[])}get numParameters(){return i(this,_r).length}compileQuery(t){return x(this,en,""),x(this,_r,[]),this.visitNode(t),freeze({query:t,sql:this.getSql(),parameters:[...i(this,_r)]})}getSql(){return i(this,en)}visitSelectQuery(t){var o,l;const n=this.parentNode!==void 0&&!ParensNode.is(this.parentNode)&&!InsertQueryNode.is(this.parentNode)&&!CreateTableNode.is(this.parentNode)&&!CreateViewNode.is(this.parentNode)&&!SetOperationNode.is(this.parentNode);this.parentNode===void 0&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("select"),t.distinctOn&&(this.append(" "),this.compileDistinctOn(t.distinctOn)),(o=t.frontModifiers)!=null&&o.length&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.selections&&(this.append(" "),this.compileList(t.selections)),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.groupBy&&(this.append(" "),this.visitNode(t.groupBy)),t.having&&(this.append(" "),this.visitNode(t.having)),t.setOperations&&(this.append(" "),this.compileList(t.setOperations," ")),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.offset&&(this.append(" "),this.visitNode(t.offset)),(l=t.endModifiers)!=null&&l.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...t.endModifiers])," ")),n&&this.append(")")}visitFrom(t){this.append("from "),this.compileList(t.froms)}visitSelection(t){this.visitNode(t.selection)}visitColumn(t){this.visitNode(t.column)}compileDistinctOn(t){this.append("distinct on ("),this.compileList(t),this.append(")")}compileList(t,n=", "){const o=t.length-1;for(let l=0;l<=o;l++)this.visitNode(t[l]),l<o&&this.append(n)}visitWhere(t){this.append("where "),this.visitNode(t.where)}visitHaving(t){this.append("having "),this.visitNode(t.having)}visitInsertQuery(t){const n=this.nodeStack.find(QueryNode.is)!==t;!n&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append(t.replace?"replace":"insert"),t.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(t.into),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.values&&(this.append(" "),this.visitNode(t.values)),t.defaultValues&&(this.append(" "),this.append("default values")),t.onConflict&&(this.append(" "),this.visitNode(t.onConflict)),t.onDuplicateKey&&(this.append(" "),this.visitNode(t.onDuplicateKey)),t.returning&&(this.append(" "),this.visitNode(t.returning)),n&&this.append(")")}visitValues(t){this.append("values "),this.compileList(t.values)}visitDeleteQuery(t){const n=this.nodeStack.find(QueryNode.is)!==t;!n&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("delete "),this.visitNode(t.from),t.using&&(this.append(" "),this.visitNode(t.using)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.orderBy&&(this.append(" "),this.visitNode(t.orderBy)),t.limit&&(this.append(" "),this.visitNode(t.limit)),t.returning&&(this.append(" "),this.visitNode(t.returning)),n&&this.append(")")}visitReturning(t){this.append("returning "),this.compileList(t.selections)}visitAlias(t){this.visitNode(t.node),this.append(" as "),this.visitNode(t.alias)}visitReference(t){t.table&&(this.visitNode(t.table),this.append(".")),this.visitNode(t.column)}visitSelectAll(t){this.append("*")}visitIdentifier(t){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(t),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(t){if(!isString(t.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(t.name))}visitAnd(t){this.visitNode(t.left),this.append(" and "),this.visitNode(t.right)}visitOr(t){this.visitNode(t.left),this.append(" or "),this.visitNode(t.right)}visitValue(t){t.immediate?this.appendImmediateValue(t.value):this.appendValue(t.value)}visitValueList(t){this.append("("),this.compileList(t.values),this.append(")")}visitTuple(t){this.append("("),this.compileList(t.values),this.append(")")}visitPrimitiveValueList(t){this.append("(");const{values:n}=t;for(let o=0;o<n.length;++o)this.appendValue(n[o]),o!==n.length-1&&this.append(", ");this.append(")")}visitParens(t){this.append("("),this.visitNode(t.node),this.append(")")}visitJoin(t){this.append(JOIN_TYPE_SQL[t.joinType]),this.append(" "),this.visitNode(t.table),t.on&&(this.append(" "),this.visitNode(t.on))}visitOn(t){this.append("on "),this.visitNode(t.on)}visitRaw(t){const{sqlFragments:n,parameters:o}=t;for(let l=0;l<n.length;++l)this.append(n[l]),o.length>l&&this.visitNode(o[l])}visitOperator(t){this.append(t.operator)}visitTable(t){this.visitNode(t.table)}visitSchemableIdentifier(t){t.schema&&(this.visitNode(t.schema),this.append(".")),this.visitNode(t.identifier)}visitCreateTable(t){this.append("create "),t.frontModifiers&&t.frontModifiers.length>0&&(this.compileList(t.frontModifiers," "),this.append(" ")),t.temporary&&this.append("temporary "),this.append("table "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.table),t.selectQuery?(this.append(" as "),this.visitNode(t.selectQuery)):(this.append(" ("),this.compileList([...t.columns,...t.constraints??[]]),this.append(")"),t.onCommit&&(this.append(" on commit "),this.append(t.onCommit)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," ")))}visitColumnDefinition(t){this.visitNode(t.column),this.append(" "),this.visitNode(t.dataType),t.unsigned&&this.append(" unsigned"),t.frontModifiers&&t.frontModifiers.length>0&&(this.append(" "),this.compileList(t.frontModifiers," ")),t.generated&&(this.append(" "),this.visitNode(t.generated)),t.defaultTo&&(this.append(" "),this.visitNode(t.defaultTo)),t.notNull&&this.append(" not null"),t.unique&&this.append(" unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.primaryKey&&this.append(" primary key"),t.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),t.references&&(this.append(" "),this.visitNode(t.references)),t.check&&(this.append(" "),this.visitNode(t.check)),t.endModifiers&&t.endModifiers.length>0&&(this.append(" "),this.compileList(t.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(t){this.append("references "),this.visitNode(t.table),this.append(" ("),this.compileList(t.columns),this.append(")"),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate))}visitDropTable(t){this.append("drop table "),t.ifExists&&this.append("if exists "),this.visitNode(t.table),t.cascade&&this.append(" cascade")}visitDataType(t){this.append(t.dataType)}visitOrderBy(t){this.append("order by "),this.compileList(t.items)}visitOrderByItem(t){this.visitNode(t.orderBy),t.direction&&(this.append(" "),this.visitNode(t.direction))}visitGroupBy(t){this.append("group by "),this.compileList(t.items)}visitGroupByItem(t){this.visitNode(t.groupBy)}visitUpdateQuery(t){const n=this.nodeStack.find(QueryNode.is)!==t;!n&&t.explain&&(this.visitNode(t.explain),this.append(" ")),n&&this.append("("),t.with&&(this.visitNode(t.with),this.append(" ")),this.append("update "),this.visitNode(t.table),this.append(" set "),t.updates&&this.compileList(t.updates),t.from&&(this.append(" "),this.visitNode(t.from)),t.joins&&(this.append(" "),this.compileList(t.joins," ")),t.where&&(this.append(" "),this.visitNode(t.where)),t.returning&&(this.append(" "),this.visitNode(t.returning)),n&&this.append(")")}visitColumnUpdate(t){this.visitNode(t.column),this.append(" = "),this.visitNode(t.value)}visitLimit(t){this.append("limit "),this.visitNode(t.limit)}visitOffset(t){this.append("offset "),this.visitNode(t.offset)}visitOnConflict(t){this.append("on conflict"),t.columns?(this.append(" ("),this.compileList(t.columns),this.append(")")):t.constraint?(this.append(" on constraint "),this.visitNode(t.constraint)):t.indexExpression&&(this.append(" ("),this.visitNode(t.indexExpression),this.append(")")),t.indexWhere&&(this.append(" "),this.visitNode(t.indexWhere)),t.doNothing===!0?this.append(" do nothing"):t.updates&&(this.append(" do update set "),this.compileList(t.updates),t.updateWhere&&(this.append(" "),this.visitNode(t.updateWhere)))}visitOnDuplicateKey(t){this.append("on duplicate key update "),this.compileList(t.updates)}visitCreateIndex(t){this.append("create "),t.unique&&this.append("unique "),this.append("index "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.using&&(this.append(" using "),this.visitNode(t.using)),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.nullsNotDistinct&&this.append(" nulls not distinct"),t.where&&(this.append(" "),this.visitNode(t.where))}visitDropIndex(t){this.append("drop index "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.table&&(this.append(" on "),this.visitNode(t.table)),t.cascade&&this.append(" cascade")}visitCreateSchema(t){this.append("create schema "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.schema)}visitDropSchema(t){this.append("drop schema "),t.ifExists&&this.append("if exists "),this.visitNode(t.schema),t.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("primary key ("),this.compileList(t.columns),this.append(")")}visitUniqueConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("unique"),t.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(t.columns),this.append(")")}visitCheckConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("check ("),this.visitNode(t.expression),this.append(")")}visitForeignKeyConstraint(t){t.name&&(this.append("constraint "),this.visitNode(t.name),this.append(" ")),this.append("foreign key ("),this.compileList(t.columns),this.append(") "),this.visitNode(t.references),t.onDelete&&(this.append(" on delete "),this.append(t.onDelete)),t.onUpdate&&(this.append(" on update "),this.append(t.onUpdate))}visitList(t){this.compileList(t.items)}visitWith(t){this.append("with "),t.recursive&&this.append("recursive "),this.compileList(t.expressions)}visitCommonTableExpression(t){this.visitNode(t.name),this.append(" as "),isBoolean(t.materialized)&&(t.materialized||this.append("not "),this.append("materialized ")),this.visitNode(t.expression)}visitCommonTableExpressionName(t){this.visitNode(t.table),t.columns&&(this.append("("),this.compileList(t.columns),this.append(")"))}visitAlterTable(t){this.append("alter table "),this.visitNode(t.table),this.append(" "),t.renameTo&&(this.append("rename to "),this.visitNode(t.renameTo)),t.setSchema&&(this.append("set schema "),this.visitNode(t.setSchema)),t.addConstraint&&this.visitNode(t.addConstraint),t.dropConstraint&&this.visitNode(t.dropConstraint),t.columnAlterations&&this.compileColumnAlterations(t.columnAlterations),t.addIndex&&this.visitNode(t.addIndex),t.dropIndex&&this.visitNode(t.dropIndex)}visitAddColumn(t){this.append("add column "),this.visitNode(t.column)}visitRenameColumn(t){this.append("rename column "),this.visitNode(t.column),this.append(" to "),this.visitNode(t.renameTo)}visitDropColumn(t){this.append("drop column "),this.visitNode(t.column)}visitAlterColumn(t){this.append("alter column "),this.visitNode(t.column),this.append(" "),t.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(t.dataType),t.dataTypeExpression&&(this.append("using "),this.visitNode(t.dataTypeExpression))),t.setDefault&&(this.append("set default "),this.visitNode(t.setDefault)),t.dropDefault&&this.append("drop default"),t.setNotNull&&this.append("set not null"),t.dropNotNull&&this.append("drop not null")}visitModifyColumn(t){this.append("modify column "),this.visitNode(t.column)}visitAddConstraint(t){this.append("add "),this.visitNode(t.constraint)}visitDropConstraint(t){this.append("drop constraint "),t.ifExists&&this.append("if exists "),this.visitNode(t.constraintName),t.modifier==="cascade"?this.append(" cascade"):t.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(t){this.append(t.operator),this.append(" "),t.all&&this.append("all "),this.visitNode(t.expression)}visitCreateView(t){this.append("create "),t.orReplace&&this.append("or replace "),t.materialized&&this.append("materialized "),t.temporary&&this.append("temporary "),this.append("view "),t.ifNotExists&&this.append("if not exists "),this.visitNode(t.name),this.append(" "),t.columns&&(this.append("("),this.compileList(t.columns),this.append(") ")),t.as&&(this.append("as "),this.visitNode(t.as))}visitDropView(t){this.append("drop "),t.materialized&&this.append("materialized "),this.append("view "),t.ifExists&&this.append("if exists "),this.visitNode(t.name),t.cascade&&this.append(" cascade")}visitGenerated(t){this.append("generated "),t.always&&this.append("always "),t.byDefault&&this.append("by default "),this.append("as "),t.identity&&this.append("identity"),t.expression&&(this.append("("),this.visitNode(t.expression),this.append(")")),t.stored&&this.append(" stored")}visitDefaultValue(t){this.append("default "),this.visitNode(t.defaultValue)}visitSelectModifier(t){t.rawModifier?this.visitNode(t.rawModifier):this.append(SELECT_MODIFIER_SQL[t.modifier]),t.of&&(this.append(" of "),this.compileList(t.of,", "))}visitCreateType(t){this.append("create type "),this.visitNode(t.name),t.enum&&(this.append(" as enum "),this.visitNode(t.enum))}visitDropType(t){this.append("drop type "),t.ifExists&&this.append("if exists "),this.visitNode(t.name)}visitExplain(t){this.append("explain"),(t.options||t.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),t.options&&(this.visitNode(t.options),t.format&&this.append(this.getExplainOptionsDelimiter())),t.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(t.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(t){this.append("default")}visitAggregateFunction(t){this.append(t.func),this.append("("),t.distinct&&this.append("distinct "),this.compileList(t.aggregated),this.append(")"),t.filter&&(this.append(" filter("),this.visitNode(t.filter),this.append(")")),t.over&&(this.append(" "),this.visitNode(t.over))}visitOver(t){this.append("over("),t.partitionBy&&(this.visitNode(t.partitionBy),t.orderBy&&this.append(" ")),t.orderBy&&this.visitNode(t.orderBy),this.append(")")}visitPartitionBy(t){this.append("partition by "),this.compileList(t.items)}visitPartitionByItem(t){this.visitNode(t.partitionBy)}visitBinaryOperation(t){this.visitNode(t.leftOperand),this.append(" "),this.visitNode(t.operator),this.append(" "),this.visitNode(t.rightOperand)}visitUnaryOperation(t){this.visitNode(t.operator),this.isMinusOperator(t.operator)||this.append(" "),this.visitNode(t.operand)}isMinusOperator(t){return OperatorNode.is(t)&&t.operator==="-"}visitUsing(t){this.append("using "),this.compileList(t.tables)}visitFunction(t){this.append(t.func),this.append("("),this.compileList(t.arguments),this.append(")")}visitCase(t){this.append("case"),t.value&&(this.append(" "),this.visitNode(t.value)),t.when&&(this.append(" "),this.compileList(t.when," ")),t.else&&(this.append(" else "),this.visitNode(t.else)),this.append(" end"),t.isStatement&&this.append(" case")}visitWhen(t){this.append("when "),this.visitNode(t.condition),t.result&&(this.append(" then "),this.visitNode(t.result))}visitJSONReference(t){this.visitNode(t.reference),this.visitNode(t.traversal)}visitJSONPath(t){t.inOperator&&this.visitNode(t.inOperator),this.append("'$");for(const n of t.pathLegs)this.visitNode(n);this.append("'")}visitJSONPathLeg(t){const n=t.type==="ArrayLocation";this.append(n?"[":"."),this.append(String(t.value)),n&&this.append("]")}visitJSONOperatorChain(t){for(let n=0,o=t.values.length;n<o;n++)n===o-1?this.visitNode(t.operator):this.append("->"),this.visitNode(t.values[n])}visitAddIndex(t){this.append("add "),t.unique&&this.append("unique "),this.append("index "),this.visitNode(t.name),t.columns&&(this.append(" ("),this.compileList(t.columns),this.append(")")),t.using&&(this.append(" using "),this.visitNode(t.using))}append(t){x(this,en,i(this,en)+t)}appendValue(t){this.addParameter(t),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(t){const n=this.getLeftIdentifierWrapper(),o=this.getRightIdentifierWrapper();let l="";for(const c of t)l+=c,c===n?l+=n:c===o&&(l+=o);return l}addParameter(t){i(this,_r).push(t)}appendImmediateValue(t){if(isString(t))this.append(`'${t}'`);else if(isNumber(t)||isBoolean(t))this.append(t.toString());else if(isNull(t))this.append("null");else if(isDate(t))this.appendImmediateValue(t.toISOString());else if(isBigInt(t))this.appendImmediateValue(t.toString());else throw new Error(`invalid immediate value ${t}`)}sortSelectModifiers(t){return t.sort((n,o)=>n.modifier&&o.modifier?SELECT_MODIFIER_PRIORITY[n.modifier]-SELECT_MODIFIER_PRIORITY[o.modifier]:1),freeze(t)}compileColumnAlterations(t){this.compileList(t)}announcesNewColumnDataType(){return!0}}en=new WeakMap,_r=new WeakMap;const SELECT_MODIFIER_SQL=freeze({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),SELECT_MODIFIER_PRIORITY=freeze({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),JOIN_TYPE_SQL=freeze({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),CompiledQuery=freeze({raw(r,e=[]){return freeze({sql:r,query:RawNode.createWithSql(r),parameters:freeze(e)})}});class DialectAdapterBase{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}}var Ft,Dn,tn,rn;class SqliteDriver{constructor(e){g(this,Ft,void 0);g(this,Dn,new ConnectionMutex);g(this,tn,void 0);g(this,rn,void 0);x(this,Ft,freeze({...e}))}async init(){x(this,tn,isFunction(i(this,Ft).database)?await i(this,Ft).database():i(this,Ft).database),x(this,rn,new SqliteConnection(i(this,tn))),i(this,Ft).onCreateConnection&&await i(this,Ft).onCreateConnection(i(this,rn))}async acquireConnection(){return await i(this,Dn).lock(),i(this,rn)}async beginTransaction(e){await e.executeQuery(CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(CompiledQuery.raw("rollback"))}async releaseConnection(){i(this,Dn).unlock()}async destroy(){var e;(e=i(this,tn))==null||e.close()}}Ft=new WeakMap,Dn=new WeakMap,tn=new WeakMap,rn=new WeakMap;var nn;class SqliteConnection{constructor(e){g(this,nn,void 0);x(this,nn,e)}executeQuery(e){const{sql:t,parameters:n}=e,o=i(this,nn).prepare(t);if(o.reader)return Promise.resolve({rows:o.all(n)});{const{changes:l,lastInsertRowid:c}=o.run(n),f=l!=null?BigInt(l):void 0;return Promise.resolve({numUpdatedOrDeletedRows:f,numAffectedRows:f,insertId:c!=null?BigInt(c):void 0,rows:[]})}}async*streamQuery(e,t){const{sql:n,parameters:o,query:l}=e,c=i(this,nn).prepare(n);if(SelectQueryNode.is(l)){const f=c.iterate(o);for(const h of f)yield{rows:[h]}}else throw new Error("Sqlite driver only supports streaming of select queries")}}nn=new WeakMap;var gr,sn;class ConnectionMutex{constructor(){g(this,gr,void 0);g(this,sn,void 0)}async lock(){for(;i(this,gr);)await i(this,gr);x(this,gr,new Promise(e=>{x(this,sn,e)}))}unlock(){const e=i(this,sn);x(this,gr,void 0),x(this,sn,void 0),e==null||e()}}gr=new WeakMap,sn=new WeakMap;const ID_WRAP_REGEX=/"/g;class SqliteQueryCompiler extends DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(ID_WRAP_REGEX,'""')}visitDefaultInsertValue(e){this.append("null")}}const DEFAULT_MIGRATION_TABLE="kysely_migration",DEFAULT_MIGRATION_LOCK_TABLE="kysely_migration_lock";freeze({__noMigrations__:!0});var on,Ii,Go;class SqliteIntrospector{constructor(e){g(this,Ii);g(this,on,void 0);x(this,on,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let t=i(this,on).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(t=t.where("name","!=",DEFAULT_MIGRATION_TABLE).where("name","!=",DEFAULT_MIGRATION_LOCK_TABLE));const n=await t.execute();return Promise.all(n.map(({name:o})=>Y(this,Ii,Go).call(this,o)))}async getMetadata(e){return{tables:await this.getTables(e)}}}on=new WeakMap,Ii=new WeakSet,Go=async function(e){var c,f,h,m,b,E;const t=i(this,on),n=await t.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),o=(E=(b=(m=(h=(f=(c=n.sql)==null?void 0:c.split(/[\(\),]/))==null?void 0:f.find(k=>k.toLowerCase().includes("autoincrement")))==null?void 0:h.trimStart())==null?void 0:m.split(/\s+/))==null?void 0:b[0])==null?void 0:E.replace(/["`]/g,""),l=await t.selectFrom(sql`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:n.type==="view",columns:l.map(k=>({name:k.name,dataType:k.type,isNullable:!k.notnull,isAutoIncrementing:k.name===o,hasDefaultValue:k.dflt_value!=null}))}};class SqliteAdapter extends DialectAdapterBase{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}var Wn;class SqliteDialect{constructor(e){g(this,Wn,void 0);x(this,Wn,freeze({...e}))}createDriver(){return new SqliteDriver(i(this,Wn))}createQueryCompiler(){return new SqliteQueryCompiler}createAdapter(){return new SqliteAdapter}createIntrospector(e){return new SqliteIntrospector(e)}}Wn=new WeakMap;function toBytes(r){return Uint8Array.from([...r].map(e=>e.charCodeAt(0)))}function fromBytes(r){return String.fromCharCode(...r)}function encode(r){return r.length?[fromBytes(r[0].site_id),...r.flatMap(e=>[e.cid,fromBytes(e.pk),e.table,JSON.stringify(e.val),e.db_version,e.col_version,e.cl,e.seq])]:[]}function decode(r){if(!r[0])return[];const e=toBytes(r[0]),t=[];for(let n=1;n<r.length;n+=8){const o=JSON.parse(r[n+3]);t.push({site_id:e,cid:r[n],pk:toBytes(r[n+1]),table:r[n+2],val:o&&typeof o=="object"?new Uint8Array(Object.values(o)):o,db_version:r[n+4],col_version:r[n+5],cl:r[n+6],seq:r[n+7]})}return t}function selectVersion(){const r=sql`SELECT 
    crsql_db_version() as current,
    IFNULL(MAX(version), 0) as synced
  FROM "__crstore_sync"`;return{execute:()=>r.execute(this).then(e=>e.rows[0])}}function updateVersion(r){return this.updateTable("__crstore_sync").set({version:r??sql`crsql_db_version()`})}function selectClient(){const r=sql`SELECT crsql_site_id() as client`;return{execute:()=>r.execute(this).then(e=>fromBytes(e.rows[0].client))}}function changesSince(r,e){let t=this.selectFrom("crsql_changes").select(sql`crsql_site_id()`.as("site_id")).select(["cid","pk","table","val","db_version","col_version","cl","seq"]).where("db_version",">",r).$if(!r,n=>n.where("cid","!=","__crsql_del")).$if(e===null,n=>n.where("site_id","is",sql`crsql_site_id()`)).$if(typeof e=="string",n=>n.where("site_id","is not",toBytes(e))).$castTo();return{execute:()=>t.execute().then(encode)}}function insertChanges(r){const e=async t=>{r.length&&(await t.insertInto("crsql_changes").values(decode(r)).execute(),await updateVersion.bind(t)().execute())};return{execute:()=>this.isTransaction?e(this):this.transaction().execute(e)}}function resolveChanges(r){return{execute:()=>applyOperation.bind(this)(e=>insertChanges.bind(e)(r).execute()).execute().then(e=>e.changes)}}function applyOperation(r,...e){return{execute:()=>this.transaction().execute(async t=>{const{current:n}=await selectVersion.bind(t)().execute(),o=await r(t,...e),l=await changesSince.bind(t)(n).execute();return{result:o,changes:l}})}}function finalize(){const r=sql`select crsql_finalize();`;return{execute:()=>r.execute(this)}}function affectedTables(r){var e,t,n,o;if(Array.isArray(r)){const l=new Set;for(let c=3;c<r.length;c+=8)l.add(r[c]);return[...l]}if(r.kind==="TableNode")return[r.table.identifier.name];if(r.kind==="ReferenceNode"&&r.table)return[r.table.table.identifier.name];if(r.kind==="AliasNode")return affectedTables(r.node);if(r.kind==="SelectQueryNode"){const l=[...((e=r.from)==null?void 0:e.froms)||[],...((t=r.joins)==null?void 0:t.map(c=>c.table))||[],...((n=r.selections)==null?void 0:n.map(c=>c.selection))||[],...((o=r.with)==null?void 0:o.expressions.map(c=>c.expression))||[]].flatMap(affectedTables);return[...new Set(l)]}return[]}const wasmUrl=""+new URL("../assets/crsqlite.52890b09.wasm",import.meta.url).href;var Module=(()=>{var r=import.meta.url;return function(e={}){var t=e,n,o;t.ready=new Promise((s,a)=>{n=s,o=a});var l=Object.assign({},t),c="./this.program",f=(s,a)=>{throw a},h=typeof window=="object",m=typeof importScripts=="function",b="",E;(h||m)&&(m?b=self.location.href:typeof document<"u"&&document.currentScript&&(b=document.currentScript.src),r&&(b=r),b.indexOf("blob:")!==0?b=b.substr(0,b.replace(/[?#].*/,"").lastIndexOf("/")+1):b="",m&&(E=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}));var k=t.print||console.log.bind(console),L=t.printErr||console.error.bind(console);Object.assign(t,l),l=null,t.thisProgram&&(c=t.thisProgram),t.quit&&(f=t.quit);var I;t.wasmBinary&&(I=t.wasmBinary);var p=t.noExitRuntime||!0;typeof WebAssembly!="object"&&be("no native wasm support detected");var w,y=!1,_,R,A,j,S,F,he,G;function $(){var s=w.buffer;t.HEAP8=R=new Int8Array(s),t.HEAP16=j=new Int16Array(s),t.HEAPU8=A=new Uint8Array(s),t.HEAPU16=new Uint16Array(s),t.HEAP32=S=new Int32Array(s),t.HEAPU32=F=new Uint32Array(s),t.HEAPF32=he=new Float32Array(s),t.HEAPF64=G=new Float64Array(s)}var z=[],H=[],ue=[],X=[],oe=0;function ye(){var s=t.preRun.shift();z.unshift(s)}var M=0,te=null;function be(s){throw t.onAbort&&t.onAbort(s),s="Aborted("+s+")",L(s),y=!0,_=1,s=new WebAssembly.RuntimeError(s+". Build with -sASSERTIONS for more info."),o(s),s}function Te(s){return s.startsWith("data:application/octet-stream;base64,")}var ce;if(t.locateFile){if(ce="crsqlite.wasm",!Te(ce)){var Ye=ce;ce=t.locateFile?t.locateFile(Ye,b):b+Ye}}else ce=new URL(""+new URL("../assets/crsqlite.52890b09.wasm",import.meta.url).href,self.location).href;function at(s){if(s==ce&&I)return new Uint8Array(I);if(E)return E(s);throw"both async and sync fetching of the wasm failed"}function Ze(s){return I||!h&&!m||typeof fetch!="function"?Promise.resolve().then(()=>at(s)):fetch(s,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+s+"'";return a.arrayBuffer()}).catch(()=>at(s))}function Qt(s,a,u){return Ze(s).then(d=>WebAssembly.instantiate(d,a)).then(d=>d).then(u,d=>{L(`failed to asynchronously prepare wasm: ${d}`),be(d)})}function Mt(s,a){var u=ce;return I||typeof WebAssembly.instantiateStreaming!="function"||Te(u)||typeof fetch!="function"?Qt(u,s,a):fetch(u,{credentials:"same-origin"}).then(d=>WebAssembly.instantiateStreaming(d,s).then(a,function(N){return L(`wasm streaming compile failed: ${N}`),L("falling back to ArrayBuffer instantiation"),Qt(u,s,a)}))}var J,we;function Vn(s){this.name="ExitStatus",this.message=`Program terminated with exit(${s})`,this.status=s}var Cr=s=>{for(;0<s.length;)s.shift()(t)};function Ie(s,a="i8"){switch(a.endsWith("*")&&(a="*"),a){case"i1":return R[s>>0];case"i8":return R[s>>0];case"i16":return j[s>>1];case"i32":return S[s>>2];case"i64":be("to do getValue(i64) use WASM_BIGINT");case"float":return he[s>>2];case"double":return G[s>>3];case"*":return F[s>>2];default:be(`invalid type for getValue: ${a}`)}}function Pe(s,a,u="i8"){switch(u.endsWith("*")&&(u="*"),u){case"i1":R[s>>0]=a;break;case"i8":R[s>>0]=a;break;case"i16":j[s>>1]=a;break;case"i32":S[s>>2]=a;break;case"i64":be("to do setValue(i64) use WASM_BIGINT");case"float":he[s>>2]=a;break;case"double":G[s>>3]=a;break;case"*":F[s>>2]=a;break;default:be(`invalid type for setValue: ${u}`)}}var Tt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,se=(s,a,u)=>{var d=a+u;for(u=a;s[u]&&!(u>=d);)++u;if(16<u-a&&s.buffer&&Tt)return Tt.decode(s.subarray(a,u));for(d="";a<u;){var N=s[a++];if(N&128){var T=s[a++]&63;if((N&224)==192)d+=String.fromCharCode((N&31)<<6|T);else{var O=s[a++]&63;N=(N&240)==224?(N&15)<<12|T<<6|O:(N&7)<<18|T<<12|O<<6|s[a++]&63,65536>N?d+=String.fromCharCode(N):(N-=65536,d+=String.fromCharCode(55296|N>>10,56320|N&1023))}}else d+=String.fromCharCode(N)}return d},Jn=(s,a)=>{for(var u=0,d=s.length-1;0<=d;d--){var N=s[d];N==="."?s.splice(d,1):N===".."?(s.splice(d,1),u++):u&&(s.splice(d,1),u--)}if(a)for(;u;u--)s.unshift("..");return s},pt=s=>{var a=s.charAt(0)==="/",u=s.substr(-1)==="/";return(s=Jn(s.split("/").filter(d=>!!d),!a).join("/"))||a||(s="."),s&&u&&(s+="/"),(a?"/":"")+s},qi=s=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(s).slice(1);return s=a[0],a=a[1],!s&&!a?".":(a&&(a=a.substr(0,a.length-1)),s+a)},xr=s=>{if(s==="/")return"/";s=pt(s),s=s.replace(/\/$/,"");var a=s.lastIndexOf("/");return a===-1?s:s.substr(a+1)},V=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return s=>crypto.getRandomValues(s);be("initRandomDevice")},pe=s=>(pe=V())(s);function ve(){for(var s="",a=!1,u=arguments.length-1;-1<=u&&!a;u--){if(a=0<=u?arguments[u]:"/",typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";s=a+"/"+s,a=a.charAt(0)==="/"}return s=Jn(s.split("/").filter(d=>!!d),!a).join("/"),(a?"/":"")+s||"."}var xe=[],Ue=s=>{for(var a=0,u=0;u<s.length;++u){var d=s.charCodeAt(u);127>=d?a++:2047>=d?a+=2:55296<=d&&57343>=d?(a+=4,++u):a+=3}return a},ke=(s,a,u,d)=>{if(!(0<d))return 0;var N=u;d=u+d-1;for(var T=0;T<s.length;++T){var O=s.charCodeAt(T);if(55296<=O&&57343>=O){var D=s.charCodeAt(++T);O=65536+((O&1023)<<10)|D&1023}if(127>=O){if(u>=d)break;a[u++]=O}else{if(2047>=O){if(u+1>=d)break;a[u++]=192|O>>6}else{if(65535>=O){if(u+2>=d)break;a[u++]=224|O>>12}else{if(u+3>=d)break;a[u++]=240|O>>18,a[u++]=128|O>>12&63}a[u++]=128|O>>6&63}a[u++]=128|O&63}}return a[u]=0,u-N},rr=[];function ft(s,a){rr[s]={input:[],Ub:[],ec:a},zi(s,Di)}var Di={open(s){var a=rr[s.node.ic];if(!a)throw new B(43);s.Vb=a,s.seekable=!1},close(s){s.Vb.ec.lc(s.Vb)},lc(s){s.Vb.ec.lc(s.Vb)},read(s,a,u,d){if(!s.Vb||!s.Vb.ec.Ac)throw new B(60);for(var N=0,T=0;T<d;T++){try{var O=s.Vb.ec.Ac(s.Vb)}catch{throw new B(29)}if(O===void 0&&N===0)throw new B(6);if(O==null)break;N++,a[u+T]=O}return N&&(s.node.timestamp=Date.now()),N},write(s,a,u,d){if(!s.Vb||!s.Vb.ec.uc)throw new B(60);try{for(var N=0;N<d;N++)s.Vb.ec.uc(s.Vb,a[u+N])}catch{throw new B(29)}return d&&(s.node.timestamp=Date.now()),N}},Wi={Ac(){e:{if(!xe.length){var s=null;if(typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`)),!s){var a=null;break e}a=Array(Ue(s)+1),s=ke(s,a,0,a.length),a.length=s,xe=a}a=xe.shift()}return a},uc(s,a){a===null||a===10?(k(se(s.Ub,0)),s.Ub=[]):a!=0&&s.Ub.push(a)},lc(s){s.Ub&&0<s.Ub.length&&(k(se(s.Ub,0)),s.Ub=[])},ad(){return{Xc:25856,Zc:5,Wc:191,Yc:35387,Vc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},bd(){return 0},cd(){return[24,80]}},na={uc(s,a){a===null||a===10?(L(se(s.Ub,0)),s.Ub=[]):a!=0&&s.Ub.push(a)},lc(s){s.Ub&&0<s.Ub.length&&(L(se(s.Ub,0)),s.Ub=[])}};function ds(s,a){var u=s.Qb?s.Qb.length:0;u>=a||(a=Math.max(a,u*(1048576>u?2:1.125)>>>0),u!=0&&(a=Math.max(a,256)),u=s.Qb,s.Qb=new Uint8Array(a),0<s.Sb&&s.Qb.set(u.subarray(0,s.Sb),0))}var ae={Yb:null,Xb(){return ae.createNode(null,"/",16895,0)},createNode(s,a,u,d){if((u&61440)===24576||(u&61440)===4096)throw new B(63);return ae.Yb||(ae.Yb={dir:{node:{Wb:ae.Fb.Wb,Tb:ae.Fb.Tb,fc:ae.Fb.fc,mc:ae.Fb.mc,Ec:ae.Fb.Ec,rc:ae.Fb.rc,pc:ae.Fb.pc,Dc:ae.Fb.Dc,qc:ae.Fb.qc},stream:{bc:ae.Pb.bc}},file:{node:{Wb:ae.Fb.Wb,Tb:ae.Fb.Tb},stream:{bc:ae.Pb.bc,read:ae.Pb.read,write:ae.Pb.write,xc:ae.Pb.xc,nc:ae.Pb.nc,oc:ae.Pb.oc}},link:{node:{Wb:ae.Fb.Wb,Tb:ae.Fb.Tb,jc:ae.Fb.jc},stream:{}},yc:{node:{Wb:ae.Fb.Wb,Tb:ae.Fb.Tb},stream:aa}}),u=ms(s,a,u,d),ht(u.mode)?(u.Fb=ae.Yb.dir.node,u.Pb=ae.Yb.dir.stream,u.Qb={}):(u.mode&61440)===32768?(u.Fb=ae.Yb.file.node,u.Pb=ae.Yb.file.stream,u.Sb=0,u.Qb=null):(u.mode&61440)===40960?(u.Fb=ae.Yb.link.node,u.Pb=ae.Yb.link.stream):(u.mode&61440)===8192&&(u.Fb=ae.Yb.yc.node,u.Pb=ae.Yb.yc.stream),u.timestamp=Date.now(),s&&(s.Qb[a]=u,s.timestamp=u.timestamp),u},$c(s){return s.Qb?s.Qb.subarray?s.Qb.subarray(0,s.Sb):new Uint8Array(s.Qb):new Uint8Array(0)},Fb:{Wb(s){var a={};return a.Kc=(s.mode&61440)===8192?s.id:1,a.Bc=s.id,a.mode=s.mode,a.Qc=1,a.uid=0,a.Nc=0,a.ic=s.ic,ht(s.mode)?a.size=4096:(s.mode&61440)===32768?a.size=s.Sb:(s.mode&61440)===40960?a.size=s.link.length:a.size=0,a.Gc=new Date(s.timestamp),a.Pc=new Date(s.timestamp),a.Jc=new Date(s.timestamp),a.Hc=4096,a.Ic=Math.ceil(a.size/a.Hc),a},Tb(s,a){if(a.mode!==void 0&&(s.mode=a.mode),a.timestamp!==void 0&&(s.timestamp=a.timestamp),a.size!==void 0&&(a=a.size,s.Sb!=a))if(a==0)s.Qb=null,s.Sb=0;else{var u=s.Qb;s.Qb=new Uint8Array(a),u&&s.Qb.set(u.subarray(0,Math.min(a,s.Sb))),s.Sb=a}},fc(){throw Fi[44]},mc(s,a,u,d){return ae.createNode(s,a,u,d)},Ec(s,a,u){if(ht(s.mode)){try{var d=nr(a,u)}catch{}if(d)for(var N in d.Qb)throw new B(55)}delete s.parent.Qb[s.name],s.parent.timestamp=Date.now(),s.name=u,a.Qb[u]=s,a.timestamp=s.parent.timestamp,s.parent=a},rc(s,a){delete s.Qb[a],s.timestamp=Date.now()},pc(s,a){var u=nr(s,a),d;for(d in u.Qb)throw new B(55);delete s.Qb[a],s.timestamp=Date.now()},Dc(s){var a=[".",".."],u;for(u in s.Qb)s.Qb.hasOwnProperty(u)&&a.push(u);return a},qc(s,a,u){return s=ae.createNode(s,a,41471,0),s.link=u,s},jc(s){if((s.mode&61440)!==40960)throw new B(28);return s.link}},Pb:{read(s,a,u,d,N){var T=s.node.Qb;if(N>=s.node.Sb)return 0;if(s=Math.min(s.node.Sb-N,d),8<s&&T.subarray)a.set(T.subarray(N,N+s),u);else for(d=0;d<s;d++)a[u+d]=T[N+d];return s},write(s,a,u,d,N,T){if(a.buffer===R.buffer&&(T=!1),!d)return 0;if(s=s.node,s.timestamp=Date.now(),a.subarray&&(!s.Qb||s.Qb.subarray)){if(T)return s.Qb=a.subarray(u,u+d),s.Sb=d;if(s.Sb===0&&N===0)return s.Qb=a.slice(u,u+d),s.Sb=d;if(N+d<=s.Sb)return s.Qb.set(a.subarray(u,u+d),N),d}if(ds(s,N+d),s.Qb.subarray&&a.subarray)s.Qb.set(a.subarray(u,u+d),N);else for(T=0;T<d;T++)s.Qb[N+T]=a[u+T];return s.Sb=Math.max(s.Sb,N+d),d},bc(s,a,u){if(u===1?a+=s.position:u===2&&(s.node.mode&61440)===32768&&(a+=s.node.Sb),0>a)throw new B(28);return a},xc(s,a,u){ds(s.node,a+u),s.node.Sb=Math.max(s.node.Sb,a+u)},nc(s,a,u,d,N){if((s.node.mode&61440)!==32768)throw new B(43);if(s=s.node.Qb,N&2||s.buffer!==R.buffer){if((0<u||u+a<s.length)&&(s.subarray?s=s.subarray(u,u+a):s=Array.prototype.slice.call(s,u,u+a)),u=!0,a=65536*Math.ceil(a/65536),(N=xo(65536,a))?(A.fill(0,N,N+a),a=N):a=0,!a)throw new B(48);R.set(s,a)}else u=!1,a=s.byteOffset;return{Rc:a,Fc:u}},oc(s,a,u,d){return ae.Pb.write(s,a,0,d,u,!1),0}}},ia=(s,a)=>{var u=0;return s&&(u|=365),a&&(u|=146),u},Bi=null,fs={},dn=[],sa=1,Ut=null,hs=!0,B=null,Fi={};function st(s,a={}){if(s=ve(s),!s)return{path:"",node:null};if(a=Object.assign({zc:!0,vc:0},a),8<a.vc)throw new B(32);s=s.split("/").filter(O=>!!O);for(var u=Bi,d="/",N=0;N<s.length;N++){var T=N===s.length-1;if(T&&a.parent)break;if(u=nr(u,s[N]),d=pt(d+"/"+s[N]),u.cc&&(!T||T&&a.zc)&&(u=u.cc.root),!T||a.ac){for(T=0;(u.mode&61440)===40960;)if(u=gs(d),d=ve(qi(d),u),u=st(d,{vc:a.vc+1}).node,40<T++)throw new B(32)}}return{path:d,node:u}}function Hn(s){for(var a;;){if(s===s.parent)return s=s.Xb.Cc,a?s[s.length-1]!=="/"?`${s}/${a}`:s+a:s;a=a?`${s.name}/${a}`:s.name,s=s.parent}}function Pi(s,a){for(var u=0,d=0;d<a.length;d++)u=(u<<5)-u+a.charCodeAt(d)|0;return(s+u>>>0)%Ut.length}function ps(s){var a=Pi(s.parent.id,s.name);if(Ut[a]===s)Ut[a]=s.dc;else for(a=Ut[a];a;){if(a.dc===s){a.dc=s.dc;break}a=a.dc}}function nr(s,a){var u;if(u=(u=Ar(s,"x"))?u:s.Fb.fc?0:2)throw new B(u,s);for(u=Ut[Pi(s.id,a)];u;u=u.dc){var d=u.name;if(u.parent.id===s.id&&d===a)return u}return s.Fb.fc(s,a)}function ms(s,a,u,d){return s=new Io(s,a,u,d),a=Pi(s.parent.id,s.name),s.dc=Ut[a],Ut[a]=s}function ht(s){return(s&61440)===16384}function Ns(s){var a=["r","w","rw"][s&3];return s&512&&(a+="w"),a}function Ar(s,a){if(hs)return 0;if(!a.includes("r")||s.mode&292){if(a.includes("w")&&!(s.mode&146)||a.includes("x")&&!(s.mode&73))return 2}else return 2;return 0}function ys(s,a){try{return nr(s,a),20}catch{}return Ar(s,"wx")}function bs(s,a,u){try{var d=nr(s,a)}catch(N){return N.Rb}if(s=Ar(s,"wx"))return s;if(u){if(!ht(d.mode))return 54;if(d===d.parent||Hn(d)==="/")return 10}else if(ht(d.mode))return 31;return 0}function oa(){for(var s=0;4096>=s;s++)if(!dn[s])return s;throw new B(33)}function et(s){if(s=dn[s],!s)throw new B(8);return s}function ws(s,a=-1){return hn||(hn=function(){this.kc={}},hn.prototype={},Object.defineProperties(hn.prototype,{object:{get(){return this.node},set(u){this.node=u}},flags:{get(){return this.kc.flags},set(u){this.kc.flags=u}},position:{get(){return this.kc.position},set(u){this.kc.position=u}}})),s=Object.assign(new hn,s),a==-1&&(a=oa()),s.Zb=a,dn[a]=s}var aa={open(s){s.Pb=fs[s.node.ic].Pb,s.Pb.open&&s.Pb.open(s)},bc(){throw new B(70)}};function zi(s,a){fs[s]={Pb:a}}function Es(s,a){var u=a==="/",d=!a;if(u&&Bi)throw new B(10);if(!u&&!d){var N=st(a,{zc:!1});if(a=N.path,N=N.node,N.cc)throw new B(10);if(!ht(N.mode))throw new B(54)}a={type:s,ed:{},Cc:a,Oc:[]},s=s.Xb(a),s.Xb=a,a.root=s,u?Bi=s:N&&(N.cc=a,N.Xb&&N.Xb.Oc.push(a))}function Qi(s,a,u){var d=st(s,{parent:!0}).node;if(s=xr(s),!s||s==="."||s==="..")throw new B(28);var N=ys(d,s);if(N)throw new B(N);if(!d.Fb.mc)throw new B(63);return d.Fb.mc(d,s,a,u)}function St(s,a){return Qi(s,(a!==void 0?a:511)&1023|16384,0)}function jn(s,a,u){typeof u>"u"&&(u=a,a=438),Qi(s,a|8192,u)}function Mi(s,a){if(!ve(s))throw new B(44);var u=st(a,{parent:!0}).node;if(!u)throw new B(44);a=xr(a);var d=ys(u,a);if(d)throw new B(d);if(!u.Fb.qc)throw new B(63);u.Fb.qc(u,a,s)}function _s(s){var a=st(s,{parent:!0}).node;s=xr(s);var u=nr(a,s),d=bs(a,s,!0);if(d)throw new B(d);if(!a.Fb.pc)throw new B(63);if(u.cc)throw new B(10);a.Fb.pc(a,s),ps(u)}function gs(s){if(s=st(s).node,!s)throw new B(44);if(!s.Fb.jc)throw new B(28);return ve(Hn(s.parent),s.Fb.jc(s))}function Kn(s,a){if(s=st(s,{ac:!a}).node,!s)throw new B(44);if(!s.Fb.Wb)throw new B(63);return s.Fb.Wb(s)}function Os(s){return Kn(s,!0)}function Ts(s,a){if(s=typeof s=="string"?st(s,{ac:!0}).node:s,!s.Fb.Tb)throw new B(63);s.Fb.Tb(s,{mode:a&4095|s.mode&-4096,timestamp:Date.now()})}function Ss(s,a){if(0>a)throw new B(28);if(s=typeof s=="string"?st(s,{ac:!0}).node:s,!s.Fb.Tb)throw new B(63);if(ht(s.mode))throw new B(31);if((s.mode&61440)!==32768)throw new B(28);var u=Ar(s,"w");if(u)throw new B(u);s.Fb.Tb(s,{size:a,timestamp:Date.now()})}function Gn(s,a,u){if(s==="")throw new B(44);if(typeof a=="string"){var d={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[a];if(typeof d>"u")throw Error(`Unknown file open mode: ${a}`);a=d}if(u=a&64?(typeof u>"u"?438:u)&4095|32768:0,typeof s=="object")var N=s;else{s=pt(s);try{N=st(s,{ac:!(a&131072)}).node}catch{}}if(d=!1,a&64)if(N){if(a&128)throw new B(20)}else N=Qi(s,u,0),d=!0;if(!N)throw new B(44);if((N.mode&61440)===8192&&(a&=-513),a&65536&&!ht(N.mode))throw new B(54);if(!d&&(u=N?(N.mode&61440)===40960?32:ht(N.mode)&&(Ns(a)!=="r"||a&512)?31:Ar(N,Ns(a)):44))throw new B(u);return a&512&&!d&&Ss(N,0),a&=-131713,N=ws({node:N,path:Hn(N),flags:a,seekable:!0,position:0,Pb:N.Pb,Uc:[],error:!1}),N.Pb.open&&N.Pb.open(N),!t.logReadFiles||a&1||(Xn||(Xn={}),s in Xn||(Xn[s]=1)),N}function Is(s,a,u){if(s.Zb===null)throw new B(8);if(!s.seekable||!s.Pb.bc)throw new B(70);if(u!=0&&u!=1&&u!=2)throw new B(28);s.position=s.Pb.bc(s,a,u),s.Uc=[]}function vs(){B||(B=function(s,a){this.name="ErrnoError",this.node=a,this.Sc=function(u){this.Rb=u},this.Sc(s),this.message="FS error"},B.prototype=Error(),B.prototype.constructor=B,[44].forEach(s=>{Fi[s]=new B(s),Fi[s].stack="<generic error, no stack>"}))}var Rs;function fn(s,a,u){s=pt("/dev/"+s);var d=ia(!!a,!!u);Ui||(Ui=64);var N=Ui++<<8|0;zi(N,{open(T){T.seekable=!1},close(){u&&u.buffer&&u.buffer.length&&u(10)},read(T,O,D,v){for(var C=0,P=0;P<v;P++){try{var q=a()}catch{throw new B(29)}if(q===void 0&&C===0)throw new B(6);if(q==null)break;C++,O[D+P]=q}return C&&(T.node.timestamp=Date.now()),C},write(T,O,D,v){for(var C=0;C<v;C++)try{u(O[D+C])}catch{throw new B(29)}return v&&(T.node.timestamp=Date.now()),C}}),jn(s,d,N)}var Ui,Se={},hn,Xn;function ir(s,a,u){if(a.charAt(0)==="/")return a;if(s=s===-100?"/":et(s).path,a.length==0){if(!u)throw new B(44);return s}return pt(s+"/"+a)}function Yn(s,a,u){try{var d=s(a)}catch(T){if(T&&T.node&&pt(a)!==pt(Hn(T.node)))return-54;throw T}S[u>>2]=d.Kc,S[u+4>>2]=d.mode,F[u+8>>2]=d.Qc,S[u+12>>2]=d.uid,S[u+16>>2]=d.Nc,S[u+20>>2]=d.ic,we=[d.size>>>0,(J=d.size,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],S[u+24>>2]=we[0],S[u+28>>2]=we[1],S[u+32>>2]=4096,S[u+36>>2]=d.Ic,s=d.Gc.getTime(),a=d.Pc.getTime();var N=d.Jc.getTime();return we=[Math.floor(s/1e3)>>>0,(J=Math.floor(s/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],S[u+40>>2]=we[0],S[u+44>>2]=we[1],F[u+48>>2]=s%1e3*1e3,we=[Math.floor(a/1e3)>>>0,(J=Math.floor(a/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],S[u+56>>2]=we[0],S[u+60>>2]=we[1],F[u+64>>2]=a%1e3*1e3,we=[Math.floor(N/1e3)>>>0,(J=Math.floor(N/1e3),1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],S[u+72>>2]=we[0],S[u+76>>2]=we[1],F[u+80>>2]=N%1e3*1e3,we=[d.Bc>>>0,(J=d.Bc,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],S[u+88>>2]=we[0],S[u+92>>2]=we[1],0}var Zn=void 0;function ei(){var s=S[Zn>>2];return Zn+=4,s}var pn=(s,a)=>a+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*a:NaN,la=[0,31,60,91,121,152,182,213,244,274,305,335],ua=[0,31,59,90,120,151,181,212,243,273,304,334],Cs=s=>{var a=Ue(s)+1,u=ji(a);return u&&ke(s,A,u,a),u},$i={},xs=()=>{if(!Vi){var s={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:c||"./this.program"},a;for(a in $i)$i[a]===void 0?delete s[a]:s[a]=$i[a];var u=[];for(a in s)u.push(`${a}=${s[a]}`);Vi=u}return Vi},Vi;function As(){}function ks(){}function Ls(){}function qs(){}function Ds(){}function Ws(){}function Bs(){}function Fs(){}function Ps(){}function zs(){}function Qs(){}function Ms(){}function Us(){}function $s(){}function Vs(){}function Js(){}function Hs(){}function js(){}function Ks(){}function Gs(){}function Xs(){}function Ys(){}function Zs(){}function eo(){}function ro(){}function no(){}function io(){}function so(){}function oo(){}function ao(){}function lo(){}function uo(){}function co(){}function fo(){}function ho(){}function po(){}function mo(){}function No(){}function yo(){}function bo(){}var wo=s=>{_=s,p||0<oe||(t.onExit&&t.onExit(s),y=!0),f(s,new Vn(s))},Ji=s=>{s instanceof Vn||s=="unwind"||f(1,s)},ti=s=>{try{s()}catch(a){be(a)}};function ca(s){var a={},u;for(u in s)(function(d){var N=s[d];a[d]=typeof N=="function"?function(){ri.push(d);try{return N.apply(null,arguments)}finally{y||(ri.pop()===d||be(),It&&$t===1&&ri.length===0&&($t=0,ti(Do),typeof Fibers<"u"&&Fibers.fd()))}}:N})(u);return a}var $t=0,It=null,Eo=0,ri=[],_o={},go={},da=0,Hi=null,fa=[];function ha(){return new Promise((s,a)=>{Hi={resolve:s,reject:a}})}function pa(){var s=ji(16396),a=s+12;F[s>>2]=a,F[s+4>>2]=a+16384,a=ri[0];var u=_o[a];return u===void 0&&(u=da++,_o[a]=u,go[u]=a),S[s+8>>2]=u,s}function Oo(s){if(!y){if($t===0){var a=!1,u=!1;s((d=0)=>{if(!y&&(Eo=d,a=!0,u)){$t=2,ti(()=>Wo(It)),typeof Browser<"u"&&Browser.tc.Mc&&Browser.tc.resume(),d=!1;try{var N=(0,U[go[S[It+8>>2]]])()}catch(D){N=D,d=!0}var T=!1;if(!It){var O=Hi;O&&(Hi=null,(d?O.reject:O.resolve)(N),T=!0)}if(d&&!T)throw N}}),u=!0,a||($t=1,It=pa(),typeof Browser<"u"&&Browser.tc.Mc&&Browser.tc.pause(),ti(()=>qo(It)))}else $t===2?($t=0,ti(Bo),Ro(It),It=null,fa.forEach(d=>{if(!y)try{if(d(),!(p||0<oe))try{_=d=_,wo(d)}catch(N){Ji(N)}}catch(N){Ji(N)}})):be(`invalid state: ${$t}`);return Eo}}function To(s){return Oo(a=>{s().then(a)})}var So={},mt=(s,a,u,d,N)=>{function T(q){return--oe,v!==0&&Lo(v),a==="string"?q?se(A,q):"":a==="boolean"?!!q:q}var O={string:q=>{var Q=0;if(q!=null&&q!==0){Q=Ue(q)+1;var ne=Ki(Q);ke(q,A,ne,Q),Q=ne}return Q},array:q=>{var Q=Ki(q.length);return R.set(q,Q),Q}};s=t["_"+s];var D=[],v=0;if(d)for(var C=0;C<d.length;C++){var P=O[u[C]];P?(v===0&&(v=ko()),D[C]=P(d[C])):D[C]=d[C]}return u=It,d=s.apply(null,D),N=N&&N.async,oe+=1,It!=u?ha().then(T):(d=T(d),N?Promise.resolve(d):d)};function Io(s,a,u,d){s||(s=this),this.parent=s,this.Xb=s.Xb,this.cc=null,this.id=sa++,this.name=a,this.mode=u,this.Fb={},this.Pb={},this.ic=d}Object.defineProperties(Io.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(s){s?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(s){s?this.mode|=146:this.mode&=-147}}}),vs(),Ut=Array(4096),Es(ae,"/"),St("/tmp"),St("/home"),St("/home/web_user"),function(){St("/dev"),zi(259,{read:()=>0,write:(d,N,T,O)=>O}),jn("/dev/null",259),ft(1280,Wi),ft(1536,na),jn("/dev/tty",1280),jn("/dev/tty1",1536);var s=new Uint8Array(1024),a=0,u=()=>(a===0&&(a=pe(s).byteLength),s[--a]);fn("random",u),fn("urandom",u),St("/dev/shm"),St("/dev/shm/tmp")}(),function(){St("/proc");var s=St("/proc/self");St("/proc/self/fd"),Es({Xb(){var a=ms(s,"fd",16895,73);return a.Fb={fc(u,d){var N=et(+d);return u={parent:null,Xb:{Cc:"fake"},Fb:{jc:()=>N.path}},u.parent=u}},a}},"/proc/self/fd")}(),function(){const s=new Map;t.setAuthorizer=function(a,u,d){return u?s.set(a,{f:u,wc:d}):s.delete(a),mt("set_authorizer","number",["number"],[a])},As=function(a,u,d,N,T,O){if(s.has(a)){const{f:D,wc:v}=s.get(a);return D(v,u,d?d?se(A,d):"":null,N?N?se(A,N):"":null,T?T?se(A,T):"":null,O?O?se(A,O):"":null)}return 0}}(),function(){function s(d,N){const T=[];for(let O=0;d[N+O]!=0;++O){if(1e3<O)throw Error("C-string never terminated after 1k characters");T.push(d[N+O])}return String.fromCharCode(...T)}const a=new Map,u=new Map;t.updateHook=function(d,N){const T=a.size;return a.set(T,N),mt("update_hook","void",["number","number"],[d,T])},t.createFunction=function(d,N,T,O,D,v){const C=a.size;return a.set(C,{f:v,$b:D}),mt("create_function","number","number string number number number number".split(" "),[d,N,T,O,C,0])},t.createAggregate=function(d,N,T,O,D,v,C){const P=a.size;return a.set(P,{step:v,Lc:C,$b:D}),mt("create_function","number","number string number number number number".split(" "),[d,N,T,O,P,1])},t.getFunctionUserData=function(d){return u.get(d)},Ws=function(d,N,T,O,D,v){d=a.get(d);const C=A;D=BigInt(v)<<32n|BigInt(D)&4294967295n,d(N,s(C,T),s(C,O),D)},Ls=function(d,N,T,O){d=a.get(d),u.set(N,d.$b),d.f(N,new Uint32Array(A.buffer,O,T)),u.delete(N)},Ds=function(d,N,T,O){d=a.get(d),u.set(N,d.$b),d.step(N,new Uint32Array(A.buffer,O,T)),u.delete(N)},ks=function(d,N){d=a.get(d),u.set(N,d.$b),d.Lc(N),u.delete(N)}}(),function(){const s=new Map;t.progressHandler=function(a,u,d,N){return d?s.set(a,{f:d,wc:N}):s.delete(a),mt("progress_handler",null,["number","number"],[a,u])},qs=function(a){if(s.has(a)){const{f:u,wc:d}=s.get(a);return u(d)}return 0}}(),function(){function s(v,C){const P=`get${v}`,q=`set${v}`;return new Proxy(new DataView(A.buffer,C,v==="Int32"?4:8),{get(Q,ne){if(ne===P)return function(me,ze){if(!ze)throw Error("must be little endian");return Q[ne](me,ze)};if(ne===q)return function(me,ze,Le){if(!Le)throw Error("must be little endian");return Q[ne](me,ze,Le)};if(typeof ne=="string"&&ne.match(/^(get)|(set)/))throw Error("invalid type");return Q[ne]}})}const a=typeof So=="object",u=new Map,d=new Map,N=new Map,T=a?new Set:null,O=a?new Set:null,D=new Map;Zs=function(v,C,P,q){D.set(v?se(A,v):"",{size:C,hc:Array.from(new Uint32Array(A.buffer,q,P))})},t.createModule=function(v,C,P,q){a&&(P.handleAsync=To);const Q=u.size;return u.set(Q,{module:P,$b:q}),q=0,P.xCreate&&(q|=1),P.xConnect&&(q|=2),P.xBestIndex&&(q|=4),P.xDisconnect&&(q|=8),P.xDestroy&&(q|=16),P.xOpen&&(q|=32),P.xClose&&(q|=64),P.xFilter&&(q|=128),P.xNext&&(q|=256),P.xEof&&(q|=512),P.xColumn&&(q|=1024),P.xRowid&&(q|=2048),P.xUpdate&&(q|=4096),P.xBegin&&(q|=8192),P.xSync&&(q|=16384),P.xCommit&&(q|=32768),P.xRollback&&(q|=65536),P.xFindFunction&&(q|=131072),P.xRename&&(q|=262144),mt("create_module","number",["number","string","number","number"],[v,C,Q,q])},Us=function(v,C,P,q,Q,ne){if(C=u.get(C),d.set(Q,C),a){T.delete(Q);for(const me of T)d.delete(me)}return q=Array.from(new Uint32Array(A.buffer,q,P)).map(me=>me?se(A,me):""),C.module.xCreate(v,C.$b,q,Q,s("Int32",ne))},Ms=function(v,C,P,q,Q,ne){if(C=u.get(C),d.set(Q,C),a){T.delete(Q);for(const me of T)d.delete(me)}return q=Array.from(new Uint32Array(A.buffer,q,P)).map(me=>me?se(A,me):""),C.module.xConnect(v,C.$b,q,Q,s("Int32",ne))},Fs=function(v,C){var P=d.get(v),q=D.get("sqlite3_index_info").hc;const Q={};Q.nConstraint=Ie(C+q[0],"i32"),Q.aConstraint=[];for(var ne=Ie(C+q[1],"*"),me=D.get("sqlite3_index_constraint").size,ze=0;ze<Q.nConstraint;++ze){var Le=Q.aConstraint,ot=Le.push,$e=ne+ze*me,kr=D.get("sqlite3_index_constraint").hc,Vt={};Vt.iColumn=Ie($e+kr[0],"i32"),Vt.op=Ie($e+kr[1],"i8"),Vt.usable=!!Ie($e+kr[2],"i8"),ot.call(Le,Vt)}for(Q.nOrderBy=Ie(C+q[2],"i32"),Q.aOrderBy=[],ne=Ie(C+q[3],"*"),me=D.get("sqlite3_index_orderby").size,ze=0;ze<Q.nOrderBy;++ze)Le=Q.aOrderBy,ot=Le.push,$e=ne+ze*me,kr=D.get("sqlite3_index_orderby").hc,Vt={},Vt.iColumn=Ie($e+kr[0],"i32"),Vt.desc=!!Ie($e+kr[1],"i8"),ot.call(Le,Vt);for(Q.aConstraintUsage=[],ne=0;ne<Q.nConstraint;++ne)Q.aConstraintUsage.push({argvIndex:0,omit:!1});for(Q.idxNum=Ie(C+q[5],"i32"),Q.idxStr=null,Q.orderByConsumed=!!Ie(C+q[8],"i8"),Q.estimatedCost=Ie(C+q[9],"double"),Q.estimatedRows=Ie(C+q[10],"i32"),Q.idxFlags=Ie(C+q[11],"i32"),Q.colUsed=Ie(C+q[12],"i32"),v=P.module.xBestIndex(v,Q),P=D.get("sqlite3_index_info").hc,q=Ie(C+P[4],"*"),ne=D.get("sqlite3_index_constraint_usage").size,ot=0;ot<Q.nConstraint;++ot)me=q+ot*ne,Le=Q.aConstraintUsage[ot],$e=D.get("sqlite3_index_constraint_usage").hc,Pe(me+$e[0],Le.argvIndex,"i32"),Pe(me+$e[1],Le.omit?1:0,"i8");return Pe(C+P[5],Q.idxNum,"i32"),typeof Q.idxStr=="string"&&(q=Ue(Q.idxStr),ne=mt("sqlite3_malloc","number",["number"],[q+1]),ke(Q.idxStr,A,ne,q+1),Pe(C+P[6],ne,"*"),Pe(C+P[7],1,"i32")),Pe(C+P[8],Q.orderByConsumed,"i32"),Pe(C+P[9],Q.estimatedCost,"double"),Pe(C+P[10],Q.estimatedRows,"i32"),Pe(C+P[11],Q.idxFlags,"i32"),v},Vs=function(v){const C=d.get(v);return a?T.add(v):d.delete(v),C.module.xDisconnect(v)},$s=function(v){const C=d.get(v);return a?T.add(v):d.delete(v),C.module.xDestroy(v)},Ks=function(v,C){const P=d.get(v);if(N.set(C,P),a){O.delete(C);for(const q of O)N.delete(q)}return P.module.xOpen(v,C)},Ps=function(v){const C=N.get(v);return a?O.add(v):N.delete(v),C.module.xClose(v)},Js=function(v){return N.get(v).module.xEof(v)?1:0},Hs=function(v,C,P,q,Q){const ne=N.get(v);return P=P?P?se(A,P):"":null,Q=new Uint32Array(A.buffer,Q,q),ne.module.xFilter(v,C,P,Q)},js=function(v){return N.get(v).module.xNext(v)},zs=function(v,C,P){return N.get(v).module.xColumn(v,C,P)},Ys=function(v,C){return N.get(v).module.xRowid(v,s("BigInt64",C))},ro=function(v,C,P,q){const Q=d.get(v);return P=new Uint32Array(A.buffer,P,C),Q.module.xUpdate(v,P,s("BigInt64",q))},Bs=function(v){return d.get(v).module.xBegin(v)},eo=function(v){return d.get(v).module.xSync(v)},Qs=function(v){return d.get(v).module.xCommit(v)},Xs=function(v){return d.get(v).module.xRollback(v)},Gs=function(v,C){const P=d.get(v);return C=C?se(A,C):"",P.module.xRename(v,C)}}(),function(){function s(O,D){const v=`get${O}`,C=`set${O}`;return new Proxy(new DataView(A.buffer,D,O==="Int32"?4:8),{get(P,q){if(q===v)return function(Q,ne){if(!ne)throw Error("must be little endian");return P[q](Q,ne)};if(q===C)return function(Q,ne,me){if(!me)throw Error("must be little endian");return P[q](Q,ne,me)};if(typeof q=="string"&&q.match(/^(get)|(set)/))throw Error("invalid type");return P[q]}})}function a(O){return O>>=2,F[O]+F[O+1]*2**32}const u=typeof So=="object",d=new Map,N=new Map;t.registerVFS=function(O,D){if(mt("sqlite3_vfs_find","number",["string"],[O.name]))throw Error(`VFS '${O.name}' already registered`);u&&(O.handleAsync=To);var v=O.dd??64;const C=t._malloc(4);return D=mt("register_vfs","number",["string","number","number","number"],[O.name,v,D?1:0,C]),D||(v=Ie(C,"*"),d.set(v,O)),t._free(C),D};const T=u?new Set:null;so=function(O){const D=N.get(O);return u?T.add(O):N.delete(O),D.xClose(O)},ho=function(O,D,v,C){return N.get(O).xRead(O,A.subarray(D,D+v),a(C))},bo=function(O,D,v,C){return N.get(O).xWrite(O,A.subarray(D,D+v),a(C))},No=function(O,D){return N.get(O).xTruncate(O,a(D))},mo=function(O,D){return N.get(O).xSync(O,D)},uo=function(O,D){const v=N.get(O);return D=s("BigInt64",D),v.xFileSize(O,D)},co=function(O,D){return N.get(O).xLock(O,D)},yo=function(O,D){return N.get(O).xUnlock(O,D)},io=function(O,D){const v=N.get(O);return D=s("Int32",D),v.xCheckReservedLock(O,D)},lo=function(O,D,v){const C=N.get(O);return v=new DataView(A.buffer,v),C.xFileControl(O,D,v)},po=function(O){return N.get(O).xSectorSize(O)},ao=function(O){return N.get(O).xDeviceCharacteristics(O)},fo=function(O,D,v,C,P){if(O=d.get(O),N.set(v,O),u){T.delete(v);for(var q of T)N.delete(q)}if(q=null,C&64){q=1;const Q=[];for(;q;){const ne=A[D++];if(ne)Q.push(ne);else switch(A[D]||(q=null),q){case 1:Q.push(63),q=2;break;case 2:Q.push(61),q=3;break;case 3:Q.push(38),q=2}}q=new TextDecoder().decode(new Uint8Array(Q))}else D&&(q=D?se(A,D):"");return P=s("Int32",P),O.xOpen(q,v,C,P)},oo=function(O,D,v){return d.get(O).xDelete(D?se(A,D):"",v)},no=function(O,D,v,C){return O=d.get(O),C=s("Int32",C),O.xAccess(D?se(A,D):"",v,C)}}();var ma={a:(s,a,u,d)=>{be(`Assertion failed: ${s?se(A,s):""}, at: `+[a?a?se(A,a):"":"unknown filename",u,d?d?se(A,d):"":"unknown function"])},L:function(s,a){try{return s=s?se(A,s):"",Ts(s,a),0}catch(u){if(typeof Se>"u"||u.name!=="ErrnoError")throw u;return-u.Rb}},N:function(s,a,u){try{if(a=a?se(A,a):"",a=ir(s,a),u&-8)return-28;var d=st(a,{ac:!0}).node;return d?(s="",u&4&&(s+="r"),u&2&&(s+="w"),u&1&&(s+="x"),s&&Ar(d,s)?-2:0):-44}catch(N){if(typeof Se>"u"||N.name!=="ErrnoError")throw N;return-N.Rb}},M:function(s,a){try{var u=et(s);return Ts(u.node,a),0}catch(d){if(typeof Se>"u"||d.name!=="ErrnoError")throw d;return-d.Rb}},K:function(s){try{var a=et(s).node,u=typeof a=="string"?st(a,{ac:!0}).node:a;if(!u.Fb.Tb)throw new B(63);return u.Fb.Tb(u,{timestamp:Date.now()}),0}catch(d){if(typeof Se>"u"||d.name!=="ErrnoError")throw d;return-d.Rb}},b:function(s,a,u){Zn=u;try{var d=et(s);switch(a){case 0:var N=ei();if(0>N)return-28;for(;dn[N];)N++;return ws(d,N).Zb;case 1:case 2:return 0;case 3:return d.flags;case 4:return N=ei(),d.flags|=N,0;case 5:return N=ei(),j[N+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return S[vo()>>2]=28,-1;default:return-28}}catch(T){if(typeof Se>"u"||T.name!=="ErrnoError")throw T;return-T.Rb}},J:function(s,a){try{var u=et(s);return Yn(Kn,u.path,a)}catch(d){if(typeof Se>"u"||d.name!=="ErrnoError")throw d;return-d.Rb}},n:function(s,a,u){a=pn(a,u);try{if(isNaN(a))return 61;var d=et(s);if(!(d.flags&2097155))throw new B(28);return Ss(d.node,a),0}catch(N){if(typeof Se>"u"||N.name!=="ErrnoError")throw N;return-N.Rb}},D:function(s,a){try{if(a===0)return-28;var u=Ue("/")+1;return a<u?-68:(ke("/",A,s,a),u)}catch(d){if(typeof Se>"u"||d.name!=="ErrnoError")throw d;return-d.Rb}},G:function(s,a){try{return s=s?se(A,s):"",Yn(Os,s,a)}catch(u){if(typeof Se>"u"||u.name!=="ErrnoError")throw u;return-u.Rb}},A:function(s,a,u){try{return a=a?se(A,a):"",a=ir(s,a),a=pt(a),a[a.length-1]==="/"&&(a=a.substr(0,a.length-1)),St(a,u),0}catch(d){if(typeof Se>"u"||d.name!=="ErrnoError")throw d;return-d.Rb}},F:function(s,a,u,d){try{a=a?se(A,a):"";var N=d&256;return a=ir(s,a,d&4096),Yn(N?Os:Kn,a,u)}catch(T){if(typeof Se>"u"||T.name!=="ErrnoError")throw T;return-T.Rb}},z:function(s,a,u,d){Zn=d;try{a=a?se(A,a):"",a=ir(s,a);var N=d?ei():0;return Gn(a,u,N).Zb}catch(T){if(typeof Se>"u"||T.name!=="ErrnoError")throw T;return-T.Rb}},w:function(s,a,u,d){try{if(a=a?se(A,a):"",a=ir(s,a),0>=d)return-28;var N=gs(a),T=Math.min(d,Ue(N)),O=R[u+T];return ke(N,A,u,d+1),R[u+T]=O,T}catch(D){if(typeof Se>"u"||D.name!=="ErrnoError")throw D;return-D.Rb}},v:function(s){try{return s=s?se(A,s):"",_s(s),0}catch(a){if(typeof Se>"u"||a.name!=="ErrnoError")throw a;return-a.Rb}},H:function(s,a){try{return s=s?se(A,s):"",Yn(Kn,s,a)}catch(u){if(typeof Se>"u"||u.name!=="ErrnoError")throw u;return-u.Rb}},r:function(s,a,u){try{if(a=a?se(A,a):"",a=ir(s,a),u===0){s=a;var d=st(s,{parent:!0}).node;if(!d)throw new B(44);var N=xr(s),T=nr(d,N),O=bs(d,N,!1);if(O)throw new B(O);if(!d.Fb.rc)throw new B(63);if(T.cc)throw new B(10);d.Fb.rc(d,N),ps(T)}else u===512?_s(a):be("Invalid flags passed to unlinkat");return 0}catch(D){if(typeof Se>"u"||D.name!=="ErrnoError")throw D;return-D.Rb}},q:function(s,a,u){try{if(a=a?se(A,a):"",a=ir(s,a,!0),u){var d=F[u>>2]+4294967296*S[u+4>>2],N=S[u+8>>2];T=1e3*d+N/1e6,u+=16,d=F[u>>2]+4294967296*S[u+4>>2],N=S[u+8>>2],O=1e3*d+N/1e6}else var T=Date.now(),O=T;s=T;var D=st(a,{ac:!0}).node;return D.Fb.Tb(D,{timestamp:Math.max(s,O)}),0}catch(v){if(typeof Se>"u"||v.name!=="ErrnoError")throw v;return-v.Rb}},k:function(s,a,u){s=new Date(1e3*pn(s,a)),S[u>>2]=s.getSeconds(),S[u+4>>2]=s.getMinutes(),S[u+8>>2]=s.getHours(),S[u+12>>2]=s.getDate(),S[u+16>>2]=s.getMonth(),S[u+20>>2]=s.getFullYear()-1900,S[u+24>>2]=s.getDay(),a=s.getFullYear(),S[u+28>>2]=(a%4!==0||a%100===0&&a%400!==0?ua:la)[s.getMonth()]+s.getDate()-1|0,S[u+36>>2]=-(60*s.getTimezoneOffset()),a=new Date(s.getFullYear(),6,1).getTimezoneOffset();var d=new Date(s.getFullYear(),0,1).getTimezoneOffset();S[u+32>>2]=(a!=d&&s.getTimezoneOffset()==Math.min(d,a))|0},i:function(s,a,u,d,N,T,O,D){N=pn(N,T);try{if(isNaN(N))return 61;var v=et(d);if(a&2&&!(u&2)&&(v.flags&2097155)!==2)throw new B(2);if((v.flags&2097155)===1)throw new B(2);if(!v.Pb.nc)throw new B(43);var C=v.Pb.nc(v,s,N,a,u),P=C.Rc;return S[O>>2]=C.Fc,F[D>>2]=P,0}catch(q){if(typeof Se>"u"||q.name!=="ErrnoError")throw q;return-q.Rb}},j:function(s,a,u,d,N,T,O){T=pn(T,O);try{if(isNaN(T))return 61;var D=et(N);if(u&2){if((D.node.mode&61440)!==32768)throw new B(43);d&2||D.Pb.oc&&D.Pb.oc(D,A.slice(s,s+a),T,a,d)}}catch(v){if(typeof Se>"u"||v.name!=="ErrnoError")throw v;return-v.Rb}},s:(s,a,u)=>{function d(v){return(v=v.toTimeString().match(/\(([A-Za-z ]+)\)$/))?v[1]:"GMT"}var N=new Date().getFullYear(),T=new Date(N,0,1),O=new Date(N,6,1);N=T.getTimezoneOffset();var D=O.getTimezoneOffset();F[s>>2]=60*Math.max(N,D),S[a>>2]=+(N!=D),s=d(T),a=d(O),s=Cs(s),a=Cs(a),D<N?(F[u>>2]=s,F[u+4>>2]=a):(F[u>>2]=a,F[u+4>>2]=s)},e:()=>Date.now(),d:()=>performance.now(),t:(s,a,u)=>A.copyWithin(s,a,a+u),o:s=>{var a=A.length;if(s>>>=0,2147483648<s)return!1;for(var u=1;4>=u;u*=2){var d=a*(1+.2/u);d=Math.min(d,s+100663296);var N=Math;d=Math.max(s,d);e:{N=(N.min.call(N,2147483648,d+(65536-d%65536)%65536)-w.buffer.byteLength+65535)/65536;try{w.grow(N),$();var T=1;break e}catch{}T=void 0}if(T)return!0}return!1},B:(s,a)=>{var u=0;return xs().forEach((d,N)=>{var T=a+u;for(N=F[s+4*N>>2]=T,T=0;T<d.length;++T)R[N++>>0]=d.charCodeAt(T);R[N>>0]=0,u+=d.length+1}),0},C:(s,a)=>{var u=xs();F[s>>2]=u.length;var d=0;return u.forEach(N=>d+=N.length+1),F[a>>2]=d,0},f:function(s){try{var a=et(s);if(a.Zb===null)throw new B(8);a.sc&&(a.sc=null);try{a.Pb.close&&a.Pb.close(a)}catch(u){throw u}finally{dn[a.Zb]=null}return a.Zb=null,0}catch(u){if(typeof Se>"u"||u.name!=="ErrnoError")throw u;return u.Rb}},p:function(s,a){try{var u=et(s);return R[a>>0]=u.Vb?2:ht(u.mode)?3:(u.mode&61440)===40960?7:4,j[a+2>>1]=0,we=[0,(J=0,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],S[a+8>>2]=we[0],S[a+12>>2]=we[1],we=[0,(J=0,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],S[a+16>>2]=we[0],S[a+20>>2]=we[1],0}catch(d){if(typeof Se>"u"||d.name!=="ErrnoError")throw d;return d.Rb}},y:function(s,a,u,d){try{e:{var N=et(s);s=a;for(var T,O=a=0;O<u;O++){var D=F[s>>2],v=F[s+4>>2];s+=8;var C=N,P=D,q=v,Q=T,ne=R;if(0>q||0>Q)throw new B(28);if(C.Zb===null)throw new B(8);if((C.flags&2097155)===1)throw new B(8);if(ht(C.node.mode))throw new B(31);if(!C.Pb.read)throw new B(28);var me=typeof Q<"u";if(!me)Q=C.position;else if(!C.seekable)throw new B(70);var ze=C.Pb.read(C,ne,P,q,Q);me||(C.position+=ze);var Le=ze;if(0>Le){var ot=-1;break e}if(a+=Le,Le<v)break;typeof T<"u"&&(T+=Le)}ot=a}return F[d>>2]=ot,0}catch($e){if(typeof Se>"u"||$e.name!=="ErrnoError")throw $e;return $e.Rb}},l:function(s,a,u,d,N){a=pn(a,u);try{if(isNaN(a))return 61;var T=et(s);return Is(T,a,d),we=[T.position>>>0,(J=T.position,1<=+Math.abs(J)?0<J?+Math.floor(J/4294967296)>>>0:~~+Math.ceil((J-+(~~J>>>0))/4294967296)>>>0:0)],S[N>>2]=we[0],S[N+4>>2]=we[1],T.sc&&a===0&&d===0&&(T.sc=null),0}catch(O){if(typeof Se>"u"||O.name!=="ErrnoError")throw O;return O.Rb}},E:function(s){try{var a=et(s);return Oo(u=>{var d=a.node.Xb;d.type.Tc?d.type.Tc(d,!1,N=>{u(N?29:0)}):u(0)})}catch(u){if(typeof Se>"u"||u.name!=="ErrnoError")throw u;return u.Rb}},u:function(s,a,u,d){try{e:{var N=et(s);s=a;for(var T,O=a=0;O<u;O++){var D=F[s>>2],v=F[s+4>>2];s+=8;var C=N,P=D,q=v,Q=T,ne=R;if(0>q||0>Q)throw new B(28);if(C.Zb===null)throw new B(8);if(!(C.flags&2097155))throw new B(8);if(ht(C.node.mode))throw new B(31);if(!C.Pb.write)throw new B(28);C.seekable&&C.flags&1024&&Is(C,0,2);var me=typeof Q<"u";if(!me)Q=C.position;else if(!C.seekable)throw new B(70);var ze=C.Pb.write(C,ne,P,q,Q,void 0);me||(C.position+=ze);var Le=ze;if(0>Le){var ot=-1;break e}a+=Le,typeof T<"u"&&(T+=Le)}ot=a}return F[d>>2]=ot,0}catch($e){if(typeof Se>"u"||$e.name!=="ErrnoError")throw $e;return $e.Rb}},ta:As,P:ks,ia:Ls,da:qs,_:Ds,I:Ws,ma:Bs,x:Fs,g:Ps,pa:zs,ka:Qs,fa:Ms,ga:Us,h:$s,m:Vs,qa:Js,sa:Hs,ra:js,ea:Ks,ha:Gs,ja:Xs,oa:Ys,c:Zs,la:eo,na:ro,ba:no,W:io,aa:so,ca:oo,T:ao,V:lo,Z:uo,Y:co,S:fo,R:ho,U:po,$:mo,O:No,X:yo,Q:bo},U=function(){function s(u){if(u=u.exports,U=u=ca(u),w=U.ua,$(),H.unshift(U.va),M--,t.monitorRunDependencies&&t.monitorRunDependencies(M),M==0&&te){var d=te;te=null,d()}return u}var a={a:ma};if(M++,t.monitorRunDependencies&&t.monitorRunDependencies(M),t.instantiateWasm)try{return t.instantiateWasm(a,s)}catch(u){L(`Module.instantiateWasm callback failed with error: ${u}`),o(u)}return Mt(a,function(u){s(u.instance)}).catch(o),{}}();t._sqlite3_step=s=>(t._sqlite3_step=U.wa)(s),t._sqlite3_malloc=s=>(t._sqlite3_malloc=U.xa)(s),t._sqlite3_free=s=>(t._sqlite3_free=U.ya)(s),t._sqlite3_bind_blob=(s,a,u,d,N)=>(t._sqlite3_bind_blob=U.za)(s,a,u,d,N),t._sqlite3_bind_int=(s,a,u)=>(t._sqlite3_bind_int=U.Aa)(s,a,u),t._sqlite3_bind_int64=(s,a,u,d)=>(t._sqlite3_bind_int64=U.Ba)(s,a,u,d),t._sqlite3_bind_double=(s,a,u)=>(t._sqlite3_bind_double=U.Ca)(s,a,u),t._sqlite3_bind_null=(s,a)=>(t._sqlite3_bind_null=U.Da)(s,a),t._sqlite3_clear_bindings=s=>(t._sqlite3_clear_bindings=U.Ea)(s),t._sqlite3_bind_text=(s,a,u,d,N)=>(t._sqlite3_bind_text=U.Fa)(s,a,u,d,N),t._sqlite3_close=s=>(t._sqlite3_close=U.Ga)(s),t._sqlite3_column_type=(s,a)=>(t._sqlite3_column_type=U.Ha)(s,a),t._sqlite3_column_count=s=>(t._sqlite3_column_count=U.Ia)(s),t._sqlite3_column_text=(s,a)=>(t._sqlite3_column_text=U.Ja)(s,a),t._sqlite3_column_blob=(s,a)=>(t._sqlite3_column_blob=U.Ka)(s,a),t._sqlite3_column_bytes=(s,a)=>(t._sqlite3_column_bytes=U.La)(s,a),t._sqlite3_column_double=(s,a)=>(t._sqlite3_column_double=U.Ma)(s,a),t._sqlite3_column_int=(s,a)=>(t._sqlite3_column_int=U.Na)(s,a),t._sqlite3_column_int64=(s,a)=>(t._sqlite3_column_int64=U.Oa)(s,a),t._sqlite3_column_name=(s,a)=>(t._sqlite3_column_name=U.Pa)(s,a),t._sqlite3_declare_vtab=(s,a)=>(t._sqlite3_declare_vtab=U.Qa)(s,a),t._sqlite3_errmsg=s=>(t._sqlite3_errmsg=U.Ra)(s),t._sqlite3_exec=(s,a,u,d,N)=>(t._sqlite3_exec=U.Sa)(s,a,u,d,N),t._sqlite3_finalize=s=>(t._sqlite3_finalize=U.Ta)(s),t._sqlite3_prepare_v2=(s,a,u,d,N)=>(t._sqlite3_prepare_v2=U.Ua)(s,a,u,d,N),t._sqlite3_result_int=(s,a)=>(t._sqlite3_result_int=U.Va)(s,a),t._sqlite3_result_blob=(s,a,u,d)=>(t._sqlite3_result_blob=U.Wa)(s,a,u,d),t._sqlite3_result_int64=(s,a,u)=>(t._sqlite3_result_int64=U.Xa)(s,a,u),t._sqlite3_result_double=(s,a)=>(t._sqlite3_result_double=U.Ya)(s,a),t._sqlite3_result_null=s=>(t._sqlite3_result_null=U.Za)(s),t._sqlite3_result_error=(s,a,u)=>(t._sqlite3_result_error=U._a)(s,a,u),t._sqlite3_result_text=(s,a,u,d)=>(t._sqlite3_result_text=U.$a)(s,a,u,d),t._sqlite3_sql=s=>(t._sqlite3_sql=U.ab)(s),t._sqlite3_reset=s=>(t._sqlite3_reset=U.bb)(s),t._sqlite3_value_text=s=>(t._sqlite3_value_text=U.cb)(s),t._sqlite3_value_type=s=>(t._sqlite3_value_type=U.db)(s),t._sqlite3_value_bytes=s=>(t._sqlite3_value_bytes=U.eb)(s),t._sqlite3_value_blob=s=>(t._sqlite3_value_blob=U.fb)(s),t._sqlite3_value_int=s=>(t._sqlite3_value_int=U.gb)(s),t._sqlite3_value_int64=s=>(t._sqlite3_value_int64=U.hb)(s),t._sqlite3_value_double=s=>(t._sqlite3_value_double=U.ib)(s),t._sqlite3_get_autocommit=s=>(t._sqlite3_get_autocommit=U.jb)(s),t._sqlite3_vfs_find=s=>(t._sqlite3_vfs_find=U.kb)(s),t._sqlite3_data_count=s=>(t._sqlite3_data_count=U.lb)(s),t._sqlite3_bind_parameter_count=s=>(t._sqlite3_bind_parameter_count=U.mb)(s),t._sqlite3_bind_parameter_name=(s,a)=>(t._sqlite3_bind_parameter_name=U.nb)(s,a),t._sqlite3_libversion=()=>(t._sqlite3_libversion=U.ob)(),t._sqlite3_libversion_number=()=>(t._sqlite3_libversion_number=U.pb)(),t._sqlite3_changes=s=>(t._sqlite3_changes=U.qb)(s),t._sqlite3_limit=(s,a,u)=>(t._sqlite3_limit=U.rb)(s,a,u),t._sqlite3_open_v2=(s,a,u,d)=>(t._sqlite3_open_v2=U.sb)(s,a,u,d);var vo=()=>(vo=U.tb)(),ji=t._malloc=s=>(ji=t._malloc=U.ub)(s),Ro=t._free=s=>(Ro=t._free=U.vb)(s);t._RegisterExtensionFunctions=s=>(t._RegisterExtensionFunctions=U.wb)(s),t._set_authorizer=s=>(t._set_authorizer=U.xb)(s),t._create_function=(s,a,u,d,N,T)=>(t._create_function=U.yb)(s,a,u,d,N,T),t._update_hook=(s,a)=>(t._update_hook=U.zb)(s,a),t._create_module=(s,a,u,d)=>(t._create_module=U.Ab)(s,a,u,d),t._progress_handler=(s,a)=>(t._progress_handler=U.Bb)(s,a),t._register_vfs=(s,a,u,d)=>(t._register_vfs=U.Cb)(s,a,u,d),t._getSqliteFree=()=>(t._getSqliteFree=U.Db)();var Co=t._main=(s,a)=>(Co=t._main=U.Eb)(s,a),xo=(s,a)=>(xo=U.Gb)(s,a),Ao=()=>(Ao=U.Hb)(),ko=()=>(ko=U.Ib)(),Lo=s=>(Lo=U.Jb)(s),Ki=s=>(Ki=U.Kb)(s),qo=s=>(qo=U.Lb)(s),Do=()=>(Do=U.Mb)(),Wo=s=>(Wo=U.Nb)(s),Bo=()=>(Bo=U.Ob)();t.getTempRet0=Ao,t.ccall=mt,t.cwrap=(s,a,u,d)=>{var N=!u||u.every(T=>T==="number"||T==="boolean");return a!=="string"&&N&&!d?t["_"+s]:function(){return mt(s,a,u,arguments,d)}},t.setValue=Pe,t.getValue=Ie,t.UTF8ToString=(s,a)=>s?se(A,s,a):"",t.stringToUTF8=(s,a,u)=>ke(s,A,a,u),t.lengthBytesUTF8=Ue;var ni;te=function s(){ni||Fo(),ni||(te=s)};function Fo(){function s(){if(!ni&&(ni=!0,t.calledRun=!0,!y)){if(t.noFSInit||Rs||(Rs=!0,vs(),t.stdin=t.stdin,t.stdout=t.stdout,t.stderr=t.stderr,t.stdin?fn("stdin",t.stdin):Mi("/dev/tty","/dev/stdin"),t.stdout?fn("stdout",null,t.stdout):Mi("/dev/tty","/dev/stdout"),t.stderr?fn("stderr",null,t.stderr):Mi("/dev/tty1","/dev/stderr"),Gn("/dev/stdin",0),Gn("/dev/stdout",1),Gn("/dev/stderr",1)),hs=!1,Cr(H),Cr(ue),n(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),Po){var a=Co;try{var u=a(0,0);_=u,wo(u)}catch(d){Ji(d)}}if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)a=t.postRun.shift(),X.unshift(a);Cr(X)}}if(!(0<M)){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)ye();Cr(z),0<M||(t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),s()},1)):s())}}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();var Po=!0;return t.noInitialRun&&(Po=!1),Fo(),e.ready}})();const SQLiteAsyncESMFactory=Module,SQLITE_OK=0,SQLITE_BUSY=5,SQLITE_IOERR=10,SQLITE_NOTFOUND=12,SQLITE_CANTOPEN=14,SQLITE_MISUSE=21,SQLITE_RANGE=25,SQLITE_NOTICE=27,SQLITE_ROW=100,SQLITE_DONE=101,SQLITE_IOERR_LOCK=3850,SQLITE_IOERR_SHORT_READ=522,SQLITE_OPEN_READONLY=1,SQLITE_OPEN_READWRITE=2,SQLITE_OPEN_CREATE=4,SQLITE_OPEN_DELETEONCLOSE=8,SQLITE_OPEN_URI=64,SQLITE_LOCK_NONE=0,SQLITE_LOCK_SHARED=1,SQLITE_LOCK_RESERVED=2,SQLITE_LOCK_PENDING=3,SQLITE_LOCK_EXCLUSIVE=4,SQLITE_IOCAP_SAFE_APPEND=512,SQLITE_IOCAP_SEQUENTIAL=1024,SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN=2048,SQLITE_IOCAP_BATCH_ATOMIC=16384,SQLITE_INTEGER=1,SQLITE_FLOAT=2,SQLITE_TEXT=3,SQLITE_BLOB=4,SQLITE_NULL=5,SQLITE_UTF8=1,MAX_INT64=0x7fffffffffffffffn,MIN_INT64=-0x8000000000000000n;class SQLiteError extends Error{constructor(e,t){super(e),this.code=t}}const async=!0;function Factory(r){const e={},t=r._getSqliteFree(),n=r._malloc(8),o=[n,n+4];function l(p){if(typeof p!="string")return 0;const w=r.lengthBytesUTF8(p),y=r._sqlite3_malloc(w+1);return r.stringToUTF8(p,y,w+1),y}function c(p,w){return BigInt(w)<<32n|BigInt(p)&0xffffffffn}const f=function(){const p=BigInt(Number.MAX_SAFE_INTEGER)>>32n,w=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(y,_){return _>p||_<w?c(y,_):_*4294967296+(y&2147483647)-(y&2147483648)}}(),h=new Set;function m(p){if(!h.has(p))throw new SQLiteError("not a database",SQLITE_MISUSE)}const b=new Map;function E(p){if(!b.has(p))throw new SQLiteError("not a statement",SQLITE_MISUSE)}e.bind_collection=function(p,w){E(p);const y=Array.isArray(w),_=e.bind_parameter_count(p);for(let R=1;R<=_;++R){const A=y?R-1:e.bind_parameter_name(p,R),j=w[A];j!==void 0&&e.bind(p,R,j)}return SQLITE_OK},e.bind=function(p,w,y){switch(E(p),typeof y){case"number":return y===(y|0)?e.bind_int(p,w,y):e.bind_double(p,w,y);case"string":return e.bind_text(p,w,y);default:if(y instanceof Uint8Array||Array.isArray(y))return e.bind_blob(p,w,y);if(y===null)return e.bind_null(p,w);if(typeof y=="bigint")return e.bind_int64(p,w,y);if(y===void 0)return SQLITE_NOTICE;throw new Error("Unknown binding type "+typeof y)}},e.bind_blob=function(){const p="sqlite3_bind_blob",w=r.cwrap(p,...decl("nnnnn:n"));return function(y,_,R){E(y);const A=R.byteLength??R.length,j=r._sqlite3_malloc(A);r.HEAPU8.subarray(j).set(R);const S=w(y,_,j,A,t);return I(p,S,b.get(y))}}(),e.bind_parameter_count=function(){const p="sqlite3_bind_parameter_count",w=r.cwrap(p,...decl("n:n"));return function(y){return E(y),w(y)}}(),e.bind_double=function(){const p="sqlite3_bind_double",w=r.cwrap(p,...decl("nnn:n"));return function(y,_,R){E(y);const A=w(y,_,R);return I(p,A,b.get(y))}}(),e.bind_int=function(){const p="sqlite3_bind_int",w=r.cwrap(p,...decl("nnn:n"));return function(y,_,R){if(E(y),R>2147483647||R<-2147483648)return SQLITE_RANGE;const A=w(y,_,R);return I(p,A,b.get(y))}}(),e.bind_int64=function(){const p="sqlite3_bind_int64",w=r.cwrap(p,...decl("nnnn:n"));return function(y,_,R){if(E(y),R>MAX_INT64||R<MIN_INT64)return SQLITE_RANGE;const A=R&0xffffffffn,j=R>>32n,S=w(y,_,Number(A),Number(j));return I(p,S,b.get(y))}}(),e.bind_null=function(){const p="sqlite3_bind_null",w=r.cwrap(p,...decl("nn:n"));return function(y,_){E(y);const R=w(y,_);return I(p,R,b.get(y))}}(),e.bind_parameter_name=function(){const p="sqlite3_bind_parameter_name",w=r.cwrap(p,...decl("n:s"));return function(y,_){return E(y),w(y,_)}}(),e.bind_text=function(){const p="sqlite3_bind_text",w=r.cwrap(p,...decl("nnnnn:n"));return function(y,_,R){E(y);const A=l(R),j=w(y,_,A,-1,t);return I(p,j,b.get(y))}}(),e.changes=function(){const p="sqlite3_changes",w=r.cwrap(p,...decl("n:n"));return function(y){return m(y),w(y)}}(),e.close=function(){const p="sqlite3_close",w=r.cwrap(p,...decl("n:n"),{async});return async function(y){m(y);const _=await w(y);return h.delete(y),I(p,_,y)}}(),e.column=function(p,w){E(p);const y=e.column_type(p,w);switch(y){case SQLITE_BLOB:return e.column_blob(p,w);case SQLITE_FLOAT:return e.column_double(p,w);case SQLITE_INTEGER:const _=e.column_int(p,w),R=r.getTempRet0();return f(_,R);case SQLITE_NULL:return null;case SQLITE_TEXT:return e.column_text(p,w);default:throw new SQLiteError("unknown type",y)}},e.column_blob=function(){const p="sqlite3_column_blob",w=r.cwrap(p,...decl("nn:n"));return function(y,_){E(y);const R=e.column_bytes(y,_),A=w(y,_),j=r.HEAPU8.subarray(A,A+R),S=new ArrayBuffer(j.byteLength),F=new Uint8Array(S);return F.set(j),F}}(),e.column_bytes=function(){const p="sqlite3_column_bytes",w=r.cwrap(p,...decl("nn:n"));return function(y,_){return E(y),w(y,_)}}(),e.column_count=function(){const p="sqlite3_column_count",w=r.cwrap(p,...decl("n:n"));return function(y){return E(y),w(y)}}(),e.column_double=function(){const p="sqlite3_column_double",w=r.cwrap(p,...decl("nn:n"));return function(y,_){return E(y),w(y,_)}}(),e.column_int=function(){const p="sqlite3_column_int64",w=r.cwrap(p,...decl("nn:n"));return function(y,_){return E(y),w(y,_)}}(),e.column_int64=function(){const p="sqlite3_column_int64",w=r.cwrap(p,...decl("nn:n"));return function(y,_){E(y);const R=w(y,_),A=r.getTempRet0();return c(R,A)}}(),e.column_name=function(){const p="sqlite3_column_name",w=r.cwrap(p,...decl("nn:s"));return function(y,_){return E(y),w(y,_)}}(),e.column_names=function(p){const w=[],y=e.column_count(p);for(let _=0;_<y;++_)w.push(e.column_name(p,_));return w},e.column_text=function(){const p="sqlite3_column_text",w=r.cwrap(p,...decl("nn:s"));return function(y,_){return E(y),w(y,_)}}(),e.column_type=function(){const p="sqlite3_column_type",w=r.cwrap(p,...decl("nn:n"));return function(y,_){return E(y),w(y,_)}}(),e.update_hook=function(p,w){return m(p),r.updateHook(p,w),SQLITE_OK},e.create_function=function(p,w,y,_,R,A,j,S){if(m(p),A&&!j&&!S){const F=r.createFunction(p,w,y,_,R,A);return I("sqlite3_create_function",F,p)}if(!A&&j&&S){const F=r.createAggregate(p,w,y,_,R,j,S);return I("sqlite3_create_function",F,p)}throw new SQLiteError("invalid function combination",SQLITE_MISUSE)},e.create_module=function(p,w,y,_){m(p);const R=r.createModule(p,w,y,_);return I("sqlite3_create_module",R,p)},e.data_count=function(){const p="sqlite3_data_count",w=r.cwrap(p,...decl("n:n"));return function(y){return E(y),w(y)}}(),e.declare_vtab=function(){const p="sqlite3_declare_vtab",w=r.cwrap(p,...decl("ns:n"));return function(y,_){const R=w(y,_);return I("sqlite3_declare_vtab",R)}}(),e.exec=async function(p,w,y){for await(const _ of e.statements(p,w)){let R;for(;await e.step(_)===SQLITE_ROW;)if(y){R=R??e.column_names(_);const A=e.row(_);await y(A,R)}}return SQLITE_OK},e.finalize=function(){const p="sqlite3_finalize",w=r.cwrap(p,...decl("n:n"),{async});return async function(y){if(!b.has(y))return SQLITE_MISUSE;const _=await w(y);return b.get(y),b.delete(y),_}}(),e.get_autocommit=function(){const p="sqlite3_get_autocommit",w=r.cwrap(p,...decl("n:n"));return function(y){return w(y)}}(),e.libversion=function(){const p="sqlite3_libversion",w=r.cwrap(p,...decl(":s"));return function(){return w()}}(),e.libversion_number=function(){const p="sqlite3_libversion_number",w=r.cwrap(p,...decl(":n"));return function(){return w()}}(),e.limit=function(){const p="sqlite3_limit",w=r.cwrap(p,...decl("nnn:n"));return function(y,_,R){return w(y,_,R)}}(),e.open_v2=function(){const p="sqlite3_open_v2",w=r.cwrap(p,...decl("snnn:n"),{async});return async function(y,_,R){_=_||SQLITE_OPEN_CREATE|SQLITE_OPEN_READWRITE,R=l(R);const A=await w(y,o[0],_,R),j=r.getValue(o[0],"*");return h.add(j),r._sqlite3_free(R),r.ccall("RegisterExtensionFunctions","void",["number"],[j]),I(p,A),j}}(),e.prepare_v2=function(){const p="sqlite3_prepare_v2",w=r.cwrap(p,...decl("nnnnn:n"),{async});return async function(y,_){const R=await w(y,_,-1,o[0],o[1]);I(p,R,y);const A=r.getValue(o[0],"*");return A?(b.set(A,y),{stmt:A,sql:r.getValue(o[1],"*")}):null}}(),e.progress_handler=function(p,w,y,_){m(p),r.progressHandler(p,w,y,_)},e.reset=function(){const p="sqlite3_reset",w=r.cwrap(p,...decl("n:n"),{async});return async function(y){E(y);const _=await w(y);return I(p,_,b.get(y))}}(),e.result=function(p,w){switch(typeof w){case"number":w===(w|0)?e.result_int(p,w):e.result_double(p,w);break;case"string":e.result_text(p,w);break;default:if(w instanceof Uint8Array||Array.isArray(w))e.result_blob(p,w);else if(w===null)e.result_null(p);else{if(typeof w=="bigint")return e.result_int64(p,w);console.warn("unknown result converted to null",w),e.result_null(p)}break}},e.result_blob=function(){const p="sqlite3_result_blob",w=r.cwrap(p,...decl("nnnn:n"));return function(y,_){const R=_.byteLength??_.length,A=r._sqlite3_malloc(R);r.HEAPU8.subarray(A).set(_),w(y,A,R,t)}}(),e.result_double=function(){const p="sqlite3_result_double",w=r.cwrap(p,...decl("nn:n"));return function(y,_){w(y,_)}}(),e.result_int=function(){const p="sqlite3_result_int",w=r.cwrap(p,...decl("nn:n"));return function(y,_){w(y,_)}}(),e.result_int64=function(){const p="sqlite3_result_int64",w=r.cwrap(p,...decl("nnn:n"));return function(y,_){if(_>MAX_INT64||_<MIN_INT64)return SQLITE_RANGE;const R=_&0xffffffffn,A=_>>32n;w(y,Number(R),Number(A))}}(),e.result_null=function(){const p="sqlite3_result_null",w=r.cwrap(p,...decl("n:n"));return function(y){w(y)}}(),e.result_text=function(){const p="sqlite3_result_text",w=r.cwrap(p,...decl("nnnn:n"));return function(y,_){const R=l(_);w(y,R,-1,t)}}(),e.row=function(p){const w=[],y=e.data_count(p);for(let _=0;_<y;++_){const R=e.column(p,_);w.push((R==null?void 0:R.buffer)===r.HEAPU8.buffer?R.slice():R)}return w},e.set_authorizer=function(p,w,y){m(p);const _=r.setAuthorizer(p,w,y);return I("sqlite3_set_authorizer",_,p)},e.sql=function(){const p="sqlite3_sql",w=r.cwrap(p,...decl("n:s"));return function(y){return E(y),w(y)}}(),e.statements=function(p,w){return async function*(){const y=e.str_new(p,w);let _={stmt:null,sql:e.str_value(y)};try{for(;_=await e.prepare_v2(p,_.sql);)yield _.stmt,e.finalize(_.stmt),_.stmt=null}finally{_!=null&&_.stmt&&e.finalize(_.stmt),e.str_finish(y)}}()},e.step=function(){const p="sqlite3_step",w=r.cwrap(p,...decl("n:n"),{async});return async function(y){E(y);const _=await w(y);return I(p,_,b.get(y),[SQLITE_ROW,SQLITE_DONE])}}();let k=0;const L=new Map;e.str_new=function(p,w=""){const y=r.lengthBytesUTF8(w),_=k++&4294967295,R={offset:r._sqlite3_malloc(y+1),bytes:y};return L.set(_,R),r.stringToUTF8(w,R.offset,R.bytes+1),_},e.str_appendall=function(p,w){if(!L.has(p))throw new SQLiteError("not a string",SQLITE_MISUSE);const y=L.get(p),_=r.lengthBytesUTF8(w),R=y.bytes+_,A=r._sqlite3_malloc(R+1);r.HEAPU8.subarray(A,A+R+1).set(r.HEAPU8.subarray(y.offset,y.offset+y.bytes)),r.stringToUTF8(w,A+y.bytes,_+1),r._sqlite3_free(y.offset),y.offset=A,y.bytes=R,L.set(p,y)},e.str_finish=function(p){if(!L.has(p))throw new SQLiteError("not a string",SQLITE_MISUSE);const w=L.get(p);L.delete(p),r._sqlite3_free(w.offset)},e.str_value=function(p){if(!L.has(p))throw new SQLiteError("not a string",SQLITE_MISUSE);return L.get(p).offset},e.user_data=function(p){return r.getFunctionUserData(p)},e.value=function(p){const w=e.value_type(p);switch(w){case SQLITE_BLOB:return e.value_blob(p);case SQLITE_FLOAT:return e.value_double(p);case SQLITE_INTEGER:const y=e.value_int(p),_=r.getTempRet0();return f(y,_);case SQLITE_NULL:return null;case SQLITE_TEXT:return e.value_text(p);default:throw new SQLiteError("unknown type",w)}},e.value_blob=function(){const p="sqlite3_value_blob",w=r.cwrap(p,...decl("n:n"));return function(y){const _=e.value_bytes(y),R=w(y);return r.HEAPU8.subarray(R,R+_)}}(),e.value_bytes=function(){const p="sqlite3_value_bytes",w=r.cwrap(p,...decl("n:n"));return function(y){return w(y)}}(),e.value_double=function(){const p="sqlite3_value_double",w=r.cwrap(p,...decl("n:n"));return function(y){return w(y)}}(),e.value_int=function(){const p="sqlite3_value_int64",w=r.cwrap(p,...decl("n:n"));return function(y){return w(y)}}(),e.value_int64=function(){const p="sqlite3_value_int64",w=r.cwrap(p,...decl("n:n"));return function(y){const _=w(y),R=r.getTempRet0();return c(_,R)}}(),e.value_text=function(){const p="sqlite3_value_text",w=r.cwrap(p,...decl("n:s"));return function(y){return w(y)}}(),e.value_type=function(){const p="sqlite3_value_type",w=r.cwrap(p,...decl("n:n"));return function(y){return w(y)}}(),e.vfs_register=function(p,w){const y=r.registerVFS(p,w);return I("sqlite3_vfs_register",y)};function I(p,w,y=null,_=[SQLITE_OK]){if(_.includes(w))return w;const R=y?r.ccall("sqlite3_errmsg","string",["number"],[y]):p;throw new SQLiteError(R,w)}return e}function decl(r){const e=[],t=r.match(/([ns@]*):([nsv@])/);switch(t[2]){case"n":e.push("number");break;case"s":e.push("string");break;case"v":e.push(null);break}const n=[];for(let o of t[1])switch(o){case"n":n.push("number");break;case"s":n.push("string");break}return e.push(n),e}class Base{constructor(){le(this,"mxPathName",64)}xClose(e){return SQLITE_IOERR}xRead(e,t,n){return SQLITE_IOERR}xWrite(e,t,n){return SQLITE_IOERR}xTruncate(e,t){return SQLITE_IOERR}xSync(e,t){return SQLITE_OK}xFileSize(e,t){return SQLITE_IOERR}xLock(e,t){return SQLITE_OK}xUnlock(e,t){return SQLITE_OK}xCheckReservedLock(e,t){return t.setInt32(0,0,!0),SQLITE_OK}xFileControl(e,t,n){return SQLITE_NOTFOUND}xSectorSize(e){return 512}xDeviceCharacteristics(e){return 0}xOpen(e,t,n,o){return SQLITE_CANTOPEN}xDelete(e,t){return SQLITE_IOERR}xAccess(e,t,n){return SQLITE_IOERR}handleAsync(e){return e()}}const LOCK_TYPE_MASK=SQLITE_LOCK_NONE|SQLITE_LOCK_SHARED|SQLITE_LOCK_RESERVED|SQLITE_LOCK_PENDING|SQLITE_LOCK_EXCLUSIVE;var Ke,an,Bn,Fn,ns,vi,Xo,Ri,Yo;class WebLocksBase{constructor(){g(this,Fn);g(this,vi);g(this,Ri);g(this,Ke,SQLITE_LOCK_NONE);le(this,"timeoutMillis",0);g(this,an,new Map);g(this,Bn,Promise.resolve(0))}get state(){return i(this,Ke)}async lock(e){return Y(this,Fn,ns).call(this,Y(this,vi,Xo),e)}async unlock(e){return Y(this,Fn,ns).call(this,Y(this,Ri,Yo),e)}async isSomewhereReserved(){throw new Error("unimplemented")}async _NONEtoSHARED(){}async _SHAREDtoEXCLUSIVE(){await this._SHAREDtoRESERVED(),await this._RESERVEDtoEXCLUSIVE()}async _SHAREDtoRESERVED(){}async _RESERVEDtoEXCLUSIVE(){}async _EXCLUSIVEtoRESERVED(){}async _EXCLUSIVEtoSHARED(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED()}async _EXCLUSIVEtoNONE(){await this._EXCLUSIVEtoRESERVED(),await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _RESERVEDtoSHARED(){}async _RESERVEDtoNONE(){await this._RESERVEDtoSHARED(),await this._SHAREDtoNONE()}async _SHAREDtoNONE(){}_acquireWebLock(e,t){return new Promise(async(n,o)=>{try{await navigator.locks.request(e,t,l=>{if(n(l),l)return new Promise(c=>i(this,an).set(e,c))})}catch(l){o(l)}})}_releaseWebLock(e){var t;(t=i(this,an).get(e))==null||t(),i(this,an).delete(e)}async _pollWebLock(e){var n;return(n=(await navigator.locks.query()).held.find(({name:o})=>o===e))==null?void 0:n.mode}_getTimeoutSignal(){if(this.timeoutMillis){const e=new AbortController;return setTimeout(()=>e.abort(),this.timeoutMillis),e.signal}}}Ke=new WeakMap,an=new WeakMap,Bn=new WeakMap,Fn=new WeakSet,ns=async function(e,t){const n=t&LOCK_TYPE_MASK;try{const o=()=>e.call(this,n);return await x(this,Bn,i(this,Bn).then(o,o)),x(this,Ke,n),SQLITE_OK}catch(o){return o.name==="AbortError"?SQLITE_BUSY:(console.error(o),SQLITE_IOERR_LOCK)}},vi=new WeakSet,Xo=async function(e){if(e===i(this,Ke))return SQLITE_OK;switch(i(this,Ke)){case SQLITE_LOCK_NONE:switch(e){case SQLITE_LOCK_SHARED:return this._NONEtoSHARED();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}case SQLITE_LOCK_SHARED:switch(e){case SQLITE_LOCK_RESERVED:return this._SHAREDtoRESERVED();case SQLITE_LOCK_EXCLUSIVE:return this._SHAREDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}case SQLITE_LOCK_RESERVED:switch(e){case SQLITE_LOCK_EXCLUSIVE:return this._RESERVEDtoEXCLUSIVE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}},Ri=new WeakSet,Yo=async function(e){if(e===i(this,Ke))return SQLITE_OK;switch(i(this,Ke)){case SQLITE_LOCK_EXCLUSIVE:switch(e){case SQLITE_LOCK_SHARED:return this._EXCLUSIVEtoSHARED();case SQLITE_LOCK_NONE:return this._EXCLUSIVEtoNONE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}case SQLITE_LOCK_RESERVED:switch(e){case SQLITE_LOCK_SHARED:return this._RESERVEDtoSHARED();case SQLITE_LOCK_NONE:return this._RESERVEDtoNONE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}case SQLITE_LOCK_SHARED:switch(e){case SQLITE_LOCK_NONE:return this._SHAREDtoNONE();default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}default:throw new Error(`unexpected transition ${i(this,Ke)} -> ${e}`)}};class WebLocksExclusive extends WebLocksBase{constructor(e){super(),this._lockName=e+"-outer",this._reservedName=e+"-reserved"}async isSomewhereReserved(){return await this._pollWebLock(this._reservedName)==="exclusive"}async _NONEtoSHARED(){await this._acquireWebLock(this._lockName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _SHAREDtoRESERVED(){await this._acquireWebLock(this._reservedName,{mode:"exclusive",signal:this._getTimeoutSignal()})}async _RESERVEDtoSHARED(){this._releaseWebLock(this._reservedName)}async _SHAREDtoNONE(){this._releaseWebLock(this._lockName)}}const MAX_TRANSACTION_LIFETIME_MILLIS=5e3;let nextTxId=0;const mapTxToId=new WeakMap;function log$2(...r){}var ln,un,Pn,Me,zn,Or,Tr,Ci,Zo;class IDBContext{constructor(e,t={durability:"default"}){g(this,Ci);g(this,ln,void 0);g(this,un,void 0);g(this,Pn,void 0);g(this,Me,null);g(this,zn,0);g(this,Or,Promise.resolve());g(this,Tr,Promise.resolve());x(this,un,Promise.resolve(e).then(n=>x(this,ln,n))),x(this,Pn,t)}async close(){const e=i(this,ln)??await i(this,un);await i(this,Or),await this.sync(),e.close()}async run(e,t){const n=i(this,Or).then(()=>Y(this,Ci,Zo).call(this,e,t));return x(this,Or,n.catch(()=>{})),n}async sync(){await i(this,Or),await i(this,Tr),x(this,Tr,Promise.resolve())}}ln=new WeakMap,un=new WeakMap,Pn=new WeakMap,Me=new WeakMap,zn=new WeakMap,Or=new WeakMap,Tr=new WeakMap,Ci=new WeakSet,Zo=async function(e,t){var o,l;const n=i(this,ln)??await i(this,un);if(e==="readwrite"&&((o=i(this,Me))==null?void 0:o.mode)==="readonly")x(this,Me,null);else if(performance.now()-i(this,zn)>MAX_TRANSACTION_LIFETIME_MILLIS){try{(l=i(this,Me))==null||l.commit()}catch(c){if(c.name!=="InvalidStateError")throw c}await new Promise(c=>setTimeout(c)),x(this,Me,null)}for(let c=0;c<2;++c){if(!i(this,Me)){x(this,Me,n.transaction(n.objectStoreNames,e,i(this,Pn)));const f=x(this,zn,performance.now());x(this,Tr,i(this,Tr).then(()=>new Promise((h,m)=>{i(this,Me).addEventListener("complete",b=>{h(),i(this,Me)===b.target&&x(this,Me,null),log$2(`transaction ${mapTxToId.get(b.target)} complete`)}),i(this,Me).addEventListener("abort",b=>{console.warn("tx abort",(performance.now()-f)/1e3);const E=b.target.error;m(E),i(this,Me)===b.target&&x(this,Me,null),log$2(`transaction ${mapTxToId.get(b.target)} aborted`,E)})}))),mapTxToId.set(i(this,Me),nextTxId++)}try{const f=Object.fromEntries(Array.from(n.objectStoreNames,h=>[h,new ObjectStore(i(this,Me).objectStore(h))]));return await t(f)}catch(f){if(x(this,Me,null),c)throw f}}};function wrapRequest(r){return new Promise((e,t)=>{r.addEventListener("success",()=>e(r.result)),r.addEventListener("error",()=>t(r.error))})}var Fe;class ObjectStore{constructor(e){g(this,Fe,void 0);x(this,Fe,e)}get(e){log$2(`get ${i(this,Fe).name}`,e);const t=i(this,Fe).get(e);return wrapRequest(t)}getAll(e,t){log$2(`getAll ${i(this,Fe).name}`,e,t);const n=i(this,Fe).getAll(e,t);return wrapRequest(n)}getKey(e){log$2(`getKey ${i(this,Fe).name}`,e);const t=i(this,Fe).getKey(e);return wrapRequest(t)}getAllKeys(e,t){log$2(`getAllKeys ${i(this,Fe).name}`,e,t);const n=i(this,Fe).getAllKeys(e,t);return wrapRequest(n)}put(e,t){log$2(`put ${i(this,Fe).name}`,e,t);const n=i(this,Fe).put(e,t);return wrapRequest(n)}delete(e){log$2(`delete ${i(this,Fe).name}`,e);const t=i(this,Fe).delete(e);return wrapRequest(t)}clear(){log$2(`clear ${i(this,Fe).name}`);const e=i(this,Fe).clear();return wrapRequest(e)}index(e){return new Index(i(this,Fe).index(e))}}Fe=new WeakMap;var Sr;class Index{constructor(e){g(this,Sr,void 0);x(this,Sr,e)}getAllKeys(e,t){log$2(`IDBIndex.getAllKeys ${i(this,Sr).objectStore.name}<${i(this,Sr).name}>`,e,t);const n=i(this,Sr).getAllKeys(e,t);return wrapRequest(n)}}Sr=new WeakMap;const SECTOR_SIZE=512,MAX_TASK_MILLIS=3e3,DEFAULT_OPTIONS={durability:"default",purge:"deferred",purgeAtLeast:16};function log$1(...r){}var er,Ge,Re,Ir,vr,Pt,Qn,ss,xi,ea,Ai,ta,tr,Lr,ki,ra;class IDBBatchAtomicVFS extends Base{constructor(t="wa-sqlite",n=DEFAULT_OPTIONS){super();g(this,Qn);g(this,xi);g(this,Ai);g(this,tr);g(this,ki);g(this,er,void 0);g(this,Ge,new Map);g(this,Re,void 0);g(this,Ir,new Set);g(this,vr,performance.now());g(this,Pt,new Set);this.name=t,x(this,er,Object.assign({},DEFAULT_OPTIONS,n)),x(this,Re,new IDBContext(openDatabase(t),{durability:i(this,er).durability}))}async close(){var t;for(const n of i(this,Ge).keys())await this.xClose(n);await((t=i(this,Re))==null?void 0:t.close()),x(this,Re,null)}xOpen(t,n,o,l){return this.handleAsync(async()=>{t===null&&(t=`null_${n}`),log$1(`xOpen ${t} 0x${n.toString(16)} 0x${o.toString(16)}`);try{const c=new URL(t,"http://localhost/"),f={path:c.pathname,flags:o,block0:null,isMetadataChanged:!0,locks:new WebLocksExclusive(c.pathname)};return i(this,Ge).set(n,f),await i(this,Re).run("readwrite",async({blocks:h})=>{if(f.block0=await h.get(Y(this,tr,Lr).call(this,f,0)),!f.block0)if(o&SQLITE_OPEN_CREATE)f.block0={path:f.path,offset:0,version:0,data:new Uint8Array(0),fileSize:0},h.put(f.block0);else throw new Error(`file not found: ${f.path}`)}),l.setInt32(0,o&SQLITE_OPEN_READONLY,!0),SQLITE_OK}catch(c){return console.error(c),SQLITE_CANTOPEN}})}xClose(t){return this.handleAsync(async()=>{try{const n=i(this,Ge).get(t);return n&&(log$1(`xClose ${n.path}`),i(this,Ge).delete(t),n.flags&SQLITE_OPEN_DELETEONCLOSE&&i(this,Re).run("readwrite",({blocks:o})=>{o.delete(IDBKeyRange.bound([n.path],[n.path,[]]))})),SQLITE_OK}catch(n){return console.error(n),SQLITE_IOERR}})}xRead(t,n,o){return this.handleAsync(async()=>{const l=i(this,Ge).get(t);log$1(`xRead ${l.path} ${n.byteLength} ${o}`);try{return await i(this,Re).run("readonly",async({blocks:f})=>{let h=0;for(;h<n.byteLength;){const m=o+h,b=m<l.block0.data.byteLength?l.block0:await f.get(Y(this,tr,Lr).call(this,l,-m));if(!b||b.data.byteLength-b.offset<=m)return n.fill(0,h),SQLITE_IOERR_SHORT_READ;const E=n.subarray(h),k=m+b.offset,L=Math.min(Math.max(b.data.byteLength-k,0),E.byteLength);E.set(b.data.subarray(k,k+L)),h+=L}return SQLITE_OK})}catch(c){return console.error(c),SQLITE_IOERR}})}xWrite(t,n,o){const l=i(this,Pt).has(t);if(l||performance.now()-i(this,vr)>MAX_TASK_MILLIS){const c=this.handleAsync(async()=>{this.handleAsync!==super.handleAsync&&i(this,Pt).add(t),await new Promise(h=>setTimeout(h));const f=Y(this,Qn,ss).call(this,t,n,o);return x(this,vr,performance.now()),f});return l&&i(this,Pt).delete(t),c}return Y(this,Qn,ss).call(this,t,n,o)}xTruncate(t,n){const o=i(this,Ge).get(t);log$1(`xTruncate ${o.path} ${n}`);try{Object.assign(o.block0,{fileSize:n,data:o.block0.data.slice(0,n)});const l=Object.assign({},o.block0);return i(this,Re).run("readwrite",({blocks:c})=>{c.delete(Y(this,tr,Lr).call(this,o,-1/0,-n)),c.put(l)}),SQLITE_OK}catch(l){return console.error(l),SQLITE_IOERR}}xSync(t,n){const o=i(this,Pt).has(t);if(o||i(this,er).durability!=="relaxed"||performance.now()-i(this,vr)>MAX_TASK_MILLIS){const c=this.handleAsync(async()=>{this.handleAsync!==super.handleAsync&&i(this,Pt).add(t);const f=await Y(this,xi,ea).call(this,t,n);return x(this,vr,performance.now()),f});return o&&i(this,Pt).delete(t),c}const l=i(this,Ge).get(t);return log$1(`xSync ${l.path} ${n}`),SQLITE_OK}xFileSize(t,n){const o=i(this,Ge).get(t);return log$1(`xFileSize ${o.path}`),n.setBigInt64(0,BigInt(o.block0.fileSize),!0),SQLITE_OK}xLock(t,n){return this.handleAsync(async()=>{const o=i(this,Ge).get(t);log$1(`xLock ${o.path} ${n}`);try{const l=await o.locks.lock(n);return l===SQLITE_OK&&o.locks.state===SQLITE_LOCK_SHARED&&(o.block0=await i(this,Re).run("readonly",({blocks:c})=>c.get(Y(this,tr,Lr).call(this,o,0)))),l}catch(l){return console.error(l),SQLITE_IOERR}})}xUnlock(t,n){return this.handleAsync(async()=>{const o=i(this,Ge).get(t);log$1(`xUnlock ${o.path} ${n}`);try{return o.locks.unlock(n)}catch(l){return console.error(l),SQLITE_IOERR}})}xCheckReservedLock(t,n){return this.handleAsync(async()=>{const o=i(this,Ge).get(t);log$1(`xCheckReservedLock ${o.path}`);const l=await o.locks.isSomewhereReserved();return n.setInt32(0,l?1:0,!0),SQLITE_OK})}xSectorSize(t){return SECTOR_SIZE}xDeviceCharacteristics(t){return SQLITE_IOCAP_BATCH_ATOMIC|SQLITE_IOCAP_SAFE_APPEND|SQLITE_IOCAP_SEQUENTIAL|SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN}xFileControl(t,n,o){const l=i(this,Ge).get(t);switch(log$1(`xFileControl ${l.path} ${n}`),n){case 11:return l.overwrite=!0,SQLITE_OK;case 21:if(l.overwrite)try{return this.handleAsync(async()=>(await Y(this,ki,ra).call(this,l),SQLITE_OK))}catch(c){return console.error(c),SQLITE_IOERR}if(l.isMetadataChanged)try{i(this,Re).run("readwrite",async({blocks:c})=>{await c.put(l.block0)}),l.isMetadataChanged=!1}catch(c){return console.error(c),SQLITE_IOERR}return SQLITE_OK;case 22:return l.overwrite=!1,SQLITE_OK;case 31:return this.handleAsync(async()=>{try{return l.block0.version--,l.changedPages=new Set,i(this,Re).run("readwrite",async({blocks:c})=>{const f=await c.index("version").getAllKeys(IDBKeyRange.bound([l.path],[l.path,l.block0.version]));for(const h of f)c.delete(h)}),SQLITE_OK}catch(c){return console.error(c),SQLITE_IOERR}});case 32:try{const c=Object.assign({},l.block0);c.data=c.data.slice();const f=l.changedPages;return l.changedPages=null,l.isMetadataChanged=!1,i(this,Re).run("readwrite",async({blocks:h})=>{h.put(c);const m=await h.get([l.path,"purge",0])??{path:l.path,offset:"purge",version:0,data:new Map,count:0};m.count+=f.size;for(const b of f)m.data.set(b,c.version);h.put(m),Y(this,Ai,ta).call(this,l.path,m.count)}),SQLITE_OK}catch(c){return console.error(c),SQLITE_IOERR}case 33:return this.handleAsync(async()=>{try{return l.changedPages=null,l.isMetadataChanged=!1,l.block0=await i(this,Re).run("readonly",({blocks:c})=>c.get([l.path,0,l.block0.version+1])),SQLITE_OK}catch(c){return console.error(c),SQLITE_IOERR}});default:return SQLITE_NOTFOUND}}xAccess(t,n,o){return this.handleAsync(async()=>{try{const l=new URL(t,"file://localhost/").pathname;log$1(`xAccess ${l} ${n}`);const c=await i(this,Re).run("readonly",({blocks:f})=>f.getKey(Y(this,tr,Lr).call(this,{path:l},0)));return o.setInt32(0,c?1:0,!0),SQLITE_OK}catch(l){return console.error(l),SQLITE_IOERR}})}xDelete(t,n){return this.handleAsync(async()=>{const o=new URL(t,"file://localhost/").pathname;try{return i(this,Re).run("readwrite",({blocks:l})=>l.delete(IDBKeyRange.bound([o],[o,[]]))),n&&await i(this,Re).sync(),SQLITE_OK}catch(l){return console.error(l),SQLITE_IOERR}})}async purge(t){const n=Date.now();await i(this,Re).run("readwrite",async({blocks:o})=>{const l=await o.get([t,"purge",0]);if(l){for(const[c,f]of l.data)o.delete(IDBKeyRange.bound([t,c,f],[t,c,1/0],!0,!1));await o.delete([t,"purge",0])}log$1(`purge ${t} ${(l==null?void 0:l.data.size)??0} pages in ${Date.now()-n} ms`)})}}er=new WeakMap,Ge=new WeakMap,Re=new WeakMap,Ir=new WeakMap,vr=new WeakMap,Pt=new WeakMap,Qn=new WeakSet,ss=function(t,n,o){const l=i(this,Ge).get(t);log$1(`xWrite ${l.path} ${n.byteLength} ${o}`);try{const c=l.block0.fileSize;l.block0.fileSize<o+n.byteLength&&(l.block0.fileSize=o+n.byteLength,l.isMetadataChanged=!0);const f=o===0?l.block0:{path:l.path,offset:-o,version:l.block0.version,data:null};return f.data=n.slice(),l.changedPages?(c===l.block0.fileSize&&l.changedPages.add(-o),o!==0&&i(this,Re).run("readwrite",({blocks:h})=>h.put(f))):i(this,Re).run("readwrite",({blocks:h})=>h.put(f)),l.isMetadataChanged=o===0?!1:l.isMetadataChanged,SQLITE_OK}catch(c){return console.error(c),SQLITE_IOERR}},xi=new WeakSet,ea=async function(t,n){const o=i(this,Ge).get(t);log$1(`xSync ${o.path} ${n}`);try{o.isMetadataChanged&&(i(this,Re).run("readwrite",async({blocks:l})=>{await l.put(o.block0)}),o.isMetadataChanged=!1),await i(this,Re).sync()}catch(l){return console.error(l),SQLITE_IOERR}return SQLITE_OK},Ai=new WeakSet,ta=function(t,n){i(this,er).purge==="manual"||i(this,Ir).has(t)||n<i(this,er).purgeAtLeast||(globalThis.requestIdleCallback?globalThis.requestIdleCallback(()=>{this.purge(t),i(this,Ir).delete(t)}):setTimeout(()=>{this.purge(t),i(this,Ir).delete(t)}),i(this,Ir).add(t))},tr=new WeakSet,Lr=function(t,n,o=0){const l=!n||-n<t.block0.data.length?-1/0:t.block0.version;return IDBKeyRange.bound([t.path,n,l],[t.path,o,1/0])},ki=new WeakSet,ra=async function(t){const n=t.block0.data.length;if(n<18)return;const o=new DataView(t.block0.data.buffer,t.block0.data.byteOffset);let l=o.getUint16(16);if(l===1&&(l=65536),l===n)return;const c=Math.max(n,l),f=c/n,h=c/l,b=o.getUint32(28)*l,E=t.block0.version;await i(this,Re).run("readwrite",async({blocks:k})=>{const L=await k.index("version").getAllKeys(IDBKeyRange.bound([t.path,E+1],[t.path,1/0]));for(const I of L)k.delete(I);k.delete([t.path,"purge",0]);for(let I=0;I<b;I+=c){const p=await k.getAll(IDBKeyRange.lowerBound([t.path,-(I+c),1/0]),f);for(const w of p)k.delete([w.path,w.offset,w.version]);if(h===1){const w=new Uint8Array(l);for(const _ of p)w.set(_.data,-(I+_.offset));const y={path:t.path,offset:-I,version:E,data:w};y.offset===0&&(y.fileSize=b,t.block0=y),k.put(y)}else{const w=p[0];for(let y=0;y<h;++y){const _=-(I+y*l);if(-_>=b)break;const R={path:w.path,offset:_,version:E,data:w.data.subarray(y*l,(y+1)*l)};R.offset===0&&(R.fileSize=b,t.block0=R),k.put(R)}}}})};function openDatabase(r){return new Promise((e,t)=>{const n=globalThis.indexedDB.open(r,5);n.addEventListener("upgradeneeded",function(){n.result.createObjectStore("blocks",{keyPath:["path","offset","version"]}).createIndex("version",["path","version"])}),n.addEventListener("success",()=>{e(n.result)}),n.addEventListener("error",()=>{t(n.error)})})}const E_CANCELED=new Error("request for lock canceled");var __awaiter$2=function(r,e,t,n){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(b){try{m(n.next(b))}catch(E){c(E)}}function h(b){try{m(n.throw(b))}catch(E){c(E)}}function m(b){b.done?l(b.value):o(b.value).then(f,h)}m((n=n.apply(r,e||[])).next())})};class Semaphore{constructor(e,t=E_CANCELED){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()})}runExclusive(e,t=1){return __awaiter$2(this,void 0,void 0,function*(){const[n,o]=yield this.acquire(t);try{return yield e(n)}finally{o()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){const n=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!n)continue;const o=this._value,l=t;this._value-=t,t=this._value+1,n.resolve([o,this._newReleaser(l)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}}var __awaiter$1=function(r,e,t,n){function o(l){return l instanceof t?l:new t(function(c){c(l)})}return new(t||(t=Promise))(function(l,c){function f(b){try{m(n.next(b))}catch(E){c(E)}}function h(b){try{m(n.throw(b))}catch(E){c(E)}}function m(b){b.done?l(b.value):o(b.value).then(f,h)}m((n=n.apply(r,e||[])).next())})};class Mutex{constructor(e){this._semaphore=new Semaphore(1,e)}acquire(){return __awaiter$1(this,void 0,void 0,function*(){const[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const isDebug=globalThis.__vlcn_wa_crsqlite_dbg;function log(...r){isDebug&&console.log("crsqlite-wasm: ",...r)}const re=/insert\s|update\s|delete\s/,txRe=/begin\s|commit\s|rollback\s|savepoint\s/;function computeCacheKey(r,e,t){const n=r.toLowerCase();if(txRe.exec(n)==null)return re.exec(n)!=null?(log("received write"),null):t!=null?n+"|"+e+"|"+t.map(l=>l!=null?l.toString():"null").join("|"):n}class Stmt{constructor(e,t,n,o,l,c,f){le(this,"originDB");le(this,"stmtFinalizer");le(this,"cache");le(this,"api");le(this,"base");le(this,"str");le(this,"sql");le(this,"mode","o");le(this,"finalized",!1);le(this,"bindings",[]);this.originDB=e,this.stmtFinalizer=t,this.cache=n,this.api=o,this.base=l,this.str=c,this.sql=f,t.set(l,this)}run(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),()=>(t.length>0&&this.bind(t),this.api.step(this.base).then(()=>this.api.reset(this.base))),(e==null?void 0:e.__mutex)||this.originDB.__mutex)}get(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),async()=>{t.length>0&&this.bind(t);let n=null,o=this.mode==="o"?this.api.column_names(this.base):null;if(await this.api.step(this.base)==SQLITE_ROW){const l=this.api.row(this.base);if(o!=null){const c={};for(let f=0;f<o.length;++f)c[o[f]]=l[f];n=c}else n=l}return await this.api.reset(this.base),n},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}all(e,...t){return serialize(this.cache,computeCacheKey(this.sql,this.mode,t.length>0?t:this.bindings),async()=>{t.length>0&&this.bind(t);const n=[];let o=this.mode==="o"?this.api.column_names(this.base):null;for(;await this.api.step(this.base)==SQLITE_ROW;)if(o!=null){const l={};for(let c=0;c<o.length;++c)l[o[c]]=this.api.column(this.base,c);n.push(l)}else{n.push(this.api.row(this.base));continue}return await this.api.reset(this.base),n},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}async*iterate(e,...t){for(this.bind(t);await serialize(this.cache,void 0,()=>this.api.step(this.base),(e==null?void 0:e.__mutex)||this.originDB.__mutex)==SQLITE_ROW;)yield this.api.row(this.base);await serialize(this.cache,void 0,()=>this.api.reset(this.base),(e==null?void 0:e.__mutex)||this.originDB.__mutex)}raw(e){return e?this.mode="a":this.mode="o",this}bind(e){this.bindings=e;for(let t=0;t<e.length;++t)this.api.bind(this.base,t+1,e[t]);return this}finalize(e){return serialize(this.cache,void 0,()=>{if(!this.finalized)return this.finalized=!0,this.api.str_finish(this.str),this.stmtFinalizer.delete(this.base),this.api.finalize(this.base)},(e==null?void 0:e.__mutex)||this.originDB.__mutex)}}class TX{constructor(e,t,n,o,l){le(this,"api");le(this,"db");le(this,"__mutex");le(this,"assertOpen");le(this,"stmtFinalizer");le(this,"cache",new Map);this.api=e,this.db=t,this.__mutex=n,this.assertOpen=o,this.stmtFinalizer=l}execMany(e){return this.assertOpen(),serialize(this.cache,null,()=>this.api.exec(this.db,e.join("")),this.__mutex)}exec(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"a",t),()=>this.statements(e,!1,t),this.__mutex)}execO(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"o",t),()=>this.statements(e,!0,t),this.__mutex)}execA(e,t){return this.assertOpen(),serialize(this.cache,computeCacheKey(e,"a",t),()=>this.statements(e,!1,t),this.__mutex)}prepare(e){return this.assertOpen(),serialize(this.cache,void 0,async()=>{const t=this.api.str_new(this.db,e),n=await this.api.prepare_v2(this.db,this.api.str_value(t));if(n==null)throw this.api.str_finish(t),new Error(`Could not prepare ${e}`);return new Stmt(this,this.stmtFinalizer,this.cache,this.api,n.stmt,t,e)},this.__mutex)}tx(e){this.assertOpen();const t="crsql"+crypto.randomUUID().replaceAll("-","");return serializeTx(async n=>{await n.exec("SAVEPOINT "+t);try{await e(n)}catch(o){throw await n.exec("ROLLBACK TO "+t),await n.exec("RELEASE "+t),o}await n.exec("RELEASE "+t)},this.__mutex,this)}imperativeTx(){return this.__mutex.acquire().then(e=>{const t=new Mutex;return[e,new TX(this.api,this.db,t,this.assertOpen,this.stmtFinalizer)]})}async statements(e,t,n){const o=[],l=this.api.str_new(this.db,e);let c={stmt:null,sql:this.api.str_value(l)};try{for(;c=await this.api.prepare_v2(this.db,c.sql);){const m=c.stmt,b=[],E=this.api.column_names(m);for(n&&this.bind(m,n);await this.api.step(m)===SQLITE_ROW;){const k=this.api.row(m);b.push(k)}E.length&&o.push({columns:E,rows:b}),this.api.finalize(c.stmt),c.stmt=null}}catch(m){throw console.error(`Failed running ${e}`,m),m}finally{c!=null&&c.stmt&&this.api.finalize(c.stmt),this.api.str_finish(l)}const f=o[0];if(f==null)return null;if(!t)return f.rows;const h=[];for(const m of f.rows){const b={};for(let E=0;E<f.columns.length;++E)b[f.columns[E]]=m[E];h.push(b)}return h}bind(e,t){for(let n=0;n<t.length;++n){const o=t[n];this.api.bind(e,n+1,typeof o=="boolean"?o&&1||0:o)}}}const topLevelMutex=new Mutex;topLevelMutex.name="topLevelMutex";function serialize(r,e,t,n){if(e===null)log("Cache clear"),r==null||r.clear();else if(e!==void 0){const l=r==null?void 0:r.get(e);if(l)return log("Cache hit",e),l}log("Enqueueing query ",e);const o=n.runExclusive(t);return e&&(r==null||r.set(e,o),o.finally(()=>r==null?void 0:r.delete(e)).catch(l=>{console.error(l)})),o}function serializeTx(r,e,t){return e.runExclusive(()=>{const n=new Mutex,o=new TX(t.api,t.db,n,t.assertOpen,t.stmtFinalizer);return r(o)})}function cryb64(r,e=0){let t=3735928559^e,n=1103547991^e;for(let o=0,l;o<r.length;o++)l=r.charCodeAt(o),t=Math.imul(t^l,2654435761),n=Math.imul(n^l,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296n*BigInt(n)+BigInt(t)}function firstPick(r){const e=r[0];if(e!=null)return e[Object.keys(e)[0]]}var cn,Rr,zt,Mn,Ot,Un,Li;class DB{constructor(e,t,n){le(this,"api");le(this,"db");le(this,"filename");le(this,"__mutex",topLevelMutex);le(this,"stmtFinalizer",new Map);g(this,cn,null);g(this,Rr,null);le(this,"cache",new Map);g(this,zt,null);g(this,Mn,!1);g(this,Ot,void 0);g(this,Un,()=>{if(i(this,Mn))throw new Error("The DB is closed")});g(this,Li,(e,t,n,o)=>{i(this,zt)!=null&&i(this,zt).forEach(l=>{try{l(e,t,n,o)}catch(c){console.error("Failed notifying a DB update listener"),console.error(c)}})});this.api=e,this.db=t,this.filename=n,x(this,Ot,new TX(e,t,topLevelMutex,i(this,Un),this.stmtFinalizer))}get siteid(){return i(this,cn)}_setSiteid(e){if(i(this,cn))throw new Error("Site id already set");x(this,cn,e)}_setTablesUsedStmt(e){x(this,Rr,e)}get tablesUsedStmt(){if(i(this,Rr)==null)throw new Error("tablesUsedStmt not set");return i(this,Rr)}async automigrateTo(e,t){const n=cryb64(t),o=firstPick(await this.execA("SELECT value FROM crsql_master WHERE key = 'schema_name'")),l=firstPick(await this.execA("SELECT value FROM crsql_master WHERE key = 'schema_version'"));if(o===e&&BigInt(l||0)===n)return"noop";const c=o===void 0||o!==e?"apply":"migrate";return await this.tx(async f=>{if(l==null||o!==e){if(o!==e){const h=await f.execA("SELECT name FROM sqlite_master WHERE type = 'table' AND name NOT LIKE 'sqlite_%' AND name NOT LIKE 'crsql_%'");for(const m of h)await f.exec(`DROP TABLE [${m[0]}]`)}await f.exec(t)}else await f.exec("SELECT crsql_automigrate(?, 'SELECT crsql_finalize();')",[t]);await f.exec("INSERT OR REPLACE INTO crsql_master (key, value) VALUES (?, ?)",["schema_version",n]),await f.exec("INSERT OR REPLACE INTO crsql_master (key, value) VALUES (?, ?)",["schema_name",e])}),await this.exec("VACUUM;"),c}execMany(e){return i(this,Ot).execMany(e)}exec(e,t){return i(this,Ot).exec(e,t)}execO(e,t){return i(this,Ot).execO(e,t)}execA(e,t){return i(this,Ot).execA(e,t)}prepare(e){return i(this,Ot).prepare(e)}tx(e){return i(this,Ot).tx(e)}imperativeTx(){return i(this,Ot).imperativeTx()}async close(){var e;for(const t of this.stmtFinalizer.values())await t.finalize(this);return(e=i(this,Rr))==null||e.finalize(this),this.exec("SELECT crsql_finalize()").then(()=>(x(this,Mn,!0),serialize(this.cache,void 0,()=>this.api.close(this.db),this.__mutex)))}createFunction(e,t,n){i(this,Un).call(this),this.api.create_function(this.db,e,t.length,SQLITE_UTF8,0,(o,l)=>{const c=[];for(let h=0;h<t.length;++h)c.push(this.api.value(l[h]));const f=t(...c);f!==void 0&&this.api.result(o,f)})}onUpdate(e){return i(this,zt)==null&&(this.api.update_hook(this.db,i(this,Li)),x(this,zt,new Set)),i(this,zt).add(e),()=>{var t;return(t=i(this,zt))==null?void 0:t.delete(e)}}}cn=new WeakMap,Rr=new WeakMap,zt=new WeakMap,Mn=new WeakMap,Ot=new WeakMap,Un=new WeakMap,Li=new WeakMap;let api=null;class SQLite3{constructor(e){le(this,"base");this.base=e}open(e,t="c"){return serialize(null,void 0,()=>this.base.open_v2(e||":memory:",SQLITE_OPEN_CREATE|SQLITE_OPEN_READWRITE|SQLITE_OPEN_URI,e!=null?"idb-batch-atomic":void 0),topLevelMutex).then(n=>{const o=new DB(this.base,n,e||":memory:");return o.prepare(`SELECT tbl_name FROM tables_used(?) AS u
        JOIN sqlite_master ON sqlite_master.name = u.name
        WHERE u.schema = 'main'`).then(l=>{l.raw(!0),o._setTablesUsedStmt(l)}).then(()=>o.execA("select quote(crsql_site_id());")).then(l=>(o._setSiteid(l[0][0].replace(/'|X/g,"")),o))})}}async function initWasm(r){if(api!=null)return api;const e=await SQLiteAsyncESMFactory({locateFile(n){return r?r(n):new URL(""+new URL("../assets/crsqlite.52890b09.wasm",import.meta.url).href,self.location).href}}),t=Factory(e);return t.vfs_register(new IDBBatchAtomicVFS("idb-batch-atomic",{durability:"relaxed"})),api=new SQLite3(t),api}async function load(r,e){return{database:await(await initWasm(()=>e.wasm||wasmUrl)).open(r),browser:!0}}class CRDialect extends SqliteDialect{constructor(t){super(t);le(this,"database");this.database=async()=>typeof t.database=="function"?t.database():t.database}createDriver(){const t=this.database,n=mutex();let o,l;return{async init(){o=await t(),l={async executeQuery(c){return{rows:await o.execO(c.sql,c.parameters)}},async*streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}}},async acquireConnection(){return await n.lock(),l},async beginTransaction(c){await c.executeQuery(CompiledQuery.raw("begin"))},async commitTransaction(c){await c.executeQuery(CompiledQuery.raw("commit"))},async rollbackTransaction(c){await c.executeQuery(CompiledQuery.raw("rollback"))},async releaseConnection(){n.unlock()},async destroy(){o==null||o.close()}}}}function mutex(){let r,e;return{async lock(){for(;r;)await r;r=new Promise(t=>e=t)},unlock(){const t=e;r=void 0,e=void 0,t==null||t()}}}function json(r,e){const t=Object.entries(e).flatMap(([n,o])=>[sql.lit(n),typeof o=="string"?r.ref(o):o]);return sql`json_object(${sql.join(t)})`.withPlugin({transformQuery({node:n}){return{...n,json:!0}}}).$castTo()}function group(r,e){const t=typeof e=="string"?r.ref(e).toOperationNode():e.toOperationNode();return new AggregateFunctionBuilder({aggregateFunctionNode:{...AggregateFunctionNode.create("json_group_array",[t]),json:!0}})}function groupJSON(r,e){return group(r,json(r,e))}var $n;class JSONPlugin{constructor(){g(this,$n,new WeakMap)}transformQuery({node:e,queryId:t}){return e.kind!=="SelectQueryNode"||i(this,$n).set(t,new Set(this.getColumns(e))),e}async transformResult({result:e,queryId:t}){if(!Array.isArray(e.rows))return e;const n=i(this,$n).get(t);return n&&e.rows.forEach(o=>this.parseObject(o,n)),e}getColumns(e){var n,o;const t=[];for(const l in e)e[l]&&typeof e[l]=="object"&&(e[l].json===!0&&typeof((n=e.alias)==null?void 0:n.name)=="string"&&t.push((o=e.alias)==null?void 0:o.name),t.push(...this.getColumns(e[l])));return t}parseObject(e,t){for(const n in e)t.has(n)&&(e[n]=JSON.parse(String(e[n]))),typeof e[n]=="object"&&this.parseObject(e[n],t)}}$n=new WeakMap;function covert(r){const t={any:"blob",string:"text",number:"real",unknown:"blob",instance:"blob",bigint:"integer",integer:"integer",boolean:"boolean"}[r];if(t)return t;throw new Error(`Type "${r}" is not allowed in the database schema!`)}async function apply(r,{schema:e}){var t;for(const n in e){const o=e[n];let l=r.schema.createTable(n).ifNotExists();for(const c in o.schema){const{type:f}=o.schema[c];l=l.addColumn(c,(t=o.ordered)!=null&&t.find(([h])=>h===c)?"blob":covert(f),h=>{var m;return(m=o.primary)!=null&&m.includes(c)?h.notNull():h})}o.primary&&(l=l.addPrimaryKeyConstraint("primary_key",o.primary)),await l.execute();for(const c of o.indices||[])await r.schema.createIndex(`${n}_${c.join("_")}`).ifNotExists().on(n).columns(c).execute();o.crr&&await sql`SELECT crsql_as_crr(${n})`.execute(r);for(const c of o.ordered||[])await sql`SELECT crsql_fract_as_ordered(${n},${sql.join(c)})`.execute(r);await r.schema.createTable("__crstore_sync").ifNotExists().addColumn("version","integer").execute(),await sql`INSERT INTO __crstore_sync (version) SELECT 0
      WHERE NOT EXISTS (SELECT * FROM __crstore_sync)
    `.execute(r)}}function primary(r,...e){return r.primary=e,r}function crr(r){return r.crr=!0,r}function ordered(r,e,...t){return r.ordered||(r.ordered=[]),r.ordered.push([e,...t]),r}function index(r,...e){return r.indices||(r.indices=[]),r.indices.push(e),r}const connections$1=new Map,defaultPaths={};async function init(r,e,t=defaultPaths){if(connections$1.has(r))return connections$1.get(r);const{database:n,browser:o}=await load(r,t),l=o?CRDialect:SqliteDialect,c=new Kysely({dialect:new l({database:n}),plugins:[new JSONPlugin]}),f=c.destroy.bind(c);await c.transaction().execute(m=>apply(m,e));const h=Object.assign(c,{resolveChanges,applyOperation,insertChanges,updateVersion,selectVersion,selectClient,changesSince,async destroy(){return connections$1.delete(r),await finalize.bind(c)().execute(),f()}});return connections$1.set(r,h),h}const raf=globalThis.requestAnimationFrame||globalThis.setTimeout,error=Symbol("error");function queue(r,e){const t=new Map;let n;async function o(){return n||(n=new Promise(l=>raf(async()=>{const c=await r,f=new Map;await c.transaction().execute(async h=>{const m=e&&(await selectVersion.bind(h)().execute()).current;for(const[b,E]of t.entries()){const k=await E(h).catch(L=>({[error]:L}));f.set(b,k)}e==null||e(await changesSince.bind(h)(m).execute())}),t.clear(),n=void 0,l(f)})))}return{enqueue(l,c,...f){return t.set(l,h=>c(h,...f)),o().then(h=>h.get(l)).then(h=>{if(h&&typeof h=="object"&&error in h)throw h[error];return h})}}}const empty=[],ready=r=>r!==empty;function database(r,{ssr:e=!1,name:t="crstore.db",paths:n=defaultPaths,error:o=void 0,push:l=void 0,pull:c=void 0,online:f=()=>{var h;return!!((h=globalThis.navigator)!=null&&h.onLine)}}={}){var G;const m=!e&&!1?new Promise(()=>{}):init(t,r,n),b="BroadcastChannel"in globalThis?new globalThis.BroadcastChannel(`${t}-sync`):null,E=$=>S($.data,$.data[0]),k=queue(m,S),L=queue(m);b==null||b.addEventListener("message",E),(G=globalThis.addEventListener)==null||G.call(globalThis,"online",R);const I=new Map;let p=()=>{};R();async function w($,z){return L.enqueue(z,H=>H.getExecutor().executeQuery($,z)).then(H=>H.rows)}function y($,z,H){const ue=async(X,oe)=>{try{if(H&&H.client===oe)return;await z(X,oe)}catch(ye){o==null||o(ye)}};return $.forEach(X=>{var oe;I.has(X)||I.set(X,new Set),(oe=I.get(X))==null||oe.add(ue)}),H?m.then(async X=>{const oe=await X.changesSince(H.version,H.client).execute();oe.length&&ue(oe)}):ue([]),()=>$.forEach(X=>{var oe;return(oe=I.get(X))==null?void 0:oe.delete(ue)})}async function _(){if(!l||!f())return;const $=await m,{current:z,synced:H}=await $.selectVersion().execute();if(z<=H)return;const ue=await $.changesSince(H,null).execute();await l(ue),await $.updateVersion(z).execute()}async function R(){var ue,X;if((ue=globalThis.removeEventListener)==null||ue.call(globalThis,"offline",p),p(),!c||!f())return;const $=await m,{synced:z}=await $.selectVersion().execute(),H=await $.selectClient().execute();await _(),p=c({version:z,client:H},{async onData(oe){oe.length&&(await $.insertChanges(oe).execute(),await S(oe,oe[0]))}}).unsubscribe,(X=globalThis.addEventListener)==null||X.call(globalThis,"offline",p)}async function A($,...z){return k.enqueue({},$,...z)}async function j($){if(!$.length)return;const z=await m;await S(await z.resolveChanges($).execute(),$[0])}async function S($,z){var oe;if(!$.length)return;const H=new Set,ue=affectedTables($);(oe=I.get("*"))==null||oe.forEach(ye=>H.add(ye)),ue.forEach(ye=>{var M;return(M=I.get(ye))==null?void 0:M.forEach(te=>H.add(te))});const X=[...H].map(ye=>ye($,z));z||(b==null||b.postMessage($),await _()),await Promise.all(X)}async function F(){var $,z;p(),b==null||b.close(),I.clear(),($=globalThis.removeEventListener)==null||$.call(globalThis,"online",R),(z=globalThis.removeEventListener)==null||z.call(globalThis,"offline",p),b==null||b.removeEventListener("message",E),await m.then(H=>H.destroy())}const he=Object.assign(store.bind({connection:m,subscribe:y,update:A,refresh:w},[]),{with:(...$)=>store.bind({connection:m,subscribe:y,update:A,refresh:w},$)});return{close:F,merge:j,update:A,subscribe:y,connection:m,store:he}}function store(r,e,t={}){const{connection:n,update:o,refresh:l}=this,c=derived(r,L=>L);let f=null,h=null;const{subscribe:m,set:b}=writable(empty,()=>{let L=()=>{};return n.then(I=>{if(!L)return;let p=()=>{};const w=c.subscribe(y=>{const _=e(I,...y).toOperationNode(),R=affectedTables(_),A=I.getExecutor();h={queryId:Math.random().toString(36).slice(2)},f=A.compileQuery(A.transformQuery(_,h),h),p(),p=this.subscribe(R,E)});L=()=>(w(),p())}),()=>(L==null||L(),L=null)});async function E(){await n,!(!f||!h)&&b(await l(f,h))}const k={};for(const L in t)k[L]=(...I)=>o(t[L],...I);return{...k,set:b,subscribe:m,update(L,...I){return L?o(L,...I):E()},then(L,I){let p=[];const w=m(y=>p=y);return E().then(()=>(w(),L(p)),I)}}}const APPEND=1,source=r=>r.selectFrom(e=>e.selectFrom("sources").select(["owner","source"]).orderBy("sources.primary","desc").as("ordered")).select(["owner",e=>group(e,"source").as("sources")]).groupBy("owner").$castTo(),asset=r=>r.selectFrom(e=>e.selectFrom("assets").select(["owner","art","thumbnail"]).orderBy("assets.primary","desc").as("ordered")).select(["owner",e=>group(e,"art").as("arts"),e=>group(e,"thumbnail").as("thumbnails")]).groupBy("owner").$castTo(),artist$1=r=>r.selectFrom("artists").leftJoin("source","source.owner","artists.id").leftJoin("asset","asset.owner","artists.id").select(["artists.id","artists.title","artists.following",e=>e.fn.coalesce("asset.arts",e.val("[]")).as("arts"),e=>e.fn.coalesce("asset.thumbnails",e.val("[]")).as("thumbnails"),e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources")]).$castTo(),album$1=r=>r.selectFrom("albums").leftJoin("source","source.owner","albums.id").leftJoin("asset","asset.owner","albums.id").leftJoin("attribution","attribution.album","albums.id").innerJoin("artist","artist.id","attribution.artist").select(["albums.id","albums.title","albums.year",e=>e.fn.coalesce("asset.arts",e.val("[]")).as("arts"),e=>e.fn.coalesce("asset.thumbnails",e.val("[]")).as("thumbnails"),e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources"),e=>groupJSON(e,{id:"artist.id",title:"artist.title",arts:"artist.arts",thumbnails:"artist.thumbnails",sources:"artist.sources"}).filterWhere("artist.id","is not",null).as("artists")]).groupBy("albums.id").$castTo(),track$2=r=>r.selectFrom("tracks").leftJoin("source","source.owner","tracks.id").innerJoin("album","album.id","tracks.album").select(["tracks.id","tracks.title","tracks.duration","album.artists",e=>e.fn.coalesce("source.sources",e.val("[]")).as("sources"),e=>json(e,{id:"album.id",title:"album.title",year:"album.year",arts:"album.arts",thumbnails:"album.thumbnails",sources:"album.sources"}).as("album")]).$castTo(),localDevice=sql`crsql_site_id()`,uuid=()=>Math.random()*2**32>>>0,sanitize=r=>r.replace(/-/g," ").split(/\s+/g).map(e=>`"${e.replace(/"/g,'""')}"`).join(" "),position={first:null,before:r=>r.selectFrom("queue").select("id").where("position","=",1).limit(1),shift:r=>e=>e.selectFrom("queue").select("id").whereRef(t=>t.selectFrom("queue").select(sql`position + 1`.as("position")).where("id","=",r),"=","position").limit(1),next:r=>r.selectFrom("devices").select("playback").where("id","=",localDevice).limit(1),last:r=>r.selectFrom("playback").select("id").where("device","=",localDevice).orderBy("order","desc").orderBy("id","desc").limit(1),random:r=>e=>e.selectFrom(t=>t.selectFrom("queue").select(["id","position"]).$if(!!r.length,n=>n.unionAll(sql`VALUES ${sql.raw(r.map(o=>`(${o}, 1)`).join(","))}`)).unionAll(sql`SELECT null,1 WHERE NOT EXISTS (SELECT 1 FROM queue WHERE position >= 0)`).as("data")).select("id").where("position",">=",0).orderBy(sql`random()`).limit(1)};async function pushTracks(r,e){e.length&&(await pushAlbums(r,e.map(t=>({...t.album,artists:t.artists}))),await r.insertInto("tracks").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,duration:t.duration,album:t.album.id}))).execute(),await pushResources(r,e))}async function pushAlbums(r,e){e.length&&(await pushArtists(r,e.flatMap(t=>t.artists)),e.find(t=>t.artists.length)&&await r.insertInto("attribution").onConflict(t=>t.doNothing()).values(e.flatMap(t=>t.artists.map(({id:n})=>({album:t.id,artist:n})))).execute(),await r.insertInto("albums").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,year:t.year}))).execute(),await pushResources(r,e))}async function pushArtists(r,e){e.length&&(await r.insertInto("artists").onConflict(t=>t.doNothing()).values(e.map(t=>({id:t.id,title:t.title,following:0}))).execute(),await pushResources(r,e))}async function pushResources(r,e){e.length&&(e.find(t=>t.sources.length)&&await r.insertInto("sources").onConflict(t=>t.doNothing()).values(e.flatMap(({id:t,sources:n})=>n.map((o,l)=>({owner:t,source:o,primary:+!l&&sql`NOT EXISTS (SELECT 1 FROM sources WHERE owner = ${t} AND "primary" = 1)`})))).execute(),e.find(t=>{var n;return(n=t.arts)==null?void 0:n.length})&&await r.insertInto("assets").onConflict(t=>t.doNothing()).values(e.flatMap(({id:t,arts:n,thumbnails:o})=>{if(!n)return[];const l=n.find((c,f)=>!!(o!=null&&o[f]))||n[0];return n.map((c,f)=>({owner:t,art:c,thumbnail:o==null?void 0:o[f],primary:+(c===l)&&sql`NOT EXISTS (SELECT 1 FROM assets WHERE owner = ${t} AND "primary" = 1)`}))})).execute())}const preceding$1=({store:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).with("update",t=>t.selectFrom("playback").select(n=>n.selectFrom("devices").select("id").as("_"))).selectFrom("queue").innerJoin("track","track.id","queue.track").where("position","<",0).select("queue.id as entry").select(fields).$castTo()),upcoming$1=({store:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).with("update",t=>t.selectFrom("playback").select(n=>n.selectFrom("devices").select("id").as("_"))).selectFrom("queue").innerJoin("track","track.id","queue.track").where("position",">",0).select("queue.id as entry").select(fields).$castTo()),playback$2=({store:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("devices").innerJoin("playback","playback.id","devices.playback").innerJoin("track","track.id","playback.track").select(["direction","repeat","infinite","device","progress"]).select(t=>json(t,{entry:"playback.id",id:"track.id",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).as("track")).select(sql`device = crsql_site_id()`.as("local")).select(fields).$castTo(),{async push(e,t,n="next"){if(!t.length)return;await pushTracks(e,t);const{direction:o,playback:l}=await e.selectFrom("devices").where("id","=",localDevice).select(["direction","playback"]).executeTakeFirstOrThrow(),c=t.map(uuid),f=o!=1?Number.isInteger(n)?n:n==="first"?position.first:n==="next"?position.next:position.last:Number.isInteger(n)?position.shift(+n):n==="first"?position.last:n==="next"?position.before:position.first;await e.insertInto("playback_fractindex").values(t.map((h,m)=>({id:c[m],track:h.id,device:localDevice,after_id:n==="random"?position.random(c.slice(0,m)):m>0&&o!=1?c[m-1]:f}))).execute(),!~l&&n==="random"&&await e.updateTable("devices").set({playback:h=>h.selectFrom("queue").select("id").$castTo().limit(1)}).execute()},async purge(e,t){t.length&&await e.deleteFrom("playback").where("id","in",t).execute()},async clear(e,t=localDevice){await e.deleteFrom("playback").where("device","=",t).execute(),await e.updateTable("devices").set({playback:-1,progress:0}).where("id","=",t).execute()},async sync(e,t){await e.updateTable("devices").where("id","=",localDevice).set({progress:t}).execute()},async rearrange(e,t,n=null){const{direction:o}=await e.selectFrom("devices").where("id","=",localDevice).select(["direction"]).executeTakeFirstOrThrow(),l=o!=1?n:n!=null?position.shift(n):position.last;await e.updateTable("playback_fractindex").set({after_id:l}).where("id","=",t).execute()},async redirect(e,t){const n=["forward","backward","shuffled"],{direction:o}=await e.selectFrom("devices").select("direction").where("id","=",localDevice).executeTakeFirstOrThrow(),l=n.indexOf(t);o!==l&&await e.updateTable("devices").set({direction:l}).where("id","=",localDevice).execute()},async repeat(e,t){const n=["none","single","all"];await e.updateTable("devices").set({repeat:n.indexOf(t)}).where("id","=",localDevice).execute()},async infinite(e,t){await e.updateTable("devices").set({infinite:t==null?sql`!infinite`:+t}).where("id","=",localDevice).execute()},async replicate(e,t){const n=uuid();await e.updateTable("devices").where("id","=",localDevice).set({playback:n,progress:o=>o.selectFrom("devices").where("id","=",t).select("progress")}).execute(),await e.deleteFrom("playback").where("device","=",localDevice).execute(),await e.insertInto("playback").expression(o=>o.selectFrom("playback").select(l=>l.case().when(c=>c.selectFrom("devices").whereRef("id","=","playback.device").select("devices.playback"),"=",l.ref("playback.id")).then(n).else(sql`ABS(RANDOM() % 4294967296)`).end().as("id")).select(sql`${localDevice}`.as("device")).select(["track","order","temp"]).where("device","=",t)).execute()}}),fields=["track.id","track.title","track.duration","track.album","track.artists","track.sources"];class StructError extends TypeError{constructor(e,t){let n;const{message:o,explanation:l,...c}=e,{path:f}=e,h=f.length===0?o:`At path: ${f.join(".")} -- ${o}`;super(l??h),l!=null&&(this.cause=h),Object.assign(this,c),this.name=this.constructor.name,this.failures=()=>n??(n=[e,...t()])}}function isIterable(r){return isObject$1(r)&&typeof r[Symbol.iterator]=="function"}function isObject$1(r){return typeof r=="object"&&r!=null}function print(r){return typeof r=="symbol"?r.toString():typeof r=="string"?JSON.stringify(r):`${r}`}function shiftIterator(r){const{done:e,value:t}=r.next();return e?void 0:t}function toFailure(r,e,t,n){if(r===!0)return;r===!1?r={}:typeof r=="string"&&(r={message:r});const{path:o,branch:l}=e,{type:c}=t,{refinement:f,message:h=`Expected a value of type \`${c}\`${f?` with refinement \`${f}\``:""}, but received: \`${print(n)}\``}=r;return{value:n,type:c,refinement:f,key:o[o.length-1],path:o,branch:l,...r,message:h}}function*toFailures(r,e,t,n){isIterable(r)||(r=[r]);for(const o of r){const l=toFailure(o,e,t,n);l&&(yield l)}}function*run(r,e,t={}){const{path:n=[],branch:o=[r],coerce:l=!1,mask:c=!1}=t,f={path:n,branch:o};if(l&&(r=e.coercer(r,f),c&&e.type!=="type"&&isObject$1(e.schema)&&isObject$1(r)&&!Array.isArray(r)))for(const m in r)e.schema[m]===void 0&&delete r[m];let h="valid";for(const m of e.validator(r,f))m.explanation=t.message,h="not_valid",yield[m,void 0];for(let[m,b,E]of e.entries(r,f)){const k=run(b,E,{path:m===void 0?n:[...n,m],branch:m===void 0?o:[...o,b],coerce:l,mask:c,message:t.message});for(const L of k)L[0]?(h=L[0].refinement!=null?"not_refined":"not_valid",yield[L[0],void 0]):l&&(b=L[1],m===void 0?r=b:r instanceof Map?r.set(m,b):r instanceof Set?r.add(b):isObject$1(r)&&(b!==void 0||m in r)&&(r[m]=b))}if(h!=="not_valid")for(const m of e.refiner(r,f))m.explanation=t.message,h="not_refined",yield[m,void 0];h==="valid"&&(yield[void 0,r])}class Struct{constructor(e){const{type:t,schema:n,validator:o,refiner:l,coercer:c=h=>h,entries:f=function*(){}}=e;this.type=t,this.schema=n,this.entries=f,this.coercer=c,o?this.validator=(h,m)=>{const b=o(h,m);return toFailures(b,m,this,h)}:this.validator=()=>[],l?this.refiner=(h,m)=>{const b=l(h,m);return toFailures(b,m,this,h)}:this.refiner=()=>[]}assert(e,t){return assert(e,this,t)}create(e,t){return create(e,this,t)}is(e){return is(e,this)}mask(e,t){return mask(e,this,t)}validate(e,t={}){return validate(e,this,t)}}function assert(r,e,t){const n=validate(r,e,{message:t});if(n[0])throw n[0]}function create(r,e,t){const n=validate(r,e,{coerce:!0,message:t});if(n[0])throw n[0];return n[1]}function mask(r,e,t){const n=validate(r,e,{coerce:!0,mask:!0,message:t});if(n[0])throw n[0];return n[1]}function is(r,e){return!validate(r,e)[0]}function validate(r,e,t={}){const n=run(r,e,t),o=shiftIterator(n);return o[0]?[new StructError(o[0],function*(){for(const c of n)c[0]&&(yield c[0])}),void 0]:[void 0,o[1]]}function assign(...r){const e=r[0].type==="type",t=r.map(o=>o.schema),n=Object.assign({},...t);return e?type(n):object(n)}function define(r,e){return new Struct({type:r,schema:null,validator:e})}function omit(r,e){const{schema:t}=r,n={...t};for(const o of e)delete n[o];switch(r.type){case"type":return type(n);default:return object(n)}}function any(){return define("any",()=>!0)}function array(r){return new Struct({type:"array",schema:r,*entries(e){if(r&&Array.isArray(e))for(const[t,n]of e.entries())yield[t,n,r]},coercer(e){return Array.isArray(e)?e.slice():e},validator(e){return Array.isArray(e)||`Expected an array value, but received: ${print(e)}`}})}function instance$1(r){return define("instance",e=>e instanceof r||`Expected a \`${r.name}\` instance, but received: ${print(e)}`)}function integer(){return define("integer",r=>typeof r=="number"&&!isNaN(r)&&Number.isInteger(r)||`Expected an integer, but received: ${print(r)}`)}function literal(r){const e=print(r),t=typeof r;return new Struct({type:"literal",schema:t==="string"||t==="number"||t==="boolean"?r:null,validator(n){return n===r||`Expected the literal \`${e}\`, but received: ${print(n)}`}})}function never(){return define("never",()=>!1)}function nullable(r){return new Struct({...r,validator:(e,t)=>e===null||r.validator(e,t),refiner:(e,t)=>e===null||r.refiner(e,t)})}function number(){return define("number",r=>typeof r=="number"&&!isNaN(r)||`Expected a number, but received: ${print(r)}`)}function object(r){const e=r?Object.keys(r):[],t=never();return new Struct({type:"object",schema:r||null,*entries(n){if(r&&isObject$1(n)){const o=new Set(Object.keys(n));for(const l of e)o.delete(l),yield[l,n[l],r[l]];for(const l of o)yield[l,n[l],t]}},validator(n){return isObject$1(n)||`Expected an object, but received: ${print(n)}`},coercer(n){return isObject$1(n)?{...n}:n}})}function optional(r){return new Struct({...r,validator:(e,t)=>e===void 0||r.validator(e,t),refiner:(e,t)=>e===void 0||r.refiner(e,t)})}function string(){return define("string",r=>typeof r=="string"||`Expected a string, but received: ${print(r)}`)}function type(r){const e=Object.keys(r);return new Struct({type:"type",schema:r,*entries(t){if(isObject$1(t))for(const n of e)yield[n,t[n],r[n]]},validator(t){return isObject$1(t)||`Expected an object, but received: ${print(t)}`},coercer(t){return isObject$1(t)?{...t}:t}})}function union(r){const e=r.map(t=>t.type).join(" | ");return new Struct({type:"union",schema:null,coercer(t){for(const n of r){const[o,l]=n.validate(t,{coerce:!0});if(!o)return l}return t},validator(t,n){const o=[];for(const l of r){const[...c]=run(t,l,n),[f]=c;if(f[0])for(const[h]of c)h&&o.push(h);else return[]}return[`Expected the value to satisfy a union of \`${e}\`, but received: ${print(t)}`,...o]}})}const track$1=object({title:string(),duration:number()}),album=object({title:string(),year:integer()}),artist=object({title:string()}),playlist=object({title:string(),relevancy:number(),shared:nullable(string()),remote:nullable(string())});type({title:optional(string()),album:optional(type({title:optional(string())})),artists:optional(array(type({title:optional(string())})))});const media=object({sources:array(string()),arts:optional(array(string())),thumbnails:optional(array(nullable(string())))}),collection=r=>object({size:integer(),duration:number(),tracks:array(r)}),unique=r=>assign(r,object({id:integer()})),artistInfo=assign(artist,media),albumInfo=assign(album,assign(media,object({artists:array(artistInfo)}))),trackInfo=assign(track$1,assign(omit(media,["arts","thumbnails"]),object({album:omit(albumInfo,["artists"]),artists:array(artistInfo)}))),playlistInfo=playlist,track=assign(unique(trackInfo),object({entry:optional(number()),album:unique(trackInfo.schema.album),artists:array(unique(trackInfo.schema.artists.schema))}));assign(unique(albumInfo),object({artists:array(unique(albumInfo.schema.artists.schema)),collection:optional(collection(track))}));assign(unique(artistInfo),object({following:optional(union([literal(0),literal(1)])),collection:optional(collection(track))}));assign(unique(playlistInfo),object({collection:optional(collection(track))}));function has(r,e){return r!==null&&typeof r=="object"&&e in r&&r[e]!==void 0}function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var murmurhash={exports:{}};(function(r){(function(){const e=l=>new TextEncoder().encode(l);function t(l,c){typeof l=="string"&&(l=e(l));let f=l.length,h=c^f,m=0,b;for(;f>=4;)b=l[m]&255|(l[++m]&255)<<8|(l[++m]&255)<<16|(l[++m]&255)<<24,b=(b&65535)*1540483477+(((b>>>16)*1540483477&65535)<<16),b^=b>>>24,b=(b&65535)*1540483477+(((b>>>16)*1540483477&65535)<<16),h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16)^b,f-=4,++m;switch(f){case 3:h^=(l[m+2]&255)<<16;case 2:h^=(l[m+1]&255)<<8;case 1:h^=l[m]&255,h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16)}return h^=h>>>13,h=(h&65535)*1540483477+(((h>>>16)*1540483477&65535)<<16),h^=h>>>15,h>>>0}function n(l,c){typeof l=="string"&&(l=e(l));let f,h,m,b,E,k,L,I;for(f=l.length&3,h=l.length-f,m=c,E=3432918353,k=461845907,I=0;I<h;)L=l[I]&255|(l[++I]&255)<<8|(l[++I]&255)<<16|(l[++I]&255)<<24,++I,L=(L&65535)*E+(((L>>>16)*E&65535)<<16)&4294967295,L=L<<15|L>>>17,L=(L&65535)*k+(((L>>>16)*k&65535)<<16)&4294967295,m^=L,m=m<<13|m>>>19,b=(m&65535)*5+(((m>>>16)*5&65535)<<16)&4294967295,m=(b&65535)+27492+(((b>>>16)+58964&65535)<<16);switch(L=0,f){case 3:L^=(l[I+2]&255)<<16;case 2:L^=(l[I+1]&255)<<8;case 1:L^=l[I]&255,L=(L&65535)*E+(((L>>>16)*E&65535)<<16)&4294967295,L=L<<15|L>>>17,L=(L&65535)*k+(((L>>>16)*k&65535)<<16)&4294967295,m^=L}return m^=l.length,m^=m>>>16,m=(m&65535)*2246822507+(((m>>>16)*2246822507&65535)<<16)&4294967295,m^=m>>>13,m=(m&65535)*3266489909+(((m>>>16)*3266489909&65535)<<16)&4294967295,m^=m>>>16,m>>>0}const o=n;o.v2=t,o.v3=n,r.exports=o})()})(murmurhash);var murmurhashExports=murmurhash.exports;const hash=getDefaultExportFromCjs(murmurhashExports);function titled(r){return has(r,"title")?r.title:r}function compare$1(r,e){return typeof r=="string"&&typeof e=="string"?r.localeCompare(e):typeof r=="number"&&typeof e=="number"?r-e:has(r,"title")&&has(e,"title")?compare$1(clean(titled(r)),clean(titled(e))):0}function normalize(r){if(typeof r=="string")return clean(r);if(typeof r!="object")return r;const e={...r};for(const t in e)Array.isArray(e[t])?e[t]=e[t].map(normalize).sort(compare$1):e[t]=normalize(e[t]);return e}function stringify(r){return r=normalize(r),typeof r=="string"?r:typeof r!="object"?clean(String(r)):has(r,"artists")&&has(r,"title")&&has(r,"album")?`${r.artists.map(titled)} - ${r.title} - ${titled(r.album)}`:has(r,"artists")&&has(r,"title")?`${r.artists.map(titled)} - ${r.title}`:has(r,"title")?r.title:Array.isArray(r)?r.map(titled).toString():JSON.stringify(r)}function identify(r){return has(r,"id")?+r.id:hash(stringify(r))}const playlists$2=({store:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",t=>track$2(t).innerJoin("library","library.track","tracks.id").select(["library.playlist","library.id as entry"]).orderBy("library.order").orderBy("library.id")).selectFrom("track").fullJoin("playlists","playlists.id","track.playlist").where("playlists.id",">=",0).select(["playlists.id","playlists.title","playlists.relevancy","playlists.shared","playlists.remote",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.entry",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("playlists.id").orderBy("playlists.order").orderBy("playlists.id").$castTo(),{async create(e,t){await e.insertInto("playlists").onConflict(n=>n.doNothing()).values({id:identify(t),order:APPEND,relevancy:1,...t}).execute()},async edit(e,t,n){await e.updateTable("playlists").where("id","=",t).set(n).execute()},async rearrange(e,t,n){await e.updateTable("playlists_fractindex").set({after_id:n||null}).where("id","=",t).execute()},async delete(e,t){await e.deleteFrom("playlists").where("id","=",t).execute()},get(e,t){return e.selectFrom("playlists").selectAll().where("id","=",t).executeTakeFirstOrThrow()}}),resources$1=({store:r})=>r(e=>e.with("source",source).with("asset",asset).selectFrom("source").leftJoin("asset","asset.owner","source.owner").select([t=>t.fn.coalesce("asset.arts",t.val("[]")).as("arts"),t=>t.fn.coalesce("asset.thumbnails",t.val("[]")).as("thumbnails"),t=>t.fn.coalesce("source.sources",t.val("[]")).as("sources")]).$castTo(),{async prioritize(e,t,n){const o=t==="art"?"assets":"sources";await e.updateTable(o).set({primary:sql`${sql.ref(t)} = ${n}`}).where("owner","=",l=>l.selectFrom(o).where(t,"=",n).select("owner")).execute()},get(e,t){return e.with("source",source).with("asset",asset).selectFrom("source").leftJoin("asset","asset.owner","source.owner").select([n=>n.fn.coalesce("asset.arts",n.val("[]")).as("arts"),n=>n.fn.coalesce("asset.thumbnails",n.val("[]")).as("thumbnails"),n=>n.fn.coalesce("source.sources",n.val("[]")).as("sources")]).where("source.owner","=",t).$castTo().executeTakeFirstOrThrow()}}),settings$2=({store:r})=>r(e=>e.selectFrom("settings").select(["key",sql`json_extract(value, '$')`.as("value")]),{async store(e,t,n,o="settings"){o!=="settings"&&(await e.schema.createTable(o).ifNotExists().addColumn("key","text",l=>l.primaryKey()).addColumn("value","text").execute(),await e.schema.createIndex(o+"_value").ifNotExists().on(o).column("value").execute()),await e.insertInto(o).onConflict(l=>l.doUpdateSet({value:JSON.stringify(n)})).values({key:t,value:JSON.stringify(n)}).execute()},async extract(e,t,n="settings"){return e.selectFrom(n).select("value").where("key","=",t).executeTakeFirstOrThrow().then(o=>JSON.parse(o.value))},async lookup(e,t,n="settings"){return e.selectFrom(n).select("key").where("value","=",JSON.stringify(t)).executeTakeFirstOrThrow().then(o=>o.key)}}),history$2=({store:r})=>r(e=>e.selectFrom("history").orderBy("date","desc").selectAll(),{async log(e,t){t.trim()&&await e.insertInto("history").onConflict(n=>n.doUpdateSet({date:Date.now()})).values({query:t,date:Date.now()}).execute()},async clear(e){await e.deleteFrom("history").execute()},get(e){return e.selectFrom("history").selectAll().orderBy("date","desc").execute()}}),artists$2=({store:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("artist").leftJoin("attribution","attribution.artist","artist.id").leftJoin("albums","albums.id","attribution.album").leftJoin("tracks","tracks.album","albums.id").leftJoin("track","track.id","tracks.id").select(["artist.id","artist.title","artist.following","artist.arts","artist.thumbnails","artist.sources",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.id",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("artist.id").orderBy(t=>t.fn.count("track.duration"),"desc").orderBy("artist.title").$castTo(),{async push(e,t){await pushArtists(e,t)},async edit(e,t,n){await e.updateTable("artists").where("id","=",t).set(n)},async follow(e,t){await e.updateTable("artists").set({following:1}).where("id","=",t).execute()},async unfollow(e,t){await e.updateTable("artists").set({following:0}).where("id","=",t).execute()},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).selectFrom("artists_fts").where("artists_fts","match",sanitize(t)).orderBy("rank").innerJoin("artist","artist.id","artists_fts.rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).selectFrom("artist").where("artist.id","=",t).selectAll().$castTo().executeTakeFirstOrThrow()}}),library$2=({store:r})=>r(e=>e.selectFrom("library").selectAll(),{async push(e,t,n){t.length&&(await pushTracks(e,t),n!=null&&await e.insertInto("library").onConflict(o=>o.doNothing()).values(t.map(({id:o})=>({id:uuid(),order:APPEND,date:~~(Date.now()/1e3),track:o,playlist:n}))).execute())},async rearrange(e,t,n){await e.updateTable("library_fractindex").set({after_id:n||null}).where("id","=",t).execute()},async purge(e,t){const n=t.map(o=>e.deleteFrom("library").where("id","=",o).execute());await Promise.all(n)},async get(e,t){return t.length?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources","library.id as entry"]).where("library.id","in",t).$castTo().execute():[]},async sample(e,t){const n=t,o=n*Math.sqrt(2*Math.PI)/2,l=sql`POW(ABS(RANDOM()) / 9223372036854775808,
        ${o} /
        EXP(-0.5 * POW(row_number() OVER (ORDER BY date DESC) / ${n},2)) *
        playlists.relevancy
      )`;return await e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").innerJoin("playlists","playlists.id","library.playlist").innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources"]).where("relevancy",">",0).orderBy(l,"desc").limit(t).execute()},async banned(e){return await e.selectFrom("library").leftJoin("playlists","playlists.id","library.playlist").select("library.track").where("relevancy","<",0).execute().then(t=>t.map(n=>n.track))}}),id=integer,boolean=integer,tracks$2=assign(unique(track$1),object({album:id()}));crr(tracks$2);index(tracks$2,"album");primary(tracks$2,"id");const albums$2=unique(album);crr(albums$2);primary(albums$2,"id");const artists$1=assign(unique(artist),object({following:boolean()}));crr(artists$1);primary(artists$1,"id");const attribution=object({album:id(),artist:id()});crr(attribution);index(attribution,"artist");primary(attribution,"album","artist");const sources=object({source:string(),owner:id(),primary:boolean()});crr(sources);primary(sources,"owner","source");const assets=object({art:string(),thumbnail:nullable(string()),owner:id(),primary:boolean()});crr(assets);primary(assets,"owner","art");const playlists$1=assign(unique(playlist),object({order:string()}));crr(playlists$1);primary(playlists$1,"id");ordered(playlists$1,"order");index(playlists$1,"order","id");const library$1=object({id:id(),playlist:id(),track:id(),date:integer(),order:string()});crr(library$1);primary(library$1,"id");index(library$1,"date");index(library$1,"track");index(library$1,"playlist");index(library$1,"order","id");ordered(library$1,"order","playlist");const playback$1=object({id:id(),device:instance$1(Uint8Array),track:id(),order:string(),temp:any()});crr(playback$1);primary(playback$1,"id");index(playback$1,"device");index(playback$1,"order","id");ordered(playback$1,"order","device");const devices=object({id:instance$1(Uint8Array),playback:id(),direction:integer(),infinite:integer(),progress:number(),repeat:integer()});crr(devices);primary(devices,"id");const settings$1=object({key:string(),value:string()});crr(settings$1);index(settings$1,"value");primary(settings$1,"key");const history$1=object({query:string(),date:integer()});crr(history$1);index(history$1,"date");primary(history$1,"query");const schema=object({tracks:tracks$2,albums:albums$2,attribution,artists:artists$1,sources,assets,library:library$1,playlists:playlists$1,playback:playback$1,devices,settings:settings$1,history:history$1}),tracks$1=({store:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("library").where("playlist",">=",0).innerJoin("track","track.id","library.track").select(["track.id","track.title","track.duration","track.album","track.artists","track.sources","library.id as entry","library.date"]).orderBy("library.date","desc").orderBy("library.id").$castTo(),{async edit(e,t,n){const o=await e.updateTable("tracks").where("id","=",t).set({...n,album:void 0}).returning("album").executeTakeFirst();o!=null&&o.album&&n.album&&await e.updateTable("albums").where("id","=",o.album).set(n.album).execute()},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("tracks_fts").where("tracks_fts","match",sanitize(t)).orderBy("rank").innerJoin("track","track.id","rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",track$2).selectFrom("track").selectAll().where("id","=",t).$castTo().executeTakeFirstOrThrow()}}),albums$1=({store:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("album").selectAll().orderBy("album.title"),{async push(e,t){await pushAlbums(e,t)},async search(e,t,n=10,o=0){return t?e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("albums_fts").where("albums_fts","match",sanitize(t)).orderBy("rank").innerJoin("album","album.id","albums_fts.rowid").selectAll().limit(n).offset(o).$castTo().execute():[]},get(e,t){return e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).selectFrom("album").selectAll().where("album.id","=",t).$castTo().executeTakeFirstOrThrow()}}),feed$1=({store:r})=>r(e=>e.with("source",source).with("asset",asset).with("artist",artist$1).with("album",album$1).with("track",t=>track$2(t).innerJoin("library","library.track","tracks.id").select(["library.playlist","library.id as entry"]).orderBy("library.order").orderBy("library.id")).selectFrom("track").fullJoin("playlists","playlists.id","track.playlist").where("playlists.id","<",0).select(["playlists.id","playlists.title","playlists.relevancy","playlists.shared","playlists.remote",t=>json(t,{size:t.fn.count("track.duration"),duration:t.fn.coalesce(t.fn.sum("track.duration"),t.val(0)),tracks:groupJSON(t,{id:"track.id",entry:"track.entry",title:"track.title",duration:"track.duration",album:"track.album",artists:"track.artists",sources:"track.sources"}).filterWhere("track.id","is not",null)}).as("collection")]).groupBy("playlists.id").orderBy("playlists.order").orderBy("playlists.id").$castTo(),{async clear(e,t){await e.deleteFrom("library").where("playlist","=",t).execute()},async get(e,t,n=-1){return e.selectFrom("library").where("playlist","=",t).select("id").limit(n).execute().then(o=>o.map(l=>l.id))}}),connections=new Map,stores=r=>({playlists:playlists$2(r),resources:resources$1(r),preceding:preceding$1(r),playback:playback$2(r),upcoming:upcoming$1(r),settings:settings$2(r),history:history$2(r),artists:artists$2(r),library:library$2(r),albums:albums$1(r),tracks:tracks$1(r),feed:feed$1(r)});function connect(r){if(!connections.has(r.name)){const e=database(r.local?nocrr(schema):schema,r);connections.set(r.name,{...e,...stores(e)});const t=Object.assign({"../sql/cascade.sql":__vite_glob_0_0,"../sql/fts.sql":__vite_glob_0_1,"../sql/playback.sql":__vite_glob_0_2,"../sql/playlists.sql":__vite_glob_0_3});r.local&&delete t["../sql/fts.sql"];const n=Object.values(t).flatMap(o=>o.split(/\r?\n\r?\n/)).map(o=>sql.raw(o));e.update(o=>Promise.all(n.map(l=>l.execute(o))))}return connections.get(r.name)}function nocrr(r){return{...r,schema:Object.fromEntries(Object.entries(r.schema).map(([e,t])=>[e,{...t,crr:!1}]))}}function identity(r){return r}function pipeFromArray(r){return r.length===0?identity:r.length===1?r[0]:function(t){return r.reduce((n,o)=>o(n),t)}}function observable(r){const e={subscribe(t){let n=null,o=!1,l=!1,c=!1;function f(){if(n===null){c=!0;return}l||(l=!0,typeof n=="function"?n():n&&n.unsubscribe())}return n=r({next(h){var m;o||(m=t.next)==null||m.call(t,h)},error(h){var m;o||(o=!0,(m=t.error)==null||m.call(t,h),f())},complete(){var h;o||(o=!0,(h=t.complete)==null||h.call(t),f())}}),c&&f(),{unsubscribe:f}},pipe(...t){return pipeFromArray(t)(e)}};return e}function share(r){return e=>{let t=0,n=null;const o=[];function l(){n||(n=e.subscribe({next(f){var h;for(const m of o)(h=m.next)==null||h.call(m,f)},error(f){var h;for(const m of o)(h=m.error)==null||h.call(m,f)},complete(){var f;for(const h of o)(f=h.complete)==null||f.call(h)}}))}function c(){if(t===0&&n){const f=n;n=null,f.unsubscribe()}}return{subscribe(f){return t++,o.push(f),l(),{unsubscribe(){t--,c();const h=o.findIndex(m=>m===f);h>-1&&o.splice(h,1)}}}}}}class ObservableAbortError extends Error{constructor(e){super(e),this.name="ObservableAbortError",Object.setPrototypeOf(this,ObservableAbortError.prototype)}}function observableToPromise(r){let e;return{promise:new Promise((n,o)=>{let l=!1;function c(){l||(l=!0,o(new ObservableAbortError("This operation was aborted.")),f.unsubscribe())}const f=r.subscribe({next(h){l=!0,n(h),c()},error(h){l=!0,o(h),c()},complete(){l=!0,c()}});e=c}),abort:e}}function createChain(r){return observable(e=>{function t(o=0,l=r.op){const c=r.links[o];if(!c)throw new Error("No more links to execute - did you forget to add an ending link?");return c({op:l,next(h){return t(o+1,h)}})}return t().subscribe(e)})}function isObject(r){return!!r&&!Array.isArray(r)&&typeof r=="object"}function transformResultInner(r,e){if("error"in r){const n=e.transformer.deserialize(r.error);return{ok:!1,error:{...r,error:n}}}return{ok:!0,result:{...r.result,...(!r.result.type||r.result.type==="data")&&{type:"data",data:e.transformer.deserialize(r.result.data)}}}}class TransformResultError extends Error{constructor(){super("Unable to transform response from server")}}function transformResult(r,e){let t;try{t=transformResultInner(r,e)}catch{throw new TransformResultError}if(!t.ok&&(!isObject(t.error.error)||typeof t.error.error.code!="number"))throw new TransformResultError;if(t.ok&&!isObject(t.result))throw new TransformResultError;return t}function isTRPCClientError(r){return r instanceof TRPCClientError||r instanceof Error&&r.name==="TRPCClientError"}function isTRPCErrorResponse(r){return isObject(r)&&isObject(r.error)&&typeof r.error.code=="number"&&typeof r.error.message=="string"}class TRPCClientError extends Error{static from(e,t={}){const n=e;return isTRPCClientError(n)?(t.meta&&(n.meta={...n.meta,...t.meta}),n):isTRPCErrorResponse(n)?new TRPCClientError(n.error.message,{...t,result:n}):n instanceof Error?new TRPCClientError(n.message,{...t,cause:n}):new TRPCClientError("Unknown error",{...t,cause:n})}constructor(e,t){var o,l;const n=t==null?void 0:t.cause;super(e,{cause:n}),this.meta=t==null?void 0:t.meta,this.cause=n,this.shape=(o=t==null?void 0:t.result)==null?void 0:o.error,this.data=(l=t==null?void 0:t.result)==null?void 0:l.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,TRPCClientError.prototype)}}function invert(r){const e=Object.create(null);for(const t in r){const n=r[t];e[n]=t}return e}const TRPC_ERROR_CODES_BY_KEY={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};invert(TRPC_ERROR_CODES_BY_KEY);invert(TRPC_ERROR_CODES_BY_KEY);const noop=()=>{};function createInnerProxy(r,e){return new Proxy(noop,{get(n,o){if(!(typeof o!="string"||o==="then"))return createInnerProxy(r,[...e,o])},apply(n,o,l){const c=e[e.length-1]==="apply";return r({args:c?l.length>=2?l[1]:[]:l,path:c?e.slice(0,-1):e})}})}const createRecursiveProxy=r=>createInnerProxy(r,[]),createFlatProxy=r=>new Proxy(noop,{get(e,t){if(!(typeof t!="string"||t==="then"))return r(t)}});/* istanbul ignore next -- @preserve */const retryDelay=r=>r===0?0:Math.min(1e3*2**r,3e4);function createWSClient(r){const{url:e,WebSocket:t=WebSocket,retryDelayMs:n=retryDelay,onOpen:o,onClose:l}=r;/* istanbul ignore next -- @preserve */if(!t)throw new Error("No WebSocket implementation found - you probably don't want to use this on the server, but if you do you need to pass a `WebSocket`-ponyfill");let c=[];const f=Object.create(null);let h=0,m=null,b=null,E=A(),k="connecting";function L(){k!=="open"||m||(m=setTimeout(()=>{m=null,c.length===1?E.send(JSON.stringify(c.pop())):E.send(JSON.stringify(c)),c=[]}))}function I(){if(b!==null||k==="closed")return;const S=n(h++);w(S)}function p(){k="connecting";const S=E;E=A(),y(S)}function w(S){b||(k="connecting",b=setTimeout(p,S))}function y(S){Object.values(f).some(he=>he.ws===S)||S.close()}function _(){Object.values(f).forEach(S=>{S.type==="subscription"&&S.callbacks.complete()})}function R(S){c.some(F=>F.id===S.op.id)||j(S.op,S.callbacks)}function A(){const S=typeof e=="function"?e():e,F=new t(S);clearTimeout(b),b=null,F.addEventListener("open",()=>{/* istanbul ignore next -- @preserve */F===E&&(h=0,k="open",o==null||o(),L())}),F.addEventListener("error",()=>{F===E&&I()});const he=$=>{if($.method==="reconnect"&&F===E){k==="open"&&(l==null||l()),p();for(const z of Object.values(f))z.type==="subscription"&&R(z)}},G=$=>{var H,ue;const z=$.id!==null&&f[$.id];if(z){if((ue=(H=z.callbacks).next)==null||ue.call(H,$),z.ws!==E&&F===E){const X=z.ws;z.ws=E,y(X)}"result"in $&&$.result.type==="stopped"&&F===E&&z.callbacks.complete()}};return F.addEventListener("message",({data:$})=>{const z=JSON.parse($);"method"in z?he(z):G(z),(F!==E||k==="closed")&&y(F)}),F.addEventListener("close",({code:$})=>{var z,H,ue,X;k==="open"&&(l==null||l({code:$})),E===F&&I();for(const[oe,ye]of Object.entries(f))if(ye.ws===F){if(k==="closed"){delete f[oe],(H=(z=ye.callbacks).complete)==null||H.call(z);continue}ye.type==="subscription"?R(ye):(delete f[oe],(X=(ue=ye.callbacks).error)==null||X.call(ue,TRPCClientError.from(new TRPCWebSocketClosedError("WebSocket closed prematurely"))))}}),F}function j(S,F){const{type:he,input:G,path:$,id:z}=S,H={id:z,method:he,params:{input:G,path:$}};return f[z]={ws:E,type:he,callbacks:F,op:S},c.push(H),L(),()=>{var X,oe;const ue=(X=f[z])==null?void 0:X.callbacks;delete f[z],c=c.filter(ye=>ye.id!==z),(oe=ue==null?void 0:ue.complete)==null||oe.call(ue),E.readyState===t.OPEN&&S.type==="subscription"&&(c.push({id:z,method:"subscription.stop"}),L())}}return{close:()=>{k="closed",l==null||l(),_(),y(E),clearTimeout(b),b=null},request:j,getConnection(){return E}}}class TRPCWebSocketClosedError extends Error{constructor(e){super(e),this.name="TRPCWebSocketClosedError",Object.setPrototypeOf(this,TRPCWebSocketClosedError.prototype)}}function wsLink(r){return e=>{const{client:t}=r;return({op:n})=>observable(o=>{const{type:l,path:c,id:f,context:h}=n,m=e.transformer.serialize(n.input),b=t.request({type:l,path:c,input:m,id:f,context:h},{error(E){o.error(E),b()},complete(){o.complete()},next(E){const k=transformResult(E,e);if(!k.ok){o.error(TRPCClientError.from(k.error));return}o.next({result:k.result}),n.type!=="subscription"&&(b(),o.complete())}});return()=>{b()}})}}class TRPCUntypedClient{$request({type:e,input:t,path:n,context:o={}}){return createChain({links:this.links,op:{id:++this.requestId,type:e,path:n,input:t,context:o}}).pipe(share())}requestAsPromise(e){const t=this.$request(e),{promise:n,abort:o}=observableToPromise(t);return new Promise((c,f)=>{var h;(h=e.signal)==null||h.addEventListener("abort",o),n.then(m=>{c(m.result.data)}).catch(m=>{f(TRPCClientError.from(m))})})}query(e,t,n){return this.requestAsPromise({type:"query",path:e,input:t,context:n==null?void 0:n.context,signal:n==null?void 0:n.signal})}mutation(e,t,n){return this.requestAsPromise({type:"mutation",path:e,input:t,context:n==null?void 0:n.context,signal:n==null?void 0:n.signal})}subscription(e,t,n){return this.$request({type:"subscription",path:e,input:t,context:n==null?void 0:n.context}).subscribe({next(l){var c,f,h;l.result.type==="started"?(c=n.onStarted)==null||c.call(n):l.result.type==="stopped"?(f=n.onStopped)==null||f.call(n):(h=n.onData)==null||h.call(n,l.result.data)},error(l){var c;(c=n.onError)==null||c.call(n,l)},complete(){var l;(l=n.onComplete)==null||l.call(n)}})}constructor(e){this.requestId=0;const t=(()=>{const n=e.transformer;return n?"input"in n?e.transformer:{input:n,output:n}:{input:{serialize:o=>o,deserialize:o=>o},output:{serialize:o=>o,deserialize:o=>o}}})();this.runtime={transformer:{serialize:n=>t.input.serialize(n),deserialize:n=>t.output.deserialize(n)},combinedTransformer:t},this.links=e.links.map(n=>n(this.runtime))}}const clientCallTypeMap={query:"query",mutate:"mutation",subscribe:"subscription"},clientCallTypeToProcedureType=r=>clientCallTypeMap[r];function createTRPCClientProxy(r){return createFlatProxy(e=>r.hasOwnProperty(e)?r[e]:e==="__untypedClient"?r:createRecursiveProxy(({path:t,args:n})=>{const o=[e,...t],l=clientCallTypeToProcedureType(o.pop()),c=o.join(".");return r[l](c,...n)}))}function createTRPCProxyClient(r){const e=new TRPCUntypedClient(r);return createTRPCClientProxy(e)}var zo;const{sync,search:search$1,streams,expand,desource,transcribe}=createTRPCProxyClient({links:[(zo=globalThis.localStorage)!=null&&zo.getItem("remote")?wsLink({client:createWSClient({url:()=>localStorage.getItem("remote")})}):()=>()=>observable(()=>{})]}),{playlists,resources,preceding,playback,upcoming,settings,history,artists,library,albums,tracks,update,feed}=connect({name:"library.db",push:sync.push.mutate,pull:sync.pull.subscribe}),search=writable(""),extra=writable(null);function format(r,e=!1){if(!e){r=Math.round(+r),r<=0&&(r=0);const f=~~(r/3600);r-=f*3600;const h=~~(r/60);r-=h*60;const m=r,b=E=>E.toString().padStart(2,"0");return f?`${f}:${b(h)}:${b(m)}`:`${h}:${b(m)}`}const t=new Intl.RelativeTimeFormat("en"),n=Math.floor((Date.now()-+r)/1e3),o=Math.floor(n/60),l=Math.floor(o/60),c=Math.floor(l/24);return n<=1?"just now":n<60?t.format(-n,"seconds"):o<60?t.format(-o,"minutes"):l<24?t.format(-l,"hours"):t.format(-c,"days")}function compare(r){const e=new Date;return+r>+e?"In The Future":r.getFullYear()===e.getFullYear()?r.getMonth()===e.getMonth()?e.getDate()-r.getDate()===0?"Today":e.getDate()-r.getDate()===1?"Yesterday":e.getDate()-r.getDate()<7&&e.getDay()>r.getDay()?"This Week":e.getDate()-r.getDate()<7||e.getDate()-r.getDate()<14&&e.getDay()>=r.getDay()?"Last Week":"This Month":e.getMonth()-r.getMonth()===1?"Last Month":`In ${r.toLocaleString("default",{month:"long"})}`:r.getFullYear().toString()}const get_default_slot_changes=r=>({}),get_default_slot_context=r=>({slot:"after"});function create_default_slot_6(r){let e;return{c(){e=text(r[4])},l(t){e=claim_text(t,r[4])},m(t,n){insert_hydration(t,e,n)},p(t,n){n&16&&set_data(e,t[4])},d(t){t&&detach(e)}}}function create_default_slot_5(r){let e,t,n,o;return n=new Text({props:{secondary:!0,$$slots:{default:[create_default_slot_6]},$$scope:{ctx:r}}}),{c(){e=text(r[5]),t=space(),create_component(n.$$.fragment)},l(l){e=claim_text(l,r[5]),t=claim_space(l),claim_component(n.$$.fragment,l)},m(l,c){insert_hydration(l,e,c),insert_hydration(l,t,c),mount_component(n,l,c),o=!0},p(l,c){(!o||c&32)&&set_data(e,l[5]);const f={};c&1040&&(f.$$scope={dirty:c,ctx:l}),n.$set(f)},i(l){o||(transition_in(n.$$.fragment,l),o=!0)},o(l){transition_out(n.$$.fragment,l),o=!1},d(l){l&&(detach(e),detach(t)),destroy_component(n,l)}}}function create_default_slot_4(r){var n;let e=((n=r[3])==null?void 0:n.artists.map(func).join(", "))+"",t;return{c(){t=text(e)},l(o){t=claim_text(o,e)},m(o,l){insert_hydration(o,t,l)},p(o,l){var c;l&8&&e!==(e=((c=o[3])==null?void 0:c.artists.map(func).join(", "))+"")&&set_data(t,e)},d(o){o&&detach(t)}}}function create_if_block(r){let e,t;return e=new When({props:{lg:!0,$$slots:{default:[create_default_slot_2]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const l={};o&1032&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_default_slot_3(r){var n;let e=((n=r[3])==null?void 0:n.album.title)+"",t;return{c(){t=text(e)},l(o){t=claim_text(o,e)},m(o,l){insert_hydration(o,t,l)},p(o,l){var c;l&8&&e!==(e=((c=o[3])==null?void 0:c.album.title)+"")&&set_data(t,e)},d(o){o&&detach(t)}}}function create_default_slot_2(r){let e,t;return e=new Text({props:{secondary:!0,sm:!0,loading:!r[3],$$slots:{default:[create_default_slot_3]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,o){const l={};o&8&&(l.loading=!n[3]),o&1032&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}function create_default_slot_1(r){let e,t,n,o,l,c,f=`scaleX(${r[1]})`,h;e=new Text({props:{accent:!0,loading:!r[3],$$slots:{default:[create_default_slot_5]},$$scope:{ctx:r}}}),n=new Text({props:{secondary:!0,sm:!0,loading:!r[3],$$slots:{default:[create_default_slot_4]},$$scope:{ctx:r}}});let m=!r[0]&&create_if_block(r);return{c(){create_component(e.$$.fragment),t=space(),create_component(n.$$.fragment),o=space(),m&&m.c(),l=space(),c=element("div"),this.h()},l(b){claim_component(e.$$.fragment,b),t=claim_space(b),claim_component(n.$$.fragment,b),o=claim_space(b),m&&m.l(b),l=claim_space(b),c=claim_element(b,"DIV",{class:!0}),children(c).forEach(detach),this.h()},h(){attr(c,"class","absolute bottom-0 left-0 h-0.5 w-full origin-left transform-gpu bg-highlight-200 transition-transform duration-1000"),set_style(c,"transform",f)},m(b,E){mount_component(e,b,E),insert_hydration(b,t,E),mount_component(n,b,E),insert_hydration(b,o,E),m&&m.m(b,E),insert_hydration(b,l,E),insert_hydration(b,c,E),h=!0},p(b,E){const k={};E&8&&(k.loading=!b[3]),E&1072&&(k.$$scope={dirty:E,ctx:b}),e.$set(k);const L={};E&8&&(L.loading=!b[3]),E&1032&&(L.$$scope={dirty:E,ctx:b}),n.$set(L),b[0]?m&&(group_outros(),transition_out(m,1,1,()=>{m=null}),check_outros()):m?(m.p(b,E),E&1&&transition_in(m,1)):(m=create_if_block(b),m.c(),transition_in(m,1),m.m(l.parentNode,l)),E&2&&f!==(f=`scaleX(${b[1]})`)&&set_style(c,"transform",f)},i(b){h||(transition_in(e.$$.fragment,b),transition_in(n.$$.fragment,b),transition_in(m),h=!0)},o(b){transition_out(e.$$.fragment,b),transition_out(n.$$.fragment,b),transition_out(m),h=!1},d(b){b&&(detach(t),detach(o),detach(l),detach(c)),destroy_component(e,b),destroy_component(n,b),m&&m.d(b)}}}function create_default_slot(r){var l;let e,t,n=`hue-rotate(${((l=r[3])==null?void 0:l.id)||0}deg)`,o;return t=new Icon({props:{name:"note"}}),{c(){e=element("div"),create_component(t.$$.fragment),this.h()},l(c){e=claim_element(c,"DIV",{class:!0});var f=children(e);claim_component(t.$$.fragment,f),f.forEach(detach),this.h()},h(){attr(e,"class","flex h-full w-full items-center justify-center bg-gradient-to-r from-rose-400 to-red-400 text-white"),set_style(e,"filter",n)},m(c,f){insert_hydration(c,e,f),mount_component(t,e,null),o=!0},p(c,f){var h;f&8&&n!==(n=`hue-rotate(${((h=c[3])==null?void 0:h.id)||0}deg)`)&&set_style(e,"filter",n)},i(c){o||(transition_in(t.$$.fragment,c),o=!0)},o(c){transition_out(t.$$.fragment,c),o=!1},d(c){c&&detach(e),destroy_component(t)}}}function create_before_slot(r){var n,o;let e,t;return e=new Image({props:{src:r[3]?((n=r[3].album.arts)==null?void 0:n[0])||"":void 0,thumbnail:r[3]?((o=r[3].album.thumbnails)==null?void 0:o[0])||"":void 0,slot:"before",$$slots:{default:[create_default_slot]},$$scope:{ctx:r}}}),{c(){create_component(e.$$.fragment)},l(l){claim_component(e.$$.fragment,l)},m(l,c){mount_component(e,l,c),t=!0},p(l,c){var h,m;const f={};c&8&&(f.src=l[3]?((h=l[3].album.arts)==null?void 0:h[0])||"":void 0),c&8&&(f.thumbnail=l[3]?((m=l[3].album.thumbnails)==null?void 0:m[0])||"":void 0),c&1032&&(f.$$scope={dirty:c,ctx:l}),e.$set(f)},i(l){t||(transition_in(e.$$.fragment,l),t=!0)},o(l){transition_out(e.$$.fragment,l),t=!1},d(l){destroy_component(e,l)}}}function create_after_slot(r){let e;const t=r[7].default,n=create_slot(t,r,r[10],get_default_slot_context);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&1024)&&update_slot_base(n,t,o,o[10],e?get_slot_changes(t,o[10],l,get_default_slot_changes):get_all_dirty_from_scope(o[10]),get_default_slot_context)},i(o){e||(transition_in(n,o),e=!0)},o(o){transition_out(n,o),e=!1},d(o){n&&n.d(o)}}}function create_fragment(r){let e,t;return e=new Card({props:{sm:!0,flat:!0,flow:!r[0],interactive:!0,selected:r[2],$$slots:{after:[create_after_slot],before:[create_before_slot],default:[create_default_slot_1]},$$scope:{ctx:r}}}),e.$on("contextmenu",r[8]),e.$on("click",r[9]),{c(){create_component(e.$$.fragment)},l(n){claim_component(e.$$.fragment,n)},m(n,o){mount_component(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.flow=!n[0]),o&4&&(l.selected=n[2]),o&1083&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(transition_in(e.$$.fragment,n),t=!0)},o(n){transition_out(e.$$.fragment,n),t=!1},d(n){destroy_component(e,n)}}}const func=r=>r.title;function instance(r,e,t){let n,o,l,{$$slots:c={},$$scope:f}=e,{sm:h=!1}=e,{progress:m=0}=e,{selected:b=!1}=e,{track:E=void 0}=e;function k(I){bubble.call(this,r,I)}function L(I){bubble.call(this,r,I)}return r.$$set=I=>{"sm"in I&&t(0,h=I.sm),"progress"in I&&t(1,m=I.progress),"selected"in I&&t(2,b=I.selected),"track"in I&&t(3,E=I.track),"$$scope"in I&&t(10,f=I.$$scope)},r.$$.update=()=>{r.$$.dirty&8&&t(5,[n=void 0,...o]=(E==null?void 0:E.title.split("("))||[],n,(t(6,o),t(3,E))),r.$$.dirty&64&&t(4,l=o.length?"("+o.join("("):"")},[h,m,b,E,l,n,o,c,k,L,f]}class Track extends SvelteComponent{constructor(e){super(),init$1(this,e,instance,create_fragment,safe_not_equal,{sm:0,progress:1,selected:2,track:3})}}export{Card as C,Image as I,Portal as P,Realm as R,Track as T,Virtual as V,When as W,extra as a,streams as b,capitalize as c,search$1 as d,ensure_array_like as e,albums as f,artists as g,history as h,initRealm as i,expand as j,playback as k,library as l,feed as m,Text as n,outro_and_destroy_block as o,playlists as p,format as q,ready as r,search as s,tracks as t,update_keyed_each as u,hold as v,compare as w,upcoming as x,desource as y};
